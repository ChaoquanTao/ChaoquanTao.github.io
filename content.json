{"meta":{"title":"Tau's Blog","subtitle":"","description":"å¤§éŸ³å¸Œå£° å¤§è±¡æ— å½¢","author":"Tau","url":"http://example.com","root":"/"},"pages":[{"title":"","date":"2023-03-19T04:16:14.892Z","updated":"2023-03-19T04:16:14.873Z","comments":true,"path":"about/index.html","permalink":"http://example.com/about/index.html","excerpt":"","text":"202104 è‡³ä»Šï¼šç¾å›¢ç‚¹è¯„"},{"title":"æ‰€æœ‰æ ‡ç­¾","date":"2023-03-05T10:10:06.298Z","updated":"2023-03-05T10:10:06.277Z","comments":true,"path":"tags/index.html","permalink":"http://example.com/tags/index.html","excerpt":"","text":""},{"title":"æ‰€æœ‰åˆ†ç±»","date":"2023-03-05T10:08:24.455Z","updated":"2023-03-05T10:08:24.435Z","comments":true,"path":"categories/index.html","permalink":"http://example.com/categories/index.html","excerpt":"","text":""},{"title":"å…³äº","date":"2017-05-27T05:47:40.000Z","updated":"2023-03-05T09:49:53.526Z","comments":true,"path":"friends/index.html","permalink":"http://example.com/friends/index.html","excerpt":"","text":""}],"posts":[{"title":"èŠä¸€èŠlinuxä¸­çš„tcå‘½ä»¤","slug":"èŠä¸€èŠlinuxä¸­çš„tcå‘½ä»¤","date":"2023-05-25T13:00:00.000Z","updated":"2023-05-29T14:17:39.326Z","comments":true,"path":"2023/05/25/èŠä¸€èŠlinuxä¸­çš„tcå‘½ä»¤/","link":"","permalink":"http://example.com/2023/05/25/%E8%81%8A%E4%B8%80%E8%81%8Alinux%E4%B8%AD%E7%9A%84tc%E5%91%BD%E4%BB%A4/","excerpt":"","text":"æœ€è¿‘æ‚äº‹å¤ªå¤šï¼Œåˆæ˜¯ç»„ç»‡æ¶æ„è°ƒæ•´ï¼Œåˆæ˜¯æ¢å·¥ä½œï¼Œæœ€è¿‘ç»ˆäºæœ‰ç©ºèƒ½å†™ä¸‹è¿™è¾¹æ–‡ç« äº†ã€‚ tc (Traffic Controll) ä½œä¸ºlinuxä¸­çš„æµé‡æ§åˆ¶å·¥å…·ï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œå¯ä»¥å¯¹ç½‘ç»œæµé‡çš„é€Ÿç‡ã€å»¶è¿Ÿã€å¸¦å®½ç­‰è¿›è¡Œæ§åˆ¶ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç»tcå‘½ä»¤çš„ç»“æ„å’Œä½¿ç”¨ï¼Œå¤šæ•°å†…å®¹æ¥è‡ªäºå¯¹å‚è€ƒæ–‡ç« çš„ç¿»è¯‘å’Œæ•´ç†ï¼Œå¹¶å¢åŠ äº†ä¸€äº›è§£é‡Šå’Œè¯´æ˜ï¼Œå¸®åŠ©å¤§å®¶åœ¨å·¥ä½œä¸­èƒ½å¤Ÿå¿«é€Ÿç†è§£å’Œä½¿ç”¨è¯¥å‘½ä»¤ã€‚ ä»€ä¹ˆæ˜¯tcå‘½ä»¤?ä¸€è¨€ä»¥è”½ä¹‹ï¼Œtcæ˜¯linuxä¸­çš„ä¸€ä¸ªæµé‡æ§åˆ¶å·¥å…·ï¼Œå®ƒèƒ½å¤Ÿæ§åˆ¶æŒ‡å®šç±»å‹çš„ç½‘ç»œåŒ…ä»¥æŒ‡å®šçš„é€Ÿç‡å’ŒæŒ‡å®šçš„é¡ºåºä»æŒ‡å®šç½‘å¡è¿›æ¥æˆ–å‡ºå»ã€‚ tcå‘½ä»¤æœ‰ä»€ä¹ˆç”¨åŸºäºtcå‘½ä»¤çš„å¼ºå¤§èƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥åšå¾ˆå¤šæœ‰è¶£çš„äº‹ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥å¯¹ç½‘ç»œå¸¦å®½æŒ‰ç…§æµé‡ç±»å‹è¿›è¡Œé™é€Ÿï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬é™åˆ¶ç‰¹å®šåº”ç”¨ç¨‹åºæˆ–ç½‘ç»œæ¥å£çš„å¸¦å®½ä½¿ç”¨ï¼›åœ¨å®é™…çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨tcå‘½ä»¤å»æ¨¡æ‹Ÿä¸€äº›ç½‘ç»œå»¶è¿Ÿã€ç½‘ç»œä¸¢åŒ…çš„æ•…éšœï¼Œä»¥æ­¤éªŒè¯æˆ‘ä»¬çš„ç³»ç»Ÿèƒ½å¦åº”å¯¹ç½‘ç»œæŠ–åŠ¨ã€‚ tcçš„åŸç† è¿™éƒ¨åˆ†çš„å†…å®¹æ¯”è¾ƒç”Ÿç¡¬ï¼Œå¦‚æœå¤§å®¶çœ‹ç€æ¯”è¾ƒæ‡µçš„è¯ï¼Œå¯ä»¥å…ˆçœ‹ä¸‹ä¸€èŠ‚å¦‚ä½•ä½¿ç”¨çš„éƒ¨åˆ†ï¼Œç„¶åå¸¦ç€ç–‘é—®æ¥çœ‹è¿™ä¸€èŠ‚ã€‚ tcåœ¨é€»è¾‘ä¸Šæ˜¯ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼Œä¸»è¦ç”±ä»¥ä¸‹é˜Ÿåˆ—(qdisc)ï¼Œç±»åˆ«(class)ï¼Œè¿‡æ»¤å™¨(filter)æ„æˆï¼Œå…¶ä¸­é˜Ÿåˆ—å’Œç±»åˆ«å¯ä»¥é™„ç€è¿‡æ»¤å™¨ï¼Œç”¨äºå¯¹å½“å‰é˜Ÿåˆ—ä¸­çš„æµé‡è¿›è¡Œè¿‡æ»¤å’ŒåŒ¹é…ï¼Œå¹¶å°†å‘½ä¸­çš„æµé‡å‘å¾€ä¸‹ä¸€çº§ï¼Œå¤§è‡´ç»“æ„å¦‚ä¸‹ï¼š qdiscqdisc (queue discipline)å³é˜Ÿåˆ—ï¼Œlinuxç½‘ç»œä¸­æ¯ä¸ªè¿›å…¥ç½‘å¡çš„æµé‡éƒ½ä¼šè¿›å…¥ä¸€ä¸ªé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—åˆ†ä¸ºæœ‰ç±»åˆ«çš„é˜Ÿåˆ— (classful qdiscs)å’Œæ— ç±»åˆ«çš„é˜Ÿåˆ— (classless qdiscs)ï¼Œæœ‰ç±»åˆ«çš„é˜Ÿåˆ—ä¸‹å¯ä»¥æ·»åŠ ä¸€ä¸ªç±»åˆ« (class)ï¼Œè¿™ä¸ªç±»åˆ«ä¸Šå¯ä»¥æŒ‚è½½è¿‡æ»¤å™¨ (filter)ï¼›æ— ç±»åˆ«é˜Ÿåˆ—é¡¾åæ€ä¹‰ï¼Œé‡Œé¢ä¸èƒ½æ·»åŠ åˆ†ç±»ï¼Œæ˜¯ä¸€ç§æ¯”è¾ƒç®€å•çš„é˜Ÿåˆ—ã€‚tcé»˜è®¤çš„é˜Ÿåˆ—çš„fifo (å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—)ã€‚ æˆ‘ä»¬åœ¨ä½¿ç”¨ä¸­ä¼šå¸¸çœ‹åˆ°root qdisc, å…¶æŒ‡çš„æ˜¯å‡ºç«™(egress)çš„æ ¹é˜Ÿåˆ—ï¼Œtcçš„å¤§å¤šæ•°é…ç½®ä¹Ÿéƒ½æ˜¯åœ¨å‡ºç«™é˜Ÿåˆ—é‡Œé…çš„ï¼Œè€Œéå…¥ç«™(ingress)é˜Ÿåˆ—ï¼Œè¿™æ˜¯å› ä¸ºå…¥ç«™é˜Ÿåˆ—èƒ½å¤Ÿé…ç½®çš„è§„åˆ™æœ‰é™ï¼Œä¸å¦‚å‡ºç«™é˜Ÿåˆ—çš„é…ç½®çµæ´»ã€‚ qdiscåˆ†ç±»qdiscåˆ†ç±»å¦‚ä¸‹ï¼Œæ¯ç§é˜Ÿåˆ—çš„é€‚ç”¨åœºæ™¯ä¸åŒï¼Œä¸‹é¢æ˜¯è¿™äº›é˜Ÿåˆ—ä¸€èˆ¬æ€§çš„å®šä¹‰ï¼š pfifo (Packet First-In, First-Out): ä½¿ç”¨ç®€å•çš„FIFOæ’é˜Ÿç®—æ³•è¿›è¡Œæ•°æ®åŒ…è°ƒåº¦ï¼ŒæŒ‰ç…§å…ˆåˆ°å…ˆæœåŠ¡çš„åŸåˆ™è¿›è¡Œå¤„ç†ã€‚ bfifo (Byte First-In, First-Out): ç±»ä¼¼äºpfifoï¼Œä½†æŒ‰ç…§æ•°æ®åŒ…çš„å­—èŠ‚æ•°è¿›è¡Œè°ƒåº¦å’Œå¤„ç†ã€‚ sfq (Stochastic Fairness Queueing): ä½¿ç”¨éšæœºå…¬å¹³é˜Ÿåˆ—è°ƒåº¦ç®—æ³•ï¼Œå°†æ•°æ®åŒ…åˆ†é…åˆ°å¤šä¸ªå°é˜Ÿåˆ—ä¸­ï¼Œä»¥å®ç°å…¬å¹³çš„å¸¦å®½å…±äº«ã€‚ tbf (Token Bucket Filter): ä½¿ç”¨ä»¤ç‰Œæ¡¶ç®—æ³•å¯¹æ•°æ®åŒ…è¿›è¡Œè°ƒåº¦å’Œæ§åˆ¶ï¼Œé™åˆ¶ä¼ è¾“é€Ÿç‡å’Œçªå‘ä¼ è¾“é‡ã€‚ htb (Hierarchical Token Bucket): æä¾›å±‚æ¬¡åŒ–çš„æµé‡æ§åˆ¶å’Œä¼˜å…ˆçº§ç®¡ç†ï¼Œå¯ä»¥åˆ›å»ºå¤šä¸ªå­é˜Ÿåˆ—å’Œå­ç±»åˆ«ï¼Œå¹¶ä¸ºæ¯ä¸ªå­é˜Ÿåˆ—åº”ç”¨ä¸åŒçš„æµé‡æ§åˆ¶ç­–ç•¥ã€‚ prio (Priority Queueing): å…è®¸ç”¨æˆ·ä¸ºä¸åŒçš„æ•°æ®æµè®¾ç½®ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œæ•°æ®åŒ…æŒ‰ç…§ä¼˜å…ˆçº§è¿›è¡Œæ’é˜Ÿå’Œå‘é€ã€‚ red (Random Early Detection): ä½¿ç”¨éšæœºæ—©æœŸæ£€æµ‹ç®—æ³•å¯¹æ•°æ®åŒ…è¿›è¡Œè°ƒåº¦ï¼Œä»¥é¿å…ç½‘ç»œæ‹¥å¡å’Œæ•°æ®åŒ…ä¸¢å¤±ã€‚ cbq (Class-Based Queueing): æä¾›åŸºäºç±»åˆ«çš„é˜Ÿåˆ—è°ƒåº¦å’Œæµé‡ç®¡ç†ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„ç±»åˆ«è®¾ç½®ä¸åŒçš„å¸¦å®½é™åˆ¶å’Œä¼˜å…ˆçº§ã€‚ classclasså³ç±»åˆ«ï¼Œç±»åˆ«æ˜¯ä»¥é€’å½’çš„ç»“æ„ä¾é™„äºé˜Ÿåˆ—å­˜åœ¨çš„ï¼Œå³é˜Ÿåˆ—ä¸‹å¯ä»¥æ·»åŠ ç±»åˆ«ï¼Œè€Œç±»åˆ«ä¸‹åˆå¯ä»¥æ·»åŠ å­ç±»åˆ«æˆ–é˜Ÿåˆ—ã€‚æ¯ä¸ªç±»åˆ«ä¼šåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨ (filter)ï¼Œè¿™äº›è¿‡æ»¤å™¨å¯ä»¥ç”¨äºç­›é€‰å“ªäº›æµé‡å¯ä»¥è¿›å…¥å“ªäº›å­ç±»åˆ«æˆ–å­é˜Ÿåˆ—ã€‚ filterfilterå³è¿‡æ»¤å™¨ï¼Œfilterå¯ä»¥ä¾é™„äºclassæˆ–qdiscï¼Œç”¨ä»¥è¿‡æ»¤å“ªäº›æµé‡å¯ä»¥è¿›å…¥ä¸‹ä¸€é˜¶æ®µã€‚ä½œä¸ºä¸€ä¸ªfilterï¼š å¿…é¡»åŒ…å«ä¸€ä¸ªclassifier å¯ä»¥åŒ…å«ä¸€ä¸ªpolicer classifierclassifierå³è¿‡æ»¤å™¨ï¼Œç”¨ä»¥ç¡®å®šè¦å°†æ•°æ®åŒ…å‘å¾€å“ªä¸ªç±»åˆ«ã€‚æœ€å¸¸è§çš„å°±æ˜¯u32è¿‡æ»¤å™¨ï¼Œå¯ä»¥è®¤ä¸ºclassifieræ˜¯filterçš„ä¸€éƒ¨åˆ†ï¼Œç”¨æ¥è¯†åˆ«æµé‡åŒ…çš„ä¸€äº›ç‰¹å¾å±æ€§ã€‚ policerä¹Ÿæ˜¯filterçš„ä¸€éƒ¨åˆ†ã€‚å¯ä»¥é™åˆ¶ç½‘ç»œåŒ…å…¥é˜Ÿçš„é€Ÿç‡ï¼Œå¯ä»¥ç”¨äºä¸¢å¼ƒ(drop)ç½‘ç»œåŒ…ã€‚ handleç”¨äºæ ‡è¯†classæˆ–classful qdisc, ç”±major numberå’Œminor numberç»„æˆï¼š major number: å¯ä»¥éšä¾¿å‘½å Minor numner: å¦‚æœä¸º0ï¼Œè¡¨ç¤ºå½“å‰handleæœªqdiscï¼Œå…¶ä»–é0æ•°å­—è¡¨ç¤ºå½“å‰handleä¸ºclassï¼ŒåŒä¸€çˆ¶èŠ‚ç‚¹ä¸‹çš„classçš„minor numberç›¸åŒã€‚ â€‹ &gt; ffff:0è¡¨ç¤ºå…¥ç«™é˜Ÿåˆ— 123456789root 1: | _1:1_ / | \\ / | \\ / | \\ 10: 11: 12: / \\ / \\10:1 10:2 12:1 12:2 å¯¹äºä¸Šè¿°ç»“æ„ï¼Œroot 1: è¡¨ç¤ºæ ¹é˜Ÿåˆ—ï¼Œæ ¹é˜Ÿåˆ—ä¸‹æœ‰ä¸€ä¸ªç±»åˆ«1:1ï¼Œç±»åˆ«ä¸‹æœ‰ä¸‰ä¸ªé˜Ÿåˆ—10:ï¼Œ11:, 12:ï¼Œé˜Ÿåˆ—10:ä¸‹æœ‰10:1å’Œ10:2ä¸¤ä¸ªç±»åˆ«ï¼Œé˜Ÿåˆ—12:ä¸‹æœ‰12:1å’Œ12:2ä¸¤ä¸ªç±»åˆ«ã€‚ å¦‚ä½•ä½¿ç”¨ç»å†ä¸Šé¢è¿™äº›ç”Ÿç¡¬çš„æ¦‚å¿µåï¼Œä¸‹é¢æˆ‘ä»¬ä»å®æˆ˜å‡ºå‘ï¼Œçœ‹ä¸‹tcå‘½ä»¤çš„ä½¿ç”¨ã€‚ case 1: æ·»åŠ ä¸€ä¸ªé˜Ÿåˆ—12345tc qdisc add \\ â‘ &gt; dev eth0 \\ â‘¡&gt; root \\ â‘¢&gt; handle 1:0 \\ â‘£&gt; htb â‘¤ tc qdisc add: æ·»åŠ ä¸€ä¸ªé˜Ÿåˆ—è°ƒåº¦å™¨è§„åˆ™ã€‚ dev eth0: æŒ‡å®šè¦åº”ç”¨è¯¥è§„åˆ™çš„ç½‘ç»œæ¥å£ï¼Œè¿™é‡Œæ˜¯ä»¥å¤ªç½‘æ¥å£eth0ã€‚ root: æŒ‡å®šè¯¥è§„åˆ™ä¸ºæ ¹ï¼ˆrootï¼‰é˜Ÿåˆ—ï¼Œå³å‡ºç«™é˜Ÿåˆ—egressï¼Œè¡¨ç¤ºå®ƒæ˜¯é˜Ÿåˆ—è°ƒåº¦å™¨çš„é¡¶å±‚é˜Ÿåˆ—ã€‚ handle 1:0: æŒ‡å®šé˜Ÿåˆ—çš„å¤„ç†æ ‡è¯†ç¬¦ï¼ˆhandleï¼‰ï¼Œè¿™é‡Œæ˜¯1:0ã€‚è¯¥æ ‡è¯†ç¬¦ç”¨äºå”¯ä¸€æ ‡è¯†è¯¥é˜Ÿåˆ—ï¼Œç¬¬ä¸€ä¸ªæ•°å­—å¯ä»¥éšæ„æŒ‡å®šï¼Œç¬¬äºŒä¸ªæ•°å­—ä¸º0è¡¨ç¤ºé˜Ÿåˆ—ï¼Œä¹Ÿå¯ä»¥ç®€å†™ä¸º1:ã€‚ htb: æŒ‡å®šé˜Ÿåˆ—è°ƒåº¦å™¨çš„ç±»å‹ä¸ºâ€Hierarchical Token Bucketâ€ï¼ˆå±‚æ¬¡ä»¤ç‰Œæ¡¶ï¼‰ç±»å‹ï¼Œå®ƒæ˜¯ä¸€ç§æµé‡è°ƒåº¦ç®—æ³•ã€‚ case 2: æ·»åŠ ä¸€ä¸ªç®€å•class1234567tc class add \\ â‘ &gt; dev eth0 \\ â‘¡&gt; parent 1:1 \\ â‘¢&gt; classid 1:6 \\ â‘£&gt; htb \\ â‘¤&gt; rate 256kbit \\ â‘¥&gt; ceil 512kbit :seven tc class add: æ·»åŠ ä¸€ä¸ªç±»åˆ«è§„åˆ™ã€‚ dev eth0: æŒ‡å®šè¦åº”ç”¨è¯¥è§„åˆ™çš„ç½‘ç»œæ¥å£ï¼Œè¿™é‡Œæ˜¯ä»¥å¤ªç½‘æ¥å£eth0ã€‚ parent 1:1: æŒ‡å®šçˆ¶ç±»åˆ«çš„æ ‡è¯†ç¬¦ï¼Œè¯¥ç±»åˆ«æ˜¯1:1ï¼Œç”±äºminor numberé0ï¼Œè¡¨ç¤ºparentä¹Ÿæ˜¯ä¸ªclassã€‚ classid 1:6: æŒ‡å®šå½“å‰ç±»åˆ«çš„æ ‡è¯†ç¬¦ï¼Œè¯¥ç±»åˆ«æ˜¯1:6ã€‚ htb: æŒ‡å®šç±»åˆ«çš„ç±»å‹ä¸ºâ€Hierarchical Token Bucketâ€ï¼ˆå±‚æ¬¡ä»¤ç‰Œæ¡¶ï¼‰ç±»å‹ï¼Œå®ƒæ˜¯ä¸€ç§æµé‡æ§åˆ¶ç®—æ³•ã€‚ rate 256kbit: è®¾ç½®ç±»åˆ«çš„æœ€å¤§ä¼ è¾“é€Ÿç‡ä¸º256 kbit/sï¼Œè¡¨ç¤ºæµé‡åœ¨è¯¥ç±»åˆ«ä¸­çš„ä¼ è¾“é€Ÿç‡ä¸ä¼šè¶…è¿‡è¯¥å€¼ã€‚ ceil 512kbit: è®¾ç½®ç±»åˆ«çš„ä¸Šé™ä¼ è¾“é€Ÿç‡ä¸º512 kbit/sï¼Œè¡¨ç¤ºæµé‡åœ¨è¯¥ç±»åˆ«ä¸­å¯ä»¥çªå‘æ€§åœ°è¾¾åˆ°è¯¥å€¼ï¼Œä½†ä¸ä¼šæŒç»­è¶…è¿‡è¯¥å€¼ã€‚ case 3: æ·»åŠ ä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—123456# tc qdisc add dev eth0 root handle 1: prio ## åˆ›å»ºä¼˜å…ˆçº§é˜Ÿåˆ—æ—¶ä¼šé»˜è®¤åˆ›å»º 1:1, 1:2, 1:3ä¸‰ä¸ªç±»åˆ« # tc qdisc add dev eth0 parent 1:1 handle 10: sfq# tc qdisc add dev eth0 parent 1:2 handle 20: tbf rate 20kbit buffer 1600 limit 3000# tc qdisc add dev eth0 parent 1:3 handle 30: sfq ä¸Šé¢çš„å‘½ä»¤åˆ›å»ºçš„é˜Ÿåˆ—ç»“æ„ä¸º: 1234567root 1: prio / | \\ 1:1 1:2 1:3 | | | 10: 20: 30: sfq tbf sfqband 0 1 2 å¯¹äºä¸Šè¿°é…ç½®ï¼Œä¸å…ä¼šæœ‰ä¸€ä¸ªç–‘é—®ï¼Œå·²ç»é…ç½®äº†ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œä½†æ˜¯å½“æœ‰ç½‘ç»œåŒ…æ¥ä¸´æ—¶ï¼Œåº”å½“å¦‚ä½•åˆ¤æ–­å½“å‰ç½‘ç»œåŒ…çš„ä¼˜å…ˆçº§å‘¢ï¼Ÿè¿™é‡Œå…¶å®å°±æ¶‰åŠåˆ°filteräº†ï¼Œéœ€è¦ä¸ºæ ¹é˜Ÿåˆ—é…ç½®filterï¼Œæ ¹æ®filterçš„è¿‡æ»¤ç»“æœå°†æ•°æ®åŒ…å‘å¾€ä¸‹ä¸€çº§é˜Ÿåˆ—æˆ–ç±»åˆ«ã€‚ case 4: ä¸ºé˜Ÿåˆ—æ·»åŠ filter (classifieræ–¹å¼)123456# tc qdisc add dev eth0 root handle 10: prio ï¼ˆ1ï¼‰# tc filter add dev eth0 protocol ip parent 10: prio 1 u32 match \\ ï¼ˆ2ï¼‰ ip dport 22 0xffff flowid 10:1 # tc filter add dev eth0 protocol ip parent 10: prio 1 u32 match \\ ï¼ˆ3ï¼‰ ip sport 80 0xffff flowid 10:1# tc filter add dev eth0 protocol ip parent 10: prio 2 flowid 10:2 ï¼ˆ4ï¼‰ è§£é‡Šå¦‚ä¸‹ï¼š ï¼ˆ1ï¼‰åˆ›å»ºäº†ä¸€ä¸ªæ ¹é˜Ÿåˆ—ï¼ˆroot qdiscï¼‰å¹¶å°†å…¶æ ‡è¯†ç¬¦è®¾ç½®ä¸º10: ï¼ˆ2ï¼‰æ·»åŠ äº†ä¸€ä¸ªè¿‡æ»¤å™¨è§„åˆ™ï¼Œè¯¥è§„åˆ™åº”ç”¨äºæ ¹é˜Ÿåˆ—çš„å­ç±»åˆ«10:1ã€‚å®ƒä½¿ç”¨prioä¼˜å…ˆçº§ä¸º1ï¼Œå¹¶ä½¿ç”¨u32åˆ†ç±»å™¨æ¥æ£€æŸ¥ç›®æ ‡ç«¯å£æ˜¯å¦ä¸º22çš„IPæ•°æ®åŒ…ã€‚å¦‚æœåŒ¹é…æˆåŠŸï¼Œè¯¥æ•°æ®åŒ…å°†è¢«å‘é€åˆ°flowidä¸º10:1çš„å­ç±»åˆ«è¿›è¡Œè¿›ä¸€æ­¥å¤„ç† (3) æ·»åŠ äº†å¦ä¸€ä¸ªè¿‡æ»¤å™¨è§„åˆ™ï¼Œä¹Ÿåº”ç”¨äºæ ¹é˜Ÿåˆ—çš„å­ç±»åˆ«10:1ã€‚å®ƒä½¿ç”¨prioä¼˜å…ˆçº§ä¸º1ï¼Œå¹¶ä½¿ç”¨u32åˆ†ç±»å™¨æ¥æ£€æŸ¥æºç«¯å£æ˜¯å¦ä¸º80çš„IPæ•°æ®åŒ…ã€‚å¦‚æœåŒ¹é…æˆåŠŸï¼Œè¯¥æ•°æ®åŒ…å°†è¢«å‘é€åˆ°flowidä¸º10:1çš„å­ç±»åˆ«è¿›è¡Œè¿›ä¸€æ­¥å¤„ç† ï¼ˆ4ï¼‰æ·»åŠ äº†ç¬¬ä¸‰ä¸ªè¿‡æ»¤å™¨è§„åˆ™ï¼Œåº”ç”¨äºæ ¹é˜Ÿåˆ—çš„å­ç±»åˆ«10:2ã€‚å®ƒä½¿ç”¨prioä¼˜å…ˆçº§ä¸º2ï¼Œå¹¶å°†æ‰€æœ‰ä¸ç¬¦åˆç¬¬äºŒæ¡å’Œç¬¬ä¸‰æ¡è¿‡æ»¤å™¨éƒ­æ³½çš„æ•°æ®åŒ…å‘é€åˆ°flowidä¸º10:2çš„å­ç±»åˆ«ä¸­è¿›è¡Œå¤„ç†ã€‚ ä¸Šé¢çš„prio 1æˆ–prio 2å†³å®šäº†æ•°æ®åŒ…è¢«è¿‡æ»¤å™¨å¤„ç†çš„é¡ºåºï¼Œå› ä¸ºprio 1çš„ä¼˜å…ˆçº§é«˜äºprio 2, æ‰€ä»¥å½“æ•°æ®åŒ…æ¥ä¸´æ—¶ï¼Œprio 1çš„è¿‡æ»¤å™¨ä¼šå…ˆå¯¹æ•°æ®åŒ…è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…ä¸ä¸Šï¼Œæ‰ä¼šè½®åˆ°prio 2æ‰€æŒ‡çš„è¿‡æ»¤å™¨è¿›è¡Œå¤„ç†ã€‚ case 5: ä¸ºé˜Ÿåˆ—æ·»åŠ filter (policeræ–¹å¼)123456789101112131415# tc filter add \\ (1)&gt; dev eth0 \\ ï¼ˆ2ï¼‰&gt; parent 1:0 \\ (3)&gt; protocol ip \\ (4)&gt; prio 5 \\ (5)&gt; u32 \\ (6)&gt; match ip port 22 0xffff \\ (7)&gt; match ip tos 0x10 0xff \\ (8)&gt; flowid 1:6 \\ (9)&gt; police \\ (10)&gt; rate 32000bps \\ (11)&gt; burst 10240 \\ (12)&gt; mpu 0 \\ (13)&gt; action drop/continue (14) tc filter add: æ·»åŠ ä¸€ä¸ªè¿‡æ»¤å™¨è§„åˆ™ã€‚ dev eth0: æŒ‡å®šè¦åº”ç”¨è¯¥è§„åˆ™çš„ç½‘ç»œæ¥å£ï¼Œè¿™é‡Œæ˜¯ä»¥å¤ªç½‘æ¥å£eth0ã€‚ parent 1:0: æŒ‡å®šçˆ¶ç±»åˆ«çš„æ ‡è¯†ç¬¦ï¼Œè¯¥ç±»åˆ«æ˜¯1:0ã€‚è¿™è¡¨ç¤ºè¯¥è¿‡æ»¤å™¨è§„åˆ™å°†åº”ç”¨äºæ ‡è¯†ç¬¦ä¸º1:0çš„çˆ¶ç±»åˆ«ã€‚ protocol ip: æŒ‡å®šè¿‡æ»¤å™¨è§„åˆ™çš„åè®®ä¸ºIPåè®®ï¼Œè¿™æ„å‘³ç€è¯¥è§„åˆ™å°†åº”ç”¨äºIPæ•°æ®åŒ…ã€‚ prio 5: è®¾ç½®è¿‡æ»¤å™¨è§„åˆ™çš„ä¼˜å…ˆçº§ä¸º5ã€‚ä¼˜å…ˆçº§è¶Šé«˜çš„è§„åˆ™å°†é¦–å…ˆåŒ¹é…å’Œå¤„ç†æ•°æ®åŒ…ã€‚ u32: æŒ‡å®šè¿‡æ»¤å™¨åŒ¹é…è§„åˆ™çš„ç±»å‹ä¸ºu32ï¼Œè¡¨ç¤ºä½¿ç”¨32ä½çš„åŒ¹é…è§„åˆ™ã€‚ match ip port 22 0xffff: è®¾ç½®åŒ¹é…è§„åˆ™ï¼Œä»…åŒ¹é…ç›®æ ‡ç«¯å£å·ä¸º22ï¼ˆSSHç«¯å£ï¼‰çš„æ•°æ®åŒ…ã€‚ match ip tos 0x10 0xff: è®¾ç½®åŒ¹é…è§„åˆ™ï¼Œä»…åŒ¹é…TOSï¼ˆType of Serviceï¼‰å­—æ®µä¸º0x10çš„æ•°æ®åŒ…ã€‚ flowid 1:6: æŒ‡å®šåŒ¹é…çš„æ•°æ®åŒ…å°†è¢«å‘é€åˆ°æ ‡è¯†ç¬¦ä¸º1:6çš„ç±»åˆ«ã€‚ police: å¯ç”¨æµé‡æ§åˆ¶ï¼ˆpolicingï¼‰æœºåˆ¶ï¼Œç”¨äºé™åˆ¶åŒ¹é…çš„æ•°æ®åŒ…çš„ä¼ è¾“é€Ÿç‡ã€‚ rate 32000bps: è®¾ç½®æµé‡æ§åˆ¶çš„ä¼ è¾“é€Ÿç‡ä¸º32000 bpsï¼ˆæ¯”ç‰¹æ¯ç§’ï¼‰ï¼Œå³é™åˆ¶åŒ¹é…çš„æ•°æ®åŒ…çš„ä¼ è¾“é€Ÿç‡ã€‚ burst 10240: è®¾ç½®å…è®¸çš„æœ€å¤§çªå‘ä¼ è¾“é‡ä¸º10240å­—èŠ‚ï¼Œè¡¨ç¤ºæ•°æ®åŒ…å¯ä»¥åœ¨çŸ­æ—¶é—´å†…çªå‘æ€§åœ°è¾¾åˆ°è¯¥å¤§å°ã€‚ mpu 0: è®¾ç½®æœ€å°ä¼ è¾“å•å…ƒï¼ˆMinimum Packet Unitï¼‰ä¸º0ï¼Œè¡¨ç¤ºä¸è¿›è¡Œè¿›ä¸€æ­¥çš„åˆ†ç‰‡å¤„ç†ã€‚ action drop/continue: æŒ‡å®šåŒ¹é…çš„æ•°æ®åŒ…å°†è¢«ä¸¢å¼ƒæˆ–ç»§ç»­å¤„ç†ï¼Œè¿™å–å†³äºå…·ä½“çš„é…ç½®éœ€æ±‚ã€‚ å†™åœ¨æœ€åtcå‘½ä»¤å¼ºå¤§ï¼Œå¹¶ä¸”å¤æ‚ï¼Œ å…‰æ˜¯å…¶ä¸­çš„é˜Ÿåˆ—ç±»å‹å°±æœ‰å¾ˆå¤šå¯ä»¥æ¢ç©¶çš„åœ°æ–¹ï¼Œè¦ä»¥ä¸€ç¯‡æ–‡ç« æ€»ç»“tcçš„æ‰€æœ‰ç”¨æ³•ä¹Ÿä¸ç°å®ã€‚æœ¬æ–‡æ—¨åœ¨ä¸ºè¯»è€…æä¾›ä¸€ä¸ªtcçš„å¿«é€Ÿå…¥é—¨ï¼Œå¸®åŠ©è¯»è€…èƒ½å¤Ÿå¿«é€Ÿäº†è§£tcå‘½ä»¤ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰ç”¨ã€‚ å‚è€ƒæ–‡ç« https://tldp.org/HOWTO/html_single/Traffic-Control-HOWTO/#software https://tldp.org/HOWTO/Adv-Routing-HOWTO/index.html","categories":[{"name":"Linux","slug":"Linux","permalink":"http://example.com/categories/Linux/"}],"tags":[]},{"title":"ã€åŸºæœ¬åŠŸã€‘å¦‚ä½•ç†è§£Javaçº¿ç¨‹ä¸­æ–­","slug":"å¦‚ä½•ç†è§£Javaä¸­æ–­","date":"2023-03-12T01:00:00.000Z","updated":"2023-05-29T14:17:39.386Z","comments":true,"path":"2023/03/12/å¦‚ä½•ç†è§£Javaä¸­æ–­/","link":"","permalink":"http://example.com/2023/03/12/%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3Java%E4%B8%AD%E6%96%AD/","excerpt":"","text":"ä»€ä¹ˆæ˜¯çº¿ç¨‹ä¸­æ–­ä»å¹¿ä¹‰ä¸Šè®²ï¼Œå°±æ˜¯ä¸­æ–­ä¸€ä¸ªæ­£åœ¨å·¥ä½œæˆ–sleepçš„çº¿ç¨‹ï¼Œä»ä»£ç ä¸Šè®²ï¼Œ æ‰€è°“çš„çº¿ç¨‹ä¸­æ–­ï¼Œå°±æ˜¯è®¾ç½®æŸä¸ªçº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½ï¼Œå½“æˆ‘æƒ³è¦ä¸­æ–­æŸä¸ªçº¿ç¨‹çš„æ—¶å€™ï¼Œå°±å°†è¿™ä¸ªçº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½è®¾ç½®ä¸ºtrue, ä½†æ˜¯è‡³äºæ˜¯å¦å“åº”ä¸­æ–­ï¼Œå…¨å‡­JVMæˆ–è¿™ä¸ªçº¿ç¨‹è‡ªå·±å†³å®šã€‚ ä¸ºä»€ä¹ˆè¦æœ‰ä¸­æ–­ ä¸€ç§å¸¸è§çš„ç”¨é€”æ˜¯ç”¨äºçº¿ç¨‹æ± çš„shutdownæ–¹æ³•, å¦‚æœä½ å»æŸ¥çœ‹ThreadPoolExecutorçš„shutdownæ–¹æ³•æ–¹æ³•ï¼Œå°±ä¼šå‘ç°å…¶åº•å±‚å°±æ˜¯é€šè¿‡çº¿ç¨‹ä¸­æ–­æ¥ç»ˆæ­¢æ‰æ­£åœ¨å·¥ä½œçš„çº¿ç¨‹çš„ã€‚ğŸŒ°ï¼š 12345678910111213public void shutdown() &#123; final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try &#123; checkShutdownAccess(); advanceRunState(SHUTDOWN); interruptIdleWorkers(); //åœ¨è¿™é‡Œä¸­æ–­çº¿ç¨‹ onShutdown(); &#125; finally &#123; mainLock.unlock(); &#125; tryTerminate(); &#125; 123456789101112131415161718192021private void interruptIdleWorkers(boolean onlyOne) &#123; final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try &#123; for (Worker w : workers) &#123; Thread t = w.thread; if (!t.isInterrupted() &amp;&amp; w.tryLock()) &#123; try &#123; t.interrupt(); //é€šè¿‡è°ƒç”¨Thread.interruptæ–¹æ³•æ¥ä¸­æ–­æ­£åœ¨å·¥ä½œçš„çº¿ç¨‹ &#125; catch (SecurityException ignore) &#123; &#125; finally &#123; w.unlock(); &#125; &#125; if (onlyOne) break; &#125; &#125; finally &#123; mainLock.unlock(); &#125; &#125; å¦‚ä½•ä¸­æ–­å’Œçº¿ç¨‹ä¸­æ–­ç›¸å…³çš„ä¸€å…±æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ï¼š é™æ€æ–¹æ³•Thread.isInterrupted Thread.interrupt: é™æ€æ–¹æ³•Thread.interrupted Thread.isInterruptedè¯¥æ–¹æ³•æ˜¯Threadç±»çš„ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œè¿”å›å½“å‰çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½çŠ¶æ€ã€‚ Thread.interruptè¿™ä¸ªæ–¹æ³•æ˜¯Threadçš„ä¸€ä¸ªæˆå‘˜æ–¹æ³•ï¼Œå®ƒä¼šè®¾ç½®å½“å‰çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½ä¸ºtrue, è‡³äºå½“å‰çº¿ç¨‹æ˜¯å¦å“åº”ä¸­æ–­ï¼Œå’Œå½“å‰çº¿ç¨‹çš„æ‰§è¡Œå†…å®¹æœ‰å…³ã€‚ æ‰€è°“èƒ½å¤Ÿå“åº”ä¸­æ–­ï¼Œæ˜¯æŒ‡: å¦‚æœåœ¨çº¿ç¨‹é‡Œè°ƒç”¨äº†Object.wait()ç›¸å…³é‡è½½æ–¹æ³•ï¼ŒThread.join()ç›¸å…³é‡è½½æ–¹æ³•ï¼Œä»¥åŠThread.sleep()ç›¸å…³é‡è½½æ–¹æ³•ï¼Œåˆ™å½“å‰çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½ä¼šè¢«æ¸…ç©ºï¼Œå¹¶æŠ›å‡ºä¸€ä¸ªInterruptedExceptionå¼‚å¸¸ 12345678910111213141516public static void main(String[] args) throws InterruptedException &#123; Thread t = new Thread(() -&gt; &#123; while (!Thread.currentThread().isInterrupted())&#123; try &#123; System.out.println(&quot;in loop&quot;); Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; System.out.println(&quot;after interrupted: &quot; + Thread.currentThread().isInterrupted()); &#125; &#125; &#125;); t.start(); Thread.sleep(1000); t.interrupt(); &#125; å¯¹äºä¸Šè¿°ä»£ç ï¼ŒThread.currentThread().isInterrupted()ç”¨äºæŸ¥çœ‹å½“å‰çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½ã€‚åˆå§‹æ—¶ç”±äºçº¿ç¨‹æœªè¢«ä¸­æ–­ï¼ŒThread.currentThread().isInterrupted()è¿”å›false, æ‰€ä»¥èƒ½å¤Ÿè¿›å…¥åˆ°whileå¾ªç¯ä¸­ï¼Œå½“æ‰§è¡Œt.interrupt()æ—¶ï¼Œçº¿ç¨‹tä¼šæŠ›å‡ºInterruptedExceptionå¹¶æ¸…ç©ºæ ‡å¿—ä½ï¼Œæ‰€ä»¥Thread.currentThread().isInterrupted()ä¾ç„¶è¿”å›false, ä»è€Œwhileå¾ªç¯èƒ½å¤Ÿä¸€ç›´è¿›è¡Œä¸‹å»ã€‚ æ‰€ä»¥ä¸Šè¿°ä»£ç è¾“å‡º: 12345in loopafter interrupted: falsein loopin loop... ç›¸åï¼Œå¦‚æœæˆ‘ä»¬åªä¸­æ–­çº¿ç¨‹ï¼Œä½†æ˜¯ä¸å¯¹ä¸­æ–­æ ‡å¿—ä½åšä»»ä½•å“åº”çš„è¯ï¼Œé‚£ä¹ˆç›®æ ‡çº¿ç¨‹è¿˜æ˜¯ä¼šæ­£å¸¸è¿è¡Œ: 123456789101112public static void main(String[] args) throws InterruptedException &#123; Thread t = new Thread(() -&gt; &#123; while (true)&#123; boolean interrupted = Thread.currentThread().isInterrupted(); System.out.println(&quot;in loop, flag is: &quot;+ interrupted); &#125; &#125;); t.start(); Thread.sleep(1000L); t.interrupt(); &#125; è¾“å‡ºï¼š 123456...in loop, flag is: falsein loop, flag is: falsein loop, flag is: truein loop, flag is: true... å¦‚æœå½“å‰çº¿ç¨‹é˜»å¡åœ¨InterruptibleChannelç±»å‹çš„IOæ“ä½œä¸Šï¼Œåˆ™ä¼šå°†å½“å‰çº¿ç¨‹ä¸­æ–­æ ‡å¿—ä½ç½®ä¸ºtrueå¹¶æŠ›å‡ºä¸€ä¸ªClosedByInterruptException ğŸŒ°ï¼š 1234567891011121314151617public static void main(String[] args) throws IOException, InterruptedException &#123; Thread t = new Thread(() -&gt; &#123; try &#123; SocketChannel sc = SocketChannel.open(new InetSocketAddress(&quot;localhost&quot;, 8080)); sc.read(ByteBuffer.allocate(1)); &#125; catch (ClosedByInterruptException e) &#123; System.out.println(&quot;thread is interrupted, and the flag is:&quot; + Thread.currentThread().isInterrupted()); &#125; catch (IOException e) &#123; throw new RuntimeException(e); &#125; &#125;); t.start(); Thread.sleep(1000); t.interrupt(); &#125; ä¸Šè¿°ä»£ç ä»£ç ä¼šæ‰“å¼€ä¸€ä¸ªSocketChannelå¹¶é˜»å¡ç›‘å¬8080ç«¯å£ï¼Œå¦‚æœæ­¤æ—¶ä¸­æ–­å½“å‰çº¿ç¨‹ï¼Œåˆ™ä¼šå°†çº¿ç¨‹ä¸­æ–­æ ‡å¿—ä½ç½®ä¸ºtrueå¹¶ä¸”æŠ›å‡ºClosedByInterruptException, æ‰€ä»¥ä¸Šè¿°ä»£ç è¾“å‡ºä¸ºï¼š 1thread is interrupted, and the flag is:true å¦‚æœå½“å‰çº¿ç¨‹é˜»å¡åœ¨NIOçš„Selectorä¸Šï¼Œåˆ™ä¼šå°†çº¿ç¨‹ä¸­æ–­æ ‡å¿—ä½ç½®ä¸ºtrueå¹¶ä¸”ç«‹å³ä»selectåŠ¨ä½œä¸­è¿”å›ã€‚ğŸŒ°ï¼š 1234567891011121314151617181920public static void main(String[] args) throws InterruptedException &#123; Thread t = new Thread(() -&gt; &#123; try &#123; Selector selector = Selector.open(); ServerSocketChannel sc = ServerSocketChannel.open(); sc.socket().bind(new InetSocketAddress(8080)); sc.configureBlocking(false); sc.register(selector, SelectionKey.OP_ACCEPT); selector.select(); //å¦‚æœæ²¡æœ‰è¢«ä¸­æ–­ä¸”æ²¡æœ‰æ„Ÿå…´è¶£çš„äº‹ä»¶å‘ç”Ÿï¼Œåˆ™ä¼šä¸€ç›´é˜»å¡åœ¨è¿™é‡Œ System.out.println(&quot;å¦‚æœèµ°åˆ°äº†è¿™é‡Œï¼Œè¯´æ˜çº¿ç¨‹è¢«ä¸­æ–­æˆ–è€…æœ‰æ„Ÿå…´è¶£çš„äº‹ä»¶å‘ç”Ÿ&quot;); &#125; catch (IOException e) &#123; throw new RuntimeException(e); &#125; &#125;); t.start(); Thread.sleep(1000L); t.interrupt(); &#125; ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨NIOçš„æ–¹å¼å¼€å¯äº†ä¸€ä¸ªserver, å¹¶ç›‘å¬8080ç«¯å£ï¼Œç”±äºæ²¡æœ‰æ„Ÿå…´è¶£çš„äº‹ä»¶å‘ç”Ÿï¼Œserverçš„ä»£ç ä¼šä¸€ç›´é˜»å¡åœ¨ selector.select()ï¼Œæ­¤æ—¶å¦‚æœä¸­æ–­å½“å‰çº¿ç¨‹ï¼Œåˆ™selectæ–¹æ³•ä¼šç«‹å³è¿”å›ï¼Œå¹¶æ‰“å°ä¸‹ç¬¬11çš„è¾“å‡ºã€‚ ps: å¯ä»¥çœ‹åˆ°ç¬¬ä¸‰ç‚¹å’Œç¬¬å››ç‚¹è®²çš„éƒ½æ˜¯NIOçš„ä¸­æ–­å“åº”ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰è®²åˆ°BIOå‘¢ï¼Œå› ä¸ºBIOæ˜¯ä¸ä¼šå¯¹ä¸­æ–­æŠ›å‡ºå¼‚å¸¸æˆ–ç«‹å³è¿”å›çš„(è™½ç„¶ä¹Ÿä¼šè®¾ç½®ä¸­æ–­æ ‡å¿—ä½ä¸ºtrue, ä½†æ˜¯åœ¨ä»£ç è¡Œä¸ºä¸Šä¸ä¼šæœ‰ä»»ä½•å˜åŒ–)ï¼Œå¯¹äºä¸‹è¿°ä»£ç ï¼ŒæœåŠ¡ç«¯ä¼šé˜»å¡åœ¨ç¬¬12è¡ŒserverSocket.acceptä¸Šï¼Œå½“æˆ‘ä»¬æ‰§è¡Œt.interrupt()åï¼Œè™½ç„¶åœ¨ä¸»çº¿ç¨‹ç¬¬23è¡Œçš„æ‰“å°ä¸­å¯ä»¥çœ‹åˆ°çº¿ç¨‹tçš„æ ‡å¿—ä½å·²ç»ä¸ºtrueï¼Œä½†æ˜¯ServerSocketä¾ç„¶é˜»å¡ï¼Œä¸ä¼šæœ‰ä»»ä½•æ”¹å˜ã€‚ 123456789101112131415161718192021222324public static void main(String[] args) throws InterruptedException &#123; Thread t = new Thread(() -&gt; &#123; ServerSocket serverSocket = null; try &#123; serverSocket = new ServerSocket(83); &#125; catch (IOException e) &#123; throw new RuntimeException(e); &#125; try &#123; while (true) &#123; Socket socket = serverSocket.accept(); &#125; &#125; catch (IOException e) &#123; throw new RuntimeException(e); &#125; &#125;); t.start(); Thread.sleep(1000L); t.interrupt(); System.out.println(t.isInterrupted()); &#125; å¯¹äºéä¸Šè¿°å‡ ç§ç±»å‹ï¼Œåˆ™åªä¼šå°†ä¸­æ–­æ ‡å¿—ä½è®¾ç½®ä¸ºtrue. å°å°æ€»ç»“ä¸€ä¸‹ï¼ŒThread.interruptçš„æœ¬è´¨æ˜¯å°†çº¿ç¨‹ä¸­æ–­æ ‡å¿—ä½è®¾ç½®ä¸ºtrue, å¯¹äºä¸€äº›ç‰¹æ®Šçš„æ–¹æ³•ï¼Œå¦‚sleep,waitç­‰ï¼Œä¼šæŠ›å‡ºInterruptedExceptionå¹¶æ¸…ç©ºä¸­æ–­æ ‡å¿—ä½ï¼Œå¯¹äºå…¶ä»–æ“ä½œï¼Œè¦ä¹ˆæŠ›å¼‚å¸¸ï¼Œè¦ä¹ˆç«‹å³è¿”å›ï¼Œè¦ä¹ˆdo nothing, ä½†æ˜¯ä¸ä¼šæ¸…ç©ºæ ‡å¿—ä½ã€‚ä½†æ— è®ºå¦‚ä½•ï¼Œè‡³äºæ˜¯å¦è¦å“åº”ä¸­æ–­ï¼Œå…¶å®æ˜¯ç›®æ ‡çº¿ç¨‹è‡ªèº«å†³å®šçš„ã€‚ Thread.interruptedinterruptedæ˜¯Threadç±»çš„ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå®ƒä¼šè¿”å›å½“å‰çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½å¹¶æ¸…ç©ºï¼Œè¿™æ„å‘³ç€ï¼Œå¦‚æœè¿ç»­ä¸¤æ¬¡è°ƒç”¨è¯¥æ–¹æ³•ï¼Œç¬¬äºŒæ¬¡ä¸€å®šè¿”å›çš„æ˜¯false. ä¸¾ä¸ªä¾‹å­ï¼š 1234567891011121314public static void main(String[] args) throws InterruptedException &#123; Thread t = new Thread(() -&gt; &#123; while (!Thread.currentThread().isInterrupted())&#123; System.out.println(&quot;in loop, flag&quot;); &#125; System.out.println(&quot;thread is interrupted, before invoker Thread.interrupted(): &quot;+ Thread.currentThread().isInterrupted()); System.out.println(&quot;after invoker Thread.interrupted(): &quot;+Thread.interrupted()); System.out.println(&quot;after invoke Thread.interrupted() again: &quot;+Thread.interrupted()); &#125;); t.start(); Thread.sleep(1L); t.interrupt(); &#125; è¾“å‡ºï¼š 12345...in loop, flagthread is interrupted, before invoker Thread.interrupted(): trueafter invoker Thread.interrupted(): trueafter invoke Thread.interrupted() again: false å½“çº¿ç¨‹tè¢«ä¸­æ–­åï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨Thread.interrupted(),è¿”å›true, å†æ¬¡è°ƒç”¨ï¼Œè¿”å›false å†™åœ¨æœ€åJavaçš„çº¿ç¨‹ä¸­æ–­ç»™æˆ‘ä»¬æä¾›äº†ä¸€ç§å»æ”¹å˜ç›®æ ‡çº¿ç¨‹çŠ¶æ€çš„æ–¹å¼ï¼Œå’ŒThread.stopç›¸æ¯”ï¼Œä¸­æ–­æ›´åŠ æ¸©æŸ”ï¼Œå®ƒç»™ç›®æ ‡çº¿ç¨‹æä¾›äº†ä¸€ä¸ªç»ˆæ­¢çš„æœºä¼šï¼Œä½†æ˜¯è‡³äºæ˜¯å¦çœŸçš„è¦ç»ˆæ­¢ï¼Œå…¶å®æ˜¯ç”±ç›®æ ‡çº¿ç¨‹è‡ªèº«å†³å®šçš„ï¼Œç”±ç›®æ ‡çº¿ç¨‹è‡ªèº«å†³å®šæ˜¯å¦å¯¹ä¸­æ–­æ ‡å¿—ä½çš„å˜æ›´è¿›è¡Œå“åº”ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"ä¸­æ–­","slug":"ä¸­æ–­","permalink":"http://example.com/tags/%E4%B8%AD%E6%96%AD/"}]},{"title":"å¦‚ä½•åœ¨Javaä¸­ä¼˜é›…åœ°ä½¿ç”¨å¼‚å¸¸","slug":"å¦‚ä½•åœ¨Javaä¸­ä¼˜é›…åœ°ä½¿ç”¨å¼‚å¸¸","date":"2023-03-05T04:00:00.000Z","updated":"2023-05-29T14:17:39.381Z","comments":true,"path":"2023/03/05/å¦‚ä½•åœ¨Javaä¸­ä¼˜é›…åœ°ä½¿ç”¨å¼‚å¸¸/","link":"","permalink":"http://example.com/2023/03/05/%E5%A6%82%E4%BD%95%E5%9C%A8Java%E4%B8%AD%E4%BC%98%E9%9B%85%E5%9C%B0%E4%BD%BF%E7%94%A8%E5%BC%82%E5%B8%B8/","excerpt":"","text":"æœ¬æ–‡ä¼šç®€å•ä»‹ç»Javaå¼‚å¸¸çš„åˆ†ç±»ï¼Œ ä»¥åŠåœ¨ä½¿ç”¨å¼‚å¸¸è¿‡ç¨‹ä¸­çš„ä¸€äº›æ³¨æ„äº‹é¡¹ã€‚ å¼‚å¸¸çš„åˆ†ç±»Javaå¼‚å¸¸æ˜¯JVMåº”å¯¹é”™è¯¯çš„ä¸€ç§æ–¹å¼ï¼Œæ— è®ºæ˜¯ç¼–è¯‘æ—¶é”™è¯¯ã€è¿è¡Œæ—¶é”™è¯¯ã€è¿˜æ˜¯JVMå†…éƒ¨é”™è¯¯ï¼Œå®ƒçš„åˆ†ç±»å¦‚ä¸‹ï¼š Javaçš„Exceptionå’ŒErroréƒ½ç»§æ‰¿è‡ªThrowable, ExeceptionåŒ…æ‹¬CheckedExeceptionå’ŒUncheckedExceptionï¼Œå…¶ä¸­CheckedExceptionæ˜¯ä¸€äº›åœ¨ç¼–è¯‘æœŸå°±èƒ½å‘ç°çš„å¼‚å¸¸ï¼ŒJVMè¦æ±‚å¼€å‘è€…å¿…é¡»æ˜¾å¼åœ°æ•è·æˆ–æŠ›å‡ºè¯¥å¼‚å¸¸, å¦‚IOExcetion, FileNotFoundException, ClassNotFoundExceptionã€‚è€ŒUnCheckedExceptionä¸ºè¿è¡Œæ—¶å¼‚å¸¸ï¼Œåœ¨ç¼–è¯‘å™¨æ— æ³•å‘ç°ï¼ŒJVMä¹Ÿå°±ä¸è¦æ±‚å¼€å‘è€…å¿…é¡»åšå¤„ç†ã€‚ æœ‰ä¸¤ç§æ¯”è¾ƒå®¹æ˜“æ··æ·†çš„å¼‚å¸¸å’Œé”™è¯¯éœ€è¦æ³¨æ„ä¸‹ï¼šClassNotFoundException, NoClassDefFoundErrorã€‚å¦‚ä¸Šæ–‡æ‰€è¯´ï¼ŒClassNotFoundExceptionå‘ç”Ÿåœ¨ç¼–è¯‘æœŸï¼Œé€šå¸¸æ˜¯ç”±äºæ‰¾ä¸åˆ°è¯¥ç±»æ–‡ä»¶å¯¼è‡´ï¼Œæ¯”å¦‚è™½ç„¶åœ¨pomæ–‡ä»¶é‡Œå¼•ç”¨äº†è¯¥jaråŒ…ï¼Œç¼–è¯‘å™¨ä¹Ÿç¡®å®æ²¡æç¤ºæŠ¥é”™ï¼Œä½†æ˜¯ç”±äºå½“å‰çš„ç±»åŠ è½½å™¨ä¸åŠ è½½è¿™ä¸ªjaråŒ…æ‰€åœ¨pathçš„ç±»æ–‡ä»¶ï¼Œå°±ä¼šæŠ¥è¿™ä¸ªé”™ï¼Œæ¯”å¦‚è°ƒç”¨Class.forNameæˆ–Classloader.loadClassæ—¶ï¼Œå°±å¯èƒ½ä¼šæŠ¥è¿™ä¸ªå¼‚å¸¸ã€‚è€ŒNoClassDefFoundErrorå‘ç”Ÿåœ¨è¿è¡ŒæœŸï¼Œç”±äºè¿è¡Œæ—¶æ‰¾ä¸åˆ°å¯¹åº”çš„ç±»æ–‡ä»¶å¯¼è‡´ï¼Œæ¯”å¦‚ä½ ä»¥providedæ–¹å¼å¼•å…¥æŸä¸ªjaråŒ…ï¼Œç¼–è¯‘æ—¶ok, ä½†è¿è¡Œæ—¶å¯èƒ½å°±ä¼šæŠ¥é”™ã€‚ å¼‚å¸¸çš„ä½¿ç”¨ç”±äºJavaå¼‚å¸¸æœ‰ä¸€å®šçš„æ€§èƒ½æŸè€—ï¼Œåœ¨è¿™é‡Œå’Œå¤§å®¶åˆ†äº«å‡ ç‚¹å¼‚å¸¸çš„ä½¿ç”¨åŸåˆ™ 1ã€åº”å½“æ•è·ä»€ä¹ˆç²’åº¦çš„å¼‚å¸¸ï¼Ÿ â€‹ æŠ›å¼€åœºæ™¯è°ˆè¿™ä¸ªé—®é¢˜æ¯«æ— æ„ä¹‰ï¼Œçœ‹åˆ°ç½‘ä¸Šæœ‰äº›æ–‡ç« è¯´ä¸åº”å½“æ•è·Throwableç±»ï¼Œç¬”è€…ä¸è®¤åŒè¿™ç§è¯´æ³•ã€‚åœ¨ä¸€äº›ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¯¹äºä¸‹æ¸¸æŠ›å‡ºçš„ä¸åŒå¼‚å¸¸åº”å½“æœ‰ä¸åŒçš„å¤„ç†é€»è¾‘ï¼Œè¿™æ—¶æ•è·çš„å¼‚å¸¸åº”å½“è¶Šå…·ä½“è¶Šå¥½ï¼Œæ¯”å¦‚ï¼š 1234567try&#123; //biz code&#125;catch(ExeptionA a)&#123; //do something&#125;catch(ExceptionB b)&#123; //do something else&#125; ä¹Ÿæœ‰äº›åœºæ™¯ï¼Œæ¯”å¦‚ä½ çš„ä»£ç ç›¸å¯¹äºä¸»é€»è¾‘æ˜¯ä¸ªæ—è·¯åˆ†æ”¯ï¼Œè¿™æ—¶ä½ åº”å½“åœ¨è‡ªå·±ä»£ç çš„æœ€å¤–å±‚ä¸€æŠŠæ¢­æ•è·æ‰€æœ‰Exceptionå’ŒError, é¿å…æ—è·¯é€»è¾‘æŠ›å‡ºä»€ä¹ˆé¢„æœŸå¤–çš„å¼‚å¸¸è€Œå½±å“ä¸»é€»è¾‘ã€‚ï¼Œå³ä½ åº”å½“å»æ•è· Throwable: 12345try&#123; //æ—è·¯é€»è¾‘&#125;catch(Throwable t)&#123; //æ— è®ºæŠ›å‡ºä»€ä¹ˆå¼‚å¸¸ï¼Œéƒ½ä¸åº”å½“å½±å“ä¸»æµç¨‹&#125; 2ã€å°½é‡ä½¿å¼‚å¸¸å †æ ˆç®€çŸ­ â€‹ å¼‚å¸¸å †æ ˆçš„è§£ææœ‰ä¸€å®šçš„æ€§èƒ½æŸè€—ï¼Œè¿‡é•¿çš„å¼‚å¸¸æ ˆä¹Ÿä¼šç»™æ—¥å¿—æ‰“å°å¸¦æ¥å‹åŠ›ï¼Œæ‰€ä»¥ï¼Œåœ¨æ˜ç¡®çŸ¥é“ä½ çš„å¼‚å¸¸ä¼šå‘ç”Ÿåœ¨ä»€ä¹ˆä½ç½®æ—¶ï¼Œåº”å½“ä½¿å¼‚å¸¸æ ˆå°½å¯èƒ½çš„æµ…ï¼Œè€Œå¯¹åº”çš„åšæ³•å°±æ˜¯åº”å½“å°†æ•è·çš„å¼‚å¸¸é‡æ–°å®šä¹‰å†æŠ›å‡ºï¼š 12345678910111213//ä»£ç ä¸€ï¼Œç›´æ¥æŠ›å‡ºåŸå¼‚å¸¸ï¼Œä¼šä½¿å¼‚å¸¸æ ˆæ¯”è¾ƒæ·±try&#123; //biz code&#125;catch(Exeception e)&#123; throw e;&#125;//ä»£ç äºŒï¼Œæ•è·å¹¶é‡æ–°å®šä¹‰å¼‚å¸¸ï¼Œå¼‚å¸¸æ ˆä¼šä»é‡æ–°å®šä¹‰çš„åœ°æ–¹å¼€å§‹è®¡ç®—try&#123; //biz code&#125;catch(Exception e)&#123; throw new RuntimeException(&quot;error msg here&quot;)&#125; 3ã€å°†å¼‚å¸¸å®šä¹‰ä¸ºé™æ€æˆå‘˜å˜é‡ï¼Œé¿å…é‡å¤åˆ›å»ºå¯¹è±¡ å¼‚å¸¸æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ—¢ç„¶æ˜¯å¯¹è±¡ï¼Œé‚£åˆ›å»ºå’Œå›æ”¶å°±ä¼šæœ‰æ€§èƒ½æŸè€—ï¼Œè¯•æƒ³ä¸€ä¸‹ï¼Œåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œåˆšå¥½æœ‰ä¸€æ®µä»£ç æœ‰bug, é¢‘ç¹åœ°æŠ›å‡ºå¼‚å¸¸ï¼Œé¢‘ç¹åœ°åˆ›å»ºExceptionæ–°å¯¹è±¡å°±æœ‰å¯èƒ½é€ æˆé¢‘ç¹åœ°young GC. 12345try&#123; &#125;catch(Exception e)&#123; throw new Exception(); //åœ¨è¿™é‡Œé¢‘ç¹åœ°åˆ›å»ºå¹¶æŠ›å‡ºå¼‚å¸¸&#125; æ‰€ä»¥ï¼Œåœ¨æ˜ç¡®çŸ¥é“å½“å‰é€»è¾‘ä¼šæŠ›å‡ºæˆ–åº”å½“æŠ›å‡ºä»€ä¹ˆå¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œå°†å¼‚å¸¸å®šä¹‰ä¸ºé™æ€å˜é‡ï¼Œå¯ä»¥å¸®åŠ©é™ä½ç³»ç»Ÿæ€§èƒ½å¼€é”€ã€‚ä¸¾ä¸ªğŸŒ°ï¼š 1234567if(/**ä¸æ˜¯ä¼šå‘˜**/)&#123; throw BizException.ExceptionA;&#125;public BizException&#123; public static BizException ExceptionA = new BizException(&quot;ä¸æ˜¯ä¼šå‘˜!&quot;);&#125; å†™åœ¨æœ€åå¼€å‘ä¸è§„èŒƒï¼Œä¸Šçº¿ä¸¤è¡Œæ³ªã€‚äº†è§£ä¸€ä¸‹å¼‚å¸¸çš„ä½¿ç”¨æŠ€å·§å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§„é¿ä¸€äº›å¼€å‘é£é™© ğŸ«¡","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"å¼‚å¸¸","slug":"å¼‚å¸¸","permalink":"http://example.com/tags/%E5%BC%82%E5%B8%B8/"}]},{"title":"ä¸€æ¬¡ç”±ipå°ç¦å¼•èµ·çš„é—®é¢˜åˆ†æ","slug":"ä¸€æ¬¡iptableså°ç¦å¼•èµ·çš„é—®é¢˜åˆ†æ","date":"2023-02-10T14:00:00.000Z","updated":"2023-05-29T14:17:39.339Z","comments":true,"path":"2023/02/10/ä¸€æ¬¡iptableså°ç¦å¼•èµ·çš„é—®é¢˜åˆ†æ/","link":"","permalink":"http://example.com/2023/02/10/%E4%B8%80%E6%AC%A1iptables%E5%B0%81%E7%A6%81%E5%BC%95%E8%B5%B7%E7%9A%84%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/","excerpt":"","text":"é—®é¢˜èƒŒæ™¯â€‹ å‰ä¸¤å¤©æœ‰åŒäº‹å’¨è¯¢ï¼šæœºå™¨Aä¸Šæœ‰ä¸ªä¸šåŠ¡å®¢æˆ·ç«¯ï¼Œæœºå™¨Bä¸Šä¸ºæœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯è¦å®šæœŸæ¢æ´»å®¢æˆ·ç«¯ï¼Œå½“å®¢æˆ·ç«¯è®¿é—®ä¸é€šæ—¶æœåŠ¡ç«¯åº”å½“æ‘˜é™¤è¿™ä¸ªå®¢æˆ·ç«¯èŠ‚ç‚¹ã€‚ç°åœ¨è¦éªŒè¯ä¸‹å½“å®¢æˆ·ç«¯è®¿é—®ä¸é€šæ—¶æœåŠ¡ç«¯èƒ½å¦æ­£å¸¸æ‘˜é™¤èŠ‚ç‚¹ï¼Œäºæ˜¯ä½¿ç”¨äº†iptablesçš„ipå°ç¦åŠŸèƒ½ã€‚åœ¨æœºå™¨Aä¸Šå°ç¦æœºå™¨Bçš„ipåï¼Œåœ¨å°ç¦æœŸé—´æœåŠ¡Bæ— æ³•è¯·æ±‚æœåŠ¡Aï¼Œä½†æ˜¯å½“å–æ¶ˆæœºå™¨Aä¸Šçš„ipå°ç¦åï¼ŒæœåŠ¡Bå°½ç„¶æ”¶åˆ°äº†æ¥è‡ªæœåŠ¡Açš„å“åº”ï¼ â€‹ é‡åˆ°è¿™ä¸ªé—®é¢˜æˆ‘çš„ç¬¬ä¸€ååº”æ˜¯æœåŠ¡Bæ˜¯ä¸æ˜¯æœ‰ä»€ä¹ˆé‡è¯•æœºåˆ¶ï¼Œç”±äºæœåŠ¡Aè®¿é—®ä¸é€šæ‰€ä»¥å¤šé‡è¯•äº†å‡ æ¬¡ï¼Œæ”¶åˆ°çš„å“åº”å…¶å®æ˜¯é‡è¯•åçš„å“åº”ã€‚åœ¨å¾—åˆ°ä¸šåŠ¡åŒå­¦å¦å®šçš„å›ç­”åï¼Œæˆ‘å¼€å§‹æ€€ç–‘æ˜¯å¦æ˜¯tcpå±‚åšäº†é‡è¯•ã€‚ é—®é¢˜å¤ç°å…ˆå°ç¦ï¼Œå†å»ºè¿å‡†å¤‡ä¸¤å°æœºå™¨Aå’ŒB, ipåˆ†åˆ«ä¸ºï¼š10.48.22.221ï¼ˆå¯¹åº”ä¸‹æ–‡dev01ï¼‰å’Œ10.171.170.104(å¯¹åº”ä¸‹æ–‡test02). ç¬”è€…å½“æ—¶ä½¿ç”¨çš„iptableså‘½ä»¤å¦‚ä¸‹ï¼Œå«ä¹‰æ˜¯æ‹’ç»æ¥è‡ªipçš„åŒ…å’Œå‘å‘ipçš„åŒ…ï¼š 12iptables -I INPUT -s xxxx -j REJECTiptables -I OUTPUT -d xxx -j REJECT ç¬¬ä¸€æ­¥ï¼šæ·»åŠ è§„åˆ™ åœ¨dev01ä¸Šæ·»åŠ ä¸Šè¿°ä¸¤æ¡è§„åˆ™ ä½¿ç”¨iptables -LæŸ¥çœ‹ï¼Œå¯ä»¥å‘ç°æ·»åŠ æˆåŠŸ ç¬¬äºŒæ­¥ï¼šdev01ç›‘å¬ç«¯å£ ä½¿ç”¨nc -l 1234åœ¨dev01ä¸Šç›‘å¬1234ç«¯å£ ä½¿ç”¨netstat -apn|grep 1234æŸ¥çœ‹1234ç«¯å£ï¼Œå‘ç°å·²ç»å¤„äºç›‘å¬çŠ¶æ€ ç¬¬ä¸‰æ­¥éª¤ï¼štest02å‘èµ·è¿æ¥ åœ¨test02æœºå™¨ä¸Šä½¿ç”¨nc 10.171.170.104 1234å‘dev01å‘èµ·è¿æ¥ åœ¨dev01ä¸Šä½¿ç”¨tcpdump host 10.48.22.221å‘½ä»¤è¿›è¡ŒæŠ“åŒ… å¯ä»¥çœ‹åˆ°ï¼Œdev01æ”¶åˆ°äº†test02çš„SYNCåŒ…ï¼ˆä¸‰æ¬¡æ¡æ‰‹çš„ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼‰ï¼Œä½†æ˜¯ç”±äºdev01æ²¡æœ‰å‘é€å“åº”åŒ…ï¼Œæ‰€ä»¥test01ä¼šè¿›è¡Œé‡è¯•ï¼Œé‡è¯•å‡ æ¬¡åï¼Œè‡ªåŠ¨åœæ­¢å»ºè¿ï¼Œåœ¨test02ä¸Šä½¿ç”¨netstat -apnc|grep 1234å‘½ä»¤æŸ¥çœ‹çš„ç»“æœä¹Ÿèƒ½éªŒè¯è¿™ä¸€ç‚¹ è‡³æ­¤ï¼Œå¯ä»¥å¾—åˆ° ç»“è®ºä¸€ï¼šåœ¨TCPå»ºç«‹è¿æ¥é˜¶æ®µï¼Œä½¿ç”¨ 12iptables -I INPUT -s xxxx -j REJECTiptables -I OUTPUT -d xxx -j REJECT æ˜¯å¯ä»¥é˜»æ­¢TCPå»ºç«‹è¿æ¥çš„ã€‚ å…ˆå»ºè¿ï¼Œå†å°ç¦æ—¢ç„¶å…ˆå°ç¦ã€å†å»ºè¿æ˜¯ç¬¦åˆæˆ‘ä»¬é¢„æœŸçš„ï¼Œé‚£æœ¬æ–‡å¼€å§‹æåˆ°çš„é—®é¢˜ï¼šå°ç¦å–æ¶ˆåå‘é€ç«¯ä¼šæ”¶åˆ°å“åº”åŒ…ï¼Œæœ‰æ²¡æœ‰å¯èƒ½æ˜¯åŸºäºå·²ç»å»ºç«‹å¥½çš„TCPè¿æ¥è¿›è¡Œå°ç¦çš„å‘¢ï¼Ÿ å…ˆæ¸…é™¤ä¹‹å‰åœ¨dev01ä¸Šå»ºç«‹çš„è§„åˆ™ï¼š ä½¿ç”¨nc -l 1234åœ¨dev01ä¸Šç›‘å¬ç«¯å£ï¼Œ ä½¿ç”¨nc 10.171.170.104 1234åœ¨test02ä¸Šå‘èµ·è¿æ¥ï¼š å¯ä»¥çœ‹åˆ°TCPè¿æ¥å·²ç»å»ºç«‹ åœ¨dev01ä¸Šå†™å…¥è§„åˆ™ï¼š åœ¨test2ä¸Šå‘é€æ•°æ®åŒ… å¯ä»¥å‘ç°ï¼Œç”±äºæ²¡æœ‰æ”¶åˆ°ack, test2ä¸€ç›´åœ¨å°è¯•å‘é€åŒä¸€ä¸ªæ•°æ®åŒ… æ­¤æ—¶ï¼Œå¦‚æœåˆ é™¤dev1ä¸Šçš„è§„åˆ™ï¼Œä¼šæ€æ ·å‘¢ï¼Ÿ æœç„¶ï¼Œtest2æ”¶åˆ°æ¥è‡ªdev1çš„ack. è‡³æ­¤ï¼Œæˆ‘ä»¬å¾—åˆ° ç»“è®ºäºŒï¼šåœ¨å·²å»ºç«‹TCPè¿æ¥åï¼Œä½¿ç”¨ 12iptables -I INPUT -s xxxx -j REJECTiptables -I OUTPUT -d xxx -j REJECT ä¸ä¼šæ–­å¼€å·²æœ‰è¿æ¥ï¼Œå‘é€ç«¯ä¼šä¸æ–­é‡è¯•ï¼Œå¦‚æœé€šä¿¡æ¢å¤ï¼Œå‘é€ç«¯ä¼šæ”¶åˆ°ä¹‹å‰çš„ack. å¦‚ä½•è§£å†³ç›®å‰å·²ç»çŸ¥é“äº†é—®é¢˜æ‰€åœ¨ï¼Œé‚£å¦‚ä½•è§£å†³å‘¢ï¼ŸæŸ¥çœ‹iptablesç›¸å…³å‘½ä»¤å¯ä»¥å‘ç°ï¼Œiptableså‘½ä»¤å¯ä»¥æŒ‡å®šåè®®ï¼Œå¹¶ä¸”å¯¹äºTCPå‘½ä»¤å¯ä»¥æŒ‡å®šå‚æ•°ï¼Œæ¯”å¦‚é»˜è®¤çš„--reject-with icmp-port-unreachableï¼Œä¹Ÿå¯ä»¥æ˜¾å¼ä¸ºTCPåè®®æ·»åŠ å‚æ•°--reject-with tcp-reset. ä»åå­—å°±å¯ä»¥çœ‹å‡ºï¼Œtcp-resetä¼šä½¿å½“å‰å·²å»ºç«‹çš„TCPè¿æ¥ç«‹å³é‡ç½®ï¼Œçœ‹èµ·æ¥åº”è¯¥å¯ä»¥è§£å†³å»ºè¿åipå°ç¦ä¸ç”Ÿæ•ˆçš„é—®é¢˜ï¼Œæ¥ä¸‹æ¥å°±æµ‹è¯•ä¸€ä¸‹å§ã€‚ å…ˆå°ç¦ï¼Œå†å»ºè¿åœ¨dev01ä¸Šä½¿ç”¨å‘½ä»¤ 12iptables -I INPUT -p tcp -s 10.48.22.221 -j REJECT --reject-with tcp-resetiptables -I OUTPUT -p tcp -d 10.48.22.221 -j REJECT --reject-with tcp-reset dev01ç›‘å¬1234ç«¯å£ï¼Œtest02å‘èµ·è¿æ¥ï¼Œæ•ˆæœåŒä¸Šï¼Œtest02ä¼šä¸æ–­é‡è¯•SYNCåŒ…ã€‚ çœ‹æ¥è¯¥å‘½ä»¤å¯¹äºæœªå»ºè¿çš„TCPæ˜¯ç”Ÿæ•ˆçš„ã€‚ å…ˆå»ºè¿ï¼Œå†å°ç¦å»ºè¿ååŒæ ·ä½¿ç”¨å‘½ä»¤ 12iptables -I INPUT -p tcp -s 10.48.22.221 -j REJECT --reject-with tcp-resetiptables -I OUTPUT -p tcp -d 10.48.22.221 -j REJECT --reject-with tcp-reset åœ¨dev01ä¸Šå°ç¦test02,ç„¶åtest02å°è¯•å‘é€æ•°æ®åŒ…ï¼Œè¯¡å¼‚çš„äº‹æƒ…å‡ºç°äº†ï¼Œtest02å¹¶æ²¡æœ‰å¦‚æˆ‘ä»¬æ‰€æœŸæœ›çš„é‚£æ ·æ”¶åˆ°dev01çš„RESETå“åº” éš¾é“è¯´æ˜¯iptablesçš„OUTPUTç­–ç•¥å§resetåŒ…ç»™æ‹¦æˆªäº†ï¼Ÿ åœ¨å»ºè¿ä¹‹ååªç»™dev01å†™å…¥ä¸€æ¡INPUTç­–ç•¥è¯•ä¸‹ï¼š æœç„¶ï¼Œè¿™æ—¶å€™testå‘é€æ•°æ®åŒ…åç«‹å³æ”¶åˆ°äº†RESETåŒ… è‡³æ­¤ï¼Œæˆ‘ä»¬å¾—åˆ° ç»“è®ºä¸‰ï¼šå¯¹äºå·²å»ºè¿çš„TCPï¼Œä½¿ç”¨å‘½ä»¤ 1iptables -I INPUT -p tcp -s 10.48.22.221 -j REJECT --reject-with tcp-reset å¯ä»¥ä½¿TCPè¿æ¥ç«‹å³æ–­å¼€ã€‚ ç»“è®ºå››ï¼šiptables OUTPUTç­–ç•¥å’ŒINPUTç­–ç•¥ä¼šäº’ç›¸å½±å“ï¼Œç”±INPUTå¯¼è‡´çš„å“åº”åŒ…ä¼šè¢«OUTPUTç­–ç•¥ç»™æ‹¦æˆªã€‚ æ€»ç»“ä¸€ä¸‹æœ¬æ–‡ä¸»è¦ä»‹ç»äº†ä½¿ç”¨iptableså‘½ä»¤è¿›è¡Œipå°ç¦çš„æ’æŸ¥ä¹‹è·¯ï¼Œä¹‹ä¸­ä¼šæ¶‰åŠåˆ°å¾ˆå¤šç½‘ç»œçŸ¥è¯†ï¼Œå¸Œæœ›å¯¹å„ä½å°ä¼™ä¼´æœ‰æ‰€å¸®åŠ©ã€‚","categories":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"http://example.com/categories/%E7%BD%91%E7%BB%9C/"}],"tags":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"http://example.com/tags/%E7%BD%91%E7%BB%9C/"}]},{"title":"èŠä¸€èŠé™æµä¹‹guavaé™æµå™¨","slug":"èŠä¸€èŠé™æµä¹‹guavaé™æµå™¨","date":"2022-10-22T10:00:00.000Z","updated":"2023-05-29T14:17:37.600Z","comments":true,"path":"2022/10/22/èŠä¸€èŠé™æµä¹‹guavaé™æµå™¨/","link":"","permalink":"http://example.com/2022/10/22/%E8%81%8A%E4%B8%80%E8%81%8A%E9%99%90%E6%B5%81%E4%B9%8Bguava%E9%99%90%E6%B5%81%E5%99%A8/","excerpt":"","text":"å‰è¨€é™æµæ˜¯å¾®æœåŠ¡åº”ç”¨ä¸­ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„è¯é¢˜ï¼Œå½“Aè°ƒBæ—¶ï¼Œä¸ºäº†é˜²æ­¢Açš„æµé‡è¿‡å¤§æŠŠBæ‰“å®ï¼Œéœ€è¦ä¸ºBé…ç½®é™æµï¼Œé™åˆ¶ä¸Šæ¸¸åº”ç”¨å¯¹Bçš„è°ƒç”¨é¢‘ç‡ã€‚å…³äºé™æµç®—æ³•ï¼Œæœ‰æ¼æ¡¶ç®—æ³•ã€ä»¤ç‰Œæ¡¶ç®—æ³•ã€è®¡æ•°å™¨ç®—æ³•ã€æ»‘åŠ¨çª—å£ç®—æ³•ï¼Œæœ¬æ–‡ä¸å†èµ˜è¿°ã€‚æœ¬æ–‡ä¸»è¦è®²è§£guavaä¸­çš„é™æµç®—æ³•ã€‚ ç”¨æ³•guavaé™æµç®—æ³•å®ç°çš„æ˜¯ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œä¾èµ–äºåŒ… 12345&lt;dependency&gt; &lt;groupId&gt;com.google.guava&lt;/groupId&gt; &lt;artifactId&gt;guava&lt;/artifactId&gt; &lt;version&gt;31.0-jre&lt;/version&gt;&lt;/dependency&gt; èµŠè´¦æœºåˆ¶ï¼Œå°†é˜»å¡æ—¶é—´å»¶å123456public static void main(String[] args) &#123; RateLimiter rateLimiter = RateLimiter.create(1); //åˆ›å»ºä¸€ä¸ªé™æµå™¨ï¼Œæ¯ç§’å…è®¸è·å–ä¸€ä¸ªä»¤ç‰Œ while (true)&#123; System.out.println(&quot;get token in &quot;+rateLimiter.acquire()+&quot;s&quot;); //rateLimiter.acquireè¿”å›è·ç¦»ä¸Šæ¬¡è·å–é™æµå™¨ç­‰å¾…çš„æ—¶é—´ &#125;&#125; è¾“å‡ºï¼š 12345get token in 0.0s //ç¬¬ä¸€æ¬¡è·å–ä»¤ç‰Œä¸ç”¨ç­‰å¾…ã€‚get token in 0.997387sget token in 0.992418sget token in 0.996242sget token in 1.000031s å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ç¬¬ä¸€æ¬¡è·å–ä»¤ç‰Œçš„æ—¶å€™ï¼Œé™æµå™¨å¹¶æ²¡æœ‰ç­‰å¾…ä¸€ç§’ï¼Œè€Œæ˜¯ç›´æ¥è·å–ï¼Œåå€’æ˜¯ä»ç¬¬äºŒæ¬¡è·å–ä»¤ç‰Œçš„æ—¶å€™æ‰å¼€å§‹ç­‰å¾…ï¼Œè¿™ä¹Ÿæ˜¯guavaä»¤ç‰Œæ¡¶ç®—æ³•çš„ç‰¹ç‚¹ä¹‹ä¸€ï¼šèµŠè´¦ï¼Œå°†å½“å‰è¯·æ±‚æœ¬åº”é˜»å¡çš„æ—¶é—´é¡ºå»¶ç»™ä¸‹ä¸€ä¸ªè¯·æ±‚å¤„ç†ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¦™çš„è®¾è®¡ï¼Œè¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœé¢å¯¹ä¸‹é¢çš„æƒ…å†µï¼Œç¬¬ä¸€ä¸ªè¯·æ±‚ä¸ç”¨ç­‰100sï¼Œè€Œæ˜¯ç«‹å³é€šè¿‡ï¼Œåå€’æ˜¯ç¬¬äºŒä¸ªè¯·æ±‚éœ€è¦ç­‰100såæ‰èƒ½é€šè¿‡ï¼Œå¾ˆå·§å¦™åœ°å°†é˜»å¡æ—¶é—´å»¶åäº†ï¼Œè‡³äºä¼šä¸ä¼šæœ‰ç¬¬äºŒä¸ªè¯·æ±‚ã€ç¬¬äºŒä¸ªè¯·æ±‚è¦è¯·æ±‚å‡ ä¸ªä»¤ç‰Œï¼Œé‚£éƒ½æ˜¯100såçš„äº‹æƒ…äº†ï¼Œè¿™ç§èµŠè´¦æœºåˆ¶æå‡äº†é™æµå™¨å¯¹äºå½“å‰è¯·æ±‚çš„å¤„ç†é€Ÿåº¦ã€‚ 123456public static void main(String[] args) &#123; RateLimiter rateLimiter = RateLimiter.create(1); while (true)&#123; System.out.println(&quot;get token in &quot;+rateLimiter.acquire(100)+&quot;s&quot;); &#125;&#125; ä»¤ç‰Œç´¯ç§¯ï¼Œåº”å¯¹çªå‘æµé‡guavaé™æµå™¨ä¼šå°†å½“å‰æ²¡æœ‰ç”¨å®Œçš„ä»¤ç‰Œå›¤ç§¯ä¸‹æ¥ï¼Œä»¥ä¾¿åº”å¯¹æœªæ¥çš„çªå‘æµé‡ã€‚é»˜è®¤ä¼šç§¯æ”’ä¸€ç§’çš„ä»¤ç‰Œé‡ï¼Œå¯¹äºä¸‹è¿°ä»£ç ï¼Œ 123456public static void main(String[] args) &#123; RateLimiter rateLimiter = RateLimiter.create(1); while (true)&#123; System.out.println(&quot;get token in &quot;+rateLimiter.acquire(1)+&quot;s&quot;); &#125;&#125; è¾“å‡º 12345get token in 0.0sget token in 0.997302sget token in 0.993367sget token in 0.995367sget token in 0.995384s å³æ¯éš”ä¸€ç§’æ‰èƒ½è·å–ä¸€ä¸ªä»¤ç‰Œï¼Œä½†æ˜¯å¦‚æœé™æµå™¨å¯åŠ¨åå½“å‰çº¿ç¨‹sleepä¸€ç§’å†è·å–ä»¤ç‰Œæ—¶ï¼Œæ­¤æ—¶å‰å…­æ¡è¯·æ±‚ï¼ˆå‰äº”æ¡ç”¨ç´¯ç§¯çš„ä»¤ç‰Œï¼Œç¬¬å…­æ¡èµŠè´¦ï¼‰ä¸ç”¨é˜»å¡ï¼Œèƒ½å¤Ÿç«‹å³è·å¾—ä»¤ç‰Œï¼ŒåŸå› å°±åœ¨äºé™æµå™¨ç§¯æ”’äº†è¿™ä¸€ç§’çš„ä»¤ç‰Œã€‚ å³å¯¹äºä¸‹è¿°ä»£ç ï¼š 1234567public static void main(String[] args) throws InterruptedException &#123; RateLimiter rateLimiter = RateLimiter.create(5); Thread.sleep(1000); while (true)&#123; System.out.println(&quot;get token in &quot;+rateLimiter.acquire(1)+&quot;s&quot;); &#125; &#125; è¾“å‡ºï¼š 1234567get token in 0.0sget token in 0.0sget token in 0.0sget token in 0.0sget token in 0.0sget token in 0.0sget token in 0.194899s åŸç†åœ¨äº†è§£guavaä»¤ç‰Œæ¡¶ç®—æ³•çš„åŸç†ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥æ€è€ƒä¸‹ï¼Œå¦‚æœè®©æˆ‘ä»¬æ¥å®ç°ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œéœ€è¦æ€ä¹ˆå†™ï¼Ÿ æ‰€è°“ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œå°±æ˜¯ä»¥å›ºå®šçš„é€Ÿç‡å¾€ä¸€ä¸ªæ¡¶é‡Œæ”¾ä»¤ç‰Œï¼Œå½“æœ‰è¯·æ±‚æ¥æ—¶ï¼Œå°±ä»æ¡¶é‡Œå–ä»¤ç‰Œï¼Œå¦‚æœæ¡¶ç©ºäº†ï¼Œå°±é˜»å¡è¯·æ±‚ï¼Œç›´åˆ°æ¡¶é‡Œæœ‰ä»¤ç‰Œä¸ºæ­¢ã€‚æŒ‰ç…§ä»¤ç‰Œæ¡¶ç®—æ³•çš„æ€æƒ³ï¼Œæœ€ç›´è§‚çš„å®ç°æ€è·¯å°±æ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼Œä¸“é—¨èµ·ä¸€ä¸ªç”Ÿäº§ä»¤ç‰Œçš„çº¿ç¨‹ï¼Œä»¥å›ºå®šé€Ÿç‡å¾€é›†åˆï¼ˆæ¡¶ï¼‰é‡Œç”Ÿäº§ä»¤ç‰Œã€‚ä½†å¦‚æœè¿™ä¹ˆåšçš„è¯å°±ä¼šæœ‰äº›å¤æ‚ï¼Œæ¶‰åŠåˆ°ä¸€äº›çº¿ç¨‹å®‰å…¨çš„æ“ä½œã€‚ guavaä»¤ç‰Œæ¡¶çš„å®ç°å°±æ¯”è¾ƒå·§å¦™äº†ï¼Œå°†å¤šçº¿ç¨‹çš„ä»¤ç‰Œæ“ä½œæ¢ç®—æˆå•çº¿ç¨‹çš„æ—¶é—´æ“ä½œã€‚ç”±äºç”Ÿäº§ä»¤ç‰Œçš„é€Ÿç‡æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥åªè¦çŸ¥é“ç”Ÿäº§ä»¤ç‰Œçš„èµ·æ­¢æ—¶é—´ï¼Œå°±èƒ½ç®—å‡ºè¿™æ®µæ—¶é—´é‡Œç”Ÿäº§äº†å¤šå°‘ä»¤ç‰Œï¼Œæ¯æ¬¡å½“æœ‰è¯·æ±‚åˆ°æ¥æ—¶ï¼Œè®¡ç®—ä¸‹è¿„ä»Šä¸€å…±å­˜äº†å¤šå°‘ä»¤ç‰Œï¼Œå¦‚æœä»¤ç‰Œå¤Ÿç”¨ï¼Œåˆ™é€šè¿‡è¯·æ±‚ï¼Œæ›´æ–°å‰©ä½™ä»¤ç‰Œæ•°ï¼Œå¦åˆ™ï¼Œå…ˆèµŠè´¦è®©å½“å‰è¯·æ±‚é€šè¿‡ï¼Œç„¶åè®¡ç®—ä¸‹æ¬¡è¯·æ±‚åº”è¯¥é˜»å¡çš„æœ€æ—©æ—¶é—´ã€‚ é¦–å…ˆäº†è§£ä¸‹ratelimiteré‡Œé¢å‡ ä¸ªå¾ˆé‡è¦çš„å˜é‡ 12345678910//SmoothRateLimiter.java//å½“å‰å­˜å‚¨ä»¤ç‰Œæ•°double storedPermits;//æ·»åŠ ä»¤ç‰Œæ—¶é—´é—´éš”ï¼Œå¦‚æœqpsæ˜¯5ï¼Œåˆ™æ—¶é—´é—´éš”åˆ™ä¸º200msï¼Œå³æ¯200msè·å–ä¸€ä¸ªä»¤ç‰Œdouble stableIntervalMicros;//ä¸‹ä¸€æ¬¡è¯·æ±‚å¯ä»¥è·å–ä»¤ç‰Œçš„èµ·å§‹æ—¶é—´//ä¹Ÿå°±æ˜¯ä¸Šæ–‡æåˆ°çš„èµŠè´¦æœºåˆ¶ï¼Œä¸Šæ¬¡è¯·æ±‚é¢„æ¶ˆè´¹ä»¤ç‰Œå//ä¸‹æ¬¡è¯·æ±‚éœ€è¦ç­‰å¾…ç›¸åº”çš„æ—¶é—´åˆ°nextFreeTicketMicrosæ—¶åˆ»æ‰å¯ä»¥è·å–ä»¤ç‰Œprivate long nextFreeTicketMicros = 0L; å…ˆæ¥çœ‹ä¸‹acquireæ–¹æ³•ï¼š 123456//RateLimiter.javapublic double acquire(int permits) &#123; long microsToWait = reserve(permits); //è¿”å›è·å–ç›®æ ‡ä»¤ç‰Œæ•°æ‰€éœ€ç­‰å¾…çš„æ—¶é—´ stopwatch.sleepMicrosUninterruptibly(microsToWait); return 1.0 * microsToWait / SECONDS.toMicros(1L);&#125; å…¶ä¸­reserveæ–¹æ³•è¿”å›è·å–ç›®æ ‡ä»¤ç‰Œæ•°æ‰€éœ€ç­‰å¾…çš„æ—¶é—´ï¼š 1234567//RateLimiter.javafinal long reserve(int permits) &#123; checkPermits(permits); synchronized (mutex()) &#123; return reserveAndGetWaitLength(permits, stopwatch.readMicros()); &#125;&#125; 12345//RateLimiter.javafinal long reserveAndGetWaitLength(int permits, long nowMicros) &#123; long momentAvailable = reserveEarliestAvailable(permits, nowMicros); return max(momentAvailable - nowMicros, 0);&#125; æ¥ä¸‹æ¥å°±æ˜¯æ ¸å¿ƒéƒ¨åˆ†äº†ï¼š 12345678910111213141516171819202122//SmoothRateLimiter.javafinal long reserveEarliestAvailable(int requiredPermits, long nowMicros) &#123; //åˆ·æ–°æˆªæ­¢ç›®å‰çš„ä»¤ç‰Œæ•° storedPermits å’Œä¸‹æ¬¡èƒ½è·å–ä»¤ç‰Œçš„æ—¶é—´ nextFreeTicketMicros resync(nowMicros); //ä¸‹æ¬¡å…è®¸è·å–ä»¤ç‰Œçš„æ—¶é—´ç‚¹ long returnValue = nextFreeTicketMicros; //å¾—å‡ºéœ€è¦èŠ±è´¹çš„ä»¤ç‰Œæ•°ï¼Œæ¯”å¦‚éœ€è¦5ä¸ªï¼Œå½“å‰ä¸€å…±å­˜äº†3ä¸ªï¼Œåˆ™è¿”å›3ï¼›å¦‚éœ€æ±‚3ä¸ªï¼Œä½†å­˜äº†5ä¸ªï¼Œä»è¿”å›3 double storedPermitsToSpend = min(requiredPermits, this.storedPermits); //é™¤å»å·²ç§¯æ”’çš„ä»¤ç‰Œï¼Œè¿˜éœ€é¢å¤–æ”¯ä»˜çš„ä»¤ç‰Œï¼Œæ¯”å¦‚éœ€æ±‚5ä¸ªï¼Œå½“å‰å­˜äº†3ä¸ªï¼Œåˆ™è¿˜éœ€é¢å¤–æ”¯ä»˜ä¸¤ä¸ª double freshPermits = requiredPermits - storedPermitsToSpend; //æŠŠè¦é¢å¤–æ”¯ä»˜çš„ä»¤ç‰Œæ•°æ¢ç®—æˆæ—¶é—´ï¼Œæ¯”å¦‚è¿˜éœ€é¢å¤–æ”¯ä»˜ä¸¤ä¸ªï¼Œå¦‚æœè®¾ç½®çš„qpsæ˜¯5ï¼Œå³æ¯200msç”Ÿäº§ä¸€ä¸ªä»¤ç‰Œï¼Œé‚£2ä¸ªä»¤ç‰Œå°±éœ€è¦ç­‰å¾…400ms long waitMicros = storedPermitsToWaitTime(this.storedPermits, storedPermitsToSpend) + (long) (freshPermits * stableIntervalMicros); //æ›´æ–°ä¸‹æ¬¡è·å–ä»¤ç‰Œçš„æ—¶é—´ï¼Œ //è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œè¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼æ˜¯ returnValueï¼Œå³æ›´æ–°å‰çš„ nextFreeTicketMicrosï¼Œ //ä¹Ÿå°±æ˜¯è¯´å½“å‰è¯·æ±‚éœ€è¦é˜»å¡çš„æ—¶é—´ä¸å˜ï¼Œè€Œæ˜¯å°†éœ€è¦é¢å¤–æ”¯ä»˜çš„æ—¶é—´äº¤ç»™ä¸‹ä¸ªè¯·æ±‚ï¼Œä¸‹ä¸ªè¯·æ±‚éœ€è¦é˜»å¡æ›´ä¹…ï¼Œä¹Ÿå°±æ˜¯ä¸Šæ–‡è®²åˆ°çš„èµŠè´¦æœºåˆ¶ this.nextFreeTicketMicros = LongMath.saturatedAdd(nextFreeTicketMicros, waitMicros); //æ›´æ–°å·²å­˜å‚¨çš„ä»¤ç‰Œ this.storedPermits -= storedPermitsToSpend; return returnValue;&#125; åŒæ­¥nextFreeTicket 12345678void resync(long nowMicros) &#123; // if nextFreeTicket is in the past, resync to now if (nowMicros &gt; nextFreeTicketMicros) &#123; double newPermits = (nowMicros - nextFreeTicketMicros) / coolDownIntervalMicros(); storedPermits = min(maxPermits, storedPermits + newPermits); nextFreeTicketMicros = nowMicros; &#125;&#125; ä¸‹é¢é€šè¿‡ä¸€ä¸ªå°ğŸŒ°æ¥è§£é‡Šä¸€ä¸‹ï¼Œåœ¨ä¸‹å›¾ä¸­ï¼Œå‡è®¾é™æµå™¨é™æµä¸º5ps, å³æ¯200msä¸€ä¸ªè¯·æ±‚ï¼Œå½“ç¬¬ä¸€ä¸ªè¯·æ±‚åœ¨é™æµå™¨å¯åŠ¨æ—¶ï¼ˆå³0sï¼‰æ—¶åˆ°æ¥ï¼Œè¿™æ—¶å€™ä¼šç›´æ¥é€šè¿‡ï¼Œå¹¶è®¡ç®—å…è®¸ä¸‹æ¬¡è¯·æ±‚é€šè¿‡çš„æ—¶é—´ï¼Œç”±äºæ­¤æ—¶æ˜¯è¯·æ±‚ä¸¤ä¸ªä»¤ç‰Œï¼Œæ‰€ä»¥nextFreeTicketä¸º2*200ms=400msï¼Œåœ¨0-400msæœŸé—´åˆ°æ¥çš„è¯·æ±‚éƒ½ä¼šé˜»å¡åˆ°400msæ‰å…è®¸é€šè¿‡ï¼Œå¹¶å†æ¬¡æ›´æ–°nextFreeTicket. å†™åœ¨æœ€åè¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†guavaä»¤ç‰Œæ¡¶ç®—æ³•çš„ç”¨æ³•ä»¥åŠåŸç†ï¼Œæ–‡ç« åªæŒ‘é€‰äº†æœ€æ ¸å¿ƒçš„éƒ¨åˆ†è¿›è¡Œäº†ä»‹ç»ï¼Œå…³äºguava ratelimiter, é™¤äº†æ–‡ä¸­ä»‹ç»çš„åº”å¯¹çªå‘æµé‡çš„é™æµå™¨å¤–ï¼Œè¿˜æœ‰å¹³æ»‘é¢„çƒ­ï¼ˆwarmingUpï¼‰é™æµï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡Œäº†è§£ã€‚ ä»å·¥ç¨‹è§’åº¦è®²ï¼Œä¸Šè¿°é™æµå™¨æ˜¯ä¸€ç§å•æœºé™æµï¼Œå³åªèƒ½é’ˆå¯¹å•å°æœºå™¨ç”Ÿæ•ˆï¼Œä½†çœŸå®ç¯å¢ƒä¸­ä¸€ä¸ªåº”ç”¨æ›´å¤šæ˜¯é›†ç¾¤éƒ¨ç½²ï¼Œéœ€è¦é’ˆå¯¹æ•´ä¸ªé›†ç¾¤é™æµï¼Œæ¯”å¦‚è®©æ•´ä¸ªé›†ç¾¤çš„qpså°äºæŸä¸ªé˜ˆå€¼ï¼Œè¿™å°±éœ€è¦ç”¨åˆ°é›†ç¾¤é™æµï¼Œæ¯”å¦‚é˜¿é‡Œå·´å·´å¼€æºçš„sentinelã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[]},{"title":"èŠä¸€èŠDelayQueue","slug":"èŠä¸€èŠDelayQueue","date":"2022-07-06T15:00:00.000Z","updated":"2023-05-29T14:17:37.602Z","comments":true,"path":"2022/07/06/èŠä¸€èŠDelayQueue/","link":"","permalink":"http://example.com/2022/07/06/%E8%81%8A%E4%B8%80%E8%81%8ADelayQueue/","excerpt":"","text":"DelayQueueä½œä¸ºå»¶æ—¶é˜Ÿåˆ—ï¼Œæœ‰å¾ˆå¤šåº”ç”¨åœºæ™¯ï¼Œä»Šå¤©ä¸»è¦æ¥èŠä¸€ä¸‹å®ƒçš„åŸç†ã€ä¼˜ç¼ºç‚¹ä»¥åŠåº”ç”¨åœºæ™¯ã€‚ åŸºæœ¬ç”¨æ³•DelayQueueçš„å…ƒç´ éœ€è¦å®ç°Delayedæ¥å£, å¹¶è¦†ç›–getDelayæ–¹æ³•å’ŒcompareToæ–¹æ³•ï¼Œå…¶ä¸­getDelayæ–¹æ³•ä¼šè¢«è½®è¯¢è°ƒç”¨ï¼Œä»¥åˆ¤æ–­å½“å‰ä»»åŠ¡æ˜¯å¦åˆ°è¾¾æ‰§è¡Œæ—¶é—´ï¼ŒcomparedToæ–¹æ³•åˆ™æ˜¯ç”¨æ¥æ¯”è¾ƒæ¯ä¸ªä»»åŠ¡çš„å…ˆåå…³ç³»ã€‚ åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324public class MyTask implements Delayed &#123; private long curTime = System.currentTimeMillis(); private long executeTime; private long delayTime; public MyTask(long time) &#123; this.delayTime = time; this.executeTime = curTime + time; &#125; public void execute() &#123; System.out.println(&quot;execute task with delay &quot; + delayTime); &#125; @Override public long getDelay(TimeUnit unit) &#123; return unit.convert(executeTime - System.currentTimeMillis(),TimeUnit.MILLISECONDS); &#125; @Override public int compareTo(Delayed o) &#123; return (int) (this.executeTime - ((MyTask) o).executeTime); &#125;&#125; æµ‹è¯•ç±» 1234567891011121314151617181920212223public class DelayQueueApp &#123; public static void main(String[] args) &#123; DelayQueue&lt;MyTask&gt; queue = new DelayQueue&lt;&gt;(); queue.add(new MyTask(10_000)); queue.add(new MyTask(15_000)); queue.add(new MyTask(5_000)); new Thread(new Runnable() &#123; @Override public void run() &#123; while (true) &#123; try &#123; MyTask task = queue.take(); task.execute(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;).start(); &#125;&#125; æˆ‘ä»¬ç»™queueé‡Œæ·»åŠ ä¸‰ä¸ªå…ƒç´ ï¼Œå»¶è¿Ÿåˆ†åˆ«æ˜¯10ms, 15mså’Œ5ms, ç„¶ååœ¨å­çº¿ç¨‹é‡Œä»è¿™ä¸ªqueueé‡Œå–ä»»åŠ¡å¹¶æ‰§è¡Œï¼Œè¾“å‡ºï¼š 123execute task with delay 5000execute task with delay 10000execute task with delay 15000 å¯ä»¥çœ‹åˆ°ä»»åŠ¡æ˜¯æŒ‰ç…§å»¶è¿Ÿæ—¶é—´æ’åºå‡ºé˜Ÿçš„ã€‚ åŸç†DelayQueueæ˜¯åŸºäºä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„ï¼Œå¹¶ä¸”æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å…ˆåˆ—å‡ºDelayQueueä¸­å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„çš„æ¦‚å¿µï¼š ä¼˜å…ˆçº§é˜Ÿåˆ—PriorityQueue:DelayQueueçš„åº•å±‚æ˜¯ä¼˜å…ˆçº§é˜Ÿåˆ— Threadç±»å‹çš„leaderå˜é‡ å¯é‡å…¥é”ï¼šç”¨äºæ§åˆ¶å…¥é˜Ÿå’Œå‡ºé˜Ÿçš„çº¿ç¨‹å®‰å…¨ ä¼˜å…ˆçº§é˜Ÿåˆ—å’Œå¯é‡å…¥é”è¿™é‡Œä¸å†èµ˜è¿°ï¼Œå…³äºleaderå˜é‡éœ€è¦ç€é‡è¯´æ˜ä¸‹ï¼Œ**DelayQueueå¯èƒ½ä¼šæœ‰å¤šä¸ªæ¶ˆè´¹è€…çº¿ç¨‹**ï¼Œç„¶è€Œä¸€ä¸ªä»»åŠ¡èŠ‚ç‚¹æœ€ç»ˆåªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æŠ¢åˆ°ï¼Œä¸ºäº†ä¸ºäº†é¿å…ä¸å¿…è¦çš„äº‰æŠ¢ï¼ŒDelayQueueä½¿ç”¨äº†â€œLeader-Followerâ€æ¨¡å¼ï¼Œè¯´ç™½äº†å°±æ˜¯å°†æ¶ˆè´¹è€…çº¿ç¨‹æ’é˜Ÿï¼Œæ¯æ¬¡åªè®©leaderçº¿ç¨‹å»è·å–é˜Ÿé¦–èŠ‚ç‚¹ï¼Œè¿™é‡Œå°±æ¶‰åŠåˆ°ä¸¤ä¸ªç‚¹ï¼š å½“é˜Ÿé¦–å…ƒç´ å‘ç”Ÿå˜åŒ–æ—¶ï¼ˆæ¯”å¦‚åå…¥é˜Ÿçš„å…ƒç´ ä¼˜å…ˆçº§æ›´é«˜ï¼Œæˆäº†é˜Ÿé¦–å…ƒç´ ï¼‰ï¼Œleaderçº¿ç¨‹ä¹Ÿåº”å½“è·Ÿç€åˆ·æ–°ï¼Œå³leaderçº¿ç¨‹æ€»æ˜¯è‡´åŠ›äºè·å–é˜Ÿé¦–å…ƒç´ ã€‚ å½“leaderçº¿ç¨‹æ‰§è¡Œç»“æŸåï¼Œåº”å½“é‡æ–°äº§ç”Ÿleaderçº¿ç¨‹ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒLeader-Followeræ¨¡å¼å¹¶ä¸èƒ½å‡å°‘awaitNanosçš„æ—¶é—´ï¼Œå®ƒæ˜¯ç”¨æ¥é¿å…ä¸å¿…è¦çš„çº¿ç¨‹çŠ¶æ€åˆ‡æ¢çš„ï¼Œå¦‚æœä¸ç”¨Leader-Followeræ¨¡å¼ï¼Œä¹Ÿèƒ½å®ç°è¯¥åŠŸèƒ½ï¼Œä½†æ˜¯ä¼šå¢åŠ ä¸€äº›æ— æ„ä¹‰çš„çº¿ç¨‹wakeup/sleepï¼›å¦‚æœä½¿ç”¨Leader-Followeræ¨¡å¼ï¼Œåªæœ‰leaderçº¿ç¨‹ä¼šåœ¨æŒ‡å®šæ—¶é—´åè¢«å”¤é†’ï¼Œå…¶ä»–çº¿ç¨‹åˆ™æ˜¯æ— é™æœŸç­‰å¾…ï¼Œç›¸æ¯”ä¹‹ä¸‹ï¼Œåè€…æ›´é«˜æ•ˆã€‚ å…¥é˜Ÿæ–¹æ³• 123456789101112131415161718public boolean offer(E e) &#123; final ReentrantLock lock = this.lock; lock.lock(); try &#123; q.offer(e); //å…ƒç´ å…¥é˜Ÿ /**å¦‚æœå½“å‰æ˜¯é˜Ÿé¦–ï¼ˆæœ‰äººä¼šå¥½å¥‡ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸ªåˆ¤æ–­ï¼Œè¿™æ˜¯å› ä¸ºå½“å‰æ˜¯ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œåå…¥é˜Ÿçš„å…ƒç´ ä¹Ÿå¯èƒ½æ˜¯é˜Ÿé¦–ï¼‰ï¼Œ å¦‚æœé˜Ÿé¦–å…ƒç´ æœ‰å˜åŒ–ï¼Œé‚£leaderçº¿ç¨‹ä¹Ÿåº”å½“è·Ÿç€å˜åŒ–ï¼Œæ‰€ä»¥è¿™é‡Œå°†leaderç½®ä¸ºnull, ç­‰å¾…å‡ºé˜Ÿæ—¶é‡æ–°é€‰æ‹© **/ if (q.peek() == e) &#123; leader = null; available.signal(); &#125; return true; &#125; finally &#123; lock.unlock(); &#125; &#125; è¿™é‡Œé¦–å…ˆä¼šåŠ ä¸ªå¯é‡å…¥é”ï¼Œç„¶åç»™qæ·»åŠ å…ƒç´ ï¼ŒæŸ¥çœ‹qçš„å®šä¹‰ï¼Œå¯ä»¥çœ‹åˆ°å®ƒå°±æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚ 1private final PriorityQueue&lt;E&gt; q = new PriorityQueue&lt;E&gt;(); è¿™é‡Œæœ‰æ®µä»£ç éœ€è¦æ³¨æ„ä¸‹ï¼š 1234if (q.peek() == e) &#123; leader = null; available.signal();&#125; å‡ºé˜Ÿæ–¹æ³• 123456789101112131415161718192021222324252627282930313233343536public E take() throws InterruptedException &#123; final ReentrantLock lock = this.lock; lock.lockInterruptibly(); try &#123; for (;;) &#123; E first = q.peek(); if (first == null) //å¦‚æœé˜Ÿç©ºï¼Œåˆ™å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…é˜Ÿåˆ— available.await(); else &#123; long delay = first.getDelay(NANOSECONDS); if (delay &lt;= 0) //å¦‚æœé˜Ÿé¦–å…ƒç´ å·²åˆ°æœŸï¼Œåˆ™ç›´æ¥å‡ºé˜Ÿ return q.poll(); /**å¦åˆ™ï¼Œè¯´æ˜å½“å‰çº¿ç¨‹è¦æ’é˜Ÿç­‰å€™ï¼Œè¿™æ—¶å€™å°±è¦å†³å®šå½“å‰çº¿ç¨‹æ˜¯leaderçº¿ç¨‹è¿˜æ˜¯followçº¿ç¨‹ï¼Œå¦‚æœå·²ç»æœ‰leaderäº†ï¼Œé‚£å½“å‰çº¿ç¨‹å°±åª èƒ½æ˜¯followeräº†ï¼Œé»˜é»˜åŠ å…¥ç­‰å¾…é˜Ÿåˆ—å³å¯ã€‚å¦‚æœå½“å‰è¿˜æ²¡æœ‰ç­‰å¾…é˜Ÿåˆ—ï¼Œé‚£å°±æŠŠå½“å‰çº¿ç¨‹ä½œä¸ºleaderçº¿ç¨‹ï¼Œå¹¶è®©å½“å‰çº¿ç¨‹ç­‰å¾…åˆ°å‰©ä½™ æ—¶é—´**/ first = null; // don&#x27;t retain ref while waiting if (leader != null) available.await(); else &#123; Thread thisThread = Thread.currentThread(); leader = thisThread; try &#123; available.awaitNanos(delay); &#125; finally &#123; if (leader == thisThread) leader = null; &#125; &#125; &#125; &#125; &#125; finally &#123; // å¦‚æœé˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œå¹¶ä¸”æ²¡æœ‰Leaderåˆ™ä»ç­‰å¾…é˜Ÿåˆ—æ‹¿å‡ºä¸€ä¸ªçº¿ç¨‹ï¼Œè¿›è¡Œtakeæ“ä½œã€‚ if (leader == null &amp;&amp; q.peek() != null) available.signal(); lock.unlock(); &#125; &#125; åº”ç”¨çœ‹åˆ°ç½‘ä¸Šæœ‰äº›æ–‡ç« è®²DelayQueueå¯ä»¥ç”¨æ¥åšæ·˜å®ä¸‹å•åçš„å®šæ—¶å–æ¶ˆè®¢å•åŠŸèƒ½ï¼Œå¯¹æ­¤ç¬”è€…æŒä¿ç•™æ€åº¦ã€‚DelayQueueä½œä¸ºå»¶è¿Ÿé˜Ÿåˆ—ï¼Œå•ä»æŠ€æœ¯è§’åº¦æ¥çœ‹ç¡®å®å¯ä»¥ï¼Œä½†æ˜¯ä»ç³»ç»Ÿè®¾è®¡è§’åº¦çœ‹åˆ™æœ‰å¾…å•†æ¦·ã€‚ç”¨DelayQueueåšè®¢å•å–æ¶ˆåŠŸèƒ½ï¼Œæ„å‘³ç€åœ¨å†…å­˜ä¸­ç»´æŠ¤å¾…å–æ¶ˆçš„è®¢å•ä¿¡æ¯ï¼Œè¯´æ˜ä½ çš„æœåŠ¡æ˜¯æœ‰çŠ¶æ€çš„ï¼Œè€Œæœ‰çŠ¶æ€æ„å‘³ç€ï¼š1ã€æ— æ³•æ°´å¹³æ‰©å±•ï¼›2ã€å¢åŠ å¼€å‘æˆæœ¬ã€‚ä¸¾ä¸ªğŸŒ°ï¼Œå‡å¦‚å½“å‰è¿™å°æœåŠ¡å™¨çªç„¶å®•æœºï¼Œé‚£é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡éƒ½ä¸ä¼šè¢«æ‰§è¡Œï¼›åˆæ¯”å¦‚é¢ä¸´å¤§ä¿ƒæ—¶ï¼Œå½“å‰æœåŠ¡å™¨ç³»ç»Ÿè´Ÿè½½é£™å‡ï¼Œä½†æ˜¯ç”±äºä»»åŠ¡éƒ½é›†ä¸­åœ¨å½“å‰æœºå™¨çš„DelayQueueé‡Œï¼Œå³ä½¿åŠ æœºå™¨ä¹Ÿæ— æ³•è§£å†³ã€‚æ‰€ä»¥ï¼Œé¢ä¸´ä¸€äº›æ¯”è¾ƒé‡çš„è®¡ç®—ä»»åŠ¡æ—¶ï¼Œéœ€è¦è€ƒè™‘ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œå¯ç”¨æ€§ï¼Œå•å•ä¾èµ–DelayQueueæ˜¯ä¸è¡Œçš„ï¼Œä¸€èˆ¬å¤§å‹å…¬å¸éƒ½ä¼šæœ‰ä¸“é—¨åšå®šæ—¶ä»»åŠ¡çš„ä¸­é—´ä»¶ï¼Œå¯ä»¥ä¾èµ–è¿™äº›ä¸­é—´ä»¶å»å®ç°ï¼Œå¹¶å°†delayqueuä½œä¸ºä¸€ç§é™çº§ç­–ç•¥ï¼Œå¦‚æœæ˜¯å¯¹æ—¶é—´ç²¾ç¡®åº¦è¦æ±‚è¾ƒä½çš„åœºæ™¯ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘å°†è¿™äº›ä»»åŠ¡æŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ï¼Œç„¶åå®šæ—¶å»æ‰«åº“ã€‚ å†™åœ¨æœ€åæ— è®ºå¦‚ä½•ï¼Œæ²¡æœ‰æœ€ç‰›é€¼çš„æ¶æ„ï¼Œåªæœ‰æœ€åˆé€‚çš„æ¶æ„ï¼Œé€‰å‹ä¹‹å‰é™¤äº†ç»„ä»¶æœ¬èº«åŠŸèƒ½ä¹‹å¤–ï¼Œä¹Ÿè¦è€ƒè™‘åˆ°ç³»ç»Ÿç‰¹ç‚¹ï¼Œéœ€è¦åœ¨å¼€å‘æˆæœ¬ã€ç³»ç»Ÿå¯ç”¨æ€§è¦æ±‚ç­‰è¯¸å¤šå› ç´ ä¸­åšæƒè¡¡ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[]},{"title":"ä»å»ºé€ è€…æ¨¡å¼çœ‹è‡ªé™å®šæ³›å‹","slug":"Javaæ³›å‹ä¹‹è‡ªé™å®šç±»å‹","date":"2022-05-22T13:00:00.000Z","updated":"2023-05-29T14:17:39.384Z","comments":true,"path":"2022/05/22/Javaæ³›å‹ä¹‹è‡ªé™å®šç±»å‹/","link":"","permalink":"http://example.com/2022/05/22/Java%E6%B3%9B%E5%9E%8B%E4%B9%8B%E8%87%AA%E9%99%90%E5%AE%9A%E7%B1%BB%E5%9E%8B/","excerpt":"","text":"åŸºæœ¬ç”¨æ³•Javaæä¾›äº†æ³›å‹ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æœŸåšä¸€äº›ç±»å‹æ£€æŸ¥ã€‚ä»¥é›†åˆç±»Listä¸ºä¾‹ï¼Œå¦‚æœæˆ‘ä»¬è¿™æ ·ç”¨ï¼š 123456789101112public class GenericApp &#123; public static void main(String[] args) &#123; List list = new ArrayList(); list.add(1); list.add(&quot;a&quot;); for (Object value : list) &#123; System.out.println((int)value); &#125; &#125;&#125; è™½ç„¶ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ç”±äºè¿™ä¸ªlistä»€ä¹ˆç±»å‹éƒ½èƒ½æ·»åŠ ï¼Œåœ¨è¿è¡ŒæœŸå¦‚æœè¦è·å–å…¶ä¸­å…ƒç´ å¹¶åšä¸€äº›å¼ºåˆ¶ç±»å‹è½¬æ¢çš„è¯ï¼Œä¸€å®šä¼šæŠ¥é”™ã€‚ æœ‰äº†æ³›å‹ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨ç¼–è¯‘å™¨å°±å‘ç°ç¨‹åºçš„ä¸€äº›é—®é¢˜ï¼š 1234567public class GenericApp &#123; public static void main(String[] args) &#123; List&lt;Integer&gt; list = new ArrayList&lt;&gt;(); list.add(1); list.add(&quot;a&quot;); &#125;&#125; ä¸Šè¿°ä»£ç åœ¨ç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºæ³›å‹é™åˆ¶äº†å½“å‰liståªèƒ½æ·»åŠ æ•´å‹ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ³›å‹åªå­˜åœ¨äºç¼–è¯‘æœŸï¼Œç¼–è¯‘å®Œæˆä¹‹åä¼šè¿›è¡Œç±»å‹æ“¦é™¤, å°†ä¸Šè¿°ä»£ç ç¼–è¯‘åå†åç¼–è¯‘ï¼Œä½ ä¼šçœ‹åˆ°listçš„å…ƒç´ ç±»å‹å…¶å®æ˜¯Object å½“ç„¶äº†ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯æœ‰ä¸Šé™é€šé…ç¬¦çš„æ³›å‹ï¼Œé‚£åç¼–è¯‘åæ³›å‹ä¼šè¢«æ›¿æ¢æˆä¸Šç•Œçš„ç±»å‹ã€‚ è‡ªé™å®šç±»å‹åœ¨Javaæ³›å‹ä¸­ï¼Œæœ‰ä¸€ç§æ¯”è¾ƒå¥‡ç‰¹çš„ç”¨æ³•ï¼Œå«è‡ªé™å®šæ³›å‹ï¼ˆSelf Bounded Genericï¼‰ã€‚å†™æ³•æ˜¯è¿™æ ·çš„: 1class SelfBounded&lt;T extends SelfBounded&lt;T&gt;&gt;&#123;&#125; è¿™ç§è‡ªé™å®šæ³›å‹åˆæ¬¡çœ‹èµ·æ¥å¯èƒ½ä¼šæ¯”è¾ƒæ‡µé€¼ï¼ŒSelfBoundedæ¥æ”¶çš„ä¸€ä¸ªæ³›å‹å‚æ•°ï¼Œå¹¶ä¸”è¿™ä¸ªæ³›å‹çš„ä¸Šç•Œæ˜¯å®ƒè‡ªå·±ï¼Ÿçœ‹èµ·æ¥æœ‰ç‚¹é€’å½’è°ƒç”¨çš„æ„æ€ï¼Ÿ å…ˆè¯´ç»“è®ºï¼š å®ƒçš„ä½œç”¨å¸¸å¸¸ä½“ç°åœ¨ç»§æ‰¿ä¸­ï¼Œç”¨äºé™å®šå­ç±»ä¸­æ³›å‹çš„ç±»å‹ä¸Šç•Œï¼Œå½“çˆ¶ç±»çš„æŸä¸ªæ–¹æ³•æƒ³è¦è¿”å›çš„å­ç±»çš„ç±»å‹ï¼Œå¯ä»¥é‡‡ç”¨è‡ªé™å®šç±»å‹è¿™ç§æ–¹å¼ ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå»ºé€ è€…æ¨¡å¼çš„ä¾‹å­æ¥åŠ æ·±å¯¹å®ƒçš„ç†è§£ã€‚ å®ç°ä¸€ä¸ªå»ºé€ è€…æ¨¡å¼æœ‰ä¸€ä¸ªæŠ«è¨ç±»ï¼Œæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œå…·ä½“å®ç°æœ‰èŠå£«æŠ«è¨å’Œç‰›è‚‰æŠ«è¨ï¼Œè¿™ä¸¤ç§æŠ«è¨éƒ½æœ‰ä¸€äº›å…±æœ‰ç‰¹å¾ï¼Œæ¯”å¦‚éƒ½å¯ä»¥å¾€ä¸Šé¢åŠ ä¸€äº›å°æ–™ï¼ˆtoppingï¼‰ï¼ŒåŒæ—¶å„è‡ªåˆæœ‰ä¸€äº›ç‰¹æ€§ï¼Œæ¯”å¦‚èŠå£«æŠ«è¨éœ€è¦æŒ‡å®šå°ºå¯¸ï¼Œè€Œç‰›è‚‰æŠ«è¨éœ€è¦æŒ‡å®šæ˜¯å¦åŠ é…±æ–™ã€‚ æˆ‘ä»¬ä½¿ç”¨Builderæ¨¡å¼æ¥å®ç°è¿™ä¸ªéœ€æ±‚ï¼Œé¦–å…ˆå°†å…±æœ‰å±æ€§æŠ½è±¡åˆ°çˆ¶Builderé‡Œ 1234567891011public abstract class Pizza &#123; public static abstract class Builder &#123; abstract Pizza build(); public Builder addTopping(Topping topping)&#123; System.out.println(&quot;topping added&quot;); return this; &#125; &#125;&#125; èŠå£«æŠ«è¨ 1234567891011121314151617181920212223242526272829public class CheesePizza extends Pizza &#123; private String size; public CheesePizza()&#123;&#125; public CheesePizza(CheesePizzaBuilder builder)&#123; CheesePizza cheesePizza = new CheesePizza(); cheesePizza.size = builder.size; &#125; public static Builder builder()&#123; return new CheesePizzaBuilder(); &#125; public static class CheesePizzaBuilder extends Builder &#123; private String size; @Override Pizza build() &#123; return new CheesePizza(this); &#125; public CheesePizzaBuilder size(String size)&#123; this.size = size; return this; &#125; &#125;&#125; æµ‹è¯•ç±»ï¼š 12345public class PizzaApp &#123; public static void main(String[] args) &#123; Pizza cheesePizza = CheesePizza.builder().size(&quot;small&quot;).addTopping(new Topping()).build(); &#125;&#125; è¿™æ—¶å€™é—®é¢˜å°±å‡ºç°äº†ï¼ŒCheesePizzaçš„builder()æ–¹æ³•è¿”å›Builderç±»ï¼ŒBuilderç±»æ˜¯æ²¡æœ‰sizeæ–¹æ³•çš„ï¼Œå› ä¸ºsizeæ˜¯å­ç±»CheesePizzaBuilderç‰¹æœ‰çš„ã€‚ è¿™å¥½åŠï¼Œæˆ‘æŠŠCheesePizzaçš„builder()æ–¹æ³•è¿”å›å…·ä½“å­ç±»ä¸å°±å¥½äº†ï¼Ÿä¹Ÿä¸æ˜¯ä¸èƒ½ç”¨ï¼Œä½†æ˜¯ä¸ä¼˜é›…ï¼Œè¿™ä¸ªæ”¹åŠ¨æ„å‘³ç€æ¯æ¬¡buildæ—¶å¿…é€‰å…ˆè°ƒç”¨å­ç±»Builderä¸­çš„ç‰¹æœ‰æ–¹æ³•ï¼Œå¦‚size, ç„¶åæ‰èƒ½è°ƒç”¨çˆ¶Builderçš„addToppingæ–¹æ³•ï¼Œè¿™æ ·å¥½å—ï¼Ÿè¿™æ ·ä¸å¥½ï¼Œå¾ˆä¸ä¼˜é›…ã€‚ å¸¦æ³›å‹çš„å»ºé€ è€…æ¨¡å¼å†·é™åˆ†æä¸Šé¢çš„é—®é¢˜ï¼Œä½ å°±ä¼šå‘ç°æ ¹å› åœ¨äºçˆ¶Builderçš„addToppingæ–¹æ³•è¿”å›çš„ç±»å‹å’Œå­Builderçš„sizeæ–¹æ³•è¿”å›çš„ç±»å‹ä¸ä¸€è‡´ã€‚ç†è®ºä¸Šï¼Œæ—¢ç„¶æ˜¯å­Builderè¿›è¡Œbuild, æˆ‘ä»¬è‡ªç„¶å¸Œæœ›å­Builderé‡Œçš„æ¯ä¸ªæ–¹æ³•éƒ½èƒ½è¿”å›å­Builderï¼Œè¿™æ ·æ—¢èƒ½è°ƒç”¨å­Builderè‡ªå·±çš„ç‹¬æœ‰çš„æ–¹æ³•ï¼Œä¹Ÿèƒ½è°ƒç”¨çˆ¶Builderçš„æ–¹æ³•ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆæ”¹é€ : Pizzaç±» 123456789101112131415public abstract class Pizza &#123; public static abstract class Builder&lt;T&gt; &#123; public Builder()&#123;&#125; abstract Pizza build(); public T addTopping(Topping topping)&#123; // è¿™é‡Œåšäº†æ”¹å˜ System.out.println(&quot;topping added&quot;); return self(); &#125; protected abstract T self(); &#125;&#125; CheesePizzaç±» 1234567891011121314151617181920212223public class CheesePizza extends Pizza &#123; ... public static class CheesePizzaBuilder extends Builder&lt;CheesePizzaBuilder&gt; &#123; private String size; public CheesePizzaBuilder()&#123;&#125; @Override Pizza build() &#123; return new CheesePizza(this); &#125; @Override protected CheesePizzaBuilder self() &#123; //è¿™é‡Œåšäº†æ”¹å˜ return this; &#125; public CheesePizzaBuilder size(String size)&#123; this.size = size; return this; &#125; &#125;&#125; è€ƒè™‘åˆ°Builderä¸­çš„æ¯ä¸ªå…·ä½“çš„buildæ–¹æ³•ï¼ˆå¦‚sizeï¼‰éƒ½åº”è¯¥è¿”å›å…·ä½“çš„Builder, æˆ‘ä»¬ä¸ºçˆ¶BuilderåŠ å…¥äº†æ³›å‹ï¼Œè¯¥æ³›å‹è¡¨ç¤ºçš„æ˜¯å…·ä½“çš„Builder, å¹¶åœ¨addToppingåè¿”å›è¯¥æ³›å‹ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¿«ä¹çš„buildäº†ã€‚ è¿˜èƒ½å†ä¼˜åŒ–å—ä»ä¸Šé¢çš„è®¨è®ºå¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬å¼•å…¥çš„æ³›å‹å…¶å®æ˜¯æœ‰ä¸Šç•Œçš„ï¼Œæ³›å‹Tä¸€å®šæ˜¯ç»§æ‰¿è‡ªBuilderçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ›´ç²¾ç®€ä¸€ä¸‹ï¼š 123456789101112131415public abstract class Pizza &#123; public static abstract class Builder&lt;T extends Builder&lt;T&gt;&gt; &#123; //è¿™é‡Œåšäº†ä¿®æ”¹ public Builder()&#123;&#125; abstract Pizza build(); public T addTopping(Topping topping)&#123; System.out.println(&quot;topping added&quot;); return self(); &#125; protected abstract T self(); &#125;&#125; å­ç±»ä¸­çš„å†™æ³•ä¿æŒä¸å˜ï¼š 1public static class CheesePizzaBuilder extends Builder&lt;CheesePizzaBuilder&gt; &#123;&#125; é‚£è¿™æ—¶å€™å°±å‡ºç°äº†æˆ‘ä»¬å‰æ–‡æåˆ°çš„è‡ªé™å®šæ³›å‹ï¼Œå®ƒåœ¨è¿™é‡Œçš„è¯­ä¹‰æ˜¯ï¼šä¼ ç»™Builderçš„æ³›å‹ä¸€å®šæ˜¯ä¸€ä¸ªç»§æ‰¿è‡ªBuilderçš„ç±»å‹ã€‚è¿™ä¹ˆåšæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿå®ƒå¯ä»¥åœ¨ç¼–è¯‘å™¨å°½å¯èƒ½åœ°å¸®æˆ‘ä»¬æ£€æŸ¥å‡ºä¸€äº›é”™è¯¯ï¼Œå¦‚æœè¿™æ—¶å€™å­ç±»çš„Builderæ¥æ”¶äº†ä¸€ä¸ªéç»§æ‰¿è‡ªBuilderçš„ç±»å‹ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°±ä¼šç›´æ¥æŠ¥é”™ã€‚ æ€»ç»“ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†è‡ªé™å®šæ³›å‹ï¼Œå¹¶é€šè¿‡å»ºé€ è€…æ¨¡å¼åŠ æ·±äº†å¯¹å®ƒçš„ç†è§£ã€‚è‡ªé™å®šæ³›å‹ï¼Œå¸¸ç”¨äºä¼ å…¥çš„ç±»å‹å‚æ•°éœ€è¦å’Œç±»æœ¬èº«ç»§æ‰¿è‡ªåŒä¸€çˆ¶ç±»çš„åœºæ™¯ï¼Œè¯´ç™½äº†ï¼Œå®ƒçš„ä½œç”¨å¸¸å¸¸ä½“ç°åœ¨ç»§æ‰¿ä¸­ï¼Œç”¨äºé™å®šå­ç±»ä¸­æ³›å‹çš„ç±»å‹ä¸Šç•Œï¼Œå½“çˆ¶ç±»çš„æŸä¸ªæ–¹æ³•æƒ³è¦è¿”å›çš„å­ç±»çš„ç±»å‹ï¼Œå¯ä»¥é‡‡ç”¨è‡ªé™å®šç±»å‹è¿™ç§æ–¹å¼ï¼ŒåŠ å¼ºç¼–è¯‘æœŸæ ¡éªŒã€‚ å¦‚æœä½ è¦é—®åªç”¨ä¸ªæ³›å‹ï¼Œä¸è¦è‡ªæˆ‘é™å®šè¡Œä¸è¡Œï¼Œç­”æ¡ˆæ˜¯ä¹Ÿè¡Œï¼Œåªä¸è¿‡å‰è€…æ›´â€œç»†â€ï¼Œå‰è€…ä¼šåœ¨ç¼–è¯‘å™¨åšæ›´å¤šçš„ç±»å‹æ ¡éªŒã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"æ³›å‹","slug":"æ³›å‹","permalink":"http://example.com/tags/%E6%B3%9B%E5%9E%8B/"}]},{"title":"å½“ThreadLocalé‡ä¸Šçº¿ç¨‹æ± ","slug":"å½“ThreadLocalé‡ä¸Šçº¿ç¨‹æ± ","date":"2022-04-30T04:00:00.000Z","updated":"2023-05-29T14:17:39.329Z","comments":true,"path":"2022/04/30/å½“ThreadLocalé‡ä¸Šçº¿ç¨‹æ± /","link":"","permalink":"http://example.com/2022/04/30/%E5%BD%93ThreadLocal%E9%81%87%E4%B8%8A%E7%BA%BF%E7%A8%8B%E6%B1%A0/","excerpt":"","text":"æ¸©é¦¨æç¤º: æœ¬æ–‡éœ€è¦åƒåœ¾å›æ”¶ã€å¼ºå¼±å¼•ç”¨ã€å¤šçº¿ç¨‹ç­‰çŸ¥è¯†. ThreadLocalæ˜¯ä»€ä¹ˆThreadLocal, ä»åå­—å¤§æ¦‚å¯ä»¥çŸ¥é“ï¼Œå®ƒæ˜¯ä¸ªçº¿ç¨‹æœ¬åœ°å˜é‡ï¼Œæ„å‘³ç€åªæœ‰å½“å‰çº¿ç¨‹å¯ä»¥ä½¿ç”¨ï¼Œçº¿ç¨‹ä¹‹é—´ç›¸äº’éš”ç¦»ã€‚ ä¸¾ä¸ªğŸŒ°ï¼š 123456789101112131415161718192021222324public class ThreadLocalApp &#123; public static void main(String[] args) &#123; ThreadLocal&lt;String&gt; tl = new ThreadLocal&lt;&gt;(); tl.set(&quot;main&quot;); System.out.println(&quot;å˜æ›´å‰, ä¸»çº¿ç¨‹ä¸­çš„tl: &quot;+tl.get()); new Thread(new Runnable() &#123; @Override public void run() &#123; tl.set(&quot;sub thread&quot;); System.out.println(&quot;å­çº¿ç¨‹ä¸­çš„tl: &quot;+tl.get()); &#125; &#125;).start(); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException ignore) &#123; &#125; System.out.println(&quot;å˜æ›´å, ä¸»çº¿ç¨‹ä¸­çš„tl: &quot;+tl.get()); &#125;&#125; è¾“å‡º: 123å˜æ›´å‰, ä¸»çº¿ç¨‹ä¸­çš„tl: mainå­çº¿ç¨‹ä¸­çš„tl: sub threadå˜æ›´å, ä¸»çº¿ç¨‹ä¸­çš„tl: main ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å…ˆä¸»çº¿ä¸­è®¾ç½®äº†threadLocalä¸ºmainï¼Œç„¶ååœ¨å­çº¿ç¨‹ä¸­å°†tlè®¾ç½®ä¸ºsub threadï¼Œè¿™æ—¶å€™å†å»æ‰“å°ä¸»çº¿ç¨‹çš„tl, å‘ç°è¿˜æ˜¯main. å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å½“å‰çº¿ç¨‹è®¾ç½®threadLocalå˜é‡åï¼Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹ä¸­è¯¥å˜é‡çš„å€¼ã€‚ æœ‰ä»€ä¹ˆç”¨ThreadLocalå¾ˆé€‚åˆåœ¨å•ä¸€çº¿ç¨‹ä¸­ä¼ é€’ä¸€äº›ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚æ¯”å¦‚åœ¨mvcæ¨¡å‹ä¸­ï¼Œåœ¨controllerä¸­è·å–äº†ç”¨æˆ·ä¿¡æ¯ï¼Œç°åœ¨serviceå±‚ä¸­è¦ç”¨åˆ°ï¼Œä¸€ç§æ–¹æ³•å°±æ˜¯æŠŠç”¨æˆ·ä¿¡æ¯æ”¾åˆ°æ–¹æ³•å‚æ•°ä¸­ï¼Œä¸€å±‚ä¸€å±‚ä¼ é€’ä¸‹å»ï¼Œä½†è¿™æ ·å¾ˆç¹çï¼Œå¦ä¸€ç§æ–¹æ³•å°±æ˜¯åˆ©ç”¨ThreadLocal,åœ¨controllerä¸­è®¾ç½®å¥½ï¼Œåœ¨serviceä¸­è¯»å–å³å¯ã€‚ å®ç°åŸç†ä»setæ–¹æ³•æµ…çœ‹ä¸‹threadLocalçš„å®ç°åŸç†: å¯ä»¥çœ‹åˆ°ï¼Œæ‰€è°“çš„setå°±æ˜¯æŠŠvalueæ”¾åˆ°ThreadLocalMapé‡Œï¼š è¿™ä¸ªmapæ˜¯Threadçš„ä¸€ä¸ªé™æ€æˆå‘˜å˜é‡: 1ThreadLocal.ThreadLocalMap threadLocals = null; è‡³æ­¤ä¹Ÿå°±å¤§æ¦‚æ˜äº†äº†ï¼šæ‰€è°“ThreadLocal,ä¹Ÿå°±æ˜¯å®ƒç»´æŠ¤äº†ä¸€ä¸ªæŒ‡å‘Threadå¯¹è±¡çš„ThreadLocalMapç±»å‹çš„å¼•ç”¨ï¼Œå…¶ä¸­Mapçš„keyä¸ºThreadLocalç±»å‹ï¼Œsetå’Œgetçš„æ—¶å€™å°±æ˜¯æ“ä½œçš„éƒ½æ˜¯Threadå¯¹è±¡çš„mapçš„setå’Œgetæ–¹æ³•ï¼Œè¯´ç™½äº†å°±æ˜¯åœ¨æ“ä½œçº¿ç¨‹çš„å±€éƒ¨å˜é‡ï¼Œè‡ªç„¶ä¸ä¼šå—å…¶ä»–çº¿ç¨‹å½±å“ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°å…¶ä»–çº¿ç¨‹ã€‚ åœ¨çº¿ç¨‹æ± ä¸­ä½¿ç”¨ThreadLocalåœ¨çº¿ç¨‹æ± ä¸­ä½¿ç”¨ThreadLocalæ—¶è¦è®°å¾—ç”¨å®Œä¹‹åè¦åŠæ—¶ä½¿ç”¨remove()å›æ”¶,åŸå› å¦‚ä¸‹: åŸå› ä¸€: çº¿ç¨‹æ± é‡å¤ä½¿ç”¨çº¿ç¨‹ æ¥çœ‹ä¸€ä¸ªğŸŒ°: 123456789101112131415161718192021222324252627public class ThreadLocalInPoolApp &#123; public static void main(String[] args) &#123; ThreadLocal&lt;String&gt; tl = new ThreadLocal(); ExecutorService executor = Executors.newFixedThreadPool(5); for (int i = 0; i &lt; 5; i++) &#123; int finalI = i; executor.submit(new Runnable() &#123; @Override public void run() &#123; tl.set(String.valueOf(finalI)); System.out.println(&quot;setå,&quot;+Thread.currentThread().getName()+&quot; tlå€¼:&quot;+tl.get()); &#125; &#125;); &#125; for (int i = 0; i &lt; 5; i++) &#123; int finalI = i; executor.submit(new Runnable() &#123; @Override public void run() &#123; System.out.println(&quot;åœ¨æ–°æäº¤çš„ä»»åŠ¡é‡Œ,&quot;+Thread.currentThread().getName()+&quot; tlå€¼:&quot;+tl.get()); &#125; &#125;); &#125; &#125;&#125; è¾“å‡º: 12345678910setå,pool-1-thread-2 tlå€¼:1setå,pool-1-thread-4 tlå€¼:3setå,pool-1-thread-1 tlå€¼:0setå,pool-1-thread-3 tlå€¼:2setå,pool-1-thread-5 tlå€¼:4åœ¨æ–°æäº¤çš„ä»»åŠ¡é‡Œ,pool-1-thread-4 tlå€¼:3åœ¨æ–°æäº¤çš„ä»»åŠ¡é‡Œ,pool-1-thread-5 tlå€¼:4åœ¨æ–°æäº¤çš„ä»»åŠ¡é‡Œ,pool-1-thread-3 tlå€¼:2åœ¨æ–°æäº¤çš„ä»»åŠ¡é‡Œ,pool-1-thread-1 tlå€¼:0åœ¨æ–°æäº¤çš„ä»»åŠ¡é‡Œ,pool-1-thread-2 tlå€¼:1 åœ¨ä¸Šé¢çš„ä¾‹å­é‡Œï¼Œç¬”è€…åˆ›å»ºäº†ä¸€ä¸ªå¤§å°ä¸º5çš„çš„çº¿ç¨‹æ± ï¼Œåœ¨ç¬¬ä¸€ä¸ªå¾ªç¯é‡Œç»™çº¿ç¨‹æ± é‡Œé¢çš„äº”ä¸ªçº¿ç¨‹è®¾ç½®äº†tlçš„å€¼ï¼Œå½“åç»­åˆç”¨è¿™ä¸ªçº¿ç¨‹æ± çš„æ—¶å€™ï¼Œä¼šå‘ç°ä¹‹å‰è®¾ç½®çš„tlçš„å€¼è¿˜åœ¨ï¼Œè¿™æ˜¯å› ä¸ºçº¿ç¨‹æ± æ˜¯å¤ç”¨æ ¸å¿ƒçº¿ç¨‹çš„ï¼Œå¦‚æœç”¨å®ŒthreadLocalåä¸åŠæ—¶å›æ”¶ï¼Œå°±ä¼šå‡ºç°ä¸Šè¿°ç°è±¡ã€‚ ä¸‹é¢ä¸ºæ­£ç¡®ä½¿ç”¨å§¿åŠ¿: 1234567891011121314151617181920212223242526272829public class ThreadLocalInPoolApp &#123; public static void main(String[] args) &#123; ThreadLocal&lt;String&gt; tl = new ThreadLocal(); ExecutorService executor = Executors.newFixedThreadPool(5); for (int i = 0; i &lt; 5; i++) &#123; executor.submit(new Runnable() &#123; @Override public void run() &#123; try&#123; tl.set(String.valueOf(finalI)); System.out.println(&quot;setå,&quot;+Thread.currentThread().getName()+&quot; tlå€¼:&quot;+tl.get()); &#125;finally&#123; tl.remove(); //è¦åŠæ—¶remove &#125; &#125; &#125;); &#125; for (int i = 0; i &lt; 5; i++) &#123; executor.submit(new Runnable() &#123; @Override public void run() &#123; System.out.println(&quot;åœ¨æ–°æäº¤çš„ä»»åŠ¡é‡Œ,&quot;+Thread.currentThread().getName()+&quot; tlå€¼:&quot;+tl.get()); &#125; &#125;); &#125; &#125;&#125; è¾“å‡º: 12345678910setå,pool-1-thread-1 tlå€¼:0setå,pool-1-thread-5 tlå€¼:4setå,pool-1-thread-4 tlå€¼:3setå,pool-1-thread-3 tlå€¼:2setå,pool-1-thread-2 tlå€¼:1åœ¨æ–°æäº¤çš„ä»»åŠ¡é‡Œ,pool-1-thread-5 tlå€¼:nullåœ¨æ–°æäº¤çš„ä»»åŠ¡é‡Œ,pool-1-thread-2 tlå€¼:nullåœ¨æ–°æäº¤çš„ä»»åŠ¡é‡Œ,pool-1-thread-3 tlå€¼:nullåœ¨æ–°æäº¤çš„ä»»åŠ¡é‡Œ,pool-1-thread-4 tlå€¼:nullåœ¨æ–°æäº¤çš„ä»»åŠ¡é‡Œ,pool-1-thread-1 tlå€¼:null åŸå› äºŒï¼šé™ä½å†…å­˜æ³„éœ²çš„å¯èƒ½å†æ¥çœ‹ä¸‹ThreadLocal.ThreadLocalMapé‡Œé¢çš„entry. å¯ä»¥çœ‹åˆ°ï¼Œentryçš„keyæ˜¯ä¸ªThraedLocalï¼Œå¹¶ä¸”æ˜¯ä¸ªå¼±å¼•ç”¨ã€‚ å¯¹äºå¦‚ä¸‹ä»£ç : 1234567891011121314151617181920212223public class ThreadLocalApp &#123; public static void main(String[] args) throws NoSuchFieldException, IllegalAccessException &#123; //ä»£ç å—â‘  ThreadLocal&lt;String&gt; tl = new ThreadLocal&lt;&gt;(); tl.set(&quot;main&quot;); //ä»£ç å—â‘¡ tl = null; //æŸ¥çœ‹Map Class&lt;?&gt; clazz = Thread.currentThread().getClass(); Field field = clazz.getDeclaredField(&quot;threadLocals&quot;); field.setAccessible(true); Object map = field.get(Thread.currentThread()); //ä»£ç å—â‘¢ System.gc(); //gcåå†æ¬¡æŸ¥çœ‹map map = field.get(Thread.currentThread()); System.out.println(map); &#125;&#125; æ‰§è¡Œå®Œä»£ç å—â‘ åï¼ŒThreadLocalå¯¹è±¡çš„å¼•ç”¨å…³ç³»å¦‚ä¸‹ï¼Œå…¶ä¸­å®çº¿ä¸ºå¼ºå¼•ç”¨, è™šçº¿ä¸ºå¼±å¼•ç”¨ã€‚ è¿™æ—¶å€™é€šè¿‡debugæŸ¥çœ‹threadLocalMap,è¿˜æ˜¯å¯ä»¥çœ‹åˆ°ThreadLocalä»¥åŠæŒ‡å‘å®ƒçš„å¼±å¼•ç”¨çš„: æ‰§è¡Œå®Œä»£ç å—â‘¡åï¼ŒThreadLocalå¯¹è±¡å°±åªæœ‰ä¸€ä¸ªå¼±å¼•ç”¨æŒ‡å‘å®ƒ åœ¨è¿›è¡Œä¸€æ¬¡gcåï¼ŒThreadLocalå°±å½»åº•æ²¦ä¸ºâ€œå­¤å„¿â€äº†ï¼š è¿™æ—¶å€™å†å»çœ‹ThreadLocalMapï¼š è¿™æ—¶å€™å”¯ä¸€å­˜åœ¨çš„ä¸€æ¡æŒ‡å‘valueçš„å¼•ç”¨é“¾ä¸ºï¼šThread -&gt; ThreadLocalMap -&gt; Entry -&gt; value. valueè™½ç„¶ä¸€ç›´å­˜åœ¨ï¼ˆåªè¦å½“å‰çº¿ç¨‹åœ¨ï¼Œvalueå°±ä¸€ç›´åœ¨)ï¼Œä½†æ˜¯å¤–ç•Œå´æ— æ³•è·å–å®ƒã€‚è¿™æ—¶å€™ï¼Œå°±å‘ç”Ÿäº†å†…å­˜æ³„éœ²ã€‚è¦é¿å…è¿™ä¸ªé—®é¢˜,ä¹Ÿå¾ˆç®€å•ï¼Œæ¯æ¬¡ç”¨å®Œè®°å¾—removeå°±è¡Œã€‚ ä¸Šé¢è¯´äº†è¿™ä¹ˆå¤šï¼Œå†æ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šå†…å­˜æ³„éœ²å’Œå¼±å¼•ç”¨æœ‰æ²¡æœ‰å…³ç³»ï¼Ÿ ç­”æ¡ˆæ˜¯æ²¡å…³ç³»ã€‚å³ä½¿ä¸æ˜¯å¼±å¼•ç”¨ï¼Œä¹Ÿä¼šå­˜åœ¨å†…å­˜æ³„éœ²ï¼Œjdkä½¿ç”¨å¼±å¼•ç”¨åªæ˜¯ä¸ºäº†è®©å®ƒèƒ½å¤Ÿè¢«æ›´å¥½æ›´å¿«åœ°å›æ”¶ï¼Œç”¨æ–‡æ¡£åŸè¯è¯´å°±æ˜¯: 1To help deal with very large and long-lived usages, the hash table entries use WeakReferences for keys. è·¨çº¿ç¨‹ä½¿ç”¨ThreadLocalæ›´çœŸå®çš„æƒ…å†µæ˜¯ï¼Œæœ‰æ—¶å€™ä»£ç ä¸­ä¼šæœ‰å¼‚æ­¥æ“ä½œï¼Œä½†æˆ‘ä»¬åˆå¸Œæœ›åœ¨å¼‚æ­¥çº¿ç¨‹é‡Œä¹Ÿèƒ½æ‹¿åˆ°çˆ¶çº¿ç¨‹çš„ThreadLocalå˜é‡ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼ŒJDKæä¾›äº†InheritableThreadLocal. InheritableThreadLocalä¸‹è¿°ä»£ç åœ¨ä¸»çº¿ç¨‹é‡Œè®¾ç½®äº†InheritableThreadLocalå˜é‡ï¼Œåœ¨å­çº¿ç¨‹ä¸­ä»ç„¶å¯ä»¥è·å– 1234567891011121314public class InheritableThreadLocalApp &#123; public static void main(String[] args) &#123; //ä»£ç å—â‘  InheritableThreadLocal&lt;String&gt; tl = new InheritableThreadLocal&lt;&gt;(); tl.set(&quot;main&quot;); new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println(tl.get()); &#125; &#125;).start(); &#125;&#125; è¾“å‡º: 1main å®ç°åŸç†Threadç±»çš„æˆå‘˜å˜é‡å…±æœ‰ä¸¤ä¸ªThreadLocal.ThreadLocalMapç±»å‹çš„å˜é‡ï¼Œä¸€ä¸ªæ˜¯threadLocals,å¦ä¸€ä¸ªæ˜¯inheritableThreadLocals. è€ŒInheriableThreadLocalç»§æ‰¿è‡ªThreadLocal, é‡å†™äº†childValueï¼ŒgetMap,createMapä¸‰ä¸ªæ–¹æ³•ã€‚ é‚£çˆ¶çº¿ç¨‹çš„ThreadLocalå˜é‡çš„å€¼æ˜¯ä»€ä¹ˆæ—¶å€™æ‚„å’ªå’ªçš„ä¼ é€’åˆ°å­çº¿ç¨‹çš„å‘¢ï¼Ÿç­”æ¡ˆæ˜¯åˆ›å»ºçº¿ç¨‹çš„æ—¶å€™: 123public Thread(Runnable target) &#123; init(null, target, &quot;Thread-&quot; + nextThreadNum(), 0); &#125; initæ–¹æ³•é‡Œæœ‰è¿™ä¹ˆä¸€è¡Œå…³é”®ä»£ç : 123if (inheritThreadLocals &amp;&amp; parent.inheritableThreadLocals != null) this.inheritableThreadLocals = ThreadLocal.createInheritedMap(parent.inheritableThreadLocals); ç›¸å½“äºæ˜¯æŠŠparentçš„inheritableThreadLocalç»™åŸæ ·æ‹·è´äº†ä¸€ä»½ã€‚ çº¿ç¨‹æ± ä¸InheritableThreadLocalä»ä¸Šé¢å®ç°åŸç†çš„åˆ†æå¯ä»¥çŸ¥é“ï¼ŒInheritableThreadLocalæ˜¯åœ¨åˆ›å»ºçº¿ç¨‹çš„æ—¶å€™ä¼ é€’inheritableThreadLocalçš„, ç”±äºçº¿ç¨‹æ± æ˜¯å¤ç”¨çº¿ç¨‹çš„ï¼Œæ‰€ä»¥åœ¨çº¿ç¨‹æ± é‡Œä½¿ç”¨InheritableThreadLocalåŒæ ·æ˜¯è¡Œä¸é€šçš„ã€‚ å¦‚ä½•ç ´å±€å…ˆæ¥çœ‹ç—‡ç»“åœ¨å“ª:InheritableThreadLocalæ˜¯é€šè¿‡new Thread()æ—¶è¿›è¡Œçš„ä¼ é€’ï¼Œè€ƒè™‘åˆ°çº¿ç¨‹æ± æ˜¯é€šè¿‡submit(Runnable)çš„æ–¹å¼æ¥æäº¤ä»»åŠ¡ï¼Œé‚£æ˜¯å¦æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†çº¿ç¨‹æ± æˆ–è€…RunnableåŒ…è£…ä¸€ä¸‹ï¼Œåœ¨submitæˆ–è€…runæ–¹æ³•æ‰§è¡Œå‰å°†InheritableThreadLocalè¿›è¡Œä¼ é€’å‘¢ï¼Ÿ é˜¿é‡Œå¼€æºçš„TransmittableThreadLocalå°±åŸºäºä¸Šè¿°çš„æ€æƒ³ï¼Œåˆ†åˆ«é€šè¿‡ å¢å¼ºRunnableæˆ–Callable ä½¿ç”¨TtlRunnable.get()æˆ–TtlCallable.get(), æäº¤çº¿ç¨‹æ± ä¹‹åï¼Œåœ¨run()å†…å–å‡ºå˜é‡ å¢å¼ºçº¿ç¨‹æ±  ä½¿ç”¨TtlExecutors.getTtlExecutor()æˆ–getTtlExecutorService()ã€getTtlScheduledExecutorService()è·å–è£…é¥°åçš„çº¿ç¨‹æ± ä½¿ç”¨çº¿ç¨‹æ± æäº¤æ™®é€šä»»åŠ¡,åœ¨run()æ–¹æ³•å†…å–å‡ºå˜é‡ï¼ˆä»»åŠ¡å­çº¿ç¨‹ï¼‰ ä¸¤ç§æ–¹å¼è§£å†³äº†ä¼ ç»Ÿçš„InheritableThreadLocalçš„é—®é¢˜ã€‚ æ¥çœ‹ä¸‹æ•ˆæœ: 123456789101112131415161718192021222324252627282930313233public class TransmittableThreadLocalApp &#123; private static TransmittableThreadLocal&lt;String&gt; context = new TransmittableThreadLocal&lt;&gt;(); public static void main(String[] args) &#123; ExecutorService executor = Executors.newFixedThreadPool(5); context.set(&quot;value-set-in-parent&quot;); //ç©ºè½½ï¼Œå…ˆå°†çº¿ç¨‹éƒ½åˆ›å»ºèµ·æ¥ for (int i = 0; i &lt; 5; i++) &#123; executor.submit(new Runnable() &#123; @Override public void run() &#123; &#125; &#125;); &#125; // ç¬¬ä¸€æ¬¡æäº¤ Runnable task = new RunnableTask(); executor.submit(TtlRunnable.get(task)); context.set(&quot;value changed&quot;); executor.submit(TtlRunnable.get(task)); &#125; static class RunnableTask implements Runnable&#123; @Override public void run() &#123; System.out.println(context.get()); &#125; &#125;&#125; è¾“å‡º: 12value changedvalue-set-in-parent å¯ä»¥çœ‹åˆ°å°†å€¼ä¼ åˆ°çº¿ç¨‹æ± çš„çº¿ç¨‹é‡Œã€‚ æ€»ç»“æœ¬æ–‡ä»‹ç»äº†ThreadLocalå’ŒInheritableThreadLocal,ä»¥åŠå®ƒä»¬åœ¨çº¿ç¨‹æ± ä¸­ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„çš„é—®é¢˜ä»¥åŠä¸€äº›æ‰©å±•ã€‚","categories":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}]},{"title":"Nettyå­¦ä¹ ç¬”è®°ä¹‹æœåŠ¡ç«¯å»ºç«‹æ–°è¿æ¥","slug":"Nettyå­¦ä¹ ç¬”è®°ä¹‹æœåŠ¡ç«¯å»ºç«‹æ–°è¿æ¥","date":"2022-04-05T08:00:00.000Z","updated":"2023-05-29T14:17:39.336Z","comments":true,"path":"2022/04/05/Nettyå­¦ä¹ ç¬”è®°ä¹‹æœåŠ¡ç«¯å»ºç«‹æ–°è¿æ¥/","link":"","permalink":"http://example.com/2022/04/05/Netty%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BB%BA%E7%AB%8B%E6%96%B0%E8%BF%9E%E6%8E%A5/","excerpt":"","text":"å‰æƒ…æè¦åœ¨Nettyå­¦ä¹ ç¬”è®°ä¹‹æœåŠ¡ç«¯å¯åŠ¨ä¸€æ–‡ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†eventloopçš„åŸºæœ¬åŠŸèƒ½ï¼ŒçŸ¥é“äº†å®ƒçš„ä¸€ç”Ÿå…¶å®å°±æ˜¯ä¸ªæ­»å¾ªç¯ï¼Œå†å¾ªç¯é‡Œå¤„ç†IOäº‹ä»¶å’ŒtaskQueueé‡Œé¢çš„ä»»åŠ¡ï¼›åŒæ—¶æˆ‘ä»¬ä¹Ÿäº†è§£åˆ°ï¼Œåœ¨æœåŠ¡ç«¯å¯åŠ¨ä¹‹åˆ(å‡†ç¡®çš„æ¥è®²æ˜¯åœ¨channelæ³¨å†Œå®Œæˆä¹‹åè°ƒç”¨handlerAddedçš„æ—¶å€™)ä¼šç»™pipelineé‡Œæ·»åŠ ä¸€ä¸ªç‰¹æ®Šçš„handlerï¼šServerBootstrapAcceptorï¼Œæœ‰äº†è¿™ä¸¤ç‚¹ä¹‹åï¼Œè®©æˆ‘ä»¬çœ‹ä¸‹NettyæœåŠ¡ç«¯å¯åŠ¨åæ˜¯å¦‚ä½•åˆ©ç”¨reactoræ¨¡å‹å»ºç«‹æ–°è¿æ¥çš„ã€‚ æ­£æ–‡å½“å®¢æˆ·ç«¯å¯åŠ¨å¹¶ç»™æœåŠ¡ç«¯å‘é€æ¶ˆæ¯åï¼ŒæœåŠ¡ç«¯çš„eventloopå°±ä¼šç›‘å¬åˆ°å¯¹åº”äº‹ä»¶ï¼š NioEventLoop.run123456789101112131415161718192021222324252627282930313233343536373839404142protected void run() &#123; for (;;) &#123; try &#123; switch (selectStrategy.calculateStrategy(selectNowSupplier, hasTasks())) &#123; case SelectStrategy.CONTINUE: continue; case SelectStrategy.SELECT: select(wakenUp.getAndSet(false)); if (wakenUp.get()) &#123; selector.wakeup(); &#125; // fall through default: &#125; cancelledKeys = 0; needsToSelectAgain = false; final int ioRatio = this.ioRatio; if (ioRatio == 100) &#123; try &#123; processSelectedKeys(); //è¿™é‡Œå°±ä¼šæ”¯æ£±èµ·æ¥ &#125; finally &#123; // Ensure we always run tasks. runAllTasks(); &#125; &#125; else &#123; final long ioStartTime = System.nanoTime(); try &#123; processSelectedKeys(); &#125; finally &#123; // Ensure we always run tasks. final long ioTime = System.nanoTime() - ioStartTime; runAllTasks(ioTime * (100 - ioRatio) / ioRatio); &#125; &#125; &#125; catch (Throwable t) &#123; handleLoopException(t); &#125; // Always handle shutdown even if the loop processing threw an exception. ... &#125; &#125; NioEventLoop.processSelectedKey123456789101112131415private void processSelectedKey(SelectionKey k, AbstractNioChannel ch) &#123; final AbstractNioChannel.NioUnsafe unsafe = ch.unsafe(); ... try &#123; .... // Also check for readOps of 0 to workaround possible JDK bug which may otherwise lead // to a spin loop if ((readyOps &amp; (SelectionKey.OP_READ | SelectionKey.OP_ACCEPT)) != 0 || readyOps == 0) &#123; unsafe.read(); //è°ƒç”¨äº†è¿™é‡Œ &#125; &#125; catch (CancelledKeyException ignored) &#123; unsafe.close(unsafe.voidPromise()); &#125; &#125; NioMessageUnsafe.read123456789101112131415161718public void read() &#123; ... boolean closed = false; Throwable exception = null; try &#123; ... int size = readBuf.size(); for (int i = 0; i &lt; size; i ++) &#123; readPending = false; pipeline.fireChannelRead(readBuf.get(i)); //è¿™é‡Œ &#125; ... &#125; finally &#123; // Check if there is a readPending which was not processed yet. ... &#125; &#125; &#125; æœ€ç»ˆè°ƒç”¨äº†pipeline.fireChannelRead(readBuf.get(i)), åœ¨æœåŠ¡ç«¯å¯åŠ¨ä¸€æ–‡ä¸­æˆ‘ä»¬ä¹Ÿè®²åˆ°äº†pipelineçš„ä¼ æ’­ï¼Œåƒè¿™ç§firexxxçš„éƒ½æ˜¯ä»headå¾€åä¼ æ’­çš„ï¼Œæ‰€ä»¥æœ€ç»ˆä¼šä¼ æ’­åˆ°ServerBootstrapAcceptoré‡Œï¼Œè°ƒç”¨ServerBootstrapAcceptorçš„channelRead,è€Œè¿™é‡Œï¼Œå°±æ˜¯é‡å¤´æˆäº†ã€‚ ServerBootstrapAcceptor.channelRead è¿™é‡Œæœ‰å‡ ä¸ªç‚¹éœ€è¦æ³¨æ„ä¸‹ï¼š ä»£ç â‘ ï¼šè¿™é‡Œçš„Channelæ˜¯SockerChannelï¼Œè€Œä¸æ˜¯ServerSocketChannelï¼Œå³æ˜¯å®¢æˆ·ç«¯çš„Channel. ä»£ç â‘¡ï¼šchildHandlerå°±æ˜¯æˆ‘ä»¬åœ¨boostrapé‡Œé…çš„ChannelInitializerï¼Œç­‰åˆ°channelçœŸæ­£æ³¨å†Œåå›è°ƒinitChannelæ–¹æ³•ï¼ŒæŠŠMyServerHandleræ·»åŠ åˆ°pipelineï¼Œè§ä¸‹å›¾ï¼Œè¿™é‡Œçš„å¤„ç†å’ŒæœåŠ¡ç«¯å¯åŠ¨ä¸€æ–‡ä¸­doResigterä¸€èŠ‚ä¸­çš„ä»£ç â‘¡æ˜¯ä¸€ä¸ªé“ç†ï¼Œå½’æ ¹åˆ°åº•å°±æ˜¯å› ä¸ºæˆ‘ä»¬æƒ³ç»™pipelineæ·»åŠ handlerï¼Œä½†æ˜¯Channelè¿˜æ²¡æ³¨å†Œå¥½ï¼Œæ‰€ä»¥é‡‡å–çš„ä¸€ç§å¦¥åçš„æ–¹å¼ï¼Œå³å…ˆç»™pipelineæ³¨å†Œä¸€ä¸ªChannelInitializerç±»å‹çš„Handlerï¼Œç­‰åˆ°ChannelçœŸæ­£æ³¨å†Œå¥½ä¹‹åï¼Œå†å»å›è°ƒè¿™ä¸ªç‰¹æ®ŠHandlerçš„initChannelæ–¹æ³•ã€‚ è¿™é‡Œä¹Ÿå¯ä»¥è§£é‡Šbootstrapçš„handlerå’ŒchildHanlderçš„åŒºåˆ«ï¼šå‰è€…å¯¹åº”ServerSocketChannelï¼Œåè€…å¯¹åº”SockerChannel. â€‹ ä»£ç â‘¢ï¼šè¿™é‡Œå°±æ˜¯å°†channelæ³¨å†Œåˆ°eventloopä¸Šï¼Œå’Œæˆ‘ä»¬åœ¨æœåŠ¡ç«¯å¯åŠ¨ä¸€æ–‡ä¸­çœ‹åˆ°çš„serversocketChannelçš„æ³¨å†Œå·®ä¸å¤šï¼Œä½†æ˜¯æœ‰ç»†å¾®åŒºåˆ«ï¼Œä¸»è¦ä½“ç°åœ¨ æœåŠ¡ç«¯å¯åŠ¨æ—¶çš„æ³¨å†Œæ˜¯å°†serversocketChannelæ³¨å†Œåˆ°bossGroupé‡Œçš„eventloop.è€ŒchildChannelæ³¨å†Œæ—¶æ˜¯è¦æ³¨å†Œåˆ°workerGroupé‡Œã€‚ åœ¨æ³¨å†Œç¯èŠ‚ï¼Œç”±äºå½“å‰çº¿ç¨‹æ˜¯bossGroupçš„çº¿ç¨‹ï¼Œæ‰€ä»¥ä¸€å®šä¼šèµ°elseçš„é€»è¾‘, å°†æ³¨å†Œçš„ä»»åŠ¡æäº¤åˆ°childChannelè‡ªå·±çš„eventloop","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://example.com/tags/Netty/"}]},{"title":"Nettyå­¦ä¹ ç¬”è®°ä¹‹å®¢æˆ·ç«¯å¯åŠ¨","slug":"Nettyå­¦ä¹ ç¬”è®°ä¹‹å®¢æˆ·ç«¯å¯åŠ¨","date":"2022-04-04T02:00:00.000Z","updated":"2023-05-29T14:17:37.590Z","comments":true,"path":"2022/04/04/Nettyå­¦ä¹ ç¬”è®°ä¹‹å®¢æˆ·ç«¯å¯åŠ¨/","link":"","permalink":"http://example.com/2022/04/04/Netty%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%90%AF%E5%8A%A8/","excerpt":"","text":"åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œè®¨è®ºäº†nettyæœåŠ¡ç«¯å¯åŠ¨çš„å¤§æ¦‚æµç¨‹ï¼Œè¿™ç¯‡æ–‡ç« å°†ä¼šç»§ç»­çœ‹ä¸‹å®¢æˆ·ç«¯å¯åŠ¨æµç¨‹ã€‚ æ€»è§ˆä¸€èˆ¬çš„å®¢æˆ·ç«¯é•¿è¿™æ ·ï¼ŒçœŸæ­£çš„å…¥å£è¦ä»bootstrap.connectçœ‹èµ·ã€‚ åˆ†æè¿›å…¥connectæ–¹æ³•çš„æœ€ç»ˆè°ƒç”¨åœ¨è¿™é‡Œï¼š å¦‚æœå·²ç»çœ‹è¿‡æœåŠ¡ç«¯å¯åŠ¨æµç¨‹ï¼Œä¼šå‘ç°è¿™é‡Œå’ŒæœåŠ¡ç«¯çš„ä»£ç ç¥ä¼¼ï¼Œéƒ½æ˜¯å…ˆinitAndRegister,å¦‚æœæ³¨å†ŒæˆåŠŸï¼Œåˆ™ç›´æ¥æ‰§è¡ŒdoResolveAndConnect0,å¦åˆ™å°±æ·»åŠ ä¸€ä¸ªç›‘å¬å™¨ï¼Œå½“ç›‘å¬å™¨è§¦å‘çš„æ—¶å€™æ‰§è¡ŒdoResolveAndConnect0. äº‹å®ä¸ŠinitAndRegisterçš„é€»è¾‘éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºéƒ½æ˜¯èµ°çš„éƒ½æ˜¯Bootstrap.initAndRegister(). æˆ‘ä»¬åªéœ€è¦å…³æ³¨doResolveAndConnect0åšäº†ä»€ä¹ˆå³å¯ã€‚ doResolveAndConnect0 è¿™é‡Œç†Ÿæ‚‰çš„å¼‚æ­¥æ“ä½œåˆåˆåˆåˆæ¥äº†ï¼šé¦–å…ˆå¼‚æ­¥æ‰§è¡Œresolver.resovle(),å¹¶è¿”å›ä¸€ä¸ªfuture,åç»­ä¼šæ ¹æ®futureæ¥åˆ¤æ–­resolveåŠ¨ä½œæ˜¯å¦å®Œæˆã€‚å¦‚æœå®ƒå®Œæˆäº†ï¼Œåˆ™æ‰§è¡ŒdoConnectï¼Œå¦åˆ™ç»™futureæ³¨å†Œä¸€ä¸ªlistener,ç­‰åˆ°resovleå®Œæˆçš„æ—¶å€™ä¼šè§¦å‘è¿™ä¸ªlistenerï¼Œè¿›è€Œæ‰§è¡ŒdoConnect. æœ€ç»ˆçš„connectèµ°çš„æ˜¯pipelineçš„connectæ–¹æ³• ç»§ç»­ï¼Œ è¿™ä¸ªtailæ˜¯ä¸ªChannelHandlerContext,ä¹Ÿå°±æ˜¯pipelineçš„ä¸»è¦å†…å®¹ï¼Œ","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://example.com/tags/Netty/"}]},{"title":"Nettyå­¦ä¹ ç¬”è®°ä¹‹æœåŠ¡å¯åŠ¨","slug":"Nettyå­¦ä¹ ç¬”è®°ä¹‹æœåŠ¡ç«¯å¯åŠ¨","date":"2022-02-13T04:00:00.000Z","updated":"2022-02-13T04:00:00.000Z","comments":true,"path":"2022/02/13/Nettyå­¦ä¹ ç¬”è®°ä¹‹æœåŠ¡ç«¯å¯åŠ¨/","link":"","permalink":"http://example.com/2022/02/13/Netty%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8B%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%90%AF%E5%8A%A8/","excerpt":"","text":"å‰ç½®çŸ¥è¯†å­¦ä¹ ä¹‹å‰éœ€è¦ç†æ¸…è¿™ä¹ˆå‡ ä¸ªå…³é”®æ¦‚å¿µï¼š nettyç›¸å…³ï¼šEventLoop, EventLoopGroup, ChannelHandler, ChannelPipelineï¼ŒChannnelPromise, ChannelFuture nioç›¸å…³ï¼šchannel, selector. Channelä¸Selectorè°ˆåˆ°nio, é‚£ä¹ˆchannelå’Œselectorå°±æ˜¯ç»•ä¸å¼€çš„è¯é¢˜ï¼Œä»–ä»¬çš„å…³ç³»å¦‚ä¸‹ï¼š ä¸€ä¸ªselectorå’Œä¸€ä¸ªçº¿ç¨‹å¯¹åº”ï¼Œè¿™ä¹Ÿæ˜¯nioçš„å¥½å¤„ä¹‹ä¸€ï¼šç”¨å•çº¿ç¨‹å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯çš„è¿æ¥ï¼›ä¸€ä¸ªselectoråŒæ—¶å¯¹åº”å¤šä¸ªchannel,æ¯ä¸ªchannelå°†è‡ªå·±æ³¨å†Œåˆ°selectorä¸Šï¼Œæ³¨å†Œçš„æ—¶å€™ä¼šæºå¸¦è‡ªå·±æ„Ÿå…´è¶£çš„äº‹ä»¶ã€‚ç„¶åselectorå°±å»è½®è®­è¿™äº›äº‹ä»¶ï¼Œå½“æœ‰æŸä¸ªäº‹ä»¶readyæ—¶ï¼Œå°±å»é€šçŸ¥å¯¹åº”çš„channel. EventLoopç¿»è¯‘è¿‡æ¥æ˜¯äº‹ä»¶å¾ªç¯å™¨ï¼Œå…¶å®å°±æ˜¯ç”¨æ¥å¤„ç†å„ç§ioäº‹ä»¶çš„ï¼Œè¦å…·å¤‡è¿™ç§èƒ½åŠ›ï¼Œé‚£ä¹ˆeventloopå¿…é¡»ï¼š å…·æœ‰ä¸€ä¸ªselector å…·æœ‰è‡ªå·±çš„çº¿ç¨‹ï¼Œåœ¨è¿™ä¸ªçº¿ç¨‹é‡Œå¯ä»¥å¯¹selectoræ³¨å†Œçš„äº‹ä»¶è¿›è¡Œéå† æ‰€ä»¥,eventloopç»§æ‰¿è‡ªäº†Executor,å…·æœ‰çº¿ç¨‹æ± çš„èƒ½åŠ›ï¼ŒåŒæ—¶å«æœ‰ä¸€ä¸ªselector. æ¯ä¸ªchanneléƒ½å¯¹åº”ä¸€ä¸ªeventloopï¼Œåœ¨nettyå¯åŠ¨ä¹‹æ—¶ï¼Œä¼šå°†channelæ³¨å†Œåˆ°eventloopï¼Œç„¶åeventloopå°±ä¼šå¼€å¯æ­»å¾ªç¯ï¼Œå» éå†channelæ„Ÿå…´è¶£çš„äº‹ä»¶ ä½œä¸ºexecutorå»æ‰§è¡Œä»»åŠ¡é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ ä¸Šè¿°ä¸¤ç‚¹ä¾¿æ˜¯eventloopçš„æ ¸å¿ƒä½œç”¨ã€‚æˆ‘ä»¬å·²AbstractChannel.registeræ¥è¯´æ˜è¿™ä¸ªé—®é¢˜ã€‚ AbstractChannel.register1234567891011121314151617public final void register(EventLoop eventLoop, final ChannelPromise promise) &#123; ... if (eventLoop.inEventLoop()) &#123; register0(promise); &#125; else &#123; try &#123; eventLoop.execute(new Runnable() &#123; @Override public void run() &#123; register0(promise); &#125; &#125;); &#125; catch (Throwable t) &#123; ... &#125; &#125;&#125; åœ¨æ³¨å†Œchannelçš„æ—¶å€™ï¼Œå¦‚æœå½“å‰çº¿ç¨‹æ˜¯eventloopçº¿ç¨‹ï¼Œåˆ™ç›´æ¥æ³¨å†Œï¼Œå¦åˆ™ï¼Œå°†register0ä½œä¸ºä¸€ä¸ªä»»åŠ¡æäº¤åˆ°eventloopçš„ä»»åŠ¡é˜Ÿåˆ—é‡Œï¼Œä¹Ÿå°±æ˜¯executeæ–¹æ³•ã€‚ SingleThreadEventExecutor.execute executeæ–¹æ³•ä¹Ÿæ˜¯è¨€ç®€æ„èµ…ï¼Œå¦‚æœå½“å‰çº¿ç¨‹æ˜¯eventloopçº¿ç¨‹ï¼Œåˆ™ç›´æ¥addTaskï¼Œå¦åˆ™å…ˆå¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼Œç„¶åaddTask. SingleThreadEventExecutor.doStartThread1234567891011121314151617181920212223private void doStartThread() &#123; assert thread == null; executor.execute(new Runnable() &#123; @Override public void run() &#123; thread = Thread.currentThread(); if (interrupted) &#123; thread.interrupt(); &#125; boolean success = false; updateLastExecutionTime(); try &#123; SingleThreadEventExecutor.this.run(); success = true; &#125; catch (Throwable t) &#123; logger.warn(&quot;Unexpected exception from an event executor: &quot;, t); &#125; finally &#123; ... &#125; &#125;); &#125; è¿™é‡Œåˆ©ç”¨Jdkçš„Executor.executeå¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶åœ¨è¿™ä¸ªçº¿ç¨‹é‡Œå¼€å§‹äº†å®ƒçš„æ­»å¾ªç¯ï¼Œå³SingleThreadEventExecutor.this.run() NioEventloop.run1234567891011121314151617181920212223242526272829303132333435363738394041protected void run() &#123; for (;;) &#123; try &#123; switch (selectStrategy.calculateStrategy(selectNowSupplier, hasTasks())) &#123; case SelectStrategy.CONTINUE: continue; case SelectStrategy.SELECT: select(wakenUp.getAndSet(false)); if (wakenUp.get()) &#123; selector.wakeup(); &#125; // fall through default: &#125; cancelledKeys = 0; needsToSelectAgain = false; final int ioRatio = this.ioRatio; if (ioRatio == 100) &#123; try &#123; processSelectedKeys(); &#125; finally &#123; // Ensure we always run tasks. runAllTasks(); &#125; &#125; else &#123; final long ioStartTime = System.nanoTime(); try &#123; processSelectedKeys(); &#125; finally &#123; // Ensure we always run tasks. final long ioTime = System.nanoTime() - ioStartTime; runAllTasks(ioTime * (100 - ioRatio) / ioRatio); &#125; &#125; &#125; catch (Throwable t) &#123; handleLoopException(t); &#125; ... &#125; &#125; è¿™ä¸ªrunæ–¹æ³•å°±æ˜¯EventLoopçš„æ ¸å¿ƒäº†ï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªæ¯”è¾ƒå…³é”®çš„æ–¹æ³•ï¼š processSelectedKeys:æŸ¥è¯¢å·²ç»å°±ç»ªçš„äº‹ä»¶å¹¶å¤„ç†ï¼Œè¯´ç™½äº†å°±æ˜¯å¤„ç†ioäº‹ä»¶ runAllTasks:å¤„ç†ä»»åŠ¡é˜Ÿåˆ—é‡Œçš„ä»»åŠ¡ï¼Œæ¯”å¦‚æˆ‘ä»¬é€šè¿‡eventloop.executeæäº¤çš„ä»»åŠ¡ â€‹ é‚£ä¹ˆè‡³æ­¤ï¼Œeventloopçš„åŠŸèƒ½å°±å¤§æ¦‚æ¸…æ¥šäº†ï¼Œå®ƒå°±æ˜¯åœ¨æ­»å¾ªç¯é‡Œå¥—æ­»å¾ªç¯ï¼Œå»å¤„ç†ioäº‹ä»¶å’ŒtaskQueue. å½“ç„¶äº†ï¼Œé‡Œé¢è¿˜æœ‰ä¸€äº›å°ç»†èŠ‚ï¼Œæ¯”å¦‚ï¼š ä¸ºäº†åˆ†é…å¥½å¤„ç†ioäº‹ä»¶çš„æ—¶é—´å’Œå¤„ç†taskQueueçš„äº‹ä»¶ï¼Œä½¿ç”¨äº†ioratioä½œä¸ºä¸¤è€…çš„æ—¶é—´æ¯”ä¾‹ã€‚ ChannelPipelineç”¨å¼ å›¾æ¥è§£é‡Šï¼š æ¯ä¸ªchanneléƒ½ä¼šå¯¹åº”ä¸€ä¸ªchannel pipeline, è€Œè¿™ä¸ªpipelineå°±æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç±»å‹ä¸ºChannelHandlerContext,å†…éƒ¨åŒ…äº†ä¸€ä¸ªChannelHandler. è€ŒChannelHandleråˆåˆ†ä¸ºChannelInboundHandlerå’ŒChannelOutboundHandler, åˆ†åˆ«ç”¨æ¥å¤„ç†å…¥ç«™äº‹ä»¶å’Œå‡ºç«™äº‹ä»¶ï¼Œå·®ä¸å¤šåƒè¿™æ ·ï¼š å½“æœ‰å…¥ç«™äº‹ä»¶æˆ–è€…å‡ºç«™äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œäº‹ä»¶ä¼šä»¥è´£ä»»é“¾æ¨¡å¼ç»è¿‡handler. ChannelPromiseå’Œ ChannelFuturenettyæ‰©å±•äº†jdkåŸç”Ÿçš„future. è€Œpromiseåˆ™æ˜¯å¯¹Netty futureçš„è¿›ä¸€æ­¥æ‰©å±•ã€‚ jdkåŸç”Ÿfuture: nettyçš„future: å¯ä»¥çœ‹åˆ°,nettyæ‰©å±•çš„futureå¢åŠ äº†ä¸€äº›ç›‘å¬å™¨çš„addå’Œremoveçš„æ–¹æ³•ï¼Œä»¥åŠä¸€äº›åŒæ­¥æ–¹æ³•ï¼Œå¦‚await,sysnc. å†æ¥çœ‹ä¸‹promiseï¼š å¤šäº†ä¸€äº›è®¾ç½®çŠ¶æ€çš„æ–¹æ³•ï¼Œå¦‚setSuccess,setFailure è¿™äº›æ‰©å±•æ„å‘³ç€ä»€ä¹ˆnettyçš„futureå¯ä»¥addListener,removeLisener, promiseå¯ä»¥setSuccess,setFailure,æ„å‘³ç€å¼‚æ­¥æ“ä½œæ—¶ï¼Œå¦‚ä¸»çº¿ç¨‹è°ƒäº†eventloopçš„çº¿ç¨‹ï¼Œåªè¦å°†promiseè¿”å›ä¸»çº¿ç¨‹ï¼Œé‚£ä¹ˆpromiseåœ¨eventloopçº¿ç¨‹é‡Œçš„ä»»ä½•åŠ¨ä½œéƒ½å¯ä»¥è¢«ä¸»çº¿ç¨‹æ„ŸçŸ¥åˆ°ï¼Œæ¯”jdkçš„futrueæ›´åŠ å¥å£®äº†ä¸€äº›ã€‚ æ€»è§ˆä¸€èˆ¬çš„å¯åŠ¨ä»£ç é•¿è¿™æ ·ï¼š çœŸæ­£çš„å…¥å£åœ¨bindè¿™é‡Œï¼Œè¿›å»çœ‹çœ‹ï¼š é¦–å…ˆï¼ŒinitAndRegister,æ„æ€æ˜¯åˆå§‹åŒ–å¹¶æ³¨å†Œï¼Œåˆå§‹åŒ–ä»€ä¹ˆï¼Ÿæ³¨å†Œä»€ä¹ˆï¼Ÿè¿™é‡Œå…¶å®æ˜¯åˆå§‹åŒ–ä¸€ä¸ªchannel, å¹¶æŠŠeventloopçš„selectoræ³¨å†Œåˆ°channelä¸Šï¼Œæ³¨æ„è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼ï¼Œæ˜¯ä¸ªfuture,ä¹Ÿå°±æ˜¯è¯´initAndRegisterè¿™ä¸ªåŠ¨ä½œæ˜¯å¼‚æ­¥è¿›è¡Œçš„ï¼Œå¦‚æœæ³¨å†Œå®Œæˆäº†ï¼Œå³regFuture.isDone(),åˆ™è¿›è¡ŒdoBind0æ“ä½œï¼Œå¦åˆ™ï¼Œæ·»åŠ ä¸€ä¸ªç›‘å¬å™¨ï¼Œç­‰initAndRegisterå®Œæˆäº†ä¼šå‡ºå‘å®ƒï¼Œç„¶åè¿›è¡ŒdoBind0ã€‚ OKï¼Œå¤§è‡´æ¥çœ‹ï¼Œå¯åŠ¨åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼Œé¦–å…ˆinitAndRegister,ç„¶åè¿›è¡ŒdoBind0ã€‚ initAndRegisteré¦–å…ˆæ¥çœ‹ä¸‹è¿™ä¸ªinitAndRegisterç©¶ç«Ÿåšäº†äº›å•¥ã€‚ è¿™é‡Œinitåé¢ä¼šè®²ã€‚æœ€ç»ˆè°ƒç”¨åˆ°çš„æ˜¯**AbstractChannel$AbstractUnsage.register** AbstractChannel$AbstractUnsage.register è¿™ä¸ªregisteræ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œeventloopæ˜¯æœ€åˆé…ç½®çš„bossGroup,ChannelPromiseæ˜¯å¯¹Channelçš„åŒ…è£…ã€‚è¿™é‡Œè¦æ³¨æ„ï¼Œæ³¨å†Œçš„åŠ¨ä½œå¿…é¡»å‘ç”Ÿåœ¨eventloopçš„çº¿ç¨‹é‡Œï¼Œæ‰€ä»¥å¦‚æœå½“å‰çº¿ç¨‹ä¸æ˜¯eventloopçš„çº¿ç¨‹çš„è¯ï¼Œeventloopä¼šèµ·ä¸€ä¸ªè‡ªå·±çš„çº¿ç¨‹å»åšè¿™ä¸ªäº‹æƒ…ã€‚ ç»§ç»­çœ‹register0: register0 doResigterå°±æ˜¯çœŸæ­£çš„æ³¨å†Œè¿‡ç¨‹ï¼Œåœ¨æ­»å¾ªç¯é‡Œå°†channelæ³¨å†Œåˆ°eventloopçš„selectoré‡Œã€‚ doResigter ç›¸æ¯”ä»£ç â‘ ï¼Œæ³¨å†Œå®Œæˆä¹‹åçš„â‘¡â‘¢â‘£â‘¤æ›´å€¼å¾—å…³æ³¨ã€‚ ä»£ç â‘¡å›è°ƒæ·»åŠ handleræ—¶å€™çš„handlerAddedæ–¹æ³• â€‹ è¿™é‡Œæ˜¯æœ‰ç»†èŠ‚çš„ï¼Œå›åˆ°æˆ‘ä»¬æœ€åˆçš„serverç«¯ä»£ç ï¼š â€‹ æ‰§è¡Œå®Œä»£ç â‘¡åï¼Œåº”è¯¥è¾“å‡ºâ€œHandlerAddedâ€. ä½†æ˜¯è¿™ä¸ªhandleræ˜¯ä»€ä¹ˆæ—¶å€™æ·»åŠ è¿›pipelineçš„å‘¢ï¼Ÿæ˜¯serverBootStrapçš„handler()æ–¹æ³•å—ï¼Œä¸æ˜¯ã€‚å›åˆ°initAndRegisterå¤„ï¼Œ abc çœ‹ä¸‹è¿™ä¸ªinitæ–¹æ³•ï¼š 12345678910111213141516171819202122@Override void init(Channel channel) throws Exception &#123; ... //çœç•¥è‹¥å¹²ä»£ç  p.addLast(new ChannelInitializer&lt;Channel&gt;() &#123; @Override public void initChannel(final Channel ch) throws Exception &#123; final ChannelPipeline pipeline = ch.pipeline(); ChannelHandler handler = config.handler(); if (handler != null) &#123; pipeline.addLast(handler); &#125; ch.eventLoop().execute(new Runnable() &#123; @Override public void run() &#123; pipeline.addLast(new ServerBootstrapAcceptor( ch, currentChildGroup, currentChildHandler, currentChildOptions, currentChildAttrs)); &#125; &#125;); &#125; &#125;); &#125; å¯ä»¥çœ‹åˆ°ï¼Œåœ¨initçš„æ—¶å€™ï¼Œpipelineå°±æ·»åŠ ä¸€ä¸ªhandler,å³ChannelInitializer,å¹¶è¦†ç›–äº†initChannelæ–¹æ³•,æ‰€ä»¥å¯åŠ¨åpipelieé‡Œé™¤äº†headå’Œtailä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå«åšChannelInitializerçš„handler,ä¸€å…±ä¸‰ä¸ªhandlerã€‚å†å›åˆ°ä»£ç â‘¡ï¼Œä»£ç â‘¡çš„æœ€ç»ˆåŠŸèƒ½å°±æ˜¯å»è°ƒç”¨ChannelInitializerçš„initChannelæ–¹æ³•,è€Œè¿™ä¸ªinitChannleé‡Œé¢ï¼Œæ‰æ˜¯æŠŠæˆ‘ä»¬åœ¨serverbootstrapé‡Œå®šä¹‰çš„handlerç»™åŠ åˆ°pipelineé‡Œ,å¹¶åœ¨æ·»åŠ ä¹‹åå›è°ƒhandlerAddedæ–¹æ³•ã€‚ å½“è¿™ä¸ªChannelInitializerå®Œæˆçš„å®ƒçš„ä»»åŠ¡åï¼Œå°±è¢«removeæ‰äº†ï¼Œæ­¤æ—¶pipelineé‡Œå°±åªæœ‰head,tailä»¥åŠæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„handleräº†ã€‚ ä»£ç â‘¢è®¾ç½®æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬ä¸Šæ–‡é‡Œæåˆ°çš„doBindæ–¹æ³•é‡Œçš„listenerå°±ä¼šè¢«å‡ºå‘ï¼Œä»è€Œç»§ç»­æ‰§è¡ŒdoBind0æ–¹æ³• ä»£ç â‘£æ‰§è¡Œæ·»åŠ handleræ—¶å€™çš„channelRegisteredå›è°ƒ ä»£ç â‘¤é¦–æ¬¡æ³¨å†Œçš„æ—¶å€™ä¸æ˜¯active,åé¢å†è®² OKï¼Œè‡³æ­¤ï¼Œä¸€ä¸ªchannelå°±åˆå§‹åŒ–å¥½äº†ï¼Œå¹¶ä¸”æ³¨å†Œäº†åˆ°äº†eventloopä¸Š doBind0ä¹¦æ¥ä¸Šå›register0çš„ä»£ç â‘¢ï¼Œè®¾ç½®æˆåŠŸåï¼ŒdoBindæ–¹æ³•é‡Œçš„regFutureæ·»åŠ çš„listenerå°±è¢«è§¦å‘äº†ï¼Œæ¥åˆ°äº†doBind0ç¯èŠ‚ã€‚ è¿™é‡Œçš„channel.bind()ä¹Ÿæ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„ï¼Œçœ‹ä¼¼æ˜¯channelçš„bindï¼Œå…¶å®æœ€åè°ƒçš„æ˜¯pipelineçš„bind.(æ’ä¸€å˜´ï¼Œpipielineåœ¨nettyé‡Œç›¸å½“æ ¸å¿ƒï¼ŒåŸºäºè´£ä»»é“¾æ¨¡å¼ï¼Œæ‰€æœ‰çš„äº‹ä»¶éƒ½åœ¨pipelineé‡ŒæµåŠ¨ï¼Œåé¢ä¼šä¸“é—¨èµ·ä¸€ç¯‡æ–‡ç« è¯´è¿™ä¸ªäº‹æƒ…ã€‚) AbstractChannel.bind() DefaultChannelPipeline.bind() â€‹ å¯ä»¥çœ‹åˆ°ï¼Œpipelineçš„bindæ˜¯ä»tailå¼€å§‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯ä»å°¾éƒ¨å‘å¤´éƒ¨ä¼ æ’­çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œcontextçš„ç±»å‹åº”è¯¥æ˜¯outboundContenxt æ€»ç»“ä¸€ä¸‹æœåŠ¡ç«¯å¯åŠ¨éœ€è¦åšè¿™ä¹ˆå‡ ä»¶äº‹ï¼šåˆå§‹åŒ–ä¸€ä¸ªchannel, ç„¶åæŠŠè¿™ä¸ªchannelæ³¨å†Œåˆ°selectorä¸Šï¼Œç„¶åæŠŠåœ¨channelä¸Šç»‘å®šæœåŠ¡ç«¯åœ°å€ã€‚ æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œpipelineè´¯ç©¿å…¨å±€ï¼Œèµ·ç€ä¼ é€’äº‹ä»¶çš„ä½œç”¨ã€‚","categories":[{"name":"Netty","slug":"Netty","permalink":"http://example.com/categories/Netty/"}],"tags":[{"name":"Netty","slug":"Netty","permalink":"http://example.com/tags/Netty/"}]},{"title":"ä¸€æ¬¡ç”±åŒ¿åå†…éƒ¨ç±»å¼•å‘çš„é—®é¢˜","slug":"ä¸€æ¬¡ç”±åŒ¿åç±»å¼•å‘çš„é—®é¢˜","date":"2022-02-12T03:00:00.000Z","updated":"2022-02-12T03:00:00.000Z","comments":true,"path":"2022/02/12/ä¸€æ¬¡ç”±åŒ¿åç±»å¼•å‘çš„é—®é¢˜/","link":"","permalink":"http://example.com/2022/02/12/%E4%B8%80%E6%AC%A1%E7%94%B1%E5%8C%BF%E5%90%8D%E7%B1%BB%E5%BC%95%E5%8F%91%E7%9A%84%E9%97%AE%E9%A2%98/","excerpt":"","text":"å‰èœä¼—æ‰€å‘¨çŸ¥ï¼Œjavaçš„å†…éƒ¨ç±»æ˜¯å¯ä»¥è®¿é—®åˆ°å¤–éƒ¨ç±»çš„fieldçš„ï¼Œå¦‚ï¼š 12345678910111213141516public class Fruit &#123; private String name; public Origin origin()&#123; return new Origin(); &#125; class Origin&#123; String province; String county; public void info()&#123; System.out.println(&quot;fruit from &quot;+ province + &quot; &quot;+county+&quot; name:&quot;+name); //å¯ä»¥è®¿é—®åˆ°å¤–éƒ¨ç±»çš„nameå±æ€§ &#125; &#125;&#125; ä½†æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬æ‰“å°ä¸‹originå¯¹è±¡çš„å­—æ®µ 12345678public static void main(String[] args) &#123; Fruit fruit = new Fruit(); Origin origin = fruit.origin(); for (Field field : origin.getClass().getDeclaredFields()) &#123; System.out.println(field); &#125; &#125; è¾“å‡ºï¼š 123java.lang.String innerclass.Fruit$Origin.provincejava.lang.String innerclass.Fruit$Origin.countyfinal innerclass.Fruit innerclass.Fruit$Origin.this$0 å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†Originç±»è‡ªæœ‰çš„provinceå’Œcountyå­—æ®µå¤–ï¼Œç¼–è¯‘æ—¶ä¼šç”Ÿæˆä¸€ä¸ªthis$0å­—æ®µï¼Œç”±finalä¿®é¥°ï¼Œç±»å‹æ˜¯Fruit. æ‰€ä»¥ï¼Œå†…éƒ¨ç±»ä¹‹æ‰€ä»¥èƒ½å¤Ÿè®¿é—®åˆ°å¤–éƒ¨ç±»çš„field,æ˜¯å› ä¸ºå®ƒæŒæœ‰äº†ä¸€ä¸ªå¤–éƒ¨ç±»çš„å¼•ç”¨this$0 ç¨å¾®å¤æ‚çš„æƒ…å†µå½“åŒ¿åç±»åŠ ä¸ŠæŠ½è±¡ç±»ï¼Œä¼šç¢°æ’å‡ºæ€æ ·çš„ç«èŠ±å‘¢ï¼Ÿ å®šä¹‰ä¸€ä¸ªæŠ½è±¡ç±»Parentï¼Œå®ƒå«æœ‰ä¸€ä¸ªæŠ½è±¡å†…éƒ¨ç±»Childï¼ŒåŒæ—¶æœ‰ä¸€ä¸ªchild1æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªChildå¯¹è±¡ï¼š 1234567public abstract class Parent &#123; protected abstract class Child&#123;&#125; protected Child child1()&#123; return new Child() &#123; &#125;; &#125;&#125; å†å®šä¹‰ä¸€ä¸ªParentImplç±»ï¼Œç»§æ‰¿è‡ªParent, åŒæ—¶æœ‰ä¸€ä¸ªchild2æ–¹æ³•ï¼Œä¹Ÿè¿”å›ä¸€ä¸ªChildå¯¹è±¡ 123456public class ParentImpl extends Parent&#123; public Parent.Child child2()&#123; return new Child() &#123; &#125;; &#125;&#125; æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªParentImplå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡åº”è¯¥æœ‰ä¸¤ä¸ªå¯æ“ä½œçš„æ–¹æ³•ï¼Œchild1()å’Œchild2(), child1()æ˜¯æ¥è‡ªçˆ¶ç±»çš„æ–¹æ³•ï¼Œchild2()æ˜¯å®ç°ç±»è‡ªå·±çš„æ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯Childç±»å‹ï¼Œä½†æ˜¯ä¼šä¸ä¼šæœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿç­”æ¡ˆå°±åœ¨this$0. æˆ‘ä»¬åˆ†åˆ«å»æ‰“å°è¿™ä¸¤ä¸ªè¿”å›å¯¹è±¡çš„this$0 12345678910public static void main(String[] args) throws IllegalAccessException &#123; ParentImpl parentImpl = new ParentImpl(); Parent.Child child2 = parentImpl.child2(); //å®ç°è‡ªå­ç±»çš„child Field outField2 = getField(child2.getClass(),&quot;this$0&quot;); //å­ç±»å†…éƒ¨ç±»çš„this$0 System.out.println(&quot;å­ç±»new Child()çš„this$0:&quot;+outField2); Parent.Child child1 = parentImpl.child1(); //çˆ¶ç±»é‡Œå®ç°çš„child Field outField1 = getField(child1.getClass(),&quot;this$0&quot;); //çˆ¶ç±»å†…éƒ¨ç±»çš„this$0 System.out.println(&quot;çˆ¶ç±»new Child()çš„this$0:&quot;+outField1);&#125; è¾“å‡ºï¼š 12å­ç±»new Child()çš„this$0:final ParentImpl ParentImpl$1.this$0çˆ¶ç±»new Child()çš„this$0:final Parent Parent$1.this$0 å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªå¯¹è±¡çš„this$0æœ‰æ‰€ä¸åŒï¼Œå­ç±»newçš„Childçš„this$0æ˜¯ParentImplç±»å‹ï¼Œçˆ¶ç±»newçš„Childçš„this$0æ˜¯Parentç±»å‹ï¼Œå€’ä¹Ÿåˆæƒ…åˆç†ã€‚ é‚£è¿™ä¸ªæ—¶å€™ï¼Œå‡å¦‚è¯´ï¼Œæˆ‘æ‹¿åˆ°äº†å­ç±»é‡Œçš„å†…éƒ¨ç±»å¯¹è±¡ï¼Œå³child2, åŒæ—¶æˆ‘åˆæœ‰çˆ¶ç±»å†…éƒ¨ç±»çš„this$0,outField1, æˆ‘èƒ½å¦ä»child2åˆ©ç”¨åå°„æ‹¿åˆ°çˆ¶å¯¹è±¡å‘¢ï¼Ÿå³ 1outField1.get(child2); æŠ›å¼‚å¸¸äº†ï¼š 1234567Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: Can not set final Parent field Parent$1.this$0 to ParentImpl$1 at sun.reflect.UnsafeFieldAccessorImpl.throwSetIllegalArgumentException(UnsafeFieldAccessorImpl.java:167) at sun.reflect.UnsafeFieldAccessorImpl.throwSetIllegalArgumentException(UnsafeFieldAccessorImpl.java:171) at sun.reflect.UnsafeFieldAccessorImpl.ensureObj(UnsafeFieldAccessorImpl.java:58) at sun.reflect.UnsafeQualifiedObjectFieldAccessorImpl.get(UnsafeQualifiedObjectFieldAccessorImpl.java:38) at java.lang.reflect.Field.get(Field.java:393) at Main.main(Main.java:15) é‚£æ¢ä¸€ä¸‹å‘¢ï¼Ÿ 1outField2.get(child1); ä¹Ÿä¸è¡Œ 1234567Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: Can not set final ParentImpl field ParentImpl$1.this$0 to Parent$1 at sun.reflect.UnsafeFieldAccessorImpl.throwSetIllegalArgumentException(UnsafeFieldAccessorImpl.java:167) at sun.reflect.UnsafeFieldAccessorImpl.throwSetIllegalArgumentException(UnsafeFieldAccessorImpl.java:171) at sun.reflect.UnsafeFieldAccessorImpl.ensureObj(UnsafeFieldAccessorImpl.java:58) at sun.reflect.UnsafeQualifiedObjectFieldAccessorImpl.get(UnsafeQualifiedObjectFieldAccessorImpl.java:38) at java.lang.reflect.Field.get(Field.java:393) at Main.main(Main.java:12) è¯´ç™½äº†å°±æ˜¯ï¼Œchild2é‡Œé¢æ²¡æœ‰final Parent Parent$1.this$0è¿™ä¸ªfield,ä½ æƒ³get,å°±ä¼šæŠ›å¼‚å¸¸ï¼ŒåŒç†child1é‡Œé¢ä¹Ÿæ²¡æœ‰final ParentImpl ParentImpl$1.this$0è¿™ä¸ªfieldï¼Œä½ æƒ³get,ä¹Ÿä¼šæŠ›å¼‚å¸¸ã€‚ æ€»ç»“ä¸€ä¸‹ä¸Šé¢è¯´åˆ°çš„åŒ¿åå†…éƒ¨ç±»çš„é—®é¢˜ï¼Œè¯´ç™½äº†æ˜¯å®ƒçš„ä½œç”¨åŸŸçš„é—®é¢˜ï¼Œçˆ¶ç±»é‡Œçš„æŠ½è±¡å†…éƒ¨ç±»ï¼Œåœ¨çˆ¶ç±»é‡Œnew,å’Œåœ¨å­ç±»é‡Œnew, this$0çš„æŒ‡å‘æ˜¯ä¸åŒçš„ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"}]},{"title":"Dockerç¬”è®°","slug":"Dockerå­¦ä¹ ","date":"2021-11-13T07:00:00.000Z","updated":"2023-05-29T14:17:39.325Z","comments":true,"path":"2021/11/13/Dockerå­¦ä¹ /","link":"","permalink":"http://example.com/2021/11/13/Docker%E5%AD%A6%E4%B9%A0/","excerpt":"","text":"å¸¸è§å‘½ä»¤ docker image lsæŸ¥çœ‹é•œåƒåˆ—è¡¨ docker ps æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ docker run -p 8888:80 -tid blog-20220502 /bin/bash å¯åŠ¨å®¹å™¨ è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨ï¼šdocker exec -ti &#123;containerId&#125; /bin/bash -t ä¸ºdockeråˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯å¹¶ç»‘å®šåˆ°å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¸Š -i æ˜¯è®©å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¿æŒæ‰“å¼€çŠ¶æ€ docker stop/start/restart constainerId æˆ‘åœ¨åˆ«äººçš„å®¹å™¨é‡Œè¿›è¡Œäº†ä¿®æ”¹ï¼Œå¦‚ä½•ä¿å­˜æˆæ–°çš„é•œåƒï¼Ÿå…ˆå°†ä¹‹å‰çš„containeråœæ‰,ç„¶ådocker commit oldContainerId newImage, æ³¨æ„ï¼Œæ˜¯containerId","categories":[{"name":"å®¹å™¨","slug":"å®¹å™¨","permalink":"http://example.com/categories/%E5%AE%B9%E5%99%A8/"}],"tags":[]},{"title":"Linux supervise","slug":"Linux Supervise","date":"2021-08-31T15:00:00.000Z","updated":"2023-05-29T14:17:39.312Z","comments":true,"path":"2021/08/31/Linux Supervise/","link":"","permalink":"http://example.com/2021/08/31/Linux%20Supervise/","excerpt":"","text":"ä»Šå¤©å·¥ä½œä¸­é‡åˆ°ä¸€ä¸ªå‘½ä»¤svcï¼Œå¯ä»¥ç”¨äºä¼˜é›…æ€æ­»è¿›ç¨‹ã€‚æœ¬ç€å•¥éƒ½ä¸ä¼šçš„ç²¾ç¥ï¼Œåˆ¨æ ¹é—®é¢˜ä¸€å“ˆã€‚ èƒŒæ™¯: ä¸€èˆ¬è€Œè¨€ç”Ÿäº§ç¯å¢ƒä¸­çš„æœåŠ¡éƒ½æ˜¯æœ‰å®ˆæŠ¤è¿›ç¨‹çš„ï¼šå½“å®ƒæŒ‚æ‰åï¼Œä¼šæœ‰å¦å¤–ä¸€ä¸ªè¿›ç¨‹æŠŠå®ƒç«‹é©¬æ‹‰èµ·æ¥ã€‚ åœ¨æŒ‡å¯¼è¿™ä¸ªä¸œè¥¿ä»¥å‰ï¼Œæˆ‘éƒ½æ˜¯é€šè¿‡cron+è„šæœ¬çš„æ–¹å¼æ¥è¾¾åˆ°è¿™ä¸€ç›®çš„çš„ï¼Œä½†æ˜¯ç¼ºç‚¹å°±æ˜¯cronåªèƒ½ç²¾ç¡®åˆ°åˆ†é’Ÿï¼Œä¸å¤Ÿç»†ã€‚ æ­£é¤ï¼š linuxä¸­æœ‰ä¸ªç›‘æ§å·¥å…·ï¼Œå«superviseï¼Œå®ƒæ˜¯daemontoolsé‡Œé¢çš„ä¸€ä¸ªå·¥å…·ã€‚ daemontoolsæ˜¯ä»€ä¹ˆï¼Ÿ å®ƒæ˜¯ä¸€ä¸ªlinuxå·¥å…·åŒ…ï¼Œhttp://cr.yp.to/daemontools.htmlã€‚ superviseæ˜¯ä»€ä¹ˆï¼Ÿ superviseç”¨æ¥ç›‘æ§ä¸€ä¸ªæœåŠ¡ï¼Œå½“æœåŠ¡æ­»æ‰æ—¶ï¼Œå¯ä»¥ç«‹é©¬å°†å…¶æ‹‰èµ·ã€‚è¦å®ç°è¿™ä¸ªæ“ä½œï¼Œsuperviseå‘½ä»¤éœ€è¦åˆ›å»ºä¸€ä¸ªrunæ–‡ä»¶ã€‚","categories":[{"name":"Linux","slug":"Linux","permalink":"http://example.com/categories/Linux/"}],"tags":[]},{"title":"Tomcat Sessionç®¡ç†","slug":"å…³äºTomcatçš„Sessionç®¡ç†","date":"2021-06-06T06:00:00.000Z","updated":"2023-05-29T14:17:39.310Z","comments":true,"path":"2021/06/06/å…³äºTomcatçš„Sessionç®¡ç†/","link":"","permalink":"http://example.com/2021/06/06/%E5%85%B3%E4%BA%8ETomcat%E7%9A%84Session%E7%AE%A1%E7%90%86/","excerpt":"","text":"Hey whatâ€™s up guys. æœ‰å¥½é•¿ä¸€æ®µæ—¶é—´æ²¡å†™åšå®¢äº†ï¼Œæœ€è¿‘ä¹Ÿæ˜¯æ¥ä¸Šæµ·ä¸€ä¸ªå¤šæœˆéš¾å¾—çš„ä¸€ä¸ªå‘¨æœ«ï¼Œæ‰€ä»¥å†™ç‚¹ä¸œè¥¿å§ã€‚ å…³äºsession cookieç›¸å…³çš„å†…å®¹åœ¨æ ¡æ‹›æ—¶ä¹Ÿè¢«ç»å¸¸é—®åˆ°ï¼Œä½†æ˜¯æœ€è¿‘æ„Ÿè§‰å¯¹è¿™å—çš„ç†è§£è¿˜æ˜¯ä¸å¤Ÿæ·±å…¥ï¼Œæ‰€ä»¥å†å­¦ä¹ ä¸€ä¸‹ã€‚ ä¼—æ‰€å‘¨çŸ¥sessionç”¨äºä¼šè¯ç®¡ç†ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œhttp requestçš„headeré‡Œçš„cookieså­—æ®µé‡Œä¼šå¸¦ä¸ªsessionID, æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åï¼Œä»cookieä¸­æ‹¿å‡ºsessionID, ç„¶åæ ¹æ®è¿™ä¸ªsessionIDä»æœåŠ¡ç«¯å­˜å‚¨çš„sessionä¸­æ‹¿å‡ºå¯¹åº”çš„session, ç„¶åè¿™ä¸ªsessioné‡Œé¢ä¸€èˆ¬ä¼šå­˜å‚¨ç”¨æˆ·åã€ä¼šè¯è¿‡æœŸæ—¶é—´ç­‰ã€‚ æµç¨‹æ˜¯è¿™ä¹ˆä¸ªæµç¨‹ï¼Œä½†æ˜¯æˆ‘ä¹‹å‰ä¸€ç›´å¿½ç•¥äº†ä¸€ç‚¹ï¼ŒæœåŠ¡ç«¯çš„sessionæ˜¯æ€ä¹ˆå­˜å‚¨çš„ï¼Ÿå› ä¸ºè€ƒè™‘åˆ°æœåŠ¡ç«¯çš„æ‰©å±•æ€§ï¼Œsessionæœ‰æ—¶å€™ä¼šè¢«å­˜å‚¨åˆ°redisæˆ–è€…mysqlä¸­ï¼Œæ‰€ä»¥æˆ‘ä¸€ç›´ä»¥ä¸ºsessionçš„ç®¡ç†éœ€è¦å¼€å‘è€…è‡ªå·±å»åšï¼Œåæ¥å‘ç°ï¼Œå…¶å®tomactæœ‰è‡ªå·±çš„ä¼šè¯ç®¡ç†åŠŸèƒ½ã€‚ è€Œäº‹å®æ˜¯ï¼ŒTomcatå†…éƒ¨æœ‰ä¸ªManageræ¥å£ï¼Œè¿™ä¸ªæ¥å£çš„å®ç°ç±»è´Ÿè´£ç®¡ç†session,å…·ä½“æ¥è¯´ï¼Œè´Ÿè´£sessionçš„å¢åˆ æ”¹æŸ¥ã€‚Manageråº•ä¸‹æœ‰StandarManagerå’ŒPersistanceManagerBaseä¸¤ç§å®ç°ï¼Œä¸€ç§å°†sessionå­˜åœ¨å†…å­˜ï¼Œä¸€ç§åˆ™æ˜¯æŒä¹…åŒ–ã€‚å½“ç„¶StandardManagerä¸ºäº†ä¿è¯å¯é æ€§ï¼Œä¹Ÿä¼šå°†sessionå­˜åˆ°æ–‡ä»¶ä¸­ï¼Œåªä¸è¿‡æ²¡æœ‰ç¬¬äºŒç§å­˜åˆ°æ•°æ®åº“é‚£ä¹ˆä¸“ä¸šå’Œé«˜æ•ˆç½¢äº†ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[]},{"title":"Springboot @Asyncæ¢é™©","slug":"Springboot-@Asyncæ¢é™©","date":"2020-12-02T09:30:00.000Z","updated":"2023-05-29T14:17:39.383Z","comments":true,"path":"2020/12/02/Springboot-@Asyncæ¢é™©/","link":"","permalink":"http://example.com/2020/12/02/Springboot-@Async%E6%8E%A2%E9%99%A9/","excerpt":"","text":"ä»ä¸šåŠ¡è¯´èµ·ï¼Œç”¨åˆ°äº†@Asyncåœ¨ä¸»çº¿ç¨‹ä¸­æ¥æ”¶æ•°æ®ï¼Œè¿›è¡Œæ•°æ®æ‹¼æ¥ï¼Œç„¶åå­˜åº“ï¼Œæœ€åè¿”å›http 200, ç”±äºå®¢æˆ·ç«¯æœ‰å¤±è´¥é‡è¯•æœºåˆ¶ï¼Œä¸”å¤±è´¥æ¬¡æ•°å¤šäº†ä¹‹åä¼šä¸å†è¯·æ±‚ï¼Œæ‰€ä»¥ä¸ºäº†é¿å…ç”±äºå­˜åº“å¯¼è‡´çš„é˜»å¡ï¼Œé¡¹ç›®ä¸­ä½¿ç”¨@asyncè¿›è¡Œå¼‚æ­¥å¤„ç†ã€‚ å‡ºç°äº†æ„æ–™ä¹‹å¤–çš„é—®é¢˜é¡¹ç›®ä¸Šçº¿åå‘ç°ï¼Œä¸€æ®µæ—¶é—´ä¹‹åå®¢æˆ·ç«¯åœæ­¢è¯·æ±‚æœåŠ¡ç«¯äº†ï¼ˆè¿™é‡Œå…¶å®æ˜¯å®¢æˆ·ç«¯çš„è‡ªåŠ¨æ¨é€åŠŸèƒ½è¢«å…³äº†ï¼‰æŸ¥çœ‹æ—¥å¿—å‘ç°æ˜¯ä½¿ç”¨äº†@asyncçš„å­çº¿ç¨‹æŠ›äº†å¼‚å¸¸ï¼Œå¯¼è‡´æ²¡æœ‰æ­£å¸¸è¿”å›http 200ç»™å®¢æˆ·ç«¯ã€‚ è¿™å°±å¥‡äº†æ€ªäº†ï¼Œ@asyncæ˜¯å¼‚æ­¥å¤„ç†ï¼Œç†è®ºä¸Šè®²ï¼Œåœ¨@asyncä¸­å‡ºç°å¼‚å¸¸ä¸åº”è¯¥ä¼šå½±å“åˆ°ä¸»çº¿ç¨‹è¿”å›http 200å•Šã€‚å› æ­¤ç¬”è€…è¿›è¡Œäº†è¿›ä¸€æ­¥çš„éªŒè¯ã€‚ @Asyncæ¢ç§˜æ˜¯å¦æ˜¯å­çº¿ç¨‹çš„éªŒè¯èµ·åˆæˆ‘çš„ä»£ç æ˜¯è¿™æ ·å†™çš„ï¼ˆspringbootä¸‹çš„testæ–‡ä»¶ä¸‹çš„ï¼‰ 123456789101112131415161718192021@Slf4j@RunWith(SpringRunner.class)@SpringBootTestpublic class AsyncTest &#123; @Test public void test()&#123; log.info(&quot;before:&#123;&#125;&quot;,Thread.currentThread().getName()); asyncTest(); log.info(&quot;after&quot;); &#125; @Async(&quot;asyncTaskExecutor&quot;) public void asyncTest()&#123; log.info(&quot;sub:&#123;&#125;&quot;,Thread.currentThread().getName()); try &#123; Thread.sleep(5000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;&#125; ä½†æ˜¯è¾“å‡ºå°±å¾ˆå¥‡æ€ªäº†ï¼š 123before:&quot;main&quot;sub:&quot;main&quot;after åŠ äº†asyncæ³¨è§£ï¼Œä½†æ˜¯ä¼¼ä¹å¹¶æ²¡æœ‰å¼€å¯å­çº¿ç¨‹ï¼Ÿ é€šè¿‡æŸ¥æ‰¾èµ„æ–™å¾—çŸ¥ï¼ŒåŸæ¥ä½¿ç”¨asyncæ³¨è§£çš„æ–¹æ³•ä¸èƒ½å’Œä¸»çº¿ç¨‹çš„æ–¹æ³•åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œè¿™é‡Œçš„åŸå› ç¬”è€…ä¼šç¨åè§£é‡Šï¼Œäºæ˜¯ä¿®æ”¹ä»£ç ï¼š AsyncTest 1234567891011121314@Slf4j@RunWith(SpringRunner.class)@SpringBootTestpublic class AsyncTest &#123; @Autowired AnotherTest anotherTest; @Test public void test()&#123; log.info(&quot;before:&#123;&#125;&quot;,Thread.currentThread().getName()); anotherTest.asyncTest(); log.info(&quot;after&quot;); &#125;&#125; AnotherTest 12345678910111213@Slf4j@Servicepublic class AnotherTest &#123; @Async(&quot;asyncTaskExecutor&quot;) public void asyncTest()&#123; log.info(&quot;sub:&#123;&#125;&quot;,Thread.currentThread().getName()); try &#123; Thread.sleep(5000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;&#125; å†æ¬¡æ‰§è¡Œï¼Œä¸€æ ·çš„è¾“å‡ºï¼Ÿï¼Ÿï¼Ÿå°å°çš„è„‘è¢‹æœ‰å¤§å¤§çš„ç–‘æƒ‘ã€‚åæ¥æ‰¾åˆ°åŸå› ï¼Œéœ€è¦åœ¨SpringBootApplicationæ‰€åœ¨ç±»ä½¿ç”¨@EnableAsyncå¼€å¯asyncåŠŸèƒ½ï¼Œåƒè¿™æ ·ï¼š 12345678@SpringBootApplication@EnableAsync@MapperScan(&quot;com.aier.camerawater.mapper&quot;)public class CamerawaterApplication &#123;public static void main(String[] args) &#123; SpringApplication.run(CamerawaterApplication.class, args); &#125;&#125; å†æ¬¡è¿è¡Œï¼Œè¾“å‡ºæ˜¯å¯¹äº†ï¼š 123before:&quot;main&quot;aftersub:&quot;async-task-thread-pool-1&quot; ä½†æ˜¯åœ¨è¾“å‡ºçš„åé¢è·Ÿäº†ä¸ªInterruptException: 123456789101112131415161718192020-12-02 19:10:33.960 INFO com.aier.camerawater.AsyncTest - before:&quot;main&quot;2020-12-02 19:10:33.971 INFO com.aier.camerawater.AsyncTest - after2020-12-02 19:10:33.980 INFO com.aier.camerawater.AnotherTest - sub:&quot;async-task-thread-pool-1&quot;2020-12-02 19:10:33.986 INFO org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor - Shutting down ExecutorService &#x27;asyncTaskExecutor&#x27;java.lang.InterruptedException: sleep interrupted at java.lang.Thread.sleep(Native Method) at com.aier.camerawater.AnotherTest.asyncTest(AnotherTest.java:14) at com.aier.camerawater.AnotherTest$$FastClassBySpringCGLIB$$437e206d.invoke(&lt;generated&gt;) at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218) at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:771) at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:749) at org.springframework.aop.interceptor.AsyncExecutionInterceptor.lambda$invoke$0(AsyncExecutionInterceptor.java:115) at java.util.concurrent.FutureTask.run(FutureTask.java:266) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.Thread.run(Thread.java:748)Process finished with exit code 0 å†æ¬¡æ„£ä½ï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œå‡ºç°InterruptExceptionçš„åŸå› ä¹‹ä¸€å°±æ˜¯å½“çº¿ç¨‹sleepçš„æ—¶å€™è¢«ä¸­æ–­å°±ä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ï¼Œå…·ä½“å¯ä»¥å‚è€ƒç¬”è€…çš„è¿™ç¯‡æ–‡ç« ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬çš„ä»£ç ä¸­ä¹Ÿæ²¡æœ‰interruptçš„ç›¸å…³æ“ä½œå•Šã€‚ä½†æ˜¯å†·é™è§‚å¯Ÿä¸€ä¸‹ä½ å°±ä¼šå‘ç°ï¼Œåœ¨æŠ›å‡ºå¼‚å¸¸çš„ä¸Šé¢ï¼Œè¿˜æœ‰è¿™ä¹ˆä¸€è¡Œï¼š 1org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor - Shutting down ExecutorService &#x27;asyncTaskExecutor&#x27;java.lang.InterruptedException: sleep interrupted ä¹Ÿå°±æ˜¯è¯´ï¼Œæ˜¯ç”±äºä¸»çº¿ç¨‹å…ˆç»“æŸçš„ï¼Œç„¶åè¿™æ—¶å€™çº¿ç¨‹æ± æ‰“ç®—shutdownäº†ï¼Œäºæ˜¯å°±interruptäº†æˆ‘ä»¬çš„å­çº¿ç¨‹ã€‚æ¢å¥è¯è¯´å°±æ˜¯ï¼Œè¿™ä¸ªçº¿ç¨‹æ± æ˜¯è·Ÿç€ä¸»çº¿ç¨‹èµ°çš„ï¼Œä¸»çº¿ç¨‹ç»“æŸå®ƒå°±ç»“æŸã€‚ è¿™ä¼¼ä¹å’Œæˆ‘ä»¬å¹³æ—¶ç”¨çš„çº¿ç¨‹æ± ä¸å¤ªä¸€æ ·å•Šï¼Œå¹³æ—¶ä½¿ç”¨ä¹Ÿæ²¡è§å®ƒè¿™ä¹ˆçŒ´æ€¥ï¼Œè¿˜æ²¡ç­‰å­çº¿ç¨‹ç»“æŸå°±åŒ†åŒ†shutdownå•Šã€‚åœ¨ç½‘ä¸Šé˜…è¯»äº†ä¸€äº›æ–‡ç« åå‘ç°ï¼Œä¼¼ä¹é—®é¢˜ä¸æ˜¯å‡ºåœ¨çº¿ç¨‹æ± ä¸Šï¼Œè€Œæ˜¯å•å…ƒæµ‹è¯•ï¼è¿˜è®°å¾—ç¬”è€…åœ¨æ–‡ç« å¼€å§‹çš„æ—¶å€™è¯´è¿‡è¿™ä¸ªæµ‹è¯•ä»£ç æ˜¯å†™åœ¨springbootçš„testæ–‡ä»¶å¤¹ä¸‹å—ï¼Œä¹Ÿå°±æ˜¯å•å…ƒæµ‹è¯•çš„ä½ç½®ï¼Œç›®æµ‹æ˜¯åœ¨å•å…ƒæµ‹è¯•ä¸­ï¼Œå½“ä¸»çº¿ç¨‹æ‰§è¡Œå®Œä¹‹åï¼Œä¸»çº¿ç¨‹æ‰€åœ¨beanå°±è¢«å›æ”¶äº†ï¼Œä¸åªæ˜¯çº¿ç¨‹æ± ï¼Œæ¢æˆåŸç”Ÿçš„çº¿ç¨‹åˆ›å»ºæ–¹æ³•éƒ½ä¼šæœ‰è¿™ä¹ˆä¸ªé—®é¢˜ã€‚ é‚£ä¹ˆæ€ä¹ˆè§£å†³å‘¢ï¼Ÿä¸¥æ ¼æ¥è®²ï¼Œè¿™ç§æƒ…å†µåªæœ‰åœ¨å•å…ƒæµ‹è¯•æ—¶æ‰å‡ºç°ï¼Œæ‰€ä»¥ä¸ç”¨å¤ªåœ¨æ„ï¼Œä½†æ˜¯å¦‚æœéè¦è§£å†³ï¼Œä¹Ÿæ˜¯æœ‰åŠæ³•çš„ï¼š 1asyncTaskExecutor.setWaitForTasksToCompleteOnShutdown(true); åŠ ä¸Šè¿™å¥ï¼Œçº¿ç¨‹æ± å°±ä¼šç­‰taskéƒ½æ‰§è¡Œå®Œæ‰ä¼šshutdownäº†ã€‚ ä¸‹é¢æ¥è®²ä¸Šé¢çš„é—ç•™é—®é¢˜ï¼šä½¿ç”¨@asyncæ—¶ï¼Œä¸ºä»€ä¹ˆå¼‚æ­¥æ–¹æ³•ä¸èƒ½å’Œè°ƒç”¨å®ƒçš„æ–¹æ³•å±äºåŒä¸€ä¸ªç±»ï¼Ÿ å…¶å®è¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæœ€å¥½çš„åŠæ³•å°±æ˜¯å»ç†è§£å’Œå®ç°springä¸­çš„ä¾èµ–æ³¨å…¥ï¼Œç„¶åæ‰‹å†™ä¸€ä¸ªæ³¨è§£ï¼Œä¸‹é¢ç»™å‡ºå‚è€ƒè‡ªè¿™ç¯‡æ–‡ç« çš„å›ç­”ï¼š spring åœ¨æ‰«æbeançš„æ—¶å€™ä¼šæ‰«ææ–¹æ³•ä¸Šæ˜¯å¦åŒ…å«@Asyncæ³¨è§£ï¼Œå¦‚æœåŒ…å«ï¼Œspringä¼šä¸ºè¿™ä¸ªbeanåŠ¨æ€åœ°ç”Ÿæˆä¸€ä¸ªå­ç±»ï¼ˆå³ä»£ç†ç±»ï¼Œproxyï¼‰ï¼Œä»£ç†ç±»æ˜¯ç»§æ‰¿åŸæ¥é‚£ä¸ªbeançš„ã€‚æ­¤æ—¶ï¼Œå½“è¿™ä¸ªæœ‰æ³¨è§£çš„æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯ç”±ä»£ç†ç±»æ¥è°ƒç”¨çš„ï¼Œä»£ç†ç±»åœ¨è°ƒç”¨æ—¶å¢åŠ å¼‚æ­¥ä½œç”¨ã€‚ç„¶è€Œï¼Œå¦‚æœè¿™ä¸ªæœ‰æ³¨è§£çš„æ–¹æ³•æ˜¯è¢«åŒä¸€ä¸ªç±»ä¸­çš„å…¶ä»–æ–¹æ³•è°ƒç”¨çš„ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•çš„è°ƒç”¨å¹¶æ²¡æœ‰é€šè¿‡ä»£ç†ç±»ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡åŸæ¥çš„é‚£ä¸ª bean ä¹Ÿå°±æ˜¯ this. methodï¼Œæ‰€ä»¥å°±æ²¡æœ‰å¢åŠ å¼‚æ­¥ä½œç”¨ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„ç°è±¡å°±æ˜¯@Asyncæ³¨è§£æ— æ•ˆã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"async","slug":"async","permalink":"http://example.com/tags/async/"}]},{"title":"å®¹å™¨å­¦ä¹ ç¬”è®°","slug":"å®¹å™¨å­¦ä¹ ç¬”è®°","date":"2020-09-15T02:00:00.000Z","updated":"2023-05-29T14:17:39.320Z","comments":true,"path":"2020/09/15/å®¹å™¨å­¦ä¹ ç¬”è®°/","link":"","permalink":"http://example.com/2020/09/15/%E5%AE%B9%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","excerpt":"","text":"dockeræœ¬è´¨æ˜¯ä¸ªè¿›ç¨‹ï¼Œé€šè¿‡cgroup, namespaceå’Œrootfså®ç°çš„ä¸€ä¸ªç‰¹æ®Šçš„è¿›ç¨‹ã€‚ kuberneteså‡Œé©¾äºdockerä¹‹ä¸Šï¼Œdockeråªæ˜¯å®ƒçš„è¿è¡Œæ—¶çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œé™¤äº†è¿è¡Œæ—¶ï¼Œk8sè¿˜æœ‰è®¸å¤šå…¶ä»–çš„éƒ¨åˆ†ã€‚","categories":[{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"http://example.com/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"}],"tags":[{"name":"å®¹å™¨","slug":"å®¹å™¨","permalink":"http://example.com/tags/%E5%AE%B9%E5%99%A8/"}]},{"title":"Javaä¸­çš„ç±»å¸è½½","slug":"Javaä¸­çš„ç±»å¸è½½","date":"2020-09-06T04:00:00.000Z","updated":"2023-05-29T14:17:37.584Z","comments":true,"path":"2020/09/06/Javaä¸­çš„ç±»å¸è½½/","link":"","permalink":"http://example.com/2020/09/06/Java%E4%B8%AD%E7%9A%84%E7%B1%BB%E5%8D%B8%E8%BD%BD/","excerpt":"","text":"ä¸ºä»€ä¹ˆä¼šæœ‰ç±»å¸è½½ä¸€è¯´åœ¨ä¸€äº›åœºæ™¯ä¸­ï¼Œæ¯”å¦‚java agentæŠ€æœ¯ï¼Œæˆ‘ä»¬attachåˆ°ç›®æ ‡jvmçš„agentä¸­çš„ç±»è¢«åŠ è½½å¹¶ä¸”ä½¿ç”¨å®Œåï¼Œå®ƒçš„ä½¿å‘½å°±å®Œæˆäº†ï¼Œç•™ç€å ç”¨jvmå†…å­˜ï¼Œè¿™æ—¶å€™å°±éœ€è¦å¸è½½æ‰ã€‚ å¦‚ä½•å¸è½½åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­æœ‰åˆ†äº«è¿‡ç±»åŠ è½½ï¼Œæœ‰ç±»åŠ è½½å°±æœ‰ç±»å¸è½½ï¼Œå½“è¿™ä¸ªç±»çš„Classå¯¹è±¡ä¸å†è¢«å¼•ç”¨æ—¶ï¼Œé‚£å®ƒçš„ç”Ÿå‘½å‘¨æœŸå°±ç»“æŸäº†ã€‚æˆ‘ä»¬éœ€è¦ç†è§£è¿™ä¹ˆå‡ ä¸ªæ¦‚å¿µï¼š ç±»åŠ è½½å™¨ Classå¯¹è±¡ ç±»çš„å®ä¾‹ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œç±»æ˜¯ç”±ç±»åŠ è½½å™¨åŠ è½½è¿›æ¥çš„ï¼Œå³ClassLoaderåŠ è½½Class. ç„¶åï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡ŒJVMè‡ªå¸¦çš„ClassLoaderå’ŒClassæ˜¯äº’ç›¸å¼•ç”¨çš„ï¼Œæ¯”å¦‚ï¼ŒClasså¯¹è±¡æ˜¯æœ‰ä¸€ä¸ªgetClassLoaderæ–¹æ³•æ¥è·å¾—å®ƒçš„ç±»åŠ è½½å…¶çš„ã€‚ åŒæ—¶ï¼Œç±»çš„å®ä¾‹æŒæœ‰Classå¯¹è±¡çš„å¼•ç”¨ï¼Œè¿™ä¸€ç‚¹å¯ä»¥ä»Objectç±»çš„getClassæ–¹æ³•ä¸­å¾—çŸ¥ã€‚ æ­£å¦‚å‰é¢æ‰€è¯´ï¼ŒJVMè‡ªå¸¦çš„ç±»åŠ è½½å™¨ä¼šä¸€ç›´æŒæœ‰å®ƒæ‰€åŠ è½½çš„Classå¯¹è±¡çš„å¼•ç”¨ï¼Œè¿™å°±æ„å‘³ç€ç”±JVMè‡ªå¸¦çš„ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æ˜¯æ— æ³•è¢«å¸è½½çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¦‚æœæƒ³è¦è¢«åŠ è½½çš„ç±»èƒ½å¤Ÿè¢«å¸è½½ï¼Œå°±éœ€è¦è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œå…¶å…·ä½“åšæ³•å°±æ˜¯ç»§æ‰¿ClassLoaderç±»ï¼Œç„¶åå¤å†™findClass()æ–¹æ³•ã€‚ ä¼šæœ‰ä»€ä¹ˆé—®é¢˜","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"ç±»å¸è½½","slug":"ç±»å¸è½½","permalink":"http://example.com/tags/%E7%B1%BB%E5%8D%B8%E8%BD%BD/"}]},{"title":"Javaä¸­çš„Instrumentation","slug":"Javaä¸­çš„Instrument","date":"2020-09-04T14:00:00.000Z","updated":"2023-05-29T14:17:39.331Z","comments":true,"path":"2020/09/04/Javaä¸­çš„Instrument/","link":"","permalink":"http://example.com/2020/09/04/Java%E4%B8%AD%E7%9A%84Instrument/","excerpt":"","text":"å‰è¨€åœ¨ä¹‹å‰çš„æ–‡ç« é‡Œæˆ‘ä»¬ä»‹ç»äº†ASMå­—èŠ‚ç æ¡†æ¶ï¼Œä½¿ç”¨å®ƒå¯ä»¥åŠ¨æ€çš„ä¿®æ”¹classæ–‡ä»¶ã€‚ä½†æ˜¯ä»”ç»†ä¸€æƒ³ï¼Œä½ ä¼šå‘ç°ä»…ä»…ASMå¹¶ä¸èƒ½çœŸæ­£ç”¨äºç”Ÿäº§ï¼Œä¸ºä»€ä¹ˆï¼Ÿå‡å¦‚ä½ å·²ç»æœ‰ä¸€ä¸ªåœ¨è¿è¡Œçš„ç³»ç»Ÿäº†ï¼Œç°åœ¨æƒ³è¦åšä¸€äº›å­—èŠ‚ç ä¿®æ”¹çš„åŠ¨ä½œï¼Œéš¾é“æˆ‘ä»¬è¦å»ä¿®æ”¹æºä»£ç å—ï¼Ÿéº»çƒ¦ä¸è¯´ï¼Œè€Œä¸”æ±¡æŸ“äº†æœ¬æ¥çš„ç³»ç»Ÿã€‚ æ‰€ä»¥æˆ‘ä»¬å°±è€ƒè™‘ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•ï¼Œå¯ä»¥å®ç°åŠ¨æ€çš„æ— æ±¡æŸ“çš„ç»‡å…¥ï¼Œè¿™å°±è¦å¼•å…¥ä»Šå¤©çš„ä¸»è§’ï¼ŒInstrumentäº†ã€‚ æ­£æ–‡Instrumentationæ˜¯Javaagentçš„ä¸€ç§å…·ä½“å®ç°ï¼Œé‚£javaagentåˆæ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœä½ åœ¨ç»ˆç«¯é‡Œè¾“å…¥java(å½“ç„¶å‰ææ˜¯ä½ å·²ç»å®‰è£…äº†jdk), ä½ ä¼šçœ‹åˆ°è¿™ä¹ˆå‡ ä¸ªå‚æ•°ï¼š å…¶ä¸­ï¼Œ-javaagentå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ï¼Œjdkæä¾›çš„Instrumentå…è®¸æˆ‘ä»¬åœ¨jvmå¯åŠ¨æˆ–è€…è¿è¡Œæ—¶ï¼ŒåŠ¨æ€åœ°æ‹¦æˆªè¦åŠ è½½çš„ç±»ï¼Œå¹¶å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚æ— è®ºæ˜¯å¯åŠ¨æ—¶è¿˜æ˜¯è¿è¡Œæ—¶ï¼Œå…¶å¤§è‡´åŸç†éƒ½æ˜¯æŠŠæˆ‘ä»¬çš„ä¿®æ”¹ä»£ç å°è£…æˆä¸€ä¸ªJaråŒ…ï¼Œç„¶åæƒ³åŠæ³•è®©ç›®æ ‡jvmè¿›ç¨‹åŠ è½½ã€‚ instrumentationä»‹ç»å…ˆä¸Šä¸€å¼ å›¾ï¼š instrumentationæ˜¯ä»€ä¹ˆï¼Ÿjdkä¸­çš„ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªæ¥å£æä¾›äº†å“ªäº›æ–¹æ³•ï¼š è¿™é‡Œæˆ‘ä¹Ÿæ¡†å‡ºæ¥äº†å¸¸ç”¨çš„å‡ ä¸ªæ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°è¿™å‡ ä¸ªæ–¹æ³•åŸºæœ¬éƒ½å’ŒClassFileTransformerè¿™ä¸ªæ¥å£æœ‰å…³ï¼Œé‚£æˆ‘ä»¬ç»§ç»­çœ‹ä¸‹ClassFileTransformerçš„ä»‹ç»ã€‚ å…¶å®ä»åå­—å¯ä»¥å¤§æ¦‚çœ‹å‡ºï¼ŒClassFileTransformeræ˜¯å¯¹classæ–‡ä»¶è¿›è¡Œè½¬æ¢çš„ï¼Œå†é€šä¿—ç‚¹ï¼Œå°±æ˜¯ç”¨æ¥ä¿®æ”¹å­—èŠ‚ç çš„ã€‚ClassFileTransformerè¿™ä¸ªæ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³•transform: 123456byte[] transform( ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined, ProtectionDomain protectionDomain, byte[] classfileBuffer) å…¶ä¸­loaderå‚æ•°æ˜¯åŠ è½½è¿™ä¸ªç±»çš„ç±»åŠ è½½å™¨ï¼ŒclassfileBufferå°±æ˜¯è½½å…¥å†…å­˜ä¸­çš„classæ–‡ä»¶ã€‚å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•è¿”å›å€¼æ˜¯ä¸ªå­—èŠ‚æ•°ç»„ï¼Œå¦‚æœè¿”å›null, åˆ™è¡¨ç¤ºå¯¹classæ–‡ä»¶ä¸åšå¤„ç†ï¼Œå¦åˆ™å°±ç”¨è¿”å›çš„å­—èŠ‚æ•°ç»„ä»£æ›¿åŸæ¥çš„ç±»ã€‚ å½“æˆ‘ä»¬ä½¿ç”¨addTransformerç»™instrumentationæ·»åŠ ClassFileTransformeråï¼Œåç»­æ‰€æœ‰JVMåŠ è½½ç±»çš„æ—¶å€™éƒ½ä¼šè¢«ClassFileTransformerçš„transformæ–¹æ³•æ‹¦æˆªã€‚ ä¸Šé¢å¤§æ¦‚ä»‹ç»äº†instrumentationå’ŒClassFileTransformerï¼Œä¸‹é¢çš„éƒ¨åˆ†ä¼šä»‹ç»è¿™ä¸¤ä¸ªä¸œè¥¿å¦‚ä½•ç»“åˆèµ·æ¥ä½¿ç”¨ã€‚å¦‚ä¸Šæ–‡æ‰€è¯´ï¼Œinstrumentationçš„åŸç†å¤§æ¦‚æ˜¯ï¼šæŠŠæˆ‘ä»¬çš„ä¿®æ”¹ä»£ç å°è£…æˆä¸€ä¸ªJaråŒ…ï¼ˆå³agentï¼‰ï¼Œç„¶åæƒ³åŠæ³•è®©ç›®æ ‡jvmè¿›ç¨‹åŠ è½½ã€‚é‚£å°±æ¶‰åŠåˆ°ä¸€ä¸ªé—®é¢˜ï¼šç›®æ ‡jvmä½•æ—¶åŠ è½½ï¼Ÿjava agentæä¾›äº†ä¸¤ç§æ‰‹æ®µï¼Œåˆ†åˆ«æ˜¯åœ¨jvmå¯åŠ¨æ—¶åŠ è½½å’Œjvmè¿è¡Œæ—¶åŠ è½½ã€‚ JVMå¯åŠ¨æ—¶åŠ è½½instrument agentä¸»è¦ç”¨åˆ°äº†premain()æ–¹æ³•ï¼Œ ä»åå­—ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œpremainå…¶å®å°±æ˜¯åœ¨mainå‡½æ•°ä¹‹å‰æ‰§è¡Œï¼Œæ‰€ä»¥ä¹Ÿå°±æ˜¯ä¼šåœ¨mainå‡½æ•°æ‰§è¡Œä¹‹å‰æ‹¦æˆªç±»çš„åŠ è½½ï¼Œå¹¶åšä¸€äº›æ”¹é€ ï¼Œpremainå‡½æ•°å¦‚ä¸‹ï¼š 1public static void premain(String agentArgs, Instrumentation inst) å…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°agentArgsæ˜¯agentå¯åŠ¨æ—¶çš„å‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯æˆ‘ä»¬çš„ä¸»è§’ï¼Œinstrumentation. ä¸€èˆ¬çš„ä¸€ä¸ªæ“ä½œæµç¨‹æ˜¯ä½¿ç”¨instrumentationçš„addTransformeræ–¹æ³•æ·»åŠ ä¸€ä¸ªClassFileTransformer, è€Œè¿™ä¸ªClassFileTransformeré‡Œé¢çš„transformæ–¹æ³•ä¸€èˆ¬å°±æ˜¯æˆ‘ä»¬æ–½å±•æ‹³è„šçš„åœ°æ–¹ï¼Œåœ¨è¿™é‡Œå¯ä»¥å¯¹å­—èŠ‚ç è¿›è¡Œä¿®æ”¹ç­‰æ“ä½œã€‚ä¸‹é¢çš„ä»£ç å®ç°äº†ä¸€ä¸ªç®€å•çš„Agent 123456789101112131415161718192021import java.lang.instrument.ClassFileTransformer;import java.lang.instrument.IllegalClassFormatException;import java.lang.instrument.Instrumentation;import java.security.ProtectionDomain;public class PreMainAgent &#123; public static void premain(String agentArgs, Instrumentation inst)&#123; System.out.println(&quot;agent args: &quot;+agentArgs); inst.addTransformer(new MyTransformer(),true); &#125; static class MyTransformer implements ClassFileTransformer&#123; @Override public byte[] transform(ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined, ProtectionDomain protectionDomain, byte[] classfileBuffer) throws IllegalClassFormatException &#123; System.out.println(&quot;premain load class: &quot;+className); return classfileBuffer; &#125; &#125;&#125; ç„¶åæˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ªagentæ‰“åŒ…æˆjaråŒ…ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨mavenæ‰“åŒ…ï¼Œé€šè¿‡é…ç½®pom.xmlæ–‡ä»¶ï¼Œæ ¸å¿ƒå†…å®¹å¦‚ä¸‹ï¼š 12345678910111213141516171819&lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt; &lt;version&gt;3.1.0&lt;/version&gt; &lt;configuration&gt; &lt;archive&gt; &lt;!--è‡ªåŠ¨æ·»åŠ META-INF/MANIFEST.MF --&gt; &lt;manifest&gt; &lt;addClasspath&gt;true&lt;/addClasspath&gt; &lt;/manifest&gt; &lt;manifestEntries&gt; &lt;Premain-Class&gt;PreMainAgent&lt;/Premain-Class&gt; &lt;Agent-Class&gt;PreMainAgent&lt;/Agent-Class&gt; &lt;Can-Redefine-Classes&gt;true&lt;/Can-Redefine-Classes&gt; &lt;Can-Retransform-Classes&gt;true&lt;/Can-Retransform-Classes&gt; &lt;/manifestEntries&gt; &lt;/archive&gt; &lt;/configuration&gt; &lt;/plugin&gt; ä½¿ç”¨mvn packageæ‰“åŒ…æˆJaråŒ…ï¼Œæ‰“åŒ…åçš„æ–‡ä»¶åœ¨/targetç›®å½•ä¸‹ã€‚ å®Œæˆä¸Šè¿°æ“ä½œåï¼Œæˆ‘ä»¬å†å•ç‹¬å»ºä¸€ä¸ªé¡¹ç›®ï¼Œæ¥æµ‹è¯•æˆ‘ä»¬çš„agent, 1234567891011public class Test &#123; public static void main(String[] args) &#123; System.out.println(&quot;main start&quot;); try &#123; Thread.sleep(3000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println(&quot;main end&quot;); &#125;&#125; å¦‚æœæ˜¯åœ¨ideaé‡Œè¿è¡Œçš„è¯ï¼Œæˆ‘ä»¬éœ€è¦åœ¨add configurationé‡Œé¢é…ç½®ä¸€ä¸‹ï¼š ä¸»è¦å°±æ˜¯å…³æ³¨ä¸‹è¿™ä¸ªjavaagentå‚æ•°å°±è¡Œï¼Œç„¶åè¿è¡Œï¼Œèµ°èµ·ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š 123456789101112131415agent args: nullpremain load class: java/util/concurrent/ConcurrentHashMap$ForwardingNodepremain load class: java/util/jar/Attributespremain load class: java/util/jar/Manifest$FastInputStream...(æ­¤å¤„çœç•¥è‹¥å¹²)main startpremain load class: java/net/URI...ï¼ˆæ­¤å¤„çœç•¥è‹¥å¹²ï¼‰premain load class: sun/nio/cs/US_ASCII$Decodermain endpremain load class: java/lang/Shutdownpremain load class: java/lang/Shutdown$LockProcess finished with exit code 0 è‡³æ­¤ï¼Œæµç¨‹èµ°é€šã€‚ é‚£ä¹ˆè¿™ç§jvmå¯åŠ¨æ—¶å°±åŠ è½½agentçš„æ–¹å¼æœ‰æ²¡æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿé¦–å…ˆå¥½å¤„è‚¯å®šæ˜¯æœ‰çš„ï¼Œå› ä¸ºæ­¤æ—¶agentåŠ è½½çš„æ—¶å€™å¤§éƒ¨åˆ†ç±»è¿˜æ²¡åŠ è½½ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥å®ç°å¯¹æ–°åŠ è½½çš„ç±»çš„è¿›è¡Œå­—èŠ‚ç ä¿®æ”¹ã€‚ä½†æ˜¯ï¼å¦‚æœpremainæ–¹æ³•æ‰§è¡Œå¤±è´¥æˆ–è€…æŠ›å¼‚å¸¸ï¼Œé‚£ä¹ˆjvmè¿›ç¨‹ä¼šè¢«ç»ˆæ­¢ï¼Œè¿™å°±æœ‰ç‚¹éš¾ä»¥æ¥å—äº†ã€‚ï¼ˆè¿™æ®µè¯æ‘˜è‡ªå å°ç‹¼çš„åšå®¢ï¼‰ å› æ­¤ï¼Œåœ¨jdk1.6ä¸­ï¼Œåˆæå‡ºäº†å¦ä¸€ç§æ–¹æ³•ã€‚ JVMè¿è¡Œæ—¶åŠ è½½instrument agentä¸»è¦ç”¨åˆ°äº†agentmain()æ–¹æ³•ï¼Œ instrumentåŸç†ä½¿ç”¨instrumentæœ‰ä»€ä¹ˆé—®é¢˜TODO: ç±»éš”ç¦» åå°„","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"Instrument","slug":"Instrument","permalink":"http://example.com/tags/Instrument/"}]},{"title":"ASMå­—èŠ‚ç ","slug":"ASMå­—èŠ‚ç æ³¨å…¥","date":"2020-08-30T05:00:00.000Z","updated":"2023-05-29T14:17:39.391Z","comments":true,"path":"2020/08/30/ASMå­—èŠ‚ç æ³¨å…¥/","link":"","permalink":"http://example.com/2020/08/30/ASM%E5%AD%97%E8%8A%82%E7%A0%81%E6%B3%A8%E5%85%A5/","excerpt":"","text":"å†™è¿™ç¯‡æ–‡ç« æ˜¯å› ä¸ºåœ¨å¼€æ°´å›¢å®ä¹ çš„æ—¶å€™çš„ä¸€ä¸ªé¡¹ç›®ç”¨åˆ°äº†è¿™ä¸ªæŠ€æœ¯ï¼Œåœ¨è¿™é‡Œé‡æ–°åšä¸‹æ€»ç»“å’Œæ¢³ç†ã€‚ ä»€ä¹ˆæ˜¯ASMASMæ˜¯ä¸€ä¸ªå­—èŠ‚ç æ“ä½œæ¡†æ¶ï¼Œä½¿ç”¨å®ƒå¯ä»¥åŠ¨æ€åœ°ä¿®æ”¹classæ–‡ä»¶ï¼Œæˆ–è€…è®©ç±»è¢«åŠ è½½åˆ°è™šæ‹Ÿæœºä¹‹å‰ä¿®æ”¹ä¸€äº›è¡Œä¸ºã€‚ ASMæœ‰ä»€ä¹ˆç”¨ä¸€è¨€ä»¥è”½ä¹‹ï¼ŒAOP. è¯´åˆ°AOPï¼Œå¯èƒ½ä¼šæƒ³åˆ°Springçš„JDKåŠ¨æ€ä»£ç†Proxyæˆ–è€…CGLIB. è¿™é‡ŒJDKåŠ¨æ€ä»£ç†åº•å±‚ä½¿ç”¨åå°„å®ç°ï¼Œä¼—æ‰€å‘¨çŸ¥åå°„çš„æ€§èƒ½æ¯”è¾ƒå·®ã€‚è€ŒCGLIB, å…¶å®ASMå’ŒCGLIBæ˜¯æœ‰å…³ç³»çš„ã€‚ æ€ä¹ˆç”¨ASMæä¾›äº†ä¸¤ç§APIï¼šåŸºäºäº‹ä»¶è§¦å‘çš„Core APIå’ŒåŸºäºå¯¹è±¡çš„Tree API, å…¶åŒºåˆ«å°±åœ¨äºè§£æclassæ–‡ä»¶çš„æ–¹å¼ä¸åŒã€‚ä¸‹é¢ä¼šä¸»è¦ä»‹ç»Core API. å…ˆåˆ—å‡ºä¸»è¦çŸ¥è¯†ç‚¹ï¼š Core APIæœ‰ä¸‰ä¸ªæ ¸å¿ƒç±»ï¼šClassReader,ClassWriter,ClassVisitor. æ•´ä½“ä½¿ç”¨äº†Visitoræ¨¡å¼ã€‚ é¦–å…ˆ, ClassReader, å¬åå­—å°±çŸ¥é“æ˜¯ç”¨æ¥è¯»å–Classæ–‡ä»¶çš„ï¼Œå½“ç„¶å¹¶ä¸æ˜¯ç®€å•çš„è¯»æ–‡ä»¶æ“ä½œå•¦ï¼Œå®ƒè¿˜ä¼šåˆ†æclassæ–‡ä»¶çš„ç»“æ„ä¹‹ç±»çš„ï¼Œç»™å®ƒåˆ†æçš„æ˜æ˜ç™½ç™½çš„æ”¾åˆ°å†…å­˜é‡Œã€‚ ç„¶åï¼Œè¿™ä¸ªClassReaderä¼šä½œä¸ºVisitoræ¨¡å¼ä¸­çš„è¢«è®¿é—®è€…ï¼Œå¼€è¾Ÿä¸€ä¸ªacceptæ¥å£ï¼Œæ”¾è¿›æ¥ä¸€ä¸ªClassVisitorï¼Œè¿›è¡Œä¸€äº›visitæ“ä½œã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ä¸ªç‚¹æ˜¯ï¼Œvisitæ–¹æ³•é‡Œé¢å…·ä½“çš„visité¡ºåºASMå·²ç»å›ºå®šå¥½äº†ï¼Œæˆ‘ä»¬åªéœ€è¦æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚å»è¦†ç›–ä¸€äº›visitæ–¹æ³•å³å¯ã€‚å®ƒçš„ä¸€ä¸ªæ—¶åºå›¾å¦‚ä¸‹ï¼š è€ŒClassWriteræ˜¯ClassVisitoræŠ½è±¡ç±»çš„ä¸€ä¸ªå®ç°ç±»ï¼Œå‰‹æŠŠæœ€ç»ˆä¿®æ”¹çš„å­—èŠ‚ç ä»¥byteæ•°ç»„çš„å½¢å¼è¿”å›ã€‚ ä¸‹é¢é€šè¿‡å…·ä½“çš„ä¾‹å­æ¥çœ‹ä¸‹ASMæ˜¯å¦‚ä½•æ“ä½œçš„ã€‚ å…ˆæ¥ä¸€ä¸ªæµ‹è¯•ç±»ï¼š 1234public class Test1 &#123; private int a; public void method()&#123;&#125;&#125; å†æ¥ä¸€æ‰‹javac Test1.java, ç¼–è¯‘å¾—åˆ°Test1.class. ç°åœ¨å¼€å§‹ASMç§€ã€‚ 1. è®¿é—®ç±»çš„æ–¹æ³•å’Œå­—æ®µ12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970package asm;import jdk.internal.org.objectweb.asm.*;import java.io.*;import static jdk.internal.org.objectweb.asm.Opcodes.ASM5;public class Main1 &#123; public static void main(String[] args) &#123; try &#123; new Main1().visitMethodAndField(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; public void visitMethodAndField() throws IOException &#123; //å…ˆè¯»classæ–‡ä»¶ byte[] classBytes = toByteArray(&quot;E:\\\\IntelliJidea\\\\workspace\\\\Test2\\\\src\\\\asm\\\\Test1.class&quot;); ClassReader cr = new ClassReader(classBytes); ClassWriter cw = new ClassWriter(0); ClassVisitor cv = new ClassVisitor(ASM5,cw) &#123; @Override public FieldVisitor visitField(int i, String s, String s1, String s2, Object o) &#123; System.out.println(&quot;field:&quot;+s); return super.visitField(i, s, s1, s2, o); &#125; @Override public MethodVisitor visitMethod(int i, String s, String s1, String s2, String[] strings) &#123; System.out.println(&quot;method:&quot;+s); return super.visitMethod(i, s, s1, s2, strings); &#125; &#125;; cr.accept(cv, ClassReader.SKIP_CODE | ClassReader.SKIP_DEBUG); &#125; public byte[] toByteArray(String filename) throws IOException &#123; File f = new File(filename); if (!f.exists()) &#123; throw new FileNotFoundException(filename); &#125; ByteArrayOutputStream bos = new ByteArrayOutputStream((int) f.length()); BufferedInputStream in = null; try &#123; in = new BufferedInputStream(new FileInputStream(f)); int buf_size = 1024; byte[] buffer = new byte[buf_size]; int len = 0; while (-1 != (len = in.read(buffer, 0, buf_size))) &#123; bos.write(buffer, 0, len); &#125; return bos.toByteArray(); &#125; catch (IOException e) &#123; e.printStackTrace(); throw e; &#125; finally &#123; try &#123; in.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; bos.close(); &#125; &#125;&#125; è¾“å‡ºï¼š 123field:amethod:&lt;init&gt;method:method å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼š ClassWriteræ„é€ å‡½æ•°çš„å‚æ•°ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªæ ‡å¿—ä½ï¼Œå¯ä»¥ç”¨æ¥æ ‡å¿—æ˜¯å¦ä¿®æ”¹è¿™ä¸ªç±»çš„é»˜è®¤è¡Œä¸ºï¼Œå¿…é¡»æ˜¯0æˆ–è€…COMPUTE_MAXSæˆ–è€…COMPUTE_FRAMES: COMPUTE_MAXS: ä¸€ä¸ªæ ‡å¿—ä½ç”¨æ¥è‡ªåŠ¨è®¡ç®—stack sizeçš„æœ€å¤§å€¼å’Œæ–¹æ³•å±€éƒ¨å˜é‡çš„æœ€å¤§å€¼ã€‚å¦‚æœè¿™ä¸ªæ ‡å¿—ä½è¢«è®¾ç½®ï¼Œé‚£ä¹ˆvisitMethod()è¿”å›çš„å¯¹è±¡MethodVisitorçš„æ–¹æ³•visitMaxsçš„å‚æ•°å°†ä¼šè¢«å¿½ç•¥ã€‚ COMPUTE_FRAMES: ç”¨æ¥è®¡ç®—stack map framesçš„æ ‡å¿—ä½ã€‚ ClassVisitorçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºASMç‰ˆæœ¬ã€‚ è¿™ä¸ªinitæ˜¯æˆ‘ä»¬çš„æ„é€ æ–¹æ³•ã€‚ ä¸Šé¢çš„ä»£ç ä¹Ÿå®é”¤äº†è¿™ä¸ªClassVisitoræ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæˆ‘ä»¬å®ç°å®ƒçš„æ—¶å€™ï¼Œéœ€è¦å¤å†™çš„æ–¹æ³•æœ‰ï¼š 2. æ·»åŠ å­—æ®µæˆ–æ–¹æ³•12345678910111213141516171819202122232425262728293031323334353637383940package asm;import jdk.internal.org.objectweb.asm.*;import java.io.File;import java.io.IOException;import static jdk.internal.org.objectweb.asm.Opcodes.ASM5;public class Main2 &#123; public void addField() throws IOException &#123; byte[] classBytes = ByteUtil.toByteArray(&quot;E:\\\\IntelliJidea\\\\workspace\\\\Test2\\\\src\\\\asm\\\\Test1.class&quot;); ClassReader cr = new ClassReader(classBytes); ClassWriter cw = new ClassWriter(0); ClassVisitor cv = new ClassVisitor(ASM5,cw) &#123; @Override public void visitEnd() &#123; super.visitEnd(); FieldVisitor fv = cv.visitField(Opcodes.ACC_PUBLIC,&quot;str&quot;,&quot;Ljava/lang/String;&quot;,null,null); if(fv!=null) fv.visitEnd(); &#125; &#125;; cr.accept(cv, ClassReader.SKIP_CODE | ClassReader.SKIP_DEBUG); byte[] classModifyed = cw.toByteArray(); ByteUtil.byteArray2File(new File(&quot;E:\\\\IntelliJidea\\\\workspace\\\\Test2\\\\src\\\\asm\\\\ModifiedTest1.class&quot;),classModifyed); &#125; public static void main(String[] args) &#123; try &#123; new Main2().addField(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125; æœ€åjavap ModifiedTest1.class: 123456public class asm.Test1 &#123; public java.lang.String str; public asm.Test1(); public void method();&#125; å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼š è¿™é‡Œæˆ‘ä»¬æ·»åŠ æ–¹æ³•æ˜¯ä½¿ç”¨äº†visiteEnd()æ–¹æ³•ï¼Œä»å‰é¢çš„æ—¶åºå›¾å¯ä»¥çœ‹å‡ºï¼Œå®ƒæ˜¯æœ€åä¸€ä¸ªvisitæ–¹æ³•ï¼Œç”¨ä»¥å‘Šè¯‰ASM visitç»“æŸã€‚ è¿˜éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œä½¿ç”¨äº†è´£ä»»é“¾æ¨¡å¼ã€‚ æ–°å¢æ–¹æ³•æ“ä½œç±»ä¼¼ï¼Œä¸å†èµ˜è¿°ã€‚ 3. åˆ é™¤æ–¹æ³•å’Œå­—æ®µåˆ é™¤æ“ä½œæ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦åœ¨visiteMethodæˆ–è€…visiteFieldä¸­è¿”å›nullå³å¯ã€‚ åŒæ ·ä»¥Test1.classä¸ºä¾‹ï¼Œæˆ‘ä»¬åˆ é™¤æ–¹æ³•method. 12345678910111213141516171819202122232425262728293031323334353637383940package asm;import jdk.internal.org.objectweb.asm.*;import java.io.File;import java.io.IOException;import static jdk.internal.org.objectweb.asm.Opcodes.ASM5;public class Main3 &#123; public void removeMethod() throws IOException &#123; byte[] classBytes = ByteUtil.toByteArray(&quot;E:\\\\IntelliJidea\\\\workspace\\\\Test2\\\\src\\\\asm\\\\Test1.class&quot;); ClassReader cr = new ClassReader(classBytes); ClassWriter cw = new ClassWriter(0); ClassVisitor cv = new ClassVisitor(ASM5,cw)&#123; @Override public MethodVisitor visitMethod(int i, String s, String s1, String s2, String[] strings) &#123; if(s.equals(&quot;method&quot;)) return null; return super.visitMethod(i, s, s1, s2, strings); &#125; &#125;; cr.accept(cv, ClassReader.SKIP_CODE | ClassReader.SKIP_DEBUG); byte[] classModifyed = cw.toByteArray(); ByteUtil.byteArray2File(new File(&quot;E:\\\\IntelliJidea\\\\workspace\\\\Test2\\\\src\\\\asm\\\\RemovedMethodTest1.class&quot;),classModifyed); &#125; public static void main(String[] args) &#123; try &#123; new Main3().removeMethod(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125; é€šè¿‡javapæŸ¥çœ‹ï¼Œå‘ç°å·²åˆ é™¤ã€‚ 4. ä¿®æ”¹æ–¹æ³•å†…å®¹","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"ASM","slug":"ASM","permalink":"http://example.com/tags/ASM/"}]},{"title":"å…³äºè·¨åŸŸ","slug":"å…³äºè·¨åŸŸ","date":"2020-08-06T11:00:00.000Z","updated":"2023-05-29T14:17:39.317Z","comments":true,"path":"2020/08/06/å…³äºè·¨åŸŸ/","link":"","permalink":"http://example.com/2020/08/06/%E5%85%B3%E4%BA%8E%E8%B7%A8%E5%9F%9F/","excerpt":"","text":"ä»€ä¹ˆæ˜¯è·¨åŸŸå¾€ç²—äº†è¯´ï¼Œå°±æ˜¯ä¸€ä¸ªç«™ç‚¹çš„è„šæœ¬æˆ–è€…æ–‡æ¡£ä¼å›¾è®¿é—®å¦ä¸€ä¸ªç«™ç‚¹çš„èµ„æºï¼Œè¿™æ˜¯ä¸€ç§å¹¿ä¹‰çš„å®šä¹‰ã€‚ä½†é€šå¸¸æˆ‘ä»¬è¯´çš„æ˜¯ç‹­ä¹‰çš„è·¨åŸŸï¼Œè€Œç‹­ä¹‰çš„è·¨åŸŸæ˜¯å’ŒåŒæºç­–ç•¥ç»‘å®šåœ¨ä¸€èµ·çš„ã€‚ ä»€ä¹ˆæ˜¯åŒæºç­–ç•¥åŒæºç­–ç•¥æ˜¯æµè§ˆå™¨çš„ä¸€ç§å®‰å…¨ç­–ç•¥ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢ä¸€ä¸ªæºä¸‹çš„èµ„æºå»è®¿é—®å¦ä¸€ä¸ªæºä¸‹çš„èµ„æºã€‚æ‰€è°“åŒæºï¼Œæ˜¯æŒ‡åè®®+åŸŸå+ç«¯å£ç›¸åŒã€‚ ä¸ºä»€ä¹ˆä¼šæœ‰è·¨åŸŸè·¨åŸŸæ˜¯å®å®åœ¨åœ¨å­˜åœ¨çš„ï¼Œå¾€å°äº†è¯´ï¼Œå‰ç«¯åŠ è½½çš„é™æ€èµ„æºå¯èƒ½æ¥è‡ªå…¶ä»–åŸŸï¼Œæ¯”å¦‚åŠ è½½cssæ ·å¼æˆ–è€…å›¾ç‰‡ç­‰ï¼Œå½“ç„¶è¿™ç§è·¨åŸŸæ˜¯å…è®¸çš„ã€‚åŒæºç­–ç•¥é™åˆ¶çš„è·¨åŸŸä¸»è¦æœ‰ï¼š ä¸€ä¸ªåŸŸè¯»å–å¦ä¸€ä¸ªåŸŸçš„LocalStorageæˆ–è€…Cookie. Domå’ŒJså¯¹è±¡æ— æ³•è·å¾— Ajaxè¯·æ±‚ä¸èƒ½å‘é€ã€‚ å¦‚æœè¿™äº›è¡Œä¸ºè¢«å…è®¸ï¼Œè¿™æ„å‘³ç€æˆ‘å¯ä»¥åœ¨ä¸€ä¸ªæ¶æ„ç½‘ç«™é‡Œå»è¯·æ±‚ä¸€äº›æ­£å¸¸ç½‘ç«™ï¼Œæ¯”å¦‚é“¶è¡Œï¼ŒåŒæ—¶è¿˜èƒ½å¸¦ä¸Šä½ åˆšåˆšåœ¨æ­£å¸¸ç½‘ç«™ç™»å½•åç•™ä¸‹çš„cookie, è¿™æ ·æˆ‘å°±å¯ä»¥ç™»å½•äº†ï¼Œç„¶åæˆ‘åœ¨æ¶æ„ç½‘ç«™é‡Œå¯¹é“¶è¡Œç½‘ç«™å‘èµ·ä¸€äº›ç»™è‡ªå·±è½¬æ¬¾çš„è¯·æ±‚â€¦â€¦ æ€ä¹ˆè§£å†³è·¨åŸŸè§£å†³æ–¹æ¡ˆæ¯”è¾ƒå¤šï¼Œä½œä¸ºåç«¯ï¼Œæˆ‘ç”¨çš„æ¯”è¾ƒå¤šçš„æœ‰è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰å’ŒNginxåå‘ä»£ç†ã€‚ Nginxåå‘ä»£ç†å› ä¸ºåŒæºç­–ç•¥æ˜¯æµè§ˆå™¨çš„æ“ä½œï¼Œè€Œåœ¨æœåŠ¡ç«¯è·¨åŸŸæ˜¯å¯ä»¥æ­£å¸¸è¯·æ±‚çš„ï¼Œåå‘ä»£ç†åŸç†ä¹Ÿå°±åœ¨è¿™é‡Œã€‚ä»¥Nginxä½œä¸ºæœåŠ¡ç«¯ï¼Œå¯¹äºå‰ç«¯çš„è·¨åŸŸè¯·æ±‚ï¼Œä»¥Nginxä½œä¸ºè·³æ¿ï¼Œåœ¨NginxæœåŠ¡ç«¯é‡æ–°å»è¯·æ±‚ï¼Œå°±å¯ä»¥è§£å†³è·¨åŸŸäº†ã€‚","categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://example.com/categories/%E5%89%8D%E7%AB%AF/"}],"tags":[{"name":"è·¨åŸŸ","slug":"è·¨åŸŸ","permalink":"http://example.com/tags/%E8%B7%A8%E5%9F%9F/"},{"name":"åŒæºç­–ç•¥","slug":"åŒæºç­–ç•¥","permalink":"http://example.com/tags/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/"}]},{"title":"ä»é›†åˆç±»å¼€å§‹","slug":"ä»é›†åˆç±»è°ˆèµ·","date":"2020-07-26T10:00:00.000Z","updated":"2023-05-29T14:17:39.327Z","comments":true,"path":"2020/07/26/ä»é›†åˆç±»è°ˆèµ·/","link":"","permalink":"http://example.com/2020/07/26/%E4%BB%8E%E9%9B%86%E5%90%88%E7%B1%BB%E8%B0%88%E8%B5%B7/","excerpt":"","text":"æ­¤æ–‡ä¸ºæˆ‘åœ¨å¤‡æˆ˜ç§‹æ‹›è¿‡ç¨‹ä¸­å¯¹JavaåŸºç¡€çŸ¥è¯†çš„å¯å‘å¼æ€»ç»“ã€‚ Javaé›†åˆç±»ï¼Œæœ‰Set, List, Queue. Liståº•ä¸‹æœ‰Vector, ArrayList, LinkedList. Vecotråº•ä¸‹è¿˜æœ‰ä¸ªStack. è®²ä¸€è®²åŒºåˆ«ï¼Ÿ è¦è¯´åŒºåˆ«çš„è¯ï¼ŒVectorå’ŒArrayListåº•å±‚éƒ½æ˜¯åŠ¨æ€æ•°ç»„ï¼Œä¸åŒçš„æ˜¯Vectoræ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºå®ƒçš„æ–¹æ³•æœ‰è¢«**synchronized**å…³é”®å­—ä¿®é¥°ï¼Œ è¿˜æœ‰å°±æ˜¯æ‰©å®¹ï¼ŒArrayListæ˜¯1.5å€æ‰©å®¹ï¼Œå…³äºè¿™ç‚¹å¯å‚è€ƒè¿™ç¯‡æ–‡ç« , è€ŒVectorä¸€èˆ¬æ˜¯ä¸¤å€æ‰©å®¹ï¼ˆä¸ºä»€ä¹ˆè¯´æ˜¯ä¸€èˆ¬å‘¢ï¼Œæ˜¯ä¸æ˜¯ä¸¤å€å–å†³äºæˆ‘ä»¬new Vectorçš„æ—¶å€™æœ‰æ²¡æœ‰ä¼ å®¹é‡å‚æ•°ï¼‰ã€‚ ç„¶åStackç»§æ‰¿è‡ªVector,æ‰€ä»¥å®ƒä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ è®²ä¸€è®²é”ã€Synchronizedå…³é”®å­—ï¼Ÿ è€ŒLinkerListåº•å±‚æ˜¯é“¾è¡¨ï¼Œè¿˜æœ‰ä¸€ç‚¹å°±æ˜¯LinkedListå®ç°äº†Queueæ¥å£ï¼Œæ‰€ä»¥å®ƒå¯ä»¥å½“åšé˜Ÿåˆ—æ¥ç”¨(å‡†ç¡®çš„æ¥è¯´ï¼Œåº”è¯¥æ˜¯ä¸ªåŒç«¯é˜Ÿåˆ—)ã€‚ è€ŒSetçš„å®ç°ä¸»è¦æœ‰HashSet, TreeSet, è¿˜æœ‰ä¸€ä¸ªLinkedHashSet, å®ƒç»§æ‰¿è‡ªHashSet, ä½†æ˜¯æ€§è´¨æœ‰æ‰€ä¸åŒã€‚ HashSetåº•å±‚å…¶å®ä¹Ÿæ˜¯ä¸ªHashMap, åªä¸è¿‡æŠŠHashMapçš„valueå˜æˆä¸€ä¸ªé™æ€å¯¹è±¡äº†ã€‚ TreeSetåº•å±‚æ˜¯çº¢é»‘æ ‘ï¼Œç›®çš„å°±æ˜¯å¯ä»¥å®ç°æ’åºã€‚ LinkedHashSetç»§æ‰¿è‡ªHashSet, å®ƒä¿©çš„åŒºåˆ«ç±»ä¼¼äºHashMapå’ŒLinkedHashMapçš„åŒºåˆ«ï¼ˆå‡†ç¡®çš„è¯´ä¸æ˜¯ç±»ä¼¼ï¼Œæ˜¯ç­‰åŒï¼Œå› ä¸ºå®ƒçš„ï¼‰ï¼Œå…¶åŒºåˆ«å°±åœ¨äºæˆ‘ä»¬å¯ä»¥æŒ‰ç…§å­˜å…¥çš„é¡ºåºæŒ‰åºæŠŠå…ƒç´ å–å‡ºã€‚ LinkedHashSetæˆ–LinkedHashMapçš„è¿™ä¸ªç‰¹æ€§æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼ŸLinkedHashMapå†…éƒ¨æ˜¯æœ‰ä¸€ä¸ªåŒå‘é“¾è¡¨çš„ï¼ˆå‡†ç¡®è¯´æ˜¯ç»´æŠ¤ä¸€ä¸ªé™æ€å†…éƒ¨ç±»Entry, ç»§æ‰¿è‡ªNodeï¼‰ï¼Œé€šè¿‡è¿™ä¸ªåŒå‘é“¾è¡¨æ¥ç»´æŠ¤é¡ºåºã€‚å…·ä½“ä½“ç°åœ¨ï¼š 1234567891011// link at the end of list private void linkNodeLast(LinkedHashMap.Entry&lt;K,V&gt; p) &#123; LinkedHashMap.Entry&lt;K,V&gt; last = tail; tail = p; if (last == null) head = p; else &#123; p.before = last; last.after = p; &#125; &#125; èŠèŠçº¢é»‘æ ‘ï¼Ÿ Mapå‡†ç¡®è®²ä¸èƒ½ç®—åœ¨é›†åˆç±»é‡Œé¢ï¼Œä½†æ˜¯ä¹Ÿå¾ˆå¸¸ç”¨ï¼ŒMapæ¥å£åº•ä¸‹ä¸»è¦æœ‰HashMap, TreeMap, HashTable, ä»¥åŠç»§æ‰¿è‡ªHashMapçš„LinkedHashMap. è°ˆè°ˆåŒºåˆ« HashMapæ˜¯æ•°ç»„+é“¾è¡¨ç»“æ„ï¼Œç”¨äºå­˜æ”¾é”®å€¼å¯¹ï¼ŒHashTableä¹Ÿæ˜¯ï¼Œä¸åŒçš„æ˜¯HashTableçº¿ç¨‹å®‰å…¨ï¼Œå› ä¸ºå®ƒçš„putç­‰æ–¹æ³•æ˜¯ç”¨synchronizedå…³é”®å­—ä¿®é¥°çš„ã€‚TreeMapå¯ä»¥å®ç°æ’åº,ä¹‹æ‰€ä»¥æœ‰è¿™ä¸ªåŠŸèƒ½æ˜¯å› ä¸ºå®ƒçš„åº•å±‚æ˜¯çº¢é»‘æ ‘ï¼Œæ‰€ä»¥æ¯æ¬¡putéƒ½æ˜¯ç›¸å½“äºæ˜¯æŒ‰åºæ’å…¥ã€‚LinkedHashMapç»§æ‰¿è‡ªHashMap, ä¸Šé¢åœ¨å°†LinkedHashSetçš„æ—¶å€™è®²è¿‡ï¼Œå®ƒå¯ä»¥æŒ‰ç…§æ’å…¥é¡ºåºå–å‡ºå…ƒç´ ã€‚ è°ˆè°ˆHashMapçš„æ‰©å®¹ HashMapæ˜¯æ•°ç»„+é“¾è¡¨çš„ç»“æ„ï¼Œå®ƒæ¯”è¾ƒæœ‰è¶£çš„åœ°æ–¹å°±åœ¨äºå®ƒçš„putå’Œæ‰©å®¹äº†ã€‚å®ƒçš„æ„é€ æ–¹æ³•æœ‰ä»¥ä¸‹å‡ ç§ï¼š 123public HashMap(int initialCapacity, float loadFactor) public HashMap(int initialCapacity)public HashMap() å…¶ä¸­ï¼ŒinitialCapacityæ˜¯â€åˆå§‹å®¹é‡â€œï¼ŒloadFactoræ˜¯è´Ÿè½½å› å­ã€‚æ³¨æ„è¿™é‡Œåˆå§‹å®¹é‡åŠ äº†å¼•å·ï¼Œæ„å‘³ç€è¿™å¹¶ä¸ä¸€å®šæ˜¯çœŸçš„åˆå§‹å®¹é‡ï¼Œå®ƒä¼šæ ¹æ®ä¼ å…¥çš„è¿™ä¸ªinitialCapacity, è®¡ç®—ä¸€ä¸ªç¦»å®ƒæœ€è¿‘çš„æ¯”å®ƒçš„äºŒçš„æ¬¡å¹‚ä½œä¸ºçœŸå®å®¹é‡ã€‚å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š 123456789static final int tableSizeFor(int cap) &#123; int n = cap - 1; n |= n &gt;&gt;&gt; 1; n |= n &gt;&gt;&gt; 2; n |= n &gt;&gt;&gt; 4; n |= n &gt;&gt;&gt; 8; n |= n &gt;&gt;&gt; 16; return (n &lt; 0) ? 1 : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1; &#125; ï¼ˆæœ‰ä¸€è¯´ä¸€ï¼Œè¿™ä¸ªå†™æ³•æœ‰ç‚¹çµæ€§ï¼‰ è€Œè´Ÿè½½å› å­çš„æ„æ€å…¶å®å°±æ˜¯é˜ˆå€¼ï¼Œå®ƒè¡¨ç¤ºå½“HashMapçš„å®¹é‡è¾¾åˆ°å¤šå°‘æ—¶è¦è¿›è¡Œä¸€ä¸ªæ‰©å®¹æ“ä½œã€‚ å½“æˆ‘ä»¬ä½¿ç”¨æ— å‚çš„æ„é€ å‡½æ•°æ—¶ï¼Œå®ƒä¿©é»˜è®¤å€¼åˆ†åˆ«æ˜¯16å’Œ0.75. è°ˆè°ˆHashMapå’ŒConcurrentHashMap? HashMapä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥æœ‰äº†ConcurrentHashMap, è™½ç„¶HashTableä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯ä¸¤è€…å®ç°ç•¥æœ‰ä¸åŒï¼Œæ€§èƒ½ä¹Ÿæœ‰æ‰€å·®å¼‚ã€‚HashTableæ˜¯é€šè¿‡synchronizedå…³é”®å­—å®ç°çš„ï¼Œè€ŒConcurrentHashMapåœ¨1.7å’Œ1.8ä¸­å®ç°ç•¥æœ‰ä¸åŒã€‚1.7æ˜¯é€šè¿‡åˆ†æ®µé”å®ç°çš„ï¼Œ1.8æ˜¯é€šè¿‡CAS+synchronizedå®ç°çš„ã€‚ åˆ†æ®µé”ï¼šé¦–å…ˆæ˜¯æœ‰ä¸€ä¸ªSegmentæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ æŒ‡å‘çš„æ‰æ˜¯ä¸€ä¸ªçœŸæ­£çš„HashMap, è¿™ä¸ªSegmentå¯¹è±¡ç»§æ‰¿è‡ªReentrantLock, æ‰€ä»¥æ˜¯æœ‰é”çš„åŠŸèƒ½çš„ã€‚åŸºäºåˆ†æ®µé”çš„ConcurrentHashMapç†è®ºä¸Šæœ€å¤§å¯ä»¥è¾¾åˆ°Segmentæ•°ç»„sizeçš„å¹¶å‘åº¦ã€‚ 1.8çš„ConcurrentHashMapæ”¾å¼ƒäº†åˆ†æ®µé”çš„æŠ€æœ¯ï¼Œä½¿ç”¨CAS+synchronziedæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚åœ¨æ’å…¥çš„æ—¶å€™ï¼Œå…ˆCASæ’å…¥ï¼Œå¦‚æœå¤±è´¥ï¼Œåˆ™ç”¨synchronizedåŠ é”æ’å…¥ã€‚ è°ˆè°ˆReentrantLock?","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[]},{"title":"Springæºç å­¦ä¹ ä¹‹AOP","slug":"Springæºç å­¦ä¹ ä¹‹AOP","date":"2020-03-21T04:35:04.000Z","updated":"2020-03-21T05:00:00.000Z","comments":true,"path":"2020/03/21/Springæºç å­¦ä¹ ä¹‹AOP/","link":"","permalink":"http://example.com/2020/03/21/Spring%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E4%B9%8BAOP/","excerpt":"","text":"ç»è¿‡ä¾›åº”é“¾å¤§ä½¬çš„é¢„é¢è¯•ï¼Œè§‰å¾—è‡ªå·±åœ¨Springè¿™ä¸€å—æŒæ¡åœ°è¿˜æ˜¯æœ‰äº›æµ…ï¼Œç—›å®šæ€ç—›ï¼Œå†æ¬¡é˜…è¯»æºç ã€‚ åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬å·²ç»åˆ†æäº†Spring IOCçš„ä¸€ä¸ªå¤§æ¦‚è¿‡ç¨‹ï¼Œé‚£ä¹ˆAOPåˆæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™å‘ç”Ÿçš„å‘¢ï¼Ÿï¼ˆè¿™ç¯‡æ–‡ç« ä¸è®²åŠ¨æ€ä»£ç†ï¼Œä¸è®²åˆ‡é¢åˆ‡ç‚¹é€šçŸ¥ï¼Œåªè®²ä»£ç æµç¨‹ã€‚ï¼‰ ç¼˜èµ·Spring AOPå¾ˆå…³é”®çš„ä¸€æ­¥å°±æ˜¯åˆ›å»ºAOP ä»£ç†ï¼Œé‚£ä¹ˆè¿™ä¸€åŠ¨ä½œæ˜¯ä½•æ—¶å‘ç”Ÿçš„å‘¢ï¼Ÿ ä¼—æ‰€å‘¨çŸ¥ï¼ˆä¸çŸ¥é“ä¹Ÿæ²¡å…³ç³»ï¼‰ï¼Œåˆ›å»ºä»£ç†å¯¹è±¡æœ‰ä¸€ç§ä¸“é—¨çš„ç±»å«ProxyCreator, é‚£ä¹ˆå¦‚æœæ˜¯åŸºäºæ³¨è§£åˆ›å»ºçš„è¯ï¼Œè¿™ä¸ªç±»å«åšAnnotationAwareAspectJAutoProxyCreator, å¦‚æœå»çœ‹å®ƒçš„ç»§æ‰¿å…³ç³»ä½ ä¼šå‘ç°ï¼Œå®ƒå®ç°äº†BeanPostProcessoræ¥å£ï¼Œè¿™ä¸ªæ¥å£æˆ‘ä»¬åœ¨ä¸Šç¯‡æ–‡ç« ä¸­ä¹Ÿæåˆ°äº†ï¼šBeançš„å®ä¾‹åŒ–ä¸»è¦ç»è¿‡ä¸‰ä¸ªæ–¹æ³•ï¼šcreateBeanInstance,populateBean,initializeBean.å…¶ä¸­æœ€åä¸€ä¸ªæ–¹æ³•å°±æ˜¯ç”¨æ¥å¤„ç†å„ç§å›è°ƒï¼Œå…¶ä¸­å°±åŒ…æ‹¬BeanPostProcessor,é‚£æˆ‘ä»¬å°±æ¥ç€ä¸Šä¸€èŠ‚è®²çš„BeanPostProcessorçš„å›è°ƒæ¥ç»§ç»­è®²ã€‚ å¼€å§‹å…ˆåˆ°BeanPostProcessorçš„åç½®å¤„ç†è¿™é‡Œï¼Œ AbstractAutowireCapableBeanFactory 1633è¡Œ 123if (mbd == null || !mbd.isSynthetic()) &#123; wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName); &#125; applyBeanPostProcessorsAfterInitialization: 123456789101112public Object applyBeanPostProcessorsAfterInitialization(Object existingBean, String beanName) throws BeansException &#123; Object result = existingBean; for (BeanPostProcessor beanProcessor : getBeanPostProcessors()) &#123; result = beanProcessor.postProcessAfterInitialization(result, beanName); if (result == null) &#123; return result; &#125; &#125; return result; &#125; è¿›å…¥åˆ°AbstactAutoProxyCreator,å·²ç»å‘ç°äº†ProxyCreatorçš„å½±å­äº†æœ‰æœ¨æœ‰ï¼Ÿï¼š 123456789public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException &#123; if (bean != null) &#123; Object cacheKey = getCacheKey(bean.getClass(), beanName); if (!this.earlyProxyReferences.contains(cacheKey)) &#123; return wrapIfNecessary(bean, beanName, cacheKey); &#125; &#125; return bean; &#125; wrapIfNecessary(): æˆ‘å°±åªæˆªå–å…³é”®ä»£ç å•¦ è¿™é‡Œçš„æ„æ€å°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬è¿™ä¸ªBeanæœ‰Adviceæˆ–è€…Advisorçš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¼€å§‹åˆ›å»ºä»£ç†ï¼Œå¾ˆå®¹æ˜“ç†è§£æœ‰æœ¨æœ‰ï¼Ÿ createProxy(): è¿™é‡Œä»£ç ç•¥å¤šï¼Œæˆ‘å°±ä¸è´´äº†ï¼Œå®ƒçš„æ ¸å¿ƒé€»è¾‘å°±æ˜¯å…ˆè·å–å¹¶è®¾ç½®ä¸€ä¸ªä»£ç†å·¥å‚ï¼Œç„¶åä»ä»£ç†å·¥å‚é‡Œè·å–ä»£ç†ï¼Œæ–¹æ³•çš„æœ€åä¸€å¥æ˜¯è¿™æ ·çš„ï¼š 1return proxyFactory.getProxy(getProxyClassLoader()); æ¥åˆ°Class ProxyFactory: 123public Object getProxy(ClassLoader classLoader) &#123; return createAopProxy().getProxy(classLoader); &#125; ä»åå­—å°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œåˆ›å»ºAopProxy createAopProxy(): 123456protected final synchronized AopProxy createAopProxy() &#123; if (!this.active) &#123; activate(); &#125; return getAopProxyFactory().createAopProxy(this); &#125; createAopProxy(): ä»è¿™é‡Œå°±å¯ä»¥çœ‹å‡ºï¼Œæ ¹æ®targetClassæœ‰æ²¡æœ‰æ¥å£ä¹‹ç±»çš„ï¼Œå†³å®šç”¨JdkåŠ¨æ€ä»£ç†è¿˜æ˜¯Cglib. è‡³æ­¤ï¼ŒcreateProxy()å·²ç»å®Œæˆï¼Œæˆ‘ä»¬å†å›åˆ°ä¸Šé¢ProxyFactoryçš„getProxy()æ–¹æ³•ï¼š 123public Object getProxy(ClassLoader classLoader) &#123; return createAopProxy().getProxy(classLoader); &#125; ç»§ç»­çœ‹ä¸‹jdkä»£ç†çš„getProxy()åšäº†ä»€ä¹ˆï¼š æ¥åˆ°äº†ç†Ÿæ‚‰çš„jdkåŠ¨æ€ä»£ç†æœ‰æœ¨æœ‰ã€‚ä¼—æ‰€å‘¨çŸ¥ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯InvocationHandleræ¥å£çš„å®ç°ç±»ï¼Œè¿™é‡Œç”¨äº†this, è¯´æ˜è¿™ä¸ªç±»è‡ªå·±å®ç°äº†InvocationHandleræ¥å£ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å®ƒå¤å†™çš„invoke()æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å°±å‰å®³äº†ï¼Œå®ƒæ¶‰åŠåˆ°æ‹¦æˆªå™¨è°ƒç”¨é“¾çš„æ‰§è¡Œï¼Œæˆ‘è¿™é‡Œåªæˆªå–äº†éƒ¨åˆ†æ ¸å¿ƒä»£ç ã€‚ é¦–å…ˆå®ƒä¼šå»è·å¾—å½“å‰æ–¹æ³•çš„ä¸€ä¸ªæ‹¦æˆªå™¨é“¾ï¼Œè·å¾—ä¹‹åï¼Œå¦‚æœè¿™ä¸ªchainä¸ä¸ºç©ºï¼Œæˆ‘ä»¬å°±æŠŠè¿™ä¸ªæ‹¦æˆªå™¨é“¾åˆ›å»ºæˆä¸€ä¸ªmethod invocationï¼Œç„¶åå»æ‰§è¡Œã€‚é‚£ä¹ˆè¿™ä¸ªproceed()å°±æ˜¯ä¸€ä¸ªè´£ä»»é“¾æ¨¡å¼çš„æ‰§è¡Œè¿‡ç¨‹ã€‚ æ€»ç»“å…³äºSpringçš„AOP, æˆ‘ä»¬è¦çŸ¥é“è¿™ä¹ˆå‡ ä¸ªé—®é¢˜ï¼Œ é¦–å…ˆAOPä»ä»€ä¹ˆæ—¶å€™å¼€å§‹çš„ï¼Œç­”æ¡ˆæ˜¯BeanPostProcessor,ä¹Ÿå°±æ˜¯è¯´ï¼ŒSpring AOP ä¼šåœ¨ IOC å®¹å™¨åˆ›å»º bean å®ä¾‹çš„æœ€åå¯¹ bean è¿›è¡Œå¤„ç†ã€‚å…¶å®å°±æ˜¯åœ¨è¿™ä¸€æ­¥è¿›è¡Œä»£ç†å¢å¼ºã€‚ AOPåˆ†ä¸ºä¸¤æ­¥ï¼ŒcreateProxyå’ŒgetProxy. å…¶ä¸­createProxyæœ‰jdkå’Œcglibä¸¤ç§æ–¹æ³•ã€‚è€ŒgetProxyæ˜¯æˆ‘ä»¬æœ€éœ€è¦æ³¨æ„çš„ã€‚ä»¥jdkåŠ¨æ€ä»£ç†ä¸ºä¾‹ï¼Œå®ƒçš„invokeæ–¹æ³•é‡ŒåŒ…å«äº†ä»¥è´£ä»»é“¾æ¨¡å¼å¯¹æ‹¦æˆªå™¨çš„è°ƒç”¨ã€‚","categories":[{"name":"Spring","slug":"Spring","permalink":"http://example.com/categories/Spring/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"http://example.com/tags/Spring/"}]},{"title":"Springæ€è€ƒä¸æ€»ç»“","slug":"Springæ€è€ƒä¸æ€»ç»“","date":"2020-03-19T14:44:20.000Z","updated":"2023-05-29T14:17:37.599Z","comments":true,"path":"2020/03/19/Springæ€è€ƒä¸æ€»ç»“/","link":"","permalink":"http://example.com/2020/03/19/Spring%E6%80%9D%E8%80%83%E4%B8%8E%E6%80%BB%E7%BB%93/","excerpt":"","text":"æ›´æ–°äº2020-10-01 ä»IoCçš„è§’åº¦æ¥è¯´ï¼Œspringæ˜¯ä¸ªå®¹å™¨ï¼Œè¿™ä¸ªå®¹å™¨å°±æ˜¯BeanFactory, å½“ç„¶ä½ è¯´å®ƒæ˜¯ApplicationContextä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚å®¹å™¨æ˜¯ç”¨æ¥è£…ä¸œè¥¿çš„ï¼Œè£…çš„ä¸œè¥¿å°±æ˜¯æˆ‘ä»¬å®šä¹‰çš„bean, ä¸è¿‡springå¯¹å®ƒè¿›è¡Œäº†å°è£…ï¼Œå«åšBeanDefinition. æ‰€ä»¥springåˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆä¼šåšè¿™ä¹ˆå‡ ä»¶äº‹æƒ…ï¼š åˆ›å»ºå®¹å™¨ åˆ›å»ºbeandefinition å‘å®¹å™¨é‡Œæ³¨å†Œbeandefinition Springæ˜¯å®¹å™¨ï¼Œæœ€åŸºæœ¬çš„å®¹å™¨æ˜¯BeanFactory, ç„¶åApplicationContextåˆç»§æ‰¿è‡ªå®ƒï¼Œä½†å…¶å®ä¸èƒ½è®¤ä¸ºApplicationContextæ˜¯BeanFactoryçš„å®ç°ç±»ï¼Œå› ä¸ºäº‹å®æ˜¯ApplicationContextå†…éƒ¨æŒæœ‰äº†ä¸€ä¸ªå®ä¾‹åŒ–çš„BeanFactory(DefaultListableBeanFactory). refreshæ–¹æ³•æ˜¯æ•´ä¸ªå®¹å™¨å¯åŠ¨çš„æ ¸å¿ƒã€‚æ–¹æ³•ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ï¼š obtainFreshBeanFactory(): åˆ›å»ºå®¹å™¨ï¼ŒåŠ è½½æ³¨å†ŒBean. prepareBeanFactory(): è®¾ç½®ç±»åŠ è½½å™¨ï¼Œæ·»åŠ BeanPostProcessor finishBeanFactoryInitialization(beanFactory)ï¼šåˆå§‹åŒ–æ‰€æœ‰çš„Singleton Beans createBeanInstance: å®ä¾‹åŒ–bean populateBean: å±æ€§è®¾ç½®ï¼Œå¤„ç†ä¾èµ– initializeBean: å¤„ç†å„ç§å›è°ƒ æ£€æŸ¥awareç›¸å…³æ¥å£ï¼ˆawareæ¥å£æ˜¯ä¸ºäº†è®©beanå¯ä»¥è·å–åˆ°æ¡†æ¶è‡ªèº«çš„ä¸€äº›å¯¹è±¡ï¼‰ BeanPostProcessorå‰ç½®å¤„ç† å¦‚æœå®ç°InitializeBean, è°ƒç”¨afterPropertiesSet() BeanPostProcessoråç½®å¤„ç†â€˜ BeanDefinitionæ˜¯Beanè£…è½½è¿›å®¹å™¨ä¸­çš„ä¸€ç§è¡¨ç¤ºï¼Œé‡Œé¢å…·ä½“æœ‰æ˜¯å¦æ˜¯å•ä¾‹ï¼Œå®ƒçš„ä¾èµ–ï¼Œæ˜¯å¦æ‡’åŠ è½½ï¼Œç±»åç§°ï¼Œç­‰ç­‰ã€‚","categories":[{"name":"æ¡†æ¶","slug":"æ¡†æ¶","permalink":"http://example.com/categories/%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"http://example.com/tags/Spring/"}]},{"title":"Springæºç å­¦ä¹ ","slug":"Springæºç å­¦ä¹ ä¹‹IOC","date":"2020-03-18T10:46:22.000Z","updated":"2023-05-29T14:17:37.595Z","comments":true,"path":"2020/03/18/Springæºç å­¦ä¹ ä¹‹IOC/","link":"","permalink":"http://example.com/2020/03/18/Spring%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E4%B9%8BIOC/","excerpt":"","text":"ä»Šå¤©é¢è¯•è¢«é—®åˆ°äº†Spring, è¢«é¢è¯•å®˜åŠæ¶ï¼Œç—›å®šæ€ç—›ï¼Œå†³å®šé‡æ–°å¼€å§‹å­¦ä¹ æºç ï¼ é¦–å…ˆSpringå®¹å™¨çš„é¡¶å±‚å®¹å™¨æ¥å£æ˜¯ä»€ä¹ˆï¼ŸBeanFactoryå’ŒApplicationContext, å…¶ä¸­ApplicationContextåŠ äº†ä¸€äº›ä¸Šä¸‹æ–‡çš„æ”¯æŒï¼Œæ›´ä¸ºé«˜çº§ä¸€ç‚¹ã€‚ ä»¥ClassPathXmlApplicationContextä¸ºä¾‹ï¼Œå®¹å™¨åˆå§‹åŒ–çš„å…¥å£æ–¹æ³•åœ¨å“ªé‡Œå‘¢ï¼Ÿrefresh()æ–¹æ³•ã€‚ refresh()è¿›æ¥åæœ‰å‡ å¤„æ ¸å¿ƒæ–¹æ³•ï¼Œæˆ‘ä»¬æ¥ä¸€ä¸€çœ‹ä¸‹ã€‚ ç¬¬ä¸€å¤„ obtainFreshBeanFactory(): è¿™ä¸ªæ–¹æ³•åˆè°ƒç”¨äº†refreshBeanFactory(),ä¸»è¦åšäº†ä¸¤ä»¶äº‹æƒ…ï¼šåˆ›å»ºå®¹å™¨ï¼ŒåŠ è½½BeanDefinitionï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„å®¹å™¨åˆå§‹åŒ–ä¸‰æ­¥èµ°çš„ç¬¬ä¸€æ­¥ã€‚ 12DefaultListableBeanFactory beanFactory = createBeanFactory();loadBeanDefinitions(beanFactory); ç»§ç»­çœ‹ä¸‹è¿™ä¸ªloadBeanDefinition()ï¼š å¯ä»¥çœ‹åˆ°é‡Œé¢çš„ä»£ç åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†å°±æ˜¯åˆ›å»ºå¹¶è®¾ç½®ä¸€ä¸ªè¯»å–å™¨ï¼Œç”¨æ¥è¯»å–èµ„æºæ–‡ä»¶ï¼Œç¬¬äºŒéƒ¨åˆ†å°±æ˜¯åŠ è½½BeanDefinition,å¥½ï¼Œç»§ç»­æ·±å…¥ã€‚ è¿™é‡Œçš„ä»£ç ä¹Ÿæ˜¯å¾ˆè¨€ç®€æ„èµ…ï¼Œä¸»è¦å°±æ˜¯çœ‹æˆ‘ä»¬çš„èµ„æºæ–‡ä»¶æ˜¯ä»¥ä»€ä¹ˆå½¢å¼å­˜åœ¨çš„ï¼Œä»è€Œå†³å®šåŠ è½½çš„æ˜¯Resourceè¿˜æ˜¯String. è°ƒè¯•äº†ä¸€æ‰‹å‘ç°æˆ‘ä»¬è¿™ä¸ªèµ°çš„æ˜¯ç¬¬ä¸€ç§ç±»å‹ï¼Œå¥½ï¼Œç»§ç»­çœ‹ï¼š ä»£ç ä¾æ—§ç®€å•ï¼Œæˆ‘ä»¬æ¥çœ‹æœ€æ ¸å¿ƒçš„è¿™ä¸€è¡Œå¹²äº†å•¥ï¼š 1234@Override public int loadBeanDefinitions(Resource resource) throws BeanDefinitionStoreException &#123; return loadBeanDefinitions(new EncodedResource(resource)); &#125; ç»§ç»­æ·±å…¥loadBeanDefinitions()ï¼š è¿™ä¸ªä»£ç æ¯”è¾ƒé•¿ï¼Œæˆ‘å°±åªæˆªå–æœ€é‡è¦çš„éƒ¨åˆ†è¿›è¡Œè¯´æ˜äº† è¿™ä¸ªä»£ç ä¸»è¦åšçš„å·¥ä½œå°±æ˜¯è´Ÿè´£ä»xmlé‡Œé¢è£…è½½BeanDefinition. ç»§ç»­çœ‹doLoadBeanDefinitions(): è¿™é‡ŒæŠŠxmlè½¬åŒ–æˆdocument, ç„¶åæ‰§è¡ŒregisterBeanDefinitions()æ–¹æ³•ã€‚ ç»§ç»­çœ‹registerBeanDefinitions(): ä»£ç ä¾æ—§ç®€å•ï¼Œä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šé¦–å…ˆåˆ›å»ºä¸€ä¸ªReader, ç„¶åç”±readerè¿›è¡Œæ³¨å†Œã€‚è¿™ä¸¤éƒ¨åˆ†éƒ½å¾ˆé‡è¦ï¼Œæˆ‘ä»¬ä¸€ä¸€æ¥çœ‹ï¼š åˆ›å»ºReader: è¿›è¡Œæ³¨å†Œï¼š ä»£ç ç®€å•ï¼Œç»§ç»­æ·±å…¥ï¼š doRegisterBeanDefinitions(): è¿™é‡Œé¢æœ€æ ¸å¿ƒçš„ä¸€å¥ï¼š parseBeanDefinitions(root, this.delegate); ç»§ç»­æ·±å…¥ï¼š parseDefaultElement(ele, delegate); ç»§ç»­æ·±å…¥ï¼š è¿™é‡Œå°±å‰å®³äº†ï¼Œæ ¹æ®ä¸åŒçš„èŠ‚ç‚¹åå­—è¿›è¡Œä¸åŒçš„æ“ä½œï¼Œé‚£æˆ‘ä»¬ä¸»è¦æ˜¯åŠ è½½bean, é‚£ä¹ˆèŠ‚ç‚¹åè‚¯å®šå°±æ˜¯BEAN_ELEMENTäº†ï¼Œç»§ç»­æ·±å…¥ï¼š ç»§ç»­æ¥çœ‹ä¸‹æ˜¯å¦‚ä½•è§£æElementçš„ï¼š è§£æçš„æ–¹æ³•å«è¿™ä¸ªåå­— public BeanDefinitionHolder parseBeanDefinitionElement(Element ele, BeanDefinition containingBean) å¯ä»¥çœ‹åˆ°å®ƒè¿”å›äº†ä¸€ä¸ªBeanDefinitionHolder, BeanDefinitionHolderæ˜¯å¯¹BeanDefinitionçš„è¿›ä¸€æ­¥å°è£…ï¼Œä¸ä¿¡æˆ‘ä»¬å¯ä»¥æ¥çœ‹è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼ï¼š return new BeanDefinitionHolder(beanDefinition, beanName, aliasesArray); å¯ä»¥çœ‹åˆ°é‡Œé¢å°è£…äº†beanName,aliasä»¥åŠbeanDefinition,é‚£ä¹ˆbeanDefinitionåˆæ˜¯åœ¨å“ªé‡Œå®šä¹‰çš„? è¿™ä¸ªæ–¹æ³•é‡Œæœ‰è¿™ä¹ˆä¸€å¥ä»£ç ï¼š 12AbstractBeanDefinition beanDefinition = parseBeanDefinitionElement(ele, beanName, containingBean);","categories":[],"tags":[]},{"title":"Springå¾ªç¯ä¾èµ–","slug":"Springå¾ªç¯ä¾èµ–","date":"2020-02-18T05:13:01.000Z","updated":"2023-05-29T14:17:39.334Z","comments":true,"path":"2020/02/18/Springå¾ªç¯ä¾èµ–/","link":"","permalink":"http://example.com/2020/02/18/Spring%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96/","excerpt":"","text":"è¦è°ˆSpringå¾ªç¯ä¾èµ–ï¼Œé¦–å…ˆè¦çŸ¥é“Springä½•æ—¶è¿›è¡Œä¾èµ–æ³¨å…¥ã€‚åœ¨ä»¥å‰çš„æ–‡ç« ä¸­æˆ‘ä»¬æœ‰æåˆ°ï¼ŒIoCå®¹å™¨åˆå§‹åŒ–æ—¶ï¼Œè¦ç»å†BeanDefinitionçš„Resourceå®šä½ï¼ŒBeanDefinitionçš„è½½å…¥è§£æä»¥åŠBeanDefinitionåœ¨IoCå®¹å™¨ä¸­çš„æ³¨å†Œï¼Œç»è¿‡ä¸Šè¿°è¿‡ç¨‹åï¼ŒIoCå®¹å™¨çš„åˆå§‹åŒ–å°±å®Œæˆäº†ï¼Œé‡Œé¢çš„BeanDefinitionä¹Ÿæœ‰äº†ï¼Œç„¶åæ‰å‘ç”Ÿä¾èµ–æ³¨å…¥ã€‚è€Œå¾ªç¯ä¾èµ–å°±æ˜¯åœ¨ä¾èµ–æ³¨å…¥è¿‡ç¨‹ä¸­å‘ç”Ÿçš„Aä¾èµ–äºBè€ŒBæœ‰ä¾èµ–äºAçš„ç°è±¡ã€‚ æ¥ä¸‹æ¥å†è¯´Springä¸­å‘ç”Ÿå¾ªç¯ä¾èµ–ä¼šæ€æ ·ã€‚ springä¸­çš„å¾ªç¯ä¾èµ–æœ‰ä¸‰ç§æƒ…å†µï¼š æ„é€ å™¨å¾ªç¯ä¾èµ–ï¼šspringå¤„ç†ä¸äº†ï¼ŒæŠ›å‡ºå¼‚å¸¸BeanCurrentlylnCreationException å•ä¾‹æ¨¡å¼ä¸‹çš„setterå¾ªç¯ä¾èµ–ï¼šé€šè¿‡ä¸‰çº§ç¼“å­˜å¤„ç†ã€‚ éå•ä¾‹å¾ªç¯ä¾èµ–ï¼šæ— æ³•å¤„ç†ã€‚ æ„é€ å™¨å¾ªç¯ä¾èµ–ï¼š å°†æ­£åœ¨åˆ›å»ºçš„beanè®°å½•åœ¨ç¼“å­˜ä¸­ï¼Œå¦‚æœä¸€ä¸ªbeanåœ¨åˆ›å»ºè¿‡ç¨‹ä¸­å‘ç°è‡ªå·±å·²ç»è¢«è®°å½•äº†ï¼Œåˆ™æŠ›å‡ºBeanCurrentlylnCreationExceptionå¼‚å¸¸ã€‚ setterå¾ªç¯ä¾èµ–ï¼š Springä¸ºäº†è§£å†³å•ä¾‹çš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½¿ç”¨äº†ä¸‰çº§ç¼“å­˜ã€‚ 1234567/** Cache of singleton objects: bean name â€“&gt; bean instance */private final Map singletonObjects = new ConcurrentHashMap(256);/** Cache of singleton factories: bean name â€“&gt; ObjectFactory */private final Map&gt; singletonFactories = new HashMap&gt;(16);/** Cache of early singleton objects: bean name â€“&gt; bean instance */private final Map earlySingletonObjects = new HashMap(16);å¤åˆ¶ä»£ç  è¿™ä¸‰çº§ç¼“å­˜çš„ä½œç”¨åˆ†åˆ«æ˜¯ï¼š singletonFactories ï¼š è¿›å…¥å®ä¾‹åŒ–é˜¶æ®µçš„å•ä¾‹å¯¹è±¡å·¥å‚çš„cache ï¼ˆä¸‰çº§ç¼“å­˜ï¼‰ earlySingletonObjects ï¼šå®Œæˆå®ä¾‹åŒ–ä½†æ˜¯å°šæœªåˆå§‹åŒ–çš„ï¼Œæå‰æš´å…‰çš„å•ä¾‹å¯¹è±¡çš„Cache ï¼ˆäºŒçº§ç¼“å­˜ï¼‰ singletonObjectsï¼šå®Œæˆåˆå§‹åŒ–çš„å•ä¾‹å¯¹è±¡çš„cacheï¼ˆä¸€çº§ç¼“å­˜ï¼‰ æˆ‘ä»¬åœ¨åˆ›å»ºbeançš„æ—¶å€™ï¼Œä¼šé¦–å…ˆä»cacheä¸­è·å–è¿™ä¸ªbeanï¼Œè¿™ä¸ªç¼“å­˜å°±æ˜¯sigletonObjectsã€‚ä¸»è¦çš„è°ƒç”¨æ–¹æ³•æ˜¯ï¼š 12345678910111213141516171819202122protected Object getSingleton(String beanName, boolean allowEarlyReference) &#123; Object singletonObject = this.singletonObjects.get(beanName); //isSingletonCurrentlyInCreation()åˆ¤æ–­å½“å‰å•ä¾‹beanæ˜¯å¦æ­£åœ¨åˆ›å»ºä¸­ if (singletonObject == null &amp;&amp; isSingletonCurrentlyInCreation(beanName)) &#123; synchronized (this.singletonObjects) &#123; singletonObject = this.earlySingletonObjects.get(beanName); //allowEarlyReference æ˜¯å¦å…è®¸ä»singletonFactoriesä¸­é€šè¿‡getObjectæ‹¿åˆ°å¯¹è±¡ if (singletonObject == null &amp;&amp; allowEarlyReference) &#123; ObjectFactory&lt;?&gt; singletonFactory = this.singletonFactories.get(beanName); if (singletonFactory != null) &#123; singletonObject = singletonFactory.getObject(); //ä»singletonFactoriesä¸­ç§»é™¤ï¼Œå¹¶æ”¾å…¥earlySingletonObjectsä¸­ã€‚ //å…¶å®ä¹Ÿå°±æ˜¯ä»ä¸‰çº§ç¼“å­˜ç§»åŠ¨åˆ°äº†äºŒçº§ç¼“å­˜ this.earlySingletonObjects.put(beanName, singletonObject); this.singletonFactories.remove(beanName); &#125; &#125; &#125; &#125; return (singletonObject != NULL_OBJECT ? singletonObject : null);&#125;å¤åˆ¶ä»£ç  ä»ä¸Šé¢ä¸‰çº§ç¼“å­˜çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒSpringè§£å†³å¾ªç¯ä¾èµ–çš„è¯€çªå°±åœ¨äºsingletonFactoriesè¿™ä¸ªä¸‰çº§cacheã€‚è¿™ä¸ªcacheçš„ç±»å‹æ˜¯ObjectFactoryï¼Œå®šä¹‰å¦‚ä¸‹ï¼š 1234public interface ObjectFactory&lt;T&gt; &#123; T getObject() throws BeansException;&#125;å¤åˆ¶ä»£ç  è¿™ä¸ªæ¥å£åœ¨AbstractBeanFactoryé‡Œå®ç°ï¼Œå¹¶åœ¨æ ¸å¿ƒæ–¹æ³•doCreateBeanï¼ˆï¼‰å¼•ç”¨ä¸‹é¢çš„æ–¹æ³•: 1234567891011protected void addSingletonFactory(String beanName, ObjectFactory&lt;?&gt; singletonFactory) &#123; Assert.notNull(singletonFactory, &quot;Singleton factory must not be null&quot;); synchronized (this.singletonObjects) &#123; if (!this.singletonObjects.containsKey(beanName)) &#123; this.singletonFactories.put(beanName, singletonFactory); this.earlySingletonObjects.remove(beanName); this.registeredSingletons.add(beanName); &#125; &#125;&#125;å¤åˆ¶ä»£ç  è¿™æ®µä»£ç å‘ç”Ÿåœ¨createBeanInstanceä¹‹åï¼ŒpopulateBeanï¼ˆï¼‰ä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯è¯´å•ä¾‹å¯¹è±¡æ­¤æ—¶å·²ç»è¢«åˆ›å»ºå‡ºæ¥(è°ƒç”¨äº†æ„é€ å™¨)ã€‚è¿™ä¸ªå¯¹è±¡å·²ç»è¢«ç”Ÿäº§å‡ºæ¥äº†ï¼Œæ­¤æ—¶å°†è¿™ä¸ªå¯¹è±¡æå‰æ›å…‰å‡ºæ¥ï¼Œè®©å¤§å®¶ä½¿ç”¨ã€‚ è¿™æ ·åšæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿè®©æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹â€œAçš„æŸä¸ªfieldæˆ–è€…setterä¾èµ–äº†Bçš„å®ä¾‹å¯¹è±¡ï¼ŒåŒæ—¶Bçš„æŸä¸ªfieldæˆ–è€…setterä¾èµ–äº†Açš„å®ä¾‹å¯¹è±¡â€è¿™ç§å¾ªç¯ä¾èµ–çš„æƒ…å†µã€‚Aé¦–å…ˆå®Œæˆäº†åˆå§‹åŒ–çš„ç¬¬ä¸€æ­¥ï¼Œå¹¶ä¸”å°†è‡ªå·±æå‰æ›å…‰åˆ°singletonFactoriesä¸­ï¼Œæ­¤æ—¶è¿›è¡Œåˆå§‹åŒ–çš„ç¬¬äºŒæ­¥ï¼Œå‘ç°è‡ªå·±ä¾èµ–å¯¹è±¡Bï¼Œæ­¤æ—¶å°±å°è¯•å»get(B)ï¼Œå‘ç°Bè¿˜æ²¡æœ‰è¢«createï¼Œæ‰€ä»¥èµ°createæµç¨‹ï¼ŒBåœ¨åˆå§‹åŒ–ç¬¬ä¸€æ­¥çš„æ—¶å€™å‘ç°è‡ªå·±ä¾èµ–äº†å¯¹è±¡Aï¼Œäºæ˜¯å°è¯•get(A)ï¼Œå°è¯•ä¸€çº§ç¼“å­˜singletonObjects(è‚¯å®šæ²¡æœ‰ï¼Œå› ä¸ºAè¿˜æ²¡åˆå§‹åŒ–å®Œå…¨)ï¼Œå°è¯•äºŒçº§ç¼“å­˜earlySingletonObjectsï¼ˆä¹Ÿæ²¡æœ‰ï¼‰ï¼Œå°è¯•ä¸‰çº§ç¼“å­˜singletonFactoriesï¼Œç”±äºAé€šè¿‡ObjectFactoryå°†è‡ªå·±æå‰æ›å…‰äº†ï¼Œæ‰€ä»¥Bèƒ½å¤Ÿé€šè¿‡ObjectFactory.getObjectæ‹¿åˆ°Aå¯¹è±¡(è™½ç„¶Aè¿˜æ²¡æœ‰åˆå§‹åŒ–å®Œå…¨ï¼Œä½†æ˜¯æ€»æ¯”æ²¡æœ‰å¥½å‘€)ï¼ŒBæ‹¿åˆ°Aå¯¹è±¡åé¡ºåˆ©å®Œæˆäº†åˆå§‹åŒ–é˜¶æ®µ1ã€2ã€3ï¼Œå®Œå…¨åˆå§‹åŒ–ä¹‹åå°†è‡ªå·±æ”¾å…¥åˆ°ä¸€çº§ç¼“å­˜singletonObjectsä¸­ã€‚æ­¤æ—¶è¿”å›Aä¸­ï¼ŒAæ­¤æ—¶èƒ½æ‹¿åˆ°Bçš„å¯¹è±¡é¡ºåˆ©å®Œæˆè‡ªå·±çš„åˆå§‹åŒ–é˜¶æ®µ2ã€3ï¼Œæœ€ç»ˆAä¹Ÿå®Œæˆäº†åˆå§‹åŒ–ï¼Œè¿›å»äº†ä¸€çº§ç¼“å­˜singletonObjectsä¸­ï¼Œè€Œä¸”æ›´åŠ å¹¸è¿çš„æ˜¯ï¼Œç”±äºBæ‹¿åˆ°äº†Açš„å¯¹è±¡å¼•ç”¨ï¼Œæ‰€ä»¥Bç°åœ¨holdä½çš„Aå¯¹è±¡å®Œæˆäº†åˆå§‹åŒ–ã€‚ æ£€æµ‹å¾ªç¯ä¾èµ–çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š A åˆ›å»ºè¿‡ç¨‹ä¸­éœ€è¦ Bï¼Œäºæ˜¯ A å°†è‡ªå·±æ”¾åˆ°ä¸‰çº§ç¼“é‡Œé¢ ï¼Œå»å®ä¾‹åŒ– B B å®ä¾‹åŒ–çš„æ—¶å€™å‘ç°éœ€è¦ Aï¼Œäºæ˜¯ B å…ˆæŸ¥ä¸€çº§ç¼“å­˜ï¼Œæ²¡æœ‰ï¼Œå†æŸ¥äºŒçº§ç¼“å­˜ï¼Œè¿˜æ˜¯æ²¡æœ‰ï¼Œå†æŸ¥ä¸‰çº§ç¼“å­˜ï¼Œæ‰¾åˆ°äº†ï¼ ç„¶åæŠŠä¸‰çº§ç¼“å­˜é‡Œé¢çš„è¿™ä¸ª A æ”¾åˆ°äºŒçº§ç¼“å­˜é‡Œé¢ï¼Œå¹¶åˆ é™¤ä¸‰çº§ç¼“å­˜é‡Œé¢çš„ A B é¡ºåˆ©åˆå§‹åŒ–å®Œæ¯•ï¼Œå°†è‡ªå·±æ”¾åˆ°ä¸€çº§ç¼“å­˜é‡Œé¢ï¼ˆæ­¤æ—¶Bé‡Œé¢çš„Aä¾ç„¶æ˜¯åˆ›å»ºä¸­çŠ¶æ€ï¼‰ ç„¶åå›æ¥æ¥ç€åˆ›å»º Aï¼Œæ­¤æ—¶ B å·²ç»åˆ›å»ºç»“æŸï¼Œç›´æ¥ä»ä¸€çº§ç¼“å­˜é‡Œé¢æ‹¿åˆ° B ï¼Œç„¶åå®Œæˆåˆ›å»ºï¼Œå¹¶å°†è‡ªå·±æ”¾åˆ°ä¸€çº§ç¼“å­˜é‡Œé¢ å¦‚æ­¤ä¸€æ¥ä¾¿è§£å†³äº†å¾ªç¯ä¾èµ–çš„é—®é¢˜ æ‰€ä»¥æ€»ç»“ä»¥ä¸‹ï¼Œè§£å†³setterå¾ªç¯ä¾èµ–çš„æ–¹æ³•å°±æ˜¯åœ¨å¾ªç¯ä¾èµ–ä¹‹å‰ç»™ä»–è®¾ç½®äº†é˜¶æ¢¯ï¼Œæˆ–è€…è¯´åˆ†äº†å±‚ï¼Œä½¿å¾—é‚£ç§æ²¡æœ‰è¢«å®Œå…¨åˆå§‹åŒ–å¥½çš„å¯¹è±¡å¯ä»¥ä½œä¸ºè¢«ä¾èµ–å»å®Œæˆä¾èµ–å¯¹è±¡çš„åˆå§‹åŒ–ï¼ˆä¹Ÿå°±æ˜¯æå‰æ›å…‰ï¼‰ã€‚ springå•ä¾‹å¯¹è±¡åˆå§‹åŒ–ç»è¿‡ä»¥ä¸‹è¿‡ç¨‹ï¼š createBeanInstance: è°ƒç”¨æ„é€ æ–¹æ³•å¯¹å¯¹è±¡è¿›è¡Œå®ä¾‹åŒ–ã€‚ populateBean: å±æ€§å¡«å…… initializeBean: è°ƒç”¨xmlä¸­çš„initæ–¹æ³• æ‰€ä»¥å¾ªç¯ä¾èµ–å‘ç”Ÿåœ¨ç¬¬ä¸€äºŒæ­¥ã€‚ å‚è€ƒï¼šé“¾æ¥ï¼šhttps://juejin.im/post/5c98a7b4f265da60ee12e9b2","categories":[{"name":"Spring","slug":"Spring","permalink":"http://example.com/categories/Spring/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"http://example.com/tags/Spring/"}]},{"title":"Javaä¸­çš„åŠ¨æ€ä»£ç†","slug":"Javaä¸­çš„åŠ¨æ€ä»£ç†","date":"2020-02-16T09:41:44.000Z","updated":"2023-05-29T14:17:39.394Z","comments":true,"path":"2020/02/16/Javaä¸­çš„åŠ¨æ€ä»£ç†/","link":"","permalink":"http://example.com/2020/02/16/Java%E4%B8%AD%E7%9A%84%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/","excerpt":"","text":"æœ€è¿‘åœ¨çœ‹Springä¸­çš„AOP, å…¶å®ç°ä¸»è¦æ˜¯é åŠ¨æ€ä»£ç†ï¼Œæ‰€ä»¥æ‰“ç®—å…ˆäº†è§£ä¸€ä¸‹åŠ¨æ€ä»£ç†ã€‚ è¦è¯´åŠ¨æ€ä»£ç†ï¼Œéœ€è¦å…ˆçŸ¥é“ä»€ä¹ˆæ˜¯ä»£ç†ï¼Œæ—¢ç„¶æ˜¯åŠ¨æ€ä»£ç†ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰é™æ€ä»£ç†ï¼ŒåŒºåˆ«åˆåœ¨å“ªé‡Œã€‚ ä½•ä¸ºä»£ç†ï¼Œæœ€ç›´è§‚çš„ï¼Œæˆ‘ä»¬fqæ—¶ä¼šç”¨åˆ°å°é£æœºæˆ–è€…å…¶ä»–çš„æ­£å‘ä»£ç†ï¼Œè¯´ç™½äº†å°±æ˜¯è®©ä»£ç†ä»£æ›¿æˆ‘ä»¬å»åšæŸä»¶äº‹ï¼Œåœ¨è®¾è®¡æ¨¡å¼ä¸­ä¸“é—¨æœ‰ä¸€ä¸ªä»£ç†æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ¥çœ‹ä¸‹ä»£ç†æ¨¡å¼çš„ç±»å›¾ã€‚ å…¶ä¸­ProxyImageå°±æ˜¯ä»£ç†å¯¹è±¡ï¼Œä»£ç†äº†RealImage, å®ƒä»¬å®ç°äº†å…±åŒçš„æ¥å£ï¼ŒåŒæ—¶ProxyImageèšåˆäº†RealImage, é€šè¿‡åœ¨ProxyImageçš„displayæ–¹æ³•ä¸­è°ƒç”¨RealImageçš„display,è¾¾åˆ°ä»£ç†çš„ä½œç”¨ã€‚ è¿™æ ·çš„ä»£ç†æˆ‘ä»¬ä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºé™æ€ä»£ç†ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿå› ä¸ºè¿™ç§ä»£ç†å…³ç³»æ˜¯ä»£ç è¢«ç¼–è¯‘æˆå­—èŠ‚ç æ—¶å°±å­˜åœ¨çš„ï¼Œè€ŒåŠ¨æ€ä»£ç†åˆ™ä¸ä¸€æ ·ï¼Œå®ƒçš„ä»£ç†å…³ç³»æ˜¯è¿è¡ŒæœŸåŠ¨æ€åˆ›å»ºçš„ã€‚è¯´åˆ°è¿è¡ŒæœŸã€åŠ¨æ€ï¼Œä½ æƒ³åˆ°äº†ä»€ä¹ˆï¼Ÿåå°„ã€‚æ²¡é”™ï¼Œå…¶å®åŠ¨æ€ä»£ç†å°±æ˜¯ç”¨åˆ°äº†åå°„ã€‚ Javaä¸­å¸¸ç”¨çš„åŠ¨æ€ä»£ç†æŠ€æœ¯æœ‰JDKåŠ¨æ€ä»£ç†ä»¥åŠCGLIBåŠ¨æ€ä»£ç†ã€‚ åŸºäºJDKçš„åŠ¨æ€ä»£ç†æ ¸å¿ƒæœ‰ä¸¤ä¸ªæ–¹æ³•éœ€è¦æŒæ¡ï¼š é¦–å…ˆè¦å®ç°åŠ¨æ€ä»£ç†ï¼Œä»£ç†éœ€è¦ç»§æ‰¿InvacationHandlerç±»ï¼Œåœ¨ä»£ç†ç±»ä¸­å®ç°ä»£ç†å¯¹è±¡å’Œè¢«ä»£ç†å¯¹è±¡çš„ç»‘å®šï¼Œç”¨çš„æ˜¯Proxy.newProxyInstance()æ–¹æ³•ï¼Œç„¶åéœ€è¦é‡å†™ä¸€ä¸ªinvoke()æ–¹æ³•ï¼Œä¸¾ä¸€ä¸ªå»–é›ªå³°å¤§ä½¬ç½‘ç«™çš„ä¾‹å­ 123456789101112131415161718192021222324public class Main &#123; public static void main(String[] args) &#123; InvocationHandler handler = new InvocationHandler() &#123; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; System.out.println(method); if (method.getName().equals(&quot;morning&quot;)) &#123; System.out.println(&quot;Good morning, &quot; + args[0]); &#125; return null; &#125; &#125;;mornin Hello hello = (Hello) Proxy.newProxyInstance( Hello.class.getClassLoader(), // ä¼ å…¥ClassLoader new Class[] &#123; Hello.class &#125;, // ä¼ å…¥è¦å®ç°çš„æ¥å£ handler); // ä¼ å…¥å¤„ç†è°ƒç”¨æ–¹æ³•çš„InvocationHandler hello.morning(&quot;Bob&quot;); &#125;&#125;interface Hello &#123; void morning(String name);&#125; ä»£ç ä¸­ç”Ÿæˆäº†ä»£ç†hello, å¯ä»¥çœ‹åˆ°å®ƒå’Œè¢«ä»£ç†å¯¹è±¡æ˜¯åŒä¸€ç±»å‹çš„ï¼Œå½“æ‰§è¡Œä»£ç†å¯¹è±¡çš„morning()æ–¹æ³•æ—¶ï¼Œå°±ä¼šè°ƒç”¨handlerçš„invokeæ–¹æ³•ï¼Œå½“ç„¶äº†ï¼Œåœ¨invokeæ–¹æ³•é‡Œæˆ‘ä»¬ä¸€æ–¹é¢è°ƒç”¨äº†è¢«ä»£ç†å¯¹è±¡çš„morningæ–¹æ³•ï¼Œä¸€æ–¹é¢åŠ å…¥æˆ‘ä»¬è‡ªå·±çš„é€»è¾‘ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"åŠ¨æ€ä»£ç†","slug":"åŠ¨æ€ä»£ç†","permalink":"http://example.com/tags/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"}]},{"title":"å‡å¦‚æˆ‘æ˜¯é¢è¯•å®˜","slug":"å‡å¦‚æˆ‘æ˜¯é¢è¯•å®˜","date":"2020-02-14T13:45:34.000Z","updated":"2023-05-29T14:17:39.333Z","comments":true,"path":"2020/02/14/å‡å¦‚æˆ‘æ˜¯é¢è¯•å®˜/","link":"","permalink":"http://example.com/2020/02/14/%E5%81%87%E5%A6%82%E6%88%91%E6%98%AF%E9%9D%A2%E8%AF%95%E5%AE%98/","excerpt":"","text":"æœ€è¿‘é˜¿é‡Œå„éƒ¨é—¨å·²ç»é™†ç»­å¼€å§‹æ˜¥æ‹›ï¼Œè‡ªå·±ä¹Ÿå†™å®Œäº†é¡¹ç›®æœ€åçš„ä¸€éƒ¨åˆ†ï¼Œç®€å†ä¹Ÿåˆšåˆšå®Œæˆäº†1.0ç‰ˆæœ¬ï¼Œä½†æ˜¯ä»æ—§æŒ‰æºä¸ä½èºåŠ¨çš„å†…å¿ƒã€‚å¯¹äºç®€å†æŠ•é€’ä¸é¢è¯•ï¼Œæˆ‘æ˜¯æ—¢æœŸæœ›åˆç´§å¼ ï¼Œå®³æ€•å®ƒæ¥åˆæ€•ä»–ä¸æ¥ã€‚ä¸å…¶ä¸´æ¸Šç¾¡é±¼ï¼Œä¸å¦‚é€€è€Œç»“ç½‘ï¼Œæœ‰èºåŠ¨çš„åŠŸå¤«ï¼Œä¸å¦‚æ¸©ä¹ ä¸€ä¸‹çŸ¥è¯†ç‚¹ï¼Œæ­£å¥½æœ€è¿‘ä¸€ç›´åœ¨å†™é¡¹ç›®, çŸ¥è¯†ç‚¹ä¹Ÿå¿«å¿˜çš„å·®ä¸å¤šäº†ã€‚æ¥ä¸‹æ¥æ‰“ç®—ç»“åˆè‡ªå·±çš„ç®€å†ï¼Œä»é¢è¯•å®˜çš„è§’åº¦ï¼Œå¯¹è‡ªå·±è¿›è¡Œæé—®ã€‚ Java é›†åˆç±»æ˜¯å¦äº†è§£ï¼Ÿ Set List Queue List: Vector, ArrayList, LinkedList, Stack Set: TreeSet, HashSet Queue Vectorå’ŒArrayListåŒºåˆ« é¦–å…ˆè¦æ˜ç¡®ä¸€ç‚¹ï¼Œä»Listæ¥å£ä¸‹æ¥çš„ä¸»è¦æœ‰ä¸‰ä¸ªå®ç°ç±»ï¼ŒVector, ArrayList, LinkedList. Vectorå’ŒArrayListåº•å±‚éƒ½æ˜¯åŠ¨æ€æ•°æ®ï¼Œä¸åŒçš„æ˜¯Vectoræ˜¯çº¿ç¨‹å®‰å…¨ï¼ˆsynchronizedä¿®é¥°ï¼‰ æ‰€ä»¥å¦‚æœè¯´æœ‰å“ªäº›çº¿ç¨‹å®‰å…¨çš„List, é‚£å°±æœ‰SynchronizedList, Vector, CopyOnWriteList. ç„¶åï¼Stackåˆæ˜¯ç»§æ‰¿è‡ªVector, æ‰€ä»¥Stackä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ˆè¿™éƒ½ä¸çŸ¥é“ï¼Œç½ªå­½å•Šï¼‰ã€‚ Set å’Œ List åŒºåˆ« åŒæ­¥å®¹å™¨æœ‰å“ªäº› Vector Stack HashTable HashMapæ˜¯å¦äº†è§£ åˆå§‹å®¹é‡ï¼Œè´Ÿè½½å› å­ï¼Œæ‰©å®¹ï¼Ÿ å®¹é‡ä¸ºä»€ä¹ˆæ˜¯2çš„å› å­ æ’å…¥ï¼šå¤´æ’å°¾æ’ï¼Ÿ 1.7æ˜¯å¤´æ’ï¼Œ å¦‚ä½•è®¡ç®—hash, è®¡ç®—hashçš„æ—¶å€™ä¸ºä»€ä¹ˆè¦å–æ¨¡ hashCodeå’Œequalsçš„é‡å†™ï¼Œ equalså’Œ==çš„åŒºåˆ« HashMapæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ åšç»“æ„æ€§ä¿®æ”¹çš„æ—¶å€™ä¸å®‰å…¨ï¼Œæ€»ç»“æ¥è¯´ï¼Œå¤´æ’æ¶‰åŠåˆ°å¥½å‡ ä¸ªä»£ç ç‰‡æ®µï¼Œä»–ä»¬ä¸æ˜¯åŸå­æ“ä½œï¼Œé‚£ä¹ˆå¤šçº¿ç¨‹æ—¶å°±ä¼šå‡ºäº‹ï¼Œæ¯”å¦‚å½¢æˆç¯å½¢é“¾è¡¨ã€‚ é’ˆå¯¹HashMapçš„è¿™äº›å¼Šç«¯æœ‰è§£å†³æªæ–½å—ï¼Ÿ ConcurrentHashMap è®²ä¸€è®²ConcurrentHashMap 1.7ä¸­ä½¿ç”¨åˆ†æ®µé”ï¼Œ 1.8ä¸­ä½¿ç”¨CAS+synchronized, 1.8ä¸­å¼•å…¥äº†çº¢é»‘æ ‘ï¼Œ1.7å’Œ1.8ä¸­size()æ–¹æ³•ä¹Ÿä¸ä¸€æ ·ï¼Œ1.7ä¸­å¤šæ¬¡è®¡ç®—ï¼Œç„¶åå†³å®šæ˜¯å¦åŠ é”ï¼Œ1.8ä¸­ä½¿ç”¨baseCount+CounterCell ä¸ºä»€ä¹ˆä»1.7çš„åˆ†æ®µé”å˜æˆäº†1.8çš„CAS+synchronized è°ˆè°ˆä½ å¯¹synchronizedå…³é”®å­—çš„ç†è§£ æ˜¯ä¸€ç§Javaå†…ç½®çš„é”ï¼Œä¿®é¥°æ–¹æ³•æˆ–è€…ä»£ç å—ï¼Œä¿®é¥°ä»£ç å—æ—¶ï¼Œåº•å±‚æ˜¯moniterenterå’ŒmonitorexitæŒ‡ä»¤å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯åŠ é”çš„æ„æ€ã€‚ å†…å­˜è¯­ä¹‰ï¼šå¯è§æ€§ï¼ŒåŸå­æ€§ï¼Œæœ‰åºæ€§ synchronizedå’Œlock synchronizedæ˜¯å†…ç½®çš„ï¼Œlockæ˜¯åŸºäºAQSçš„ synchronizedç­‰å¾…ä¸­çš„çº¿ç¨‹ä¸èƒ½å“åº”ä¸­æ–­ï¼Œlockç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹æ˜¯å¯ä»¥ç›¸åº”ä¸­æ–­çš„ã€‚ synchronizedæ˜¯éå…¬å¹³é”ï¼ŒReentrantLocké»˜è®¤éå…¬å¹³é”ï¼Œå¯ä»¥è®¾ç½®ä¸ºå…¬å¹³é”ã€‚ synchronizedå‘ç”Ÿå¼‚å¸¸æ—¶ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œlockéœ€è¦æ‰‹åŠ¨é‡Šæ”¾ synchronizedæ˜¯è·å–é”è¿˜æ˜¯è¿›å…¥ç­‰å¾…é˜Ÿåˆ—æˆ‘ä»¬æ˜¯ä¸çŸ¥é“çš„ï¼Œä½†æ˜¯é€šè¿‡Lockçš„tryLockå¯ä»¥å¾—çŸ¥æœ‰æ²¡æœ‰è·å–é”æˆåŠŸã€‚ lockå¯ä»¥æœ‰å¤šä¸ªcondition Monitoræœºåˆ¶æ˜¯å¦äº†è§£ volatileå…³é”®å­—æ˜¯å¦äº†è§£ å¯¹Javaä¸­é”çš„äº†è§£ CASæ˜¯ä»€ä¹ˆ èŠèŠä½ ç†Ÿæ‚‰çš„è®¾è®¡æ¨¡å¼ Javaå†…å­˜æ¨¡å‹ï¼Œ JVMå†…å­˜æ¨¡å‹ï¼Œç±»åŠ è½½ï¼Œåƒåœ¾å›æ”¶ï¼ŒOOM fail-fast å’Œ fail-safe HashMap å’ŒHashTableåŒºåˆ« ç»§æ‰¿ä¸åŒï¼šä¸€ä¸ªå®ç°mapæ¥å£ï¼Œä¸€ä¸ªæ¥è‡ªDictionary çº¿ç¨‹å®‰å…¨ä¸åŒ å…ä¸å…è®¸nullå€¼ï¼šHashMapå…è®¸é”®æˆ–è€…å€¼ä¸ºnull, ä¸”åªå…è®¸æœ‰ä¸€ä¸ªé”®ä¸ºnullçš„å€¼ï¼ˆå› ä¸ºå¦‚æœæœ‰å¤šä¸ªé”®ä¸ºnullæ—¶ï¼Œæˆ‘æ€ä¹ˆçŸ¥é“æˆ‘getçš„nullæ˜¯å“ªä¸ªnullï¼‰ï¼Œä½†æ˜¯å¯ä»¥æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªé”®çš„å€¼ä¸ºnull, ä¸”å½“hashmapä¸­æ²¡æœ‰æŸä¸ªé”®æ—¶ï¼Œgetæ–¹æ³•ä¼šè¿”å›null, æ‰€ä»¥è¯´ï¼Œæˆ‘ä»¬ä¸èƒ½ç”¨getæ–¹æ³•æ¥åˆ¤æ–­hashmapä¸­æ˜¯å¦æœ‰æŸä¸ªé”®(å› ä¸ºgetæ–¹æ³•è¿”å›nullçš„æ—¶å€™ï¼Œå¯èƒ½æ˜¯å€¼ä¸ºnull, ä¹Ÿå¯èƒ½æ˜¯keyä¸å­˜åœ¨)ï¼Œè€Œåº”è¯¥ç”¨containsKey() çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥&gt; ç›´æ¥ä¸¢å¼ƒ &gt; &gt; ä¸¢å¼ƒé˜Ÿåˆ—ä¸­æœ€è€çš„ &gt; &gt; æŠ›å‡ºå¼‚å¸¸ &gt; &gt; CallerRunsPolicy: å°†ä»»åŠ¡åˆ†ç»™è°ƒç”¨çº¿ç¨‹å»æ‰§è¡Œ çº¿ç¨‹å®‰å…¨çš„list Vector å¾ˆå¤è€ CopyOnWriteArrayList jucåŒ…ä¸­çš„ï¼Œé”ä½äº†æ•´ä¸ªå¯¹è±¡ synchronizedList Collectionså·¥å…·ç±»ä¸­çš„ Springä¸ºä»€ä¹ˆè¦ç”¨åŠ¨æ€ä»£ç†è€Œä¸æ˜¯é™æ€ä»£ç†ï¼Ÿ é™æ€ä»£ç†çš„ä»£ç†å…³ç³»æ˜¯åœ¨ç¼–è¯‘æœŸå°±ç”Ÿæˆçš„ï¼Œæ¯”è¾ƒæ­»æ¿ï¼Œè€Œä¸”æ˜¯éœ€è¦ä»classæ–‡ä»¶è½¬æˆè¿è¡Œæ—¶çš„ç±»çš„ï¼Œè€ŒåŠ¨æ€ä»£ç†æ¯”è¾ƒçµæ´»ï¼Œç›´æ¥åœ¨è¿è¡ŒæœŸç”Ÿæˆå­—èŠ‚ç å¹¶åŠ è½½åˆ°JVMä¸­å»ï¼ŒSpringä¸­ä»£ç†åº”è¯¥å¾ˆå¤šï¼Œç”¨é™æ€ä»£ç†ï¼Œä¸çµæ´»ï¼Œè€Œä¸”ä¼šç”Ÿæˆå¾ˆå¤šä¸å¿…è¦çš„classæ–‡ä»¶ã€‚ JUC é˜»å¡é˜Ÿåˆ— ArrayBlockingQueue: æœ‰ç•Œçš„é˜»å¡é˜Ÿåˆ— DelayQueue: æ— ç•Œçš„é˜»å¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªå»¶æ—¶ï¼Œåªæœ‰è¿‡æœŸäº†æ‰èƒ½å‡ºé˜Ÿ LinkedBlockingQueue: PriorityBlockingQueue: SynchronousQueue: åªèƒ½è£…ä¸€ä¸ªå…ƒç´ çš„é˜Ÿåˆ— å¸¸è§çš„OOMçš„æƒ…å†µ java.lang.OutOfMemoryError:Java heap space: å †ä¸å¤Ÿç”¨äº†ã€‚æˆ–è€…å†…å­˜æ³„æ¼ java.lang.OutOfMemoryError:GC overhead limit exceededï¼šå½“åº”ç”¨ç¨‹åºèŠ±è´¹è¶…è¿‡98%çš„æ—¶é—´ç”¨æ¥åšGCå¹¶ä¸”å›æ”¶äº†ä¸åˆ°2%çš„å †å†…å­˜æ—¶ï¼Œå°±ä¼šæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚ java.lang.OutOfMemoryError: PermGen space java.lang.OutOfMemoryError: Metaspace java.lang.OutOfMemoryError:Unable to create new native thread:çº¿ç¨‹å»ºçš„å¤ªå¤šäº†ã€‚ java.lang.OutOfMemoryError:Out of swap space? java.lang.OutOfMemoryError:Requested array size exceeds VM limit Out of memory:Kill process or sacrifice child ArrayListæ‰©å®¹ï¼Œ HashMapæ‰©å®¹ ArrayListçš„æ‰©å®¹æ˜¯åŸºäºåŠ¨æ€æ•°ç»„çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å®ƒçš„sizeå¿«è¾¾åˆ°lengthæ—¶ï¼Œä¼šè¿›è¡Œä¸€ä¸ª1.5å€çš„åŠ¨æ€æ‰©å®¹ï¼Œåº•å±‚æ˜¯é€šè¿‡Arrays.copyof()æ¥å®ç°çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªæµ…æ‹·è´ã€‚ Springå¯åŠ¨è¿‡ç¨‹ web.xmlä¸­çš„ContextLoaderListeneråœ¨å®¹å™¨å¯åŠ¨æ—¶ä¼šè§¦å‘åˆå§‹åŒ–ï¼Œè°ƒç”¨contextInitialized, åˆå§‹åŒ–ä¸€ä¸ªWebApplicationContextä¸Šä¸‹æ–‡ã€‚ ç„¶ååˆå§‹åŒ–DispatcherServlet, å®ƒä¼šä»¥ä¸Šé¢å¾—åˆ°çš„ä¸Šä¸‹æ–‡ä½œä¸ºè‡ªå·±çš„parentä¸Šä¸‹æ–‡ï¼Œç„¶åå†åˆå§‹åŒ–ä¸€ä¸ªè‡ªå·±çš„ä¸Šä¸‹æ–‡ã€‚ JUCå·¥å…·ç±» CountDownLatch: ç”¨äºä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹ä¸­è®¾ç½®await(),å­çº¿ç¨‹ä¸­countDown()æ¯æ¬¡å‡ä¸€ï¼Œåªæœ‰å½“å‡åˆ°é›¶çš„æ—¶å€™ä¸»çº¿ç¨‹ä¸­await()åé¢çš„å†…å®¹æ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚ å¦‚ä½•å®ç°ï¼šè¿˜æ˜¯é€šè¿‡å†…èšAQSå®ç°çš„ï¼Œæˆ‘ä»¬è®¾ç½®çš„countå°±æ˜¯state, æ¯æ¬¡çš„countDown()å°±æ˜¯AQSçš„ä¸€ä¸ªreleaseæ“ä½œï¼Œä¸»çº¿ç¨‹çš„await()å°±æ˜¯acquire()æ“ä½œ, å¦‚æœcountä¸ç­‰äºé›¶ï¼Œåˆ™å‡å¦‚åŒæ­¥é˜Ÿåˆ—è‡ªæ—‹ï¼Œè‡ªæ—‹èƒ½å‡ºæ¥çš„æ¡ä»¶æ˜¯count==0,æ€»ä½“æ¥è¯´å¥—ç”¨è¿˜æ˜¯AQSçš„æ¡†æ¶ã€‚ CyclicBarrier: ä½œç”¨å’Œä¸Šé¢çš„å·®ä¸å¤šï¼Œç”¨æ³•ç›¸å¯¹ç®€å•ï¼Œè€Œä¸”å¯ä»¥å¾ªç¯åˆ©ç”¨ã€‚ä¸Šé¢çš„CountDownLatchä¸»è¦ç”¨äºä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹éƒ½æ‰§è¡Œåˆ°æŸä¸ªåœ°æ–¹æ—¶ä¸»çº¿ç¨‹æ‰èƒ½ç»§ç»­ï¼Œè€ŒCyclicBarrierä¸»è¦ç”¨äºå¤šä¸ªçº¿ç¨‹ä¹‹é—´äº’ç›¸ç­‰å¾…ï¼Œå› ä¸ºå®ƒåªæœ‰ä¸€ä¸ªawaitæ–¹æ³•æ”¾åœ¨å­çº¿ç¨‹ä¸­ç”¨äºç›¸äº’ç­‰å¾…ã€‚ Samphare: ç±»ä¼¼äºæ“ä½œç³»ç»Ÿä¸­çš„ä¿¡å·é‡æœºåˆ¶ï¼Œä¸€å…±äº”é¢—ç³–ï¼Œé‚£ä¹ˆä¹Ÿå°±æœ€å¤šåªæœ‰äº”ä¸ªçº¿ç¨‹èƒ½åŒæ—¶è¿è¡Œï¼Œåªæœ‰å½“å…¶ä¸­æŸä¸ªçº¿ç¨‹æŠŠç³–è¿˜å›æ¥äº†å…¶ä»–çº¿ç¨‹æ²¡æ‹¿åˆ°ç³–çš„çº¿ç¨‹æ‰èƒ½ç»§ç»­ã€‚ å—æ£€å¼‚å¸¸ éå—æ£€å¼‚å¸¸ å—æ£€å¼‚å¸¸:ç¨‹åºè¿è¡Œä¸­å®¹æ˜“å‡ºç°çš„ï¼Œæƒ…ç†å¯å®¹çš„å¼‚å¸¸ï¼Œå‡ºç°äº†å°±è¦try catchæˆ–è€…throw ä¸å—æ£€å¼‚å¸¸ï¼šç¼–è¯‘å™¨ä¸è¦æ±‚å¼ºåˆ¶å¤„ç†çš„å¼‚å¸¸ï¼ŒåŒ…æ‹¬RunTimeExceptionå’ŒError Executoråˆ›å»ºçº¿ç¨‹æ±  newCachedThreadPool 123return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue&lt;Runnable&gt;()); æ ¸å¿ƒæ± 0ï¼Œæœ€å¤§æ± Integer.MAX_VALUE,åŒæ­¥é˜Ÿåˆ—å¤§å°ä¸º1ï¼Œæ‰€ä»¥ç›¸å½“äºæ˜¯æ¯æ¬¡éƒ½åˆ›å»ºä¸´æ—¶çº¿ç¨‹å»å·¥ä½œçš„ã€‚ newSingleThreadExecutor 1234return new FinalizableDelegatedExecutorService (new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;())); æ ¸å¿ƒæ± 1ï¼Œæœ€å¤§æ± 1ï¼Œä½†æ˜¯é˜»å¡é˜Ÿåˆ—æ˜¯æ— ç•Œçš„ï¼ŒLinkedBlockingQueueé»˜è®¤å¤§å°æ˜¯Integer.MAX_VALUE,æ‰€ä»¥ä¹Ÿå®¹æ˜“é€ æˆOOM. newFixedThreadPool 123return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;()); é“ç†åŒä¸Šã€‚ AQS Lockä¸‹çš„é”éƒ½æ˜¯é€šè¿‡èšåˆä¸€ä¸ªAQSçš„å­ç±»æ¥å®ç°çš„ï¼Œè¿™é‡Œå¯¹AQSåšä¸€ä¸ªç®€å•çš„ä»‹ç»ã€‚ AQSçš„æ ¸å¿ƒæœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯state, ä¸€ä¸ªæ˜¯åŒæ­¥é˜Ÿåˆ—ï¼Œé€šè¿‡å¯¹stateå€¼ä¿®æ”¹æ˜¯å¦æˆåŠŸè¡¨ç¤ºä¸€ä¸ªçº¿ç¨‹æ˜¯å¦è·å–é”æˆåŠŸï¼ŒæœªæˆåŠŸè·å–é”çš„çº¿ç¨‹åˆ™åŠ å…¥åŒæ­¥é˜Ÿåˆ—è‡ªæ—‹ã€‚ AQSé‡Œè¿˜åˆ†äº†å…±äº«å¼è·å–é”å’Œç‹¬å å¼è·å–é”ï¼Œåˆ†åˆ«å¯¹åº”äº†ä¸åŒçš„æ¨¡æ¿æ–¹æ³•ã€‚ åˆ›å»ºçº¿ç¨‹ ç»§æ‰¿Thread ç»§æ‰¿Runnable Future + Callable: Future = service.submit(Callable) FutureTaskåŒ…è£…Callable: service.submit(futuretask),é€šè¿‡futuretask.getè·å¾—ç»“æœ ç¼“å­˜ä¸€è‡´æ€§å¦‚ä½•ä¿è¯ä¿è¯ç¼“å­˜ä¸€è‡´æ€§ï¼Ÿ åŠ æ€»çº¿é”ï¼šCPUå’Œå…¶ä»–éƒ¨ä»¶çš„è®¿é—®æ˜¯é€šè¿‡æ€»çº¿è¿›è¡Œçš„ï¼Œæ€»çº¿åŠ é”ï¼Œé‚£ä¹ˆå°±åªèƒ½ç­‰ä¸€ä¸ªCPUæ“ä½œå®Œäº†å…¶ä»–æ‰èƒ½ç»§ç»­ã€‚ ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼šå½“CPUå†™å˜é‡æ—¶å‘ç°è¯¥å˜é‡æ˜¯å…±äº«å˜é‡æ—¶ï¼Œå°±ä¼šé€šçŸ¥å…¶ä»–CPUä½¿ä»–ä»¬çš„ç¼“å­˜æ— æ•ˆï¼Œä»è€Œè¢«è¿«åªèƒ½ä»ä¸»å­˜è¯»å–ã€‚ happens-beforeåŸåˆ™ä»€ä¹ˆæ˜¯happens-beforeï¼Ÿå®ƒæ˜¯ä¸€å¥—è§„åˆ™ï¼Œè¿™å¥—è§„åˆ™é˜è¿°äº†å¤šçº¿ç¨‹æ“ä½œä¹‹é—´çš„å†…å­˜å¯è§æ€§ã€‚ åœ¨JMMä¸­ï¼Œå¦‚æœä¸€ä¸ªæ“ä½œæ‰§è¡Œçš„ç»“æœéœ€è¦å¯¹å¦ä¸€ä¸ªæ“ä½œå¯è§ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´å¿…é¡»å­˜åœ¨happens-beforeå…³ç³»ã€‚ Javaå†…å­˜æ¨¡å‹å…·å¤‡ä¸€äº›å…ˆå¤©çš„â€œæœ‰åºæ€§â€ï¼Œå³ä¸éœ€è¦é€šè¿‡ä»»ä½•æ‰‹æ®µå°±èƒ½å¤Ÿå¾—åˆ°ä¿è¯çš„æœ‰åºæ€§ï¼Œè¿™ä¸ªé€šå¸¸ä¹Ÿç§°ä¸º happens-before åŸåˆ™ã€‚å¦‚æœä¸¤ä¸ªæ“ä½œçš„æ‰§è¡Œæ¬¡åºæ— æ³•ä»happens-beforeåŸåˆ™æ¨å¯¼å‡ºæ¥ï¼Œé‚£ä¹ˆå®ƒä»¬å°±ä¸èƒ½ä¿è¯å®ƒä»¬çš„æœ‰åºæ€§ï¼Œè™šæ‹Ÿæœºå¯ä»¥éšæ„åœ°å¯¹å®ƒä»¬è¿›è¡Œé‡æ’åºã€‚ çº¿ç¨‹ä¸­æ–­é€šè¿‡interrupt()æ–¹æ³•å¯ä»¥ä¿®æ”¹æ ‡å¿—ä½ï¼Œç„¶åç›‘æ§æ ‡å¿—ä½çš„å˜åŒ–ä¼ºæœºé€€å‡ºçº¿ç¨‹ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œç›‘æ§æ ‡æ³¨ä½çš„å˜åŒ–æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š interrupted():é™æ€æ–¹æ³•ï¼Œè°ƒç”¨å®ƒæ—¶ï¼Œæ ‡å¿—ä½ä¼šè¢«æ¸…é™¤ã€‚è¿™æ„å‘³ç€å¦‚æœä½ è¿ç€è°ƒç”¨ä¸¤æ¬¡è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡ç»“æœè‚¯å®šæ˜¯false. isInterrupted()ï¼šéé™æ€æ–¹æ³•ï¼Œè°ƒç”¨å®ƒæ—¶ï¼Œæ ‡å¿—ä½ä¸ä¼šè¢«æ¸…é™¤ è¿˜éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯å¦‚æœè¢«ä¸­æ–­çš„çº¿ç¨‹æ˜¯è¢«wait()ç­‰æ–¹æ³•é˜»å¡çš„è¯ï¼Œæ ‡å¿—ä½ä¼šè¢«æ¸…é™¤ä¸”æŠ›å‡ºä¸€ä¸ªä¸­æ–­å¼‚å¸¸ï¼Œæˆ‘ä»¬éœ€è¦æ•è·å¼‚å¸¸è¿›è¡Œé€€å‡ºã€‚ çº¿ç¨‹çŠ¶æ€ Springæ ¸å¿ƒæ–¹æ³•Springæ˜¯å®¹å™¨ï¼Œæœ€åŸºæœ¬çš„å®¹å™¨æ˜¯BeanFactory, ç„¶åApplicationContextåˆç»§æ‰¿è‡ªå®ƒï¼Œä½†å…¶å®ä¸èƒ½è®¤ä¸ºApplicationContextæ˜¯BeanFactoryçš„å®ç°ç±»ï¼Œå› ä¸ºäº‹å®æ˜¯ApplicationContextå†…éƒ¨æŒæœ‰äº†ä¸€ä¸ªå®ä¾‹åŒ–çš„BeanFactory(DefaultListableBeanFactory). refreshæ–¹æ³•æ˜¯æ•´ä¸ªå®¹å™¨å¯åŠ¨çš„æ ¸å¿ƒã€‚æ–¹æ³•ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ï¼š obtainFreshBeanFactory(): åˆ›å»ºå®¹å™¨ï¼ŒåŠ è½½æ³¨å†ŒBean. prepareBeanFactory(): è®¾ç½®ç±»åŠ è½½å™¨ï¼Œæ·»åŠ BeanPostProcessor finishBeanFactoryInitialization(beanFactory)ï¼šåˆå§‹åŒ–æ‰€æœ‰çš„Singleton Beans createBeanInstance: å®ä¾‹åŒ–bean populateBean: å±æ€§è®¾ç½®ï¼Œå¤„ç†ä¾èµ– initializeBean: å¤„ç†å„ç§å›è°ƒ æ£€æŸ¥awareç›¸å…³æ¥å£ï¼ˆawareæ¥å£æ˜¯ä¸ºäº†è®©beanå¯ä»¥è·å–åˆ°æ¡†æ¶è‡ªèº«çš„ä¸€äº›å¯¹è±¡ï¼‰ BeanPostProcessorå‰ç½®å¤„ç† å¦‚æœå®ç°InitializeBean, è°ƒç”¨afterPropertiesSet() BeanPostProcessoråç½®å¤„ç†â€˜ BeanDefinitionæ˜¯Beanè£…è½½è¿›å®¹å™¨ä¸­çš„ä¸€ç§è¡¨ç¤ºï¼Œé‡Œé¢å…·ä½“æœ‰æ˜¯å¦æ˜¯å•ä¾‹ï¼Œå®ƒçš„ä¾èµ–ï¼Œæ˜¯å¦æ‡’åŠ è½½ï¼Œç±»åç§°ï¼Œç­‰ç­‰ã€‚ JVMJVMå†…å­˜ç»“æ„æœ¬åœ°æ–¹æ³•æ ˆ è™šæ‹Ÿæœºæ ˆ ç¨‹åºè®¡æ•°å™¨ å † æ–¹æ³•åŒº æ–¹æ³•åŒºæ˜¯ä¸€ç§è§„èŒƒï¼Œæ°¸ä¹…ä»£æ˜¯æ–¹æ³•åŒºçš„ä¸€ç§å®ç°ï¼Œjdk8ä»¥åï¼Œå»æ‰äº†æ°¸ä¹…ä»£ï¼Œç”¨å…ƒç©ºé—´ä»£æ›¿ï¼Œå…ƒç©ºé—´å­˜åœ¨äºç›´æ¥å†…å­˜ä¸­ï¼ŒåŒæ—¶æŠŠå¸¸é‡æ± æ”¾åœ¨äº†å †ä¸­ï¼Œ å¸¸è§çš„OOM å †æº¢å‡ºï¼šç–¯ç‹‚åœ°ç»™ä¸€ä¸ªlisté‡Œé¢åŠ å¯¹è±¡ è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆï¼šæ ˆçš„è¯·æ±‚æ·±åº¦å¤§äºæœ¬æ¥æ·±åº¦æ—¶ä¼šæ ˆæº¢å‡ºï¼Œæ¯”å¦‚é€’å½’æ²¡å†™base caseçš„æ—¶å€™ã€‚ç–¯ç‹‚åˆ›å»ºçº¿ç¨‹çš„æ—¶å€™ä¼šé€ æˆOOM: unable to create native thread. å¼•ç”¨å¼ºå¼•ç”¨ï¼šå¸¸è§å¼•ç”¨ è½¯å¼•ç”¨ï¼šå†…å­˜æº¢å‡ºä¹‹å‰å…ˆå›æ”¶è½¯å¼•ç”¨ï¼Œå¦‚æœå›æ”¶äº†å†…å­˜è¿˜ä¸å¤Ÿå†æŠ¥å¼‚å¸¸ã€‚ å¼±å¼•ç”¨ï¼šåªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶å‰ è™šå¼•ç”¨ï¼šå”¯ä¸€ç›®çš„å°±æ˜¯è¢«å›æ”¶æ—¶èƒ½æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚ stop the worldæšä¸¾æ ¹èŠ‚ç‚¹çš„æ—¶å€™éœ€è¦stop the world å¦‚ä½•å®ç°è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ ç»§æ‰¿ClassLoader, é‡å†™findClassæ–¹æ³•ã€‚ åƒåœ¾æ”¶é›†å™¨ serial ï¼šé‡‡ç”¨å¤åˆ¶ç®—æ³•çš„æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå•çº¿ç¨‹ï¼Œéœ€è¦stop the word ParNew: Serialçš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œé‡‡ç”¨å¤åˆ¶ç®—æ³•ã€‚ Parallel Scavenge: å¹¶è¡Œçš„å¤šçº¿ç¨‹æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œå…³æ³¨ååé‡ Serial Old: Serialçš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä½¿ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³• Parallel Old: Parallel Scavengeè€å¹´ä»£æœ¬ï¼Œä½¿ç”¨æ ‡è®°æ•´ç†ã€‚ CMSæ”¶é›†å™¨ï¼šConcurrent Mark-Sweep, å¹¶å‘æ ‡è®°æ¸…é™¤ï¼Œåˆ†ä¸ºï¼š åˆå§‹æ ‡è®°ï¼šéœ€è¦stop the world å¹¶å‘æ ‡è®°ï¼š é‡æ–°æ ‡è®° å¹¶å‘æ¸…é™¤ å®ƒæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ cpuæ•æ„Ÿï¼Œå› ä¸ºå ç”¨çº¿ç¨‹ æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ å†…å­˜ç¢ç‰‡ G1æ”¶é›†å™¨ï¼šGarbage-First, ç‰¹ç‚¹ å¹¶è¡Œä¸å¹¶å‘ åˆ†ä»£æ”¶é›† ç©ºé—´æ•´åˆï¼šæ ‡è®°æ•´ç† å¯é¢„æµ‹çš„åœé¡¿ é¿å…å…¨å †æ‰«æ Remembered Set: G1æ”¶é›†å™¨æŠŠå †åˆ†æˆè‹¥å¹²ä¸ªregion, å½“ç¨‹åºå¯¹å¼•ç”¨ç±»å‹è¿›è¡Œæ“ä½œæ—¶ï¼Œä¼šæ£€æŸ¥å…¶å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦åœ¨ä¸åŒçš„regonä¸­ï¼Œå¦‚æœåœ¨ï¼Œå°±æŠŠå¼•ç”¨ä¿¡æ¯è®°å½•åœ¨remenbered setä¸­ã€‚ CMSæ”¶é›†å™¨è®¾è®¡åŸå› ï¼šä¸ºäº†å‡å°‘åœé¡¿ä»¥åŠå’Œåº”ç”¨ç¨‹åºå¹¶è¡Œè€Œè®¾è®¡ã€‚ G1æ”¶é›†å™¨åˆ†æˆå¤§å°ç›¸åŒçš„è‹¥å¹²region young GC: edenåŒºæ»¡æ—¶ä¼šè§¦å‘ï¼Œè¿™å°±æ¶‰åŠåˆ°è¦GC Root, å› ä¸ºregionçš„åˆ’åˆ†å¯èƒ½ä¼šä½¿å¾—è€å¹´ä»£ä¹Ÿå¼•ç”¨äº†å¹´è½»ä»£çš„å¯¹è±¡ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªè·¨ä»£é—®é¢˜ï¼ŒG1ä¸­å¼•å…¥äº†Rememer Set, ç”¨æ¥è®°å½•è€å¹´ä»£çš„å“ªäº›å¯¹è±¡å¼•ç”¨äº†å®ƒã€‚ global concurrent markingï¼š åˆå§‹æ ‡è®°ï¼šstop the world, æ ‡è®°äº†ä»GC Rootå¼€å§‹ç›´æ¥å¯è¾¾çš„å¯¹è±¡ï¼ŒæœŸé—´æ‰§è¡Œä¸€æ¬¡young GC, æ ¹åŒºåŸŸæ‰«æï¼šä¸»è¦æ‰«æsurvivor, å¹¶å‘æ ‡è®°: æœ€ç»ˆæ ‡è®°: ä½¿ç”¨snapshot-at-the-beginning(SATB)å®Œæˆæœ€ç»ˆå­˜æ´»æ ‡è®° æ¸…é™¤åƒåœ¾ mixed GC:G1ä¸­çš„MIXGCé€‰å®šæ‰€æœ‰æ–°ç”Ÿä»£é‡Œçš„Regionï¼Œå¤–åŠ æ ¹æ®global concurrent markingç»Ÿè®¡å¾—å‡ºæ”¶é›†æ”¶ç›Šé«˜çš„è‹¥å¹²è€å¹´ä»£Regionï¼Œåœ¨ç”¨æˆ·æŒ‡å®šçš„å¼€é”€ç›®æ ‡èŒƒå›´å†…å°½å¯èƒ½é€‰æ‹©æ”¶ç›Šé«˜çš„è€å¹´ä»£Regionè¿›è¡Œå›æ”¶ã€‚æ‰€ä»¥MIXGCå›æ”¶çš„å†…å­˜åŒºåŸŸæ˜¯æ–°ç”Ÿä»£+è€å¹´ä»£ã€‚ å¯ä»¥å‘ç°ï¼Œglobal concurrent markingå’ŒCMSçš„è¿‡ç¨‹æ˜¯å¾ˆç±»ä¼¼çš„ï¼Œä¸åŒçš„æ˜¯G1ä¸­çš„global concurrent marking æ˜¯ä¸ºmixed GCæœåŠ¡çš„ã€‚ å’ŒCMSç›¸æ¯”çš„ä¼˜åŠ¿ï¼šæœ‰å†…å­˜æ•´ç†ï¼Œå¯é¢„æµ‹çš„åœé¡¿æ—¶é—´ã€‚ JVMå‘½ä»¤ jmap: ç”Ÿæˆå †è½¬å‚¨å¿«ç…§ã€‚ jhat: å †è½¬å‚¨å¿«ç…§åˆ†æå·¥å…·ã€‚ è‡ªå·±å®šä¹‰çš„ç±»èƒ½è¢«æœ€é¡¶çº§çš„ç±»åŠ è½½å™¨åŠ è½½å—ï¼Ÿ ä¸èƒ½ã€‚Bootstrapç±»åŠ è½½å™¨åªåŠ è½½æŒ‡å®šè·¯å¾„ä¸Šçš„ç±»ï¼Œè€Œä¸”æ˜¯æŒ‰ç…§åå­—è¯†åˆ«çš„ã€‚ æ–°ç”Ÿä»£å’Œè€å¹´ä»£æ‰€é‡‡ç”¨çš„GCç®—æ³• å¤åˆ¶ç®—æ³•ï¼Œæ ‡è®°æ¸…é™¤ç®—æ³•ã€‚ æ•°æ®ç»“æ„ å¹³è¡¡æ ‘ï¼Ÿçº¢é»‘æ ‘ï¼Ÿ å¹³è¡¡æ ‘ç›¸æ¯”äºçº¢é»‘æ ‘ï¼Œå®ƒçš„è¦æ±‚æ›´ä¸ºä¸¥æ ¼ï¼Œå®ƒè¦æ±‚æ‰€æœ‰èŠ‚ç‚¹çš„å·¦å³å­æ ‘é«˜åº¦å·®ä¸è¶…è¿‡1ï¼Œè¿™ç§ä¸¥æ ¼è¦æ±‚æ¯æ¬¡æ’å…¥æˆ–è€…åˆ é™¤åå¦‚æœä¸æ»¡è¶³æ¡ä»¶å°±è¦è¿›è¡Œæ—‹è½¬ï¼Œè€Œè¿™ä¸ªæ—‹è½¬æ˜¯å¾ˆè€—æ—¶çš„ã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼Œçº¢é»‘æ ‘é€šè¿‡èŠ‚ç‚¹ç€è‰²çš„è¦æ±‚ï¼Œçº¢é»‘æ ‘ç¡®ä¿æ²¡æœ‰ä¸€æ¡è·¯å¾„ä¼šæ¯”å…¶å®ƒè·¯å¾„é•¿å‡ºä¸¤å€ã€‚æ‰€ä»¥å¯ä»¥è®¤ä¸ºå®ƒæ˜¯ä¸€ç§å¼±å¹³è¡¡æ ‘ï¼Œè€Œä¸”ç›¸å¯¹äºAVLæ ‘ï¼Œå®ƒçš„æ—‹è½¬æ¬¡æ•°å°‘ï¼Œæ›´é€‚åˆäºé‚£ç§æ’å…¥åˆ é™¤é¢‘ç¹çš„åœºæ™¯ã€‚ TreeMapåº•å±‚å°±æ˜¯çº¢é»‘æ ‘ã€‚ MYSQLæŸ¥è¯¢è¯­å¥æµç¨‹ äº‹åŠ¡ äº‹åŠ¡çš„å››ä¸ªç‰¹æ€§ï¼šACID äº‹åŠ¡éš”ç¦»ï¼š read uncommitted:ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„å†…å®¹å¯ä»¥è¢«å¦ä¸€ä¸ªäº‹åŠ¡è¯»åˆ°ï¼Œä¼šå¯¼è‡´è„è¯»é—®é¢˜ï¼ˆæŒ‡è¯»åˆ°çš„ä¸œè¥¿ä¸å¯¹ï¼‰ã€‚ read committed: ä¸€ä¸ªäº‹åŠ¡åªæœ‰æäº¤äº†å…¶ä»–äº‹åŠ¡æ‰èƒ½è¯»åˆ°ï¼Œå¤§å¤šæ•°æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ã€‚ä¼šå¯¼è‡´ä¸å¯é‡å¤è¯»é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªäº‹åŠ¡å‰åä¸¤æ¬¡è¯»åˆ°çš„å†…å®¹å¯èƒ½ä¼šä¸ä¸€æ ·ã€‚ repeatable read: ä¸€ä¸ªäº‹åŠ¡å‰åä¸¤æ¬¡è¯»åˆ°çš„å†…å®¹æ˜¯ä¸€æ ·çš„ã€‚è¿™æ˜¯MySQLé»˜è®¤çš„éš”ç¦»çº§åˆ«ã€‚ serializable: äº‹åŠ¡ä¹‹é—´ä¸²è¡Œæ‰§è¡Œã€‚ åœ¨å®ç°ä¸Šï¼Œæ•°æ®åº“é‡Œé¢ä¼šåˆ›å»ºä¸€ä¸ªè§†å›¾ï¼Œè®¿é—®çš„æ—¶å€™ä»¥è§†å›¾çš„é€»è¾‘ç»“æœä¸ºå‡†ã€‚åœ¨â€œå¯é‡å¤è¯»â€éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¿™ä¸ªè§†å›¾æ˜¯åœ¨äº‹åŠ¡å¯åŠ¨æ—¶åˆ›å»ºçš„ï¼Œæ•´ä¸ªäº‹åŠ¡å­˜åœ¨æœŸé—´éƒ½ç”¨è¿™ä¸ªè§†å›¾ã€‚åœ¨â€œè¯»æäº¤â€éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¿™ä¸ªè§†å›¾æ˜¯åœ¨æ¯ä¸ª SQL è¯­å¥å¼€å§‹æ‰§è¡Œçš„æ—¶å€™åˆ›å»ºçš„ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œâ€œè¯»æœªæäº¤â€éš”ç¦»çº§åˆ«ä¸‹ç›´æ¥è¿”å›è®°å½•ä¸Šçš„æœ€æ–°å€¼ï¼Œæ²¡æœ‰è§†å›¾æ¦‚å¿µï¼›è€Œâ€œä¸²è¡ŒåŒ–â€éš”ç¦»çº§åˆ«ä¸‹ç›´æ¥ç”¨åŠ é”çš„æ–¹å¼æ¥é¿å…å¹¶è¡Œè®¿é—®ã€‚ mysql redo log å’Œ bin log undo log redo logæ˜¯innodbå¼•æ“æ‰€æœ‰ã€‚binlogæ˜¯serverå±‚çš„ã€‚ redo logæ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•ç‰©ç†æ“ä½œã€‚ binlogæ˜¯é€»è¾‘æ—¥å¿—ï¼Œè®°å½•é€»è¾‘æ“ä½œã€‚ redo logå¾ªç¯å†™ã€‚ binlogè¿½åŠ å†™ã€‚ undo logä¸»è¦æ˜¯ä¸ºäº†ä¿è¯åŸå­æ€§ï¼Œç”¨åœ¨MVCCä¸­çš„ MySQLè¡Œé”ï¼Œè¡¨é” è¡Œé”æœ‰ä¸‰ç§ç®—æ³•ï¼š è®°å½•é”: é”çš„æ˜¯ç´¢å¼• gap lock next-key lock MySQL innodbå¦‚ä½•è§£å†³å¹»è¯» MVCC + next-key lock MySQLä¸»ä»å¤åˆ¶ Slaveä¸Šé¢çš„IOè¿›ç¨‹è¿ä¸ŠMater,è¯·æ±‚è¯»å–binlogçš„å†…å®¹ï¼Œ Slaveæ”¶åˆ°ä¿¡æ¯åï¼Œè¿½åŠ åˆ°relay-logä¸­ Slaveçš„SQLè¿›ç¨‹æ£€æŸ¥åˆ°relay-logçš„å˜åŒ–åï¼Œæ‰§è¡Œrelay Logä¸­çš„å†…å®¹ã€‚ æ•°æ®åº“èŒƒå¼ ç¬¬ä¸€èŒƒå¼ï¼šæ²¡æœ‰é‡å¤åˆ— ç¬¬äºŒèŒƒå¼ï¼šéä¸»å±æ€§å®Œå…¨ä¾èµ–äºä¸»å±æ€§ï¼ˆæ¶ˆé™¤éƒ¨åˆ†å­å‡½æ•°ä¾èµ–ï¼‰ ç¬¬ä¸‰èŒƒå¼ï¼šå±æ€§ä¸ä¾èµ–äºå…¶ä»–éä¸»å±æ€§ï¼ˆæ¶ˆé™¤ä¼ é€’ä¾èµ–ï¼‰ã€ åˆ†åº“åˆ†è¡¨çš„ç†è§£ åˆ†è¡¨å¯ä»¥è§£å†³å•è¡¨å‹åŠ›ï¼Œä½†æ˜¯æ•´ä½“æ•°æ®åº“çš„å‹åŠ›è¿˜åœ¨ï¼Œæ‰€ä»¥å°±å¯ä»¥è€ƒè™‘åˆ†åº“äº†ï¼šæŠŠä¸€äº›è¡¨æ”¾åˆ°æ–°çš„æ•°æ®åº“é‡Œ æ„å‘é” é¦–å…ˆè¦æ˜ç¡®ä¸€ç‚¹ï¼Œæ„å‘é”æ˜¯è¡¨çº§é”ï¼Œå®ƒçš„å‡ºç°ä¸»è¦æ˜¯ä¸ºäº†æå‡åŠ é”åˆ¤æ–­æ—¶çš„æ€§èƒ½ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œäº‹åŠ¡Aç»™è¡¨ä¸­æŸè¡ŒåŠ äº†å…±äº«é”ï¼Œè¿™æ—¶å€™äº‹åŠ¡Bæƒ³ç»™è¡¨åŠ ä¸ªè¡¨é”ï¼Œé‚£ä¹ˆå®ƒå°±å¾—çŸ¥é“èƒ½ä¸èƒ½åŠ ï¼Œå¦‚æœæ²¡æœ‰æ„å‘é”ï¼Œé‚£ä¹ˆè¿™ä¸ªåˆ¤æ–­å°±è¦é€è¡Œè¿›è¡Œäº†ã€‚ è€Œæœ‰äº†æ„å‘é”åï¼Œäº‹æƒ…ä¼šå˜æˆè¿™æ ·ï¼šäº‹åŠ¡AåŠ å…±äº«é”è¡Œé”çš„æ—¶å€™ï¼Œæ•°æ®åº“ä¼šå…ˆç»™è¡¨åŠ ä¸ªæ„å‘å…±äº«é”ï¼Œæ„æ€å°±æ˜¯å‘Šè¯‰åˆ«çš„äº‹åŠ¡ï¼Œè¿™ä¸ªè¡¨é‡Œæœ‰è¢«åŠ äº†å…±äº«è¡Œé”ï¼Œé‚£ä¹ˆè¿™æ—¶å€™å½“åˆ«çš„äº‹åŠ¡æƒ³ç»™è¿™ä¸ªè¡¨åŠ æ’ä»–é”è¡¨é”çš„æ—¶å€™ï¼Œä¸€æ£€æŸ¥å‘ç°æœ‰ä¸ªå…±äº«æ„å‘é”ï¼Œå°±çŸ¥é“è¿™ä¸ªæ’ä»–é”è¡¨é”ä¸èƒ½åŠ äº†ã€‚ Redisredisä¸€æ¬¡é€šä¿¡è¿‡ç¨‹ memcachedåŒºåˆ«ï¼Ÿ æ•°æ®ç±»å‹ äº‹åŠ¡ multiå¼€å¯äº‹åŠ¡ execæäº¤äº‹åŠ¡ discardä¸¢å¼ƒäº‹åŠ¡ watch: æä¾›ç±»ä¼¼CASçš„ä½œç”¨ï¼Œå½“è¢«ç›‘è§†çš„å€¼è¢«å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹æ—¶ï¼Œæ•´ä¸ªäº‹åŠ¡ä¼šå¤±è´¥ã€‚å¦‚æœç›‘æ§çš„è¿™ä¸ªå€¼è¿‡æœŸäº†ï¼Œexecæ­£å¸¸å·¥ä½œã€‚ 123456WATCH mykeyval = GET mykeyval = val + 1MULTISET mykey $valEXEC æŒä¹…åŒ– redisæ”¯æŒçš„æ•°æ®ç±»å‹æ›´ä¸ºä¸°å¯Œï¼šæœ‰string, list, set, hash, sorted set, è€Œmemcachedæ”¯æŒçš„æ•°æ®ç±»å‹æ¯”è¾ƒç®€å•ï¼Œå¯¹äºå¤æ‚ç±»å‹éœ€è¦è‡ªå·±åœ¨å®¢æˆ·ç«¯è¿›è¡Œæ”¯æŒã€‚ redisæ”¯æŒä¸»ä»å¤åˆ¶æ¨¡å¼ï¼Œè€Œmemcachedçš„æœåŠ¡å™¨ä¹‹é—´æ˜¯æ²¡æœ‰å…³ç³»çš„ï¼Œéœ€è¦å®¢æˆ·ç«¯å»åšä¸€è‡´æ€§hashå¤„ç†ï¼Œè¿™æ ·åšçš„ä¸€ä¸ªåæœæ˜¯é›†ç¾¤æ‰©å±•æ—¶å¯èƒ½å¯¼è‡´å¤§é‡ç¼“å­˜å¤±æ•ˆã€‚ redisæ˜¯å•çº¿ç¨‹çš„ï¼Œmemachedæ˜¯å¤šçº¿ç¨‹çš„ã€‚ redisä¸­å¯ä»¥é€šè¿‡multiï¼Œexecï¼Œdiscardç­‰å‘½ä»¤å¼€å¯äº‹åŠ¡ï¼Œ2.6ä»¥åè¿˜æ”¯æŒluaè„šæœ¬ï¼Œè€Œmemcachedé™¤äº†ä¸€äº›åƒincrement/decrementè¿™æ ·çš„åŸå­æ“ä½œï¼Œæ˜¯ä¸æ”¯æŒäº‹åŠ¡çš„ã€‚ redisæ”¯æŒRDBå’ŒAOFä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼Œè€Œmemcachedæœ¬èº«æ˜¯ä¸æ”¯æŒæŒä¹…åŒ–çš„ï¼Œä½†æ˜¯æœ‰ä¸€äº›åŸºäºmemcachedåè®®çš„é¡¹ç›®æ”¯æŒæŒä¹…åŒ–ã€‚ æ€»ç»“ï¼Œä»æ•°æ®ç±»å‹çš„è§’åº¦è€ƒè™‘ï¼Œä»äº‹åŠ¡çš„è§’åº¦è€ƒè™‘ï¼Œä»æŒä¹…åŒ–çš„è§’åº¦è€ƒè™‘ã€‚å‚è€ƒï¼šhttps://www.jianshu.com/p/e94fa7340923 redisåˆ†å¸ƒå¼é” redisåšåˆ†å¸ƒå¼é”ä¸»è¦æ˜¯å®ç°ä½œä¸ºé”çš„ä¸€ç§äº’æ–¥çš„åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯è¯´ç»™AåŠ äº†å°±ä¸èƒ½ç»™BåŠ ï¼Œå°±åƒä¸€ä¸ªå¼€å…³ä¸€æ ·ï¼Œè¦ä¹ˆæœå¼€é‚£è¾¹ï¼Œè¦ä¹ˆæœå…³é‚£è¾¹ã€‚å®ç°è¿™ä¸€åŠŸèƒ½çš„å‘½ä»¤æ˜¯setnx, æ„æ€æ˜¯set if not exist, setnx key valueï¼Œå½“keyä¸å­˜åœ¨çš„æ—¶å€™è®¾ç½®valueæˆåŠŸï¼Œkeyå­˜åœ¨çš„æ—¶å€™ä¸åšåŠ¨ä½œã€‚åˆ©ç”¨è¿™ä¸ªsetnxå°±å¯ä»¥å¾ˆç”ŸåŠ¨çš„ç»™å¤šä¸ªæœåŠ¡åŠ é”ï¼Œè¿˜éœ€è¦å†åŠ ä¸Šä¸€ä¸ªexpireå‘½ä»¤ï¼Œé˜²æ­¢redisçªç„¶æ‰ç”µå¯¼è‡´é”ä¸é‡Šæ”¾ã€‚ä½†è¿™ä¹ˆåšä¹Ÿæœ‰ä¸ªé—®é¢˜ï¼Œä¸‡ä¸€redisåœ¨æ‰§è¡Œäº†setnxä¹‹åä½†æ˜¯åœ¨æ‰§è¡Œexpireä¹‹å‰æ‰ç”µæ€ä¹ˆåŠï¼Ÿå…¶å®æ˜¯å¯ä»¥æŠŠè¿™ä¸¤æ¡å‘½ä»¤åˆæˆä¸€æ¡çš„ã€‚ redis KEYSå‘½ä»¤å’ŒSCANå‘½ä»¤çš„åŒºåˆ« scanæ”¯æŒå¢é‡å¼è¿­ä»£ï¼Œ å®ƒä»¬æ¯æ¬¡æ‰§è¡Œéƒ½åªä¼šè¿”å›å°‘é‡å…ƒç´ ï¼Œ æ‰€ä»¥è¿™äº›å‘½ä»¤å¯ä»¥ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œ è€Œä¸ä¼šå‡ºç°åƒ KEYS å‘½ä»¤ã€ SMEMBERS å‘½ä»¤å¸¦æ¥çš„é—®é¢˜ â€”â€” å½“ KEYS å‘½ä»¤è¢«ç”¨äºå¤„ç†ä¸€ä¸ªå¤§çš„æ•°æ®åº“æ—¶ï¼Œ åˆæˆ–è€… SMEMBERS å‘½ä»¤è¢«ç”¨äºå¤„ç†ä¸€ä¸ªå¤§çš„é›†åˆé”®æ—¶ï¼Œ å®ƒä»¬å¯èƒ½ä¼šé˜»å¡æœåŠ¡å™¨è¾¾æ•°ç§’ä¹‹ä¹…ã€‚ ä¸è¿‡ï¼Œ å¢é‡å¼è¿­ä»£å‘½ä»¤ä¹Ÿä¸æ˜¯æ²¡æœ‰ç¼ºç‚¹çš„ï¼š ä¸¾ä¸ªä¾‹å­ï¼Œ ä½¿ç”¨ SMEMBERS å‘½ä»¤å¯ä»¥è¿”å›é›†åˆé”®å½“å‰åŒ…å«çš„æ‰€æœ‰å…ƒç´ ï¼Œ ä½†æ˜¯å¯¹äº SCAN è¿™ç±»å¢é‡å¼è¿­ä»£å‘½ä»¤æ¥è¯´ï¼Œ å› ä¸ºåœ¨å¯¹é”®è¿›è¡Œå¢é‡å¼è¿­ä»£çš„è¿‡ç¨‹ä¸­ï¼Œ é”®å¯èƒ½ä¼šè¢«ä¿®æ”¹ï¼Œ æ‰€ä»¥å¢é‡å¼è¿­ä»£å‘½ä»¤åªèƒ½å¯¹è¢«è¿”å›çš„å…ƒç´ æä¾›æœ‰é™çš„ä¿è¯ redisè¿‡æœŸç­–ç•¥ï¼Œå†…å­˜æ·˜æ±°ç­–ç•¥è¿‡æœŸç­–ç•¥ï¼š å®šæ—¶è¿‡æœŸï¼šå†…å­˜å‹å¥½ï¼Œä½†æ˜¯ä¼šå ç”¨å¤§é‡CPUå¤„ç†è¿‡æœŸèµ„æº æƒ°æ€§è¿‡æœŸï¼šèŠ‚çœCPU,å†…å­˜ä¸å‹å¥½ å®šæœŸè¿‡æœŸï¼šè¿™ç§æ–¹æ¡ˆ å†…å­˜æ·˜æ±° noeviction allkeys-lruï¼šä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é‡Œé¢é€‰ allkeys-random volatile-lru volatile-random volatile-ttl redisæŒä¹…åŒ–åŸç†ï¼Ÿ RDBå…¨é‡æŒä¹…åŒ– saveå‘½ä»¤ï¼šä»¥é˜»å¡æ–¹å¼å…¨é‡æŒä¹…åŒ– bgsave: forkä¸€ä¸ªå­è¿›ç¨‹åšæŒä¹…åŒ– ä¼˜ç‚¹ï¼šæ–‡ä»¶å°ï¼Œæ¢å¤å¿«ï¼Œå­è¿›ç¨‹åšå¤‡ä»½ï¼Œä¸å½±å“æ€§èƒ½ ç¼ºç‚¹ï¼šéš”ä¸€æ®µæ—¶é—´åŒæ­¥ä¸€æ¬¡ï¼Œä¼šæœ‰æ•°æ®ä¸¢å¤± AOFåšå¢é‡æŒä¹…åŒ– ä¼˜ç‚¹:å®‰å…¨æ€§é«˜ï¼Œæœ€å¤šä¸¢å¤±ä¸€ç§’ ç¼ºç‚¹ï¼šæ–‡ä»¶ä½“ç§¯å¤§ï¼Œæ¢å¤æ…¢ redis stringçš„å®ç°ä½¿ç”¨ä¸€ç§å«åšç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSimple Dynamic Stringï¼ŒSDSï¼‰çš„æ•°æ®ç»“æ„ï¼Œè¿™ä¸ªæ•°æ®ç»“æ„é‡Œè®°å½•äº†å­—ç¬¦ä¸²å·²ä½¿ç”¨çš„é•¿åº¦ï¼Œä¸ºä½¿ç”¨çš„é•¿åº¦ï¼Œé€šè¿‡åŠ¨æ€çš„æ‰©å±•ä¸ç¼©å‡é•¿åº¦ï¼Œæ¥æå‡æ€§èƒ½ã€‚ redisäº‹åŠ¡redisäº‹åŠ¡å‘½ä»¤å¯ä»¥å°†å¤šä¸ªå‘½ä»¤æ‰“åŒ…ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å…¶ä¸­æœ‰ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œå¤±è´¥çš„è¯å…¶ä»–å‘½ä»¤ä¼šç»§ç»­æ‰§è¡Œï¼Œæ²¡æœ‰å›æ»šã€‚ ç¼“å­˜é›ªå´© ç¼“å­˜é›ªå´©ï¼šæŒ‡çš„æ˜¯ç¼“å­˜å¤§é¢ç§¯å¤±æ•ˆï¼Œæ‰€æœ‰è¯·æ±‚ä¸€ä¸‹å­éƒ½æ‰“åˆ°æ•°æ®åº“çš„æƒ…å†µã€‚ è§£å†³ï¼šå¯ä»¥ç»™å¤±æ•ˆæ—¶é—´åŠ ä¸ªéšæœºæ•°ã€‚ ç¼“å­˜ç©¿é€ï¼šæŒ‡çš„æ˜¯ç¼“å­˜æ²¡æœ‰ï¼Œæ•°æ®åº“ä¹Ÿæ²¡æœ‰ï¼Œç›´æ¥æ‰“ç©¿ è§£å†³ï¼šå¯¹è¯·æ±‚è¿›è¡Œæ ¡éªŒï¼›å¸ƒéš†è¿‡æ»¤ï¼ˆç”¨äºéªŒè¯ä¸€ä¸ªæ•°æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼‰ã€‚ ç¼“å­˜å‡»ç©¿ï¼šæ‰€æœ‰çš„è¯·æ±‚éƒ½é›†ä¸­åœ¨ä¸€ä¸ªçƒ­ç‚¹keyä¸Šï¼Œè€Œè¿™ä¸ªkeyæ°å¥½åˆšåˆšå¤±æ•ˆã€‚ è§£å†³ï¼šè®¾ç½®çƒ­ç‚¹keyæ°¸ä¸è¿‡æœŸ å­—å…¸è®¾è®¡åŸç†å­—å…¸åº•å±‚å…¶å®å°±æ˜¯ä¸ªå“ˆå¸Œè¡¨ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯å®ƒæœ‰ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Œé€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬åªç”¨ä¸€ä¸ªï¼Œåªæœ‰åœ¨rehashçš„æ—¶å€™æ‰ä¼šå¯ç”¨å¦ä¸€ä¸ªã€‚é‚£ä½•æ—¶è¿›è¡Œrehash? å½“é”®å€¼å¯¹å¤ªå¤šæˆ–è€…å¤ªå°‘çš„æ—¶å€™å°±ä¼šå¯¹å“ˆå¸Œè¡¨è¿›è¡Œæ‰©å¼ æˆ–è€…æ”¶ç¼©ã€‚é‚£å…·ä½“ä½•æ—¶ï¼Œå…·ä½“å¦‚ä½•ï¼Ÿè¯·çœ‹ä¸‹ä¸€èŠ‚ã€‚ æ¸è¿›å¼rehash ä½•æ—¶rehash æœåŠ¡å™¨ç›®å‰æ²¡æœ‰åœ¨æ‰§è¡Œ BGSAVE å‘½ä»¤æˆ–è€… BGREWRITEAOF å‘½ä»¤ï¼Œ å¹¶ä¸”å“ˆå¸Œè¡¨çš„è´Ÿè½½å› å­å¤§äºç­‰äº 1 ï¼› æœåŠ¡å™¨ç›®å‰æ­£åœ¨æ‰§è¡Œ BGSAVE å‘½ä»¤æˆ–è€… BGREWRITEAOF å‘½ä»¤ï¼Œ å¹¶ä¸”å“ˆå¸Œè¡¨çš„è´Ÿè½½å› å­å¤§äºç­‰äº 5 ï¼› ä¸ºä½•è¦æ¸è¿› æ•°æ®é‡å¤ªå¤§çš„è¯ä¼šé˜»å¡æœåŠ¡å™¨å¾ˆä¹… å¦‚ä½•æ¸è¿› å­—å…¸çš„æ•°æ®ç»“æ„é‡Œæœ‰ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Œé€šå¸¸æƒ…å†µä¸‹åªç”¨ä¸€ä¸ªï¼Œåªæœ‰rehashçš„æ—¶å€™æ‰ä¼šç”¨åˆ°å¦ä¸€ä¸ªï¼Œé€šè¿‡rehashidxçš„æ ‡è®°æ¥ä¸€ç‚¹ä¸€ç‚¹çš„rehash, åœ¨è¿™è¿‡ç¨‹ä¸­é‡è§å¢åŠ åˆ™å¢åŠ åˆ°æ–°çš„ä¸Šé¢ï¼Œåˆ é™¤åˆ™ä¾æ¬¡å¯»æ‰¾åˆ é™¤ï¼Œæ›´æ–°ä¹Ÿæ˜¯ä»¥æ­¤å¯»æ‰¾ã€‚ è´Ÿè½½å› å­ï¼šused/size redisä¸»ä»åŒæ­¥ â€‹ ä¸€ä¸»å¤šä»ï¼Œä¸»å†™ä»è¯»ã€‚ä¸€å¼€å§‹ä»ä¼šç»™ä¸»å‘ä¸€ä¸ªpsyncå‘½ä»¤ï¼Œç„¶å ä¸»èŠ‚ç‚¹åšä¸€æ¬¡bgsave, ç„¶ååç»­æ“ä½œå­˜åœ¨bufferä¸­ï¼Œbgsaveå®Œæˆåå°†RDBæ–‡ä»¶å‘ç»™ä»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹å°†å…¶åŠ è½½è¿›å†…å­˜ã€‚åŠ è½½å®Œæˆåå†é€šçŸ¥ä¸»èŠ‚ç‚¹æŠŠæœŸé—´bufferå†…å®¹å‘è¿‡æ¥è¿›è¡ŒåŒæ­¥ï¼Œæ­¤åä¸»èŠ‚ç‚¹çš„æ¯æ¬¡å†™æ“ä½œéƒ½ä¼šåŒæ­¥ç»™ä»èŠ‚ç‚¹ã€‚ ç»è¿‡è¿™ä¹ˆä¸€æ³¢æ“ä½œï¼Œä¸»ä»å°±åŒæ­¥äº†ï¼Œä½†æ˜¯ç»†å¿ƒçš„åŒå­¦å¯èƒ½ä¼šå‘ç°ï¼Œä¸‡ä¸€åé¢åˆæœ‰å‘½ä»¤æ“ä½œä¸»æœåŠ¡å™¨å‘¢ï¼Ÿè¿™æ—¶å€™å°±æ¶‰åŠåˆ°å‘½ä»¤ä¼ æ’­äº†ï¼Œå°±æ˜¯è¯´åç»­æ¯ä¸ªä¿®æ”¹å‘½ä»¤ï¼Œæˆ‘ä»¬éƒ½åŒæ—¶ä¹Ÿè®©ä»æœåŠ¡å™¨æ‰§è¡Œä»¥ä¸‹ï¼Œå°±okäº†ã€‚ åŒå†™ä¸€è‡´æ€§å…ˆåˆ ç¼“å­˜å†æ›´æ–°æ•°æ®åº“ ä¹Ÿä¼šæœ‰é—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨å»¶æ—¶åŒåˆ ç­–ç•¥ï¼Œå°±æ˜¯è¯´è¿‡ä¸€ä¼šå„¿å›æ¥æŠŠè„ç¼“å­˜å†åˆ ä¸€æ¬¡ æˆ–è€…ä¸¥æ ¼ç‚¹ï¼šä¸²è¡ŒåŒ–ã€‚ SDSè®¾è®¡åŸç†ä¸ºä»€ä¹ˆç”¨åŠ¨æ€å­—ç¬¦ä¸²ï¼Ÿåè¿‡æ¥è®²ï¼Œç”¨å›ºå®šå­—ç¬¦æ•°ç»„æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ è·å–æ•°ç»„é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦ å­—ç¬¦ä¸²appendçš„æ—¶å€™ä¼šä¸ä¼šæº¢å‡ºï¼Ÿ SDSæ¯”è¾ƒé¸¡è´¼çš„åœ°æ–¹å°±åœ¨äºå®ƒæ˜¯æœ‰é¢„ç•™ç©ºé—´çš„ï¼Œæ¯æ¬¡ä¿®æ”¹å­—ç¬¦ä¸²åä¼šå¤šåˆ†é…å’Œå½“å‰å­—ç¬¦ä¸²é•¿åº¦ä¸€æ ·çš„ç©ºé—²ç©ºé—´ã€‚ å‡å¦‚æˆ‘è¦åšä¸€ä¸ªæ‹¼æ¥çš„æ“ä½œï¼Œé¦–å…ˆæ£€æŸ¥ç©ºé—²é•¿åº¦å¤Ÿä¸å¤Ÿï¼Œå¦‚æœä¸å¤Ÿï¼Œæˆ‘å…ˆæ‰©å®¹åˆ°æ‰€éœ€è¦çš„é•¿åº¦ï¼Œç„¶åæ‹¼æ¥ï¼Œä½ ä»¥ä¸ºè¿™å°±å®Œäº†å—ï¼Œå¹¶æ²¡æœ‰ï¼Œæ‹¼æ¥å®Œäº†ä¹‹åï¼Œè¿˜ä¼šç»™åˆ†é…ä¸€ä¸ªç­‰é‡çš„ç©ºé—²ç©ºé—´ï¼Œä»¥å¤‡ä¸æ—¶ä¹‹éœ€ã€‚ RDBåŸç† pipelinedå¥½å¤„ ä½¿å¾—å¤šæ¬¡IOæ—¶é—´æŠ˜åˆæˆä¸€æ¬¡ã€‚ rediså“¨å…µï¼Ÿ é€šè¿‡ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹è¿è¡Œå“¨å…µï¼Œå¯¹ä¸»ä»èŠ‚ç‚¹è¿›è¡Œç›‘è§†ï¼Œå½“ä¸»èŠ‚ç‚¹downæ‰ä¹‹åä¼šä¸»åŠ¨å°†ä»èŠ‚ç‚¹å‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œç„¶åé€šè¿‡å‘å¸ƒè®¢é˜…æ¨¡å¼åŒæ—¶å…¶ä»–ä»èŠ‚ç‚¹ä¿®æ”¹é…ç½®ã€‚ æ‰‹å†™LRU ç»§æ‰¿LinkedHashMap, é‡å†™å®ƒçš„removeEldestEntry()æ–¹æ³• ã€ã€ ä¸€è‡´æ€§å“ˆå¸Œ &gt; å“ˆå¸Œçš„æ•´ä¸ªå€¼ç©ºé—´æ˜¯ä¸€ä¸ªåœ†ï¼ŒæŠŠæœåŠ¡å™¨æŒ‰ç…§å“ˆå¸Œç®—æ³•æ˜ å°„åˆ°åœ†ä¸Šï¼ŒæŠŠæ•°æ®ä¹Ÿæ˜ å°„åˆ°åœ†ä¸Šï¼Œæ¯ä¸ªæ•°æ®å¯¹åº”çš„æœåŠ¡å™¨å°±æ˜¯ä»å®ƒæ‰€åœ¨ä½ç½®å‘å‰èµ°èƒ½èµ°åˆ°çš„é‚£ä¸ªæœåŠ¡å™¨ã€‚ &gt; &gt; å®ƒçš„å¥½å¤„æ˜¯æ–°å¢å’Œdownæ‰æœåŠ¡å™¨å¯¹æ•´ä½“æ•°æ®çš„å½±å“è¾ƒå°ï¼Œ &gt; &gt; åå¤„æ˜¯æœåŠ¡å™¨æ•°é‡æå°‘çš„æ—¶å€™å¯èƒ½ä¼šå¯¼è‡´æ•°æ®åˆ†å¸ƒä¸å‡åŒ€ã€‚ï¼ˆå¯ä»¥é€šè¿‡æ·»åŠ ä¸€äº›è™šæ‹ŸèŠ‚ç‚¹æ¥è§£å†³ï¼‰ æ“ä½œç³»ç»Ÿ ä¿¡å·é‡ ä¿¡å·é‡æ˜¯ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œé€šè¿‡pvæ“ä½œæ¥å®ç°äº’æ–¥èµ„æºçš„è®¿é—®ï¼Œä¹Ÿå°±æ˜¯wait å’Œ signalï¼Œä½†æ˜¯è¦æ³¨æ„pæ“ä½œå’Œvæ“ä½œæ˜¯ä¸¤ä¸ªæ“ä½œç³»ç»ŸåŸè¯­ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬æ˜¯å…·æœ‰åŸå­æ€§çš„ã€‚ æ­»é” å½¢æˆæ­»é”çš„æ¡ä»¶ï¼šäº’æ–¥è®¿é—®ï¼Œè¯·æ±‚ä¿æŒï¼Œä¸å¯å‰¥å¤ºï¼Œå¾ªç¯ç­‰å¾… è¿›ç¨‹é—´é€šä¿¡ ç®¡é“ï¼ˆpipeï¼‰,æµç®¡é“(s_pipe)å’Œæœ‰åç®¡é“ï¼ˆFIFOï¼‰ ä¿¡å·ï¼ˆsignalï¼‰ æ¶ˆæ¯é˜Ÿåˆ— å…±äº«å†…å­˜ ä¿¡å·é‡ å¥—æ¥å­—ï¼ˆsocket) è¿›ç¨‹å’Œçº¿ç¨‹ è¯´ç™½äº†ï¼Œä»–ä¿©éƒ½æ˜¯CPUå·¥ä½œæ—¶é—´æ®µçš„æè¿°ï¼Œåªä¸è¿‡ç²’åº¦ä¸åŒã€‚ CPUæ‰§è¡Œè¿›ç¨‹ï¼ŒåŒ…æ‹¬åŠ è½½ä¸Šä¸‹æ–‡ï¼Œæ‰§è¡Œä»»åŠ¡ï¼Œä¿å­˜ä¸Šä¸‹æ–‡ã€‚ çº¿ç¨‹æ˜¯å¯¹è¿›ç¨‹æ›´å°çš„åˆ’åˆ†ï¼ŒCPUæ‰§è¡Œè¿›ç¨‹ä»»åŠ¡çš„æ—¶å€™ï¼Œåˆå¯ä»¥åˆ†æˆæ‰§è¡Œè¿›ç¨‹é‡Œçš„açº¿ç¨‹ï¼Œbçº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹æ˜¯å…±äº«ä¸Šä¸‹æ–‡çš„ã€‚ select poll epoll select ä¸€ä¸ªæœ€å¤§çš„é—®é¢˜æ˜¯èƒ½å¤Ÿç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡å­˜åœ¨æœ€å¤§é™åˆ¶ï¼Œè€Œä¸”éœ€è¦éå†æ–‡ä»¶æè¿°ç¬¦æ¥è·å–å·²å°±ç»ªçš„socket pollè§£å†³äº†æ–‡ä»¶æè¿°ç¬¦æ•°é‡é™åˆ¶é—®é¢˜ selectçš„å‡ å¤§ç¼ºç‚¹ï¼š ï¼ˆ1ï¼‰æ¯æ¬¡è°ƒç”¨selectï¼Œéƒ½éœ€è¦æŠŠfdé›†åˆä»ç”¨æˆ·æ€æ‹·è´åˆ°å†…æ ¸æ€ï¼Œè¿™ä¸ªå¼€é”€åœ¨fdå¾ˆå¤šæ—¶ä¼šå¾ˆå¤§ ï¼ˆ2ï¼‰åŒæ—¶æ¯æ¬¡è°ƒç”¨selectéƒ½éœ€è¦åœ¨å†…æ ¸éå†ä¼ é€’è¿›æ¥çš„æ‰€æœ‰fdï¼Œè¿™ä¸ªå¼€é”€åœ¨fdå¾ˆå¤šæ—¶ä¹Ÿå¾ˆå¤§ ï¼ˆ3ï¼‰selectæ”¯æŒçš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡å¤ªå°äº†ï¼Œé»˜è®¤æ˜¯1024 MQä½¿ç”¨åœºæ™¯ é”€å³°ï¼Œå¼‚æ­¥ï¼Œè§£è€¦ é”€å³°åªå¾—æ˜¯ï¼Œå·¨å¤§æµé‡æ¶Œè¿›æ¥çš„æ—¶å€™ï¼Œå…ˆè®©å®ƒèµ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè€Œä¸æ˜¯ç›´æ¥æ‰“åœ¨æœåŠ¡å™¨ä¸Šã€‚ å¼‚æ­¥å¯ä¸å¯ä»¥ç”¨çº¿ç¨‹æ± åšï¼Ÿ çº¿ç¨‹æ± æ˜¯åŸºäºå†…å­˜çš„ï¼Œæ‰ç”µå°±æ²¡äº†ï¼Œè€Œä¸”è€¦åˆåº¦è¾ƒé«˜ æ¶ˆæ¯é˜Ÿåˆ—ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ æ•°æ®çš„ä¸€è‡´æ€§é—®é¢˜ï¼šé‡‡ç”¨åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³ã€‚ å¯ç”¨æ€§ï¼šä¸‡ä¸€MQçªç„¶æŒ‚æ‰å’‹æ•´ é‡å¤æ¶ˆè´¹ï¼šå¹‚ç­‰ã€‚è¿›è¡Œæ ¡éªŒ é¡ºåºæ¶ˆè´¹ï¼š æ¶ˆæ¯å †ç§¯ï¼š åˆ†å¸ƒå¼äº‹åŠ¡ä¸»è¦é€šè¿‡åŠæ¶ˆæ¯æœºåˆ¶+å›æŸ¥æ¥è§£å†³ã€‚ RocketMQçš„æ¶æ„ï¼Ÿ NameServer: ç®¡ç†å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬å¯¹topicå’Œè·¯ç”±ä¿¡æ¯çš„ç®¡ç†ã€‚ æ¯ä¸ª Broker åœ¨å¯åŠ¨çš„æ—¶å€™ä¼šåˆ° NameServer æ³¨å†Œï¼ŒProducer åœ¨å‘é€æ¶ˆæ¯å‰ä¼šæ ¹æ® Topic åˆ° NameServer è·å–åˆ° Broker çš„è·¯ç”±ä¿¡æ¯ï¼ŒConsumer ä¹Ÿä¼šå®šæ—¶è·å– Topic çš„è·¯ç”±ä¿¡æ¯ã€‚ producer: ç”Ÿäº§è€… broker:æ¶ˆæ¯ä¸­è½¬ï¼Œè´Ÿè´£å­˜å‚¨æ¶ˆæ¯ã€‚ æŠ€æœ¯é€‰å‹ é¦–å…ˆå®è§‚ä¸Šè®²ï¼Œå®šåˆ¶çš„è‚¯å®šè¦æ¯”å¼€æºçš„å¥½ï¼Œä¸»è¦çš„ä¼˜åŠ¿å¯ä»¥ä½“ç°åœ¨ï¼š å¯é æ€§ï¼šRocketMQæ”¯æŒå¼‚æ­¥/åŒæ­¥åˆ·ç›˜;å¼‚æ­¥/åŒæ­¥Replicationï¼› â€‹ Kafkaä½¿ç”¨å¼‚æ­¥åˆ·ç›˜æ–¹å¼ï¼Œå¼‚æ­¥R/åŒæ­¥eplicationã€‚ â€‹ RocketMQæ‰€æ”¯æŒçš„åŒæ­¥æ–¹å¼æå‡äº†æ•°æ®çš„å¯é æ€§ï¼Œè¿™å¯¹äºé‡‘èITå¾ˆé‡è¦ã€‚ å•æœºæ”¯æŒçš„é˜Ÿåˆ—ï¼šRocketMQå•æœºæ”¯æŒçš„é˜Ÿåˆ—æ›´å¤šï¼Œæ„å‘³ç€å¯ä»¥æœ‰æ›´å¤šçš„topic æ¶ˆè´¹å¤±è´¥é‡è¯•æœºåˆ¶ï¼šRocketMQæ”¯æŒæ¶ˆè´¹å¤±è´¥é‡è¯•ã€‚ æ¶ˆæ¯é¡ºåºæ€§ï¼šä¸€å°brokerå®•æœºåï¼ŒRocketMQæ¶ˆæ¯ä¸ä¼šä¹±åºã€‚ å®šæ—¶æ¶ˆæ¯ï¼škafkaä¸æ”¯æŒ åˆ†å¸ƒå¼äº‹åŠ¡æ¶ˆæ¯ï¼škafkaä¸æ”¯æŒã€‚ æ¶ˆæ¯æŸ¥è¯¢ï¼škafkaä¸æ”¯æŒã€‚ æ¶ˆæ¯å›æº¯ï¼škafkaæŒ‰ç…§offsetå›æº¯ï¼ŒRocketMQå¯ä»¥æŒ‰ç…§æ—¶é—´å›æº¯ã€‚ æ‰€ä»¥é˜¿é‡Œä¸ºä»€ä¹ˆè¦è‡ªç ”ï¼Ÿ é‡‘èä¸šåŠ¡å¯¹æ¶ˆæ¯çš„å¯é æ€§ï¼Œé˜Ÿåˆ—ä¸ªæ•°ç­‰å¾ˆæœ‰è¦æ±‚ã€‚ å½“ä¸šåŠ¡å¢é•¿åˆ°ä¸€å®šè§„æ¨¡ï¼Œé‡‡ç”¨å¼€æºæ–¹æ¡ˆçš„æŠ€æœ¯æˆæœ¬ä¼šå˜é«˜ã€‚ å‚è€ƒï¼šhttp://jm.taobao.org/2016/03/24/rmq-vs-kafka/ æ¶ˆè´¹æ¨¡å¼é›†ç¾¤æ¨¡å¼ï¼šä¸€ä¸ªæ¶ˆè´¹è€…å¯¹åº”ä¸€ä¸ªé˜Ÿåˆ— å¹¿æ’­æ¨¡å¼ï¼šä¸€ä¸ªæ¶ˆè´¹è€…å¯¹åº”tpoicä¸‹çš„æ‰€æœ‰é˜Ÿåˆ— é›†ç¾¤æ¨¡å¼è¿›åº¦ä¿å­˜åœ¨é˜Ÿåˆ—ä¸Šï¼Œå¹¿æ’­æ¨¡å¼ä¿å­˜åœ¨æ¶ˆè´¹è€…ä¸Šã€‚ â€‹ RocketMQæ˜¯æ¨è¿˜æ˜¯æ‹‰ éƒ½æœ‰ï¼Œä½†æ˜¯æ¨çš„æœ¬è´¨è¿˜æ˜¯æ‹‰ MQå¦‚ä½•ä¿è¯é«˜å¯ç”¨ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹ï¼ˆå¦‚ä½•ä¿è¯å¹‚ç­‰ï¼‰ï¼Œå¦‚ä½•ä¿è¯å¯é æ€§ä¼ è¾“ï¼ˆå¦‚ä½•å¤„ç†æ¶ˆæ¯ä¸¢å¤±ï¼‰ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ å¦‚æœé¡¹ç›®ä¸­ç”¨åˆ°äº†MQ, è¿™äº›é—®é¢˜è‚¯å®šè·‘ä¸äº†ï¼Œä¸‹é¢ä¸€ä¸€æ¥çœ‹ä¸‹ã€‚ é«˜å¯ç”¨ï¼šåœ¨kafkaä¸­ï¼Œä¸€ä¸ªtopicåˆ†ä¸ºå¤šä¸ªpartition, è€Œè¿™äº›partitionåˆæ˜¯æ•£è½åœ¨ä¸åŒçš„brokerä¸Šçš„ï¼Œå¹¶ä¸”æ¯ä¸ªpartitionåœ¨å…¶ä»–brokerä¸Šåˆæœ‰å¤‡ä»½ï¼Œä»¥æ­¤æ¥è¾¾åˆ°é«˜å¯ç”¨ã€‚ å¹‚ç­‰ï¼šåœ¨MQåé¢é€šè¿‡ä¸€äº›idä¹‹ç±»çš„ä¸œè¥¿åšæ ¡éªŒã€‚ å¦‚ä½•ä¿è¯å¯é ä¼ è¾“ï¼šè¨€å¤–ä¹‹æ„ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢ï¼Œé‚£ä¹ˆå°±è¦è€ƒè™‘æ¶ˆæ¯ä¼šåœ¨å“ªä¸¢äº†ã€‚ æ¶ˆè´¹ç«¯å¼„ä¸¢äº†æ•°æ®ï¼šé¦–å…ˆè¦å…³é—­è‡ªåŠ¨æäº¤offset, è¿›è¡Œæ‰‹åŠ¨æäº¤ï¼Œç„¶åè‡ªå·±åœ¨æ¶ˆè´¹ç«¯è¿™è¾¹ä¿è¯å¹‚ç­‰ã€‚ MQå¼„ä¸¢æ•°æ®ï¼šä¹Ÿæœ‰å¯èƒ½ï¼Œä¸‡ä¸€leaderæŒ‚äº†ï¼Œå…¶ä»–çš„followerè¿˜æ²¡åŒæ­¥å®Œï¼Œè¿™æ ·ä¼šå¯¼è‡´è¿™ä¸ªfollowerè¢«é€‰ä¸¾æˆleaderåï¼Œè¿˜ç¼ºäº†ç‚¹æ•°æ®ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œéœ€è¦è¿›è¡Œä¸€äº›è®¾ç½®ï¼Œæ¯”å¦‚å¿…é¡»è¦æ‰€æœ‰å‰¯æœ¬å†™å®Œï¼Œæ‰ç®—å†™æˆåŠŸï¼Œè¿˜æœ‰å°±æ˜¯è‡³å°‘è®©ä¸€ä¸ªfollowerå’Œleaderä¿æŒç´§å¯†è”ç³»ã€‚ ç”Ÿäº§è€…ï¼šæˆ‘ä»¬è¦æ±‚å¿…é¡»æ˜¯æ‰€æœ‰çš„å‰¯æœ¬ä¹Ÿå†™æˆåŠŸäº†æ‰ç®—æ˜¯å‘é€æˆåŠŸã€‚ ç½‘ç»œget poståŒºåˆ« å…ˆè¯´ç»“è®ºï¼šæ²¡æœ‰æœ¬è´¨åŒºåˆ«ï¼Œå¤§éƒ¨åˆ†æ‰€è°“çš„åŒºåˆ«å…¶å®éƒ½æ˜¯æµè§ˆå™¨æˆ–è€…æœåŠ¡å™¨çš„ä¸€äº›é™åˆ¶ã€‚ get: å‚æ•°åœ¨urlä¸­ï¼› post:å‚æ•°åœ¨è¯·æ±‚ä½“ä¸­ã€‚ ï¼ˆè¿™ä¸ªæ˜¯Httpåè®®ç”¨æ³•çš„çº¦å®šï¼‰ getæäº¤çš„æ•°æ®é•¿åº¦æœ‰é™åˆ¶ï¼Œpoståˆ™å¯ä»¥æ— é™å¤§ã€‚ï¼ˆè¿™ä¸ªæ˜¯æœåŠ¡å™¨æˆ–è€…æµè§ˆå™¨çš„åŒºåˆ«ï¼‰ postä¼šç¨å¾®å®‰å…¨ä¸€ç‚¹ï¼Œå› ä¸ºå®ƒçš„æ•°æ®åœ¨è¯·æ±‚ä½“ä¸­ã€‚ getæ˜¯å¹‚ç­‰çš„ï¼Œpostä¸æ˜¯ï¼Œæ‰€ä»¥åœ¨ç½‘é¡µå›é€€æˆ–è€…åˆ·æ–°æ—¶ï¼Œpostçš„æ•°æ®ä¼šè¢«é‡æ–°æäº¤ã€‚ å¸¸è§é”™è¯¯ç  3**:é¡µé¢é‡å®šå‘ 4**ï¼šå®¢æˆ·ç«¯é”™è¯¯ 5**:æœåŠ¡å™¨é”™è¯¯ 301ï¼šèµ„æºæ°¸ä¹…ç§»åŠ¨ã€‚302ï¼šèµ„æºä¸´æ—¶ç§»åŠ¨ cookie, session, token ä¸ºä»€ä¹ˆä¼šæœ‰cookie, session? å› ä¸ºhttpæ˜¯ä¸ªæ— çŠ¶æ€çš„åè®®ï¼Œé€šè¿‡cookieå’Œsessionçš„æ“ä½œå¯ä»¥è®©æœåŠ¡ç«¯çŸ¥é“è¯·æ±‚æ˜¯è°å‘æ¥çš„ã€‚ é‚£ä¹ˆcookie sessionæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿåœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œæ¯ä¸ªæœåŠ¡å™¨éƒ½è¦ä¿å­˜ä¸€ä»½session, å¾ˆéº»çƒ¦ï¼Œä½†æ˜¯å¦‚æœæŠŠè¿™äº›sessioné›†ä¸­æ”¾åœ¨ä¸€ä¸ªæœåŠ¡å™¨çš„è¯ï¼Œåˆæ‹…å¿ƒè¿™ä¸ªæœåŠ¡å™¨å´©äº†æ•´ä¸ªsessionå°±æ²¡äº†ã€‚ è€Œtokenå‘¢ï¼Œæ•´ä¸ªç”¨æˆ·ä¿¡æ¯éƒ½åœ¨é‡Œé¢ï¼Œè€Œä¸”æ˜¯ç»è¿‡åŠ å¯†çš„ï¼Œæ¯æ¬¡å®¢æˆ·ç«¯è®¿é—®çš„æ—¶å€™åªè¦å¸¦ç€è¿™ä¸ªtoken, æœåŠ¡ç«¯è§£å¯†ä¸€ä¸‹å°±çŸ¥é“æ¥è€…ä½•äººäº†ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œç”¨æˆ·ä¿¡æ¯æ—¢æ²¡æœ‰å­˜åœ¨å®¢æˆ·ç«¯ä¹Ÿæ²¡æœ‰å­˜åœ¨æœåŠ¡ç«¯ã€‚ Http1.0 å’Œ Http2.0åŒºåˆ«http1.0: æ¯æ¬¡è¯·æ±‚éƒ½è¦å»ºç«‹ä¸€ä¸ªTCPè¿æ¥ Head of Line Blocking: è¯·æ±‚é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªè¯·æ±‚å› ä¸ºæœåŠ¡å™¨å¿™ï¼Œå¯¼è‡´åé¢çš„è¯·æ±‚è¢«é˜»å¡ã€‚ http1.1: æ”¯æŒæŒä¹…è¿æ¥ï¼šé€šè¿‡è®¾ç½®headeré‡Œconnectionæ˜¯closeè¿˜æ˜¯keep-alive, ä¸€ä¸ªTCPè¿æ¥å¯ä»¥å‘é€å¤šä¸ªhttpè¯·æ±‚ æ”¯æŒç®¡é“ï¼šæœ¬æ¥æƒ…å†µæ˜¯å‘ä¸€ä¸ªè¯·æ±‚ï¼Œå“åº”äº†æ‰èƒ½å‘ä¸‹ä¸€ä¸ªã€‚ä½¿ç”¨ç®¡é“åå°±æŠŠå®¢æˆ·ç«¯çš„é˜Ÿåˆ—æ¬è¿åˆ°äº†æœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä¸ç”¨ç­‰è¿™ä¸ªå“åº”å°±å‘ä¸‹ä¸€ä¸ªï¼Œä½†æ˜¯æœåŠ¡ç«¯è¦æŒ‰åºå“åº”ã€‚ å¯ä»¥ä½¿ç”¨å¤šä¸ªTCPè¿æ¥å¹¶è¡Œå‘è¯·æ±‚ã€‚ http2.0 å¤šè·¯å¤ç”¨ï¼Œä¸€ä¸ªHTTPè¿æ¥å¯ä»¥å¤„ç†å¤šä¸ªè¯·æ±‚ æœåŠ¡ç«¯æ¨é€ TCPå¦‚ä½•ä¿è¯å¯é è¿æ¥ ä¸‰æ¬¡æ¡æ‰‹ï¼Œå››æ¬¡æŒ¥æ‰‹ è¿ç»­ARQ(å›é€€Nï¼Œè¶…æ—¶é‡ä¼ ï¼‰ä¿è¯æ•°æ®ä¼ è¾“çš„æ­£ç¡®æ€§ï¼Œæ»‘åŠ¨çª—å£è¿›è¡Œæµé‡æ§åˆ¶ æ‹¥å¡æ§åˆ¶ï¼šæ…¢å¼€å§‹ï¼Œæ‹¥å¡é¿å…ï¼Œå¿«é‡ä¼ ï¼Œå¿«æ¢å¤ æ•°æ®åˆç†åˆ†ç‰‡å’Œæ’åº UDPä¼˜ç‚¹ UDPæ˜¯ä¸€ç§å°½åŠ›è€Œä¸ºçš„ä¼ è¾“åè®®ï¼Œå®ƒåªæ˜¯æŠ¥æ–‡çš„æ¬è¿å·¥ï¼Œä¸åšæ‹¼æ¥ï¼Œä¸åšæ‹†åˆ†ï¼Œåº”ç”¨å±‚ä¸‹æ¥çš„æŠ¥æ–‡åŠ ä¸ªipå¤´å°±ç›´æ¥ç”©åˆ°ä¸‹ä¸€å±‚ï¼Œä»–æ²¡æœ‰ä»€ä¹ˆæ‹¥å¡æ§åˆ¶ï¼Œæƒ³æ³•å°±å‘ï¼Œæ‰€ä»¥è¯´æ˜¯ä¸€ç§å°½åŠ›è€Œä¸ºï¼Œæ‰€ä»¥å®ƒé€‚ç”¨äºé‚£äº›å®æ—¶æ€§æ¯”è¾ƒé«˜çš„åœºæ™¯ã€‚ TCPä¸ºä½•è¢«ç§°ä¸ºæµåè®® è¯´åˆ°æµåè®®ï¼Œæˆ‘è§‰å’Œå’Œç²˜åŒ…æ‹†åŒ…æ˜¯æœ‰å…³ç³»çš„ï¼Œå‘é€ç«¯å‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œä¼šæŠŠå‡ ä¸ªå°åŒ…åˆæˆä¸€ä¸ªå¤§åŒ…å»å‘é€ï¼Œåœ¨æ¥æ”¶ç«¯åˆæœ‰è‡ªå·±çš„ç¼“å­˜ï¼Œå¦‚æœå–æ•°æ®ä¸å¤Ÿå¿«çš„è¯ï¼Œç¼“å­˜é‡Œå°±ä¼šè¿ç€å­˜æ”¾å¥½å‡ ä¸ªæ•°æ®åŒ…ã€‚ UDPä¸ºä½•æ²¡æœ‰ç²˜åŒ… å› ä¸ºUDPå‘é€ç«¯æ²¡æœ‰é‡‡ç”¨ä¼˜åŒ–ç®—æ³•ï¼Œè€Œä¸”æ¥æ”¶ç«¯çš„ç¼“å†²åŒºæ˜¯é“¾å¼ç»“æ„ã€‚ OSIä¸ƒå±‚æ¨¡å‹ ####TCPæ‹¥å¡æ§åˆ¶ æ»¡å¼€å§‹ï¼Œæ‹¥å¡é¿å…ï¼Œ å¿«é‡ä¼ ï¼šå¿«é‡ä¼ è¦æ±‚æ¥æ”¶æ–¹åœ¨æ”¶åˆ°ä¸€ä¸ªå¤±åºçš„æŠ¥æ–‡æ®µåå°±ç«‹å³å‘å‡ºé‡å¤ç¡®è®¤ï¼Œå‘é€æ–¹åªè¦ä¸€è¿æ”¶åˆ°ä¸‰ä¸ªé‡å¤ç¡®è®¤å°±åº”å½“ç«‹å³é‡ä¼ å¯¹æ–¹å°šæœªæ”¶åˆ°çš„æŠ¥æ–‡æ®µ å¿«æ¢å¤ï¼šå½“å‘é€æ–¹è¿ç»­æ”¶åˆ°ä¸‰ä¸ªé‡å¤ç¡®è®¤æ—¶ï¼Œå°±æ‰§è¡Œâ€œä¹˜æ³•å‡å°â€ç®—æ³•ï¼ŒæŠŠssthreshé—¨é™å‡åŠï¼ˆä¸ºäº†é¢„é˜²ç½‘ç»œå‘ç”Ÿæ‹¥å¡ï¼‰ã€‚ä½†æ˜¯æ¥ä¸‹å»å¹¶ä¸æ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•è€ƒè™‘åˆ°å¦‚æœç½‘ç»œå‡ºç°æ‹¥å¡çš„è¯å°±ä¸ä¼šæ”¶åˆ°å¥½å‡ ä¸ªé‡å¤çš„ç¡®è®¤ï¼Œæ‰€ä»¥å‘é€æ–¹ç°åœ¨è®¤ä¸ºç½‘ç»œå¯èƒ½æ²¡æœ‰å‡ºç°æ‹¥å¡ã€‚æ‰€ä»¥æ­¤æ—¶ä¸æ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•ï¼Œè€Œæ˜¯å°†cwndè®¾ç½®ä¸ºssthreshå‡åŠåçš„å€¼ï¼Œç„¶åæ‰§è¡Œæ‹¥å¡é¿å…ç®—æ³•ï¼Œä½¿cwndç¼“æ…¢å¢å¤§ â€‹ ä¸‰æ¬¡æ¡æ‰‹ httpæŠ¥æ–‡ç»“æ„è¯·æ±‚æŠ¥æ–‡ï¼š è¯·æ±‚è¡Œï¼Œè¯·æ±‚å¤´ï¼Œç©ºè¡Œï¼Œè¯·æ±‚ä½“ã€‚ å“åº”æŠ¥æ–‡ï¼šçŠ¶æ€è¡Œï¼Œå“åº”å¤´ï¼Œç©ºè¡Œï¼Œå“åº”æ­£æ–‡ã€‚ è½¬å‘ é‡å®šå‘è½¬å‘ï¼šæœåŠ¡ç«¯è¿›è¡Œï¼Œåªèƒ½è®¿é—®åˆ°å½“å‰webå®¹å™¨ä¸‹çš„url é‡å®šå‘ï¼šè¿›è¡Œä¸¤æ¬¡è¯·æ±‚ï¼Œè¿”å›çš„302å“åº”é‡Œé¢ä¼šåŒ…å«ä¸€ä¸ªæ–°åœ°å€ï¼Œè¿™ä¸ªåœ°å€ä¸å—å®¹å™¨èŒƒå›´é™åˆ¶ã€‚ åˆ†å¸ƒå¼ åˆ†å¸ƒå¼çš„ä¼˜ç‚¹ ç†è®ºå¯ä»¥æ— é™æ°´å¹³æ‰©å®¹ CAPç†è®º Consistency ä¸€è‡´æ€§ï¼šæ¯æ¬¡è¯»å–ï¼Œè¦ä¹ˆè·å¾—æœ€æ–°çš„æ•°æ®ï¼Œè¦ä¹ˆè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚ Available å¯ç”¨æ€§ï¼šæ¯æ¬¡éƒ½èƒ½è·å¾—ä¸€ä¸ªéé”™è¯¯çš„å“åº”ï¼Œä½†ä¸èƒ½ä¿è¯è·å–åˆ°çš„æ˜¯æœ€æ–°çš„ã€‚ Partition tolerance åˆ†åŒºå®¹é”™æ€§ï¼šèŠ‚ç‚¹æˆ–è€…ç½‘ç»œæ•…éšœæ—¶ï¼Œä»èƒ½å¯¹å¤–æä¾›æœåŠ¡ã€‚ å¯¹ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼ŒPæ˜¯åŸºæœ¬è¦æ±‚ï¼Œæ‰€ä»¥ä¸€èˆ¬æˆ‘ä»¬éƒ½æ˜¯é€šè¿‡æƒè¡¡CA, åŒæ—¶æƒ³åŠæ³•å°½å¯èƒ½åœ°æå‡P BASEç†è®º Basically Available åŸºæœ¬å¯ç”¨ï¼šæŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ï¼Œä¿è¯æ ¸å¿ƒå¯ç”¨ã€‚ Soft State è½¯çŠ¶æ€ï¼šå…è®¸ç³»ç»Ÿå­˜åœ¨ä¸­é—´çŠ¶æ€ã€‚ å…è®¸ä¸åŒèŠ‚ç‚¹é—´å‰¯æœ¬åŒæ­¥çš„å»¶æ—¶ã€‚ Eventually Consistency æœ€ç»ˆä¸€è‡´æ€§ï¼šæ‰€æœ‰å‰¯æœ¬ç»è¿‡ä¸€å®šæ—¶é—´ï¼Œæœ€ç»ˆè¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚ åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä¸¤é˜¶æ®µæäº¤ï¼Œä¸‰é˜¶æ®µæäº¤ï¼ŒPaxos åˆ†å¸ƒå¼äº‹åŠ¡ï¼šç›¸æ¯”äºæ™®é€šçš„é›†ä¸­å¼äº‹åŠ¡æ¥è¯´ï¼Œæœ€å¤§çš„é—®é¢˜å°±æ˜¯å®ƒåªèƒ½çŸ¥é“è‡ªèº«äº‹åŠ¡æäº¤çš„æƒ…å†µï¼Œè€Œå¯¹äºå…¶ä»–æœºå™¨ä¸Šçš„äº‹åŠ¡ï¼Œåªèƒ½é€šè¿‡ç½‘ç»œä¿¡æ¯æ¥äº†è§£ã€‚ å› æ­¤ï¼Œåœ¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸­ï¼Œæˆ‘ä»¬å°±æå‡ºäº†ä¸€ä¸ªç¬¬ä¸‰æ–¹ï¼Œæˆ–è€…è¯´å«åšåè°ƒè€…ï¼Œå®ƒè´Ÿè´£åè°ƒæ‰€æœ‰æœºå™¨ä¸Šçš„äº‹åŠ¡ã€‚ ä¸¤é˜¶æ®µæäº¤ï¼šäº‹åŠ¡æäº¤åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œç¬¬ä¸€ä¸ªæ˜¯å‡†å¤‡é˜¶æ®µï¼Œåè°ƒè€…å‘èµ·è¯¢é—®ï¼Œå‚ä¸è€…æ‰§è¡Œè¯¢é—®ï¼Œå‚ä¸è€…è¿”å›å“åº”ã€‚ç¬¬äºŒä¸ªæ˜¯æäº¤é˜¶æ®µï¼Œåè°ƒè€…æ ¹æ®å‚ä¸è€…å‘å›çš„è¯·æ±‚å†³å®šæäº¤è¿˜æ˜¯å›æ»šã€‚ ä¸¤é˜¶æ®µæäº¤æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿï¼š åŒæ­¥é˜»å¡ï¼šä¸€ä¸ªå‚ä¸è€…é˜»å¡ä½äº†ï¼Œå…¶ä»–äººéƒ½å¾—ç­‰ã€‚ å•ç‚¹æ•…éšœï¼šä¸‡ä¸€åè°ƒè€…æŒ‚äº†å’‹æ•´ã€‚ æ•°æ®ä¸ä¸€è‡´ï¼šåè°ƒè€…å‘é€commitååªæœ‰ä¸€éƒ¨åˆ†å‚ä¸è€…æ”¶åˆ°äº†å‘½ä»¤ï¼Œè€Œä¸”æ­¤æ—¶åè°ƒè€…æŒ‚æ‰äº† ï¼Œé‚£å°±åªæœ‰é‚£éƒ¨åˆ†æäº¤äº†äº‹åŠ¡è€Œå…¶ä»–çš„æ²¡æœ‰æäº¤ï¼Œå°±ä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ ä¸¤é˜¶æ®µæäº¤æ— æ³•è§£å†³çš„é—®é¢˜ï¼šå‡å¦‚åœ¨æäº¤é˜¶æ®µï¼Œåè°ƒè€…å‘å‡ºcommitä¹‹åå®•æœºï¼Œæ”¶åˆ°è¿™ä¸ªcommitå‘½ä»¤çš„å‚ä¸è€…ä¹Ÿå®•æœºï¼Œé‚£ä¹ˆè¿™æ—¶å€™å³ä½¿æœ‰æ–°çš„åè°ƒè€…ï¼Œè¿™æ¡äº‹åŠ¡çš„çŠ¶æ€ä¹Ÿæ˜¯ä¸ç¡®å®šçš„ã€‚ åœ¨æ­¤ä¹‹ä¸Šï¼Œåˆæå‡ºäº†ä¸€ä¸ªä¸‰é˜¶æ®µæäº¤ï¼Œå®ƒç›¸å½“äºæ˜¯ä¸¤é˜¶æ®µæäº¤çš„å‡çº§ç‰ˆï¼Œå®ƒåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š ä¸‰é˜¶æ®µæäº¤ï¼šcanCommit, preCommit, doCommit. ç„¶åå®ƒè¿˜å¼•å…¥äº†ä¸€ä¸ªè¶…æ—¶æœºåˆ¶ã€‚ ç›¸æ¯”äºä¸¤é˜¶æ®µæäº¤ï¼Œä¸‰é˜¶æ®µæäº¤ä¸»è¦æ˜¯è§£å†³è¿™ä¸ªå•ç‚¹æ•…éšœé—®é¢˜ï¼Œå½“å‚ä¸è€…è¶…æ—¶è¿˜æ²¡æ”¶åˆ°commitå‘½ä»¤æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨æäº¤ï¼Œå½“ç„¶ï¼Œè¿™ä¸ªä¹Ÿä¼šå¯¼è‡´ä¸ä¸€è‡´é—®é¢˜ã€‚ LinuxLinuxæŸ¥çœ‹å†…å­˜å‘½ä»¤ top, ps, free COWCopy On Write(å†™æ—¶å¤åˆ¶)ï¼Œè¯´ç™½äº†æ˜¯ä¸€ç§ä¼˜åŒ–ç­–ç•¥ï¼Œåœ¨æ“ä½œç³»ç»Ÿå±‚é¢å’Œjavaå±‚é¢éƒ½æœ‰å®ç°ã€‚ æ“ä½œç³»ç»Ÿå±‚é¢ï¼šä¼—æ‰€å‘¨çŸ¥ï¼Œfork()ä¼šäº§ç”Ÿä¸€ä¸ªå­è¿›ç¨‹ï¼Œå®ƒçš„å†…å®¹æ˜¯çˆ¶è¿›ç¨‹çš„æ‹·è´ï¼Œéœ€è¦æ³¨æ„ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªè™šæ‹Ÿåœ°å€ç©ºé—´çš„æ‹·è´ï¼Œå°±æ˜¯è¯´æœ‰å„è‡ªçš„è™šæ‹Ÿåœ°å€ï¼Œä½†æ˜¯å…±äº«ç‰©ç†åœ°å€ï¼ˆéªšå°±éªšåœ¨è¿™äº†ï¼‰ï¼Œçœ‹ä¼¼æ‹·è´ï¼Œå®åˆ™å…±äº«ï¼Œç­‰åˆ°çœŸæ­£çˆ¶å­è¿›ç¨‹å“ªä¸ªè¢«ä¿®æ”¹çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ‰æ‰§è¡ŒçœŸæ­£çš„ç‰©ç†å†…å­˜çš„æ‹·è´ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæ‹·è´çš„æ˜¯å¯¹åº”çš„é¡µï¼Œè€Œä¸æ˜¯å…¨éƒ¨æ‹·è´ï¼Œä¸ç„¶å†…å­˜å“ªé‡Œåƒå¾—æ¶ˆã€‚ è®¾è®¡æ¨¡å¼ä¾èµ–å€’ç½®åŸåˆ™ æˆ‘è§‰å¾—ä¾èµ–å€’ç½®çš„æ ¸å¿ƒå°±æ˜¯é¢å‘æ¥å£ç¼–ç¨‹ã€‚å…·ä½“æ¥è¯´å°±æ˜¯ï¼š ä¸Šå±‚ä¸åº”è¯¥ä¾èµ–äºåº•å±‚ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡ æŠ½è±¡ä¸åº”è¯¥ä¾èµ–äºç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚ è®¾è®¡åŸåˆ™å•é‡Œä¸€æ¥è¿ªå¼€ å•ä¸€èŒè´£åŸåˆ™ï¼š é‡Œæ°æ›¿æ¢åŸåˆ™ï¼šèƒ½ç”¨åŸºç±»çš„åœ°æ–¹éƒ½èƒ½ç”¨å­ç±» ä¾èµ–å€’ç½®åŸåˆ™ï¼šé¢å‘æ¥å£ç¼–ç¨‹ã€‚ æ¥å£éš”ç¦»åŸåˆ™ï¼šæ¥å£è¦å°½é‡åšåˆ°ç²¾ç®€ï¼Œä¸è¦ä¸€ä¸ªæ¥å£é‡Œå•¥éƒ½æœ‰ è¿ªç±³ç‰¹æ³•åˆ™ï¼šç±»é—´å°½å¯èƒ½è§£è€¦ å¼€æ”¾å°é—­åŸåˆ™ï¼šå¯¹æ‰©å±•å¼€å‘ï¼Œå¯¹ä¿®æ”¹å°é—­ã€‚ å·¥å…· nginxæ¶æ„ ä¸€ä¸ªmasterè¿›ç¨‹ï¼Œå¤šä¸ªworkerè¿›ç¨‹ï¼Œ masterè¿›ç¨‹è´Ÿè´£è¯»å–å’ŒéªŒè¯configæ–‡ä»¶ï¼Œç®¡ç†workerè¿›ç¨‹ æ¯ä¸ªworkerè¿›ç¨‹éƒ½å„è‡ªç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹ã€‚ nginxå¦‚ä½•çƒ­éƒ¨ç½² æ¯æ¬¡ä¿®æ”¹configæ–‡ä»¶åï¼Œä¼šé‡æ–°ç”Ÿæˆæ–°çš„worker,æ–°çš„è¯·æ±‚ä¼šäº¤ç»™æ–°çš„workerå¤„ç†ï¼Œè€workerå·¥ä½œå®Œåå°±è¢«kill nginxå¦‚ä½•é«˜å¹¶å‘ epollæ¨¡å‹ nginxæŒ‚äº†æ€ä¹ˆåŠ keepalive + nginx, keepalive nginxè´Ÿè½½å‡è¡¡ è½®è¯¢ï¼Œå“ˆå¸Œï¼Œæœ€å°‘è¿æ¥ JWT JWTåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œheader, payload, signature, ç„¶åæ•´ä½“ä¼šç”¨base64URLè½¬æˆå­—ç¬¦ä¸² JWTçš„ç‰¹ç‚¹ é»˜è®¤ä¸åŠ å¯†ï¼Œä¸èƒ½å­˜å‚¨ç§˜å¯†æ•°æ® ä¸€æ—¦ç­¾å‘ï¼Œå§‹é‡æœ‰æ•ˆã€‚ å¦‚ä½•è®¤è¯†å‰åç«¯åˆ†ç¦» æ–¹ä¾¿å¼€å‘ 2. è¯·æ±‚çš„å‹åŠ›ä¸ä¼šéƒ½å †åˆ°åº”ç”¨æœåŠ¡å™¨ä¸Šã€‚ Springäº‹åŠ¡ä¼ æ’­è¡Œä¸º required: æ²¡æœ‰åˆ™åˆ›å»ºï¼Œæœ‰åˆ™æ²¿ç”¨ã€‚ supports: æ²¡æœ‰åˆ™ä¸ç”¨ï¼Œæœ‰åˆ™æ²¿ç”¨ã€‚ mandatory: å¿…é¡»è¿è¡Œåœ¨äº‹åŠ¡å†…ï¼Œæ²¡æœ‰å°±æŠ›å¼‚å¸¸ã€‚ require_new: æ— è®ºæ˜¯å¦å­˜åœ¨ï¼Œéƒ½ä¼šåˆ›å»ºæ–°äº‹åŠ¡ã€‚ not_supported: ä¸éœ€è¦äº‹åŠ¡ï¼Œæ²¡æœ‰ä¹Ÿä¸åˆ›å»ºï¼Œæœ‰åˆ™æŒ‚èµ·ã€‚ never: ä¸æ”¯æŒäº‹åŠ¡ï¼Œå¦åˆ™æŠ¥å¼‚å¸¸ã€‚ nested: åµŒå¥—äº‹åŠ¡ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"é¢ç»","slug":"é¢ç»","permalink":"http://example.com/tags/%E9%9D%A2%E7%BB%8F/"}]},{"title":"RedisæŒä¹…åŒ–","slug":"RedisæŒä¹…åŒ–","date":"2020-02-05T05:54:18.000Z","updated":"2023-05-29T14:17:39.321Z","comments":true,"path":"2020/02/05/RedisæŒä¹…åŒ–/","link":"","permalink":"http://example.com/2020/02/05/Redis%E6%8C%81%E4%B9%85%E5%8C%96/","excerpt":"","text":"æœ€è¿‘è‡ªå·±åšçš„é¡¹ç›®ä¸­ç”¨åˆ°äº†redis, ç‰¹æ­¤è®°å½•ä¸€ä¸‹redisçš„æŒä¹…åŒ–ç›¸å…³å†…å®¹ã€‚ redisè™½è¯´æ˜¯å†…å­˜æ•°æ®åº“ï¼Œä½†å…¶å®è‡ªå·±æ˜¯æœ‰æŒä¹…åŒ–çš„ï¼Œå®ƒçš„æŒä¹…åŒ–æœ‰ä¸¤ç§æ–¹å¼ï¼šRDBæŒä¹…åŒ–å’ŒAOFæŒä¹…åŒ–ã€‚ RDBæŒä¹…åŒ–ä¼šåœ¨ä¸€ä¸ªç‰¹å®šçš„æ—¶é—´é—´éš”è¿›è¡Œä¸€ä¸ªå¿«ç…§æ–‡ä»¶çš„ä¿å­˜ã€‚ AOFæŒä¹…åŒ–ä¼šè®°å½•æ¯ä¸€ä¸ªæœåŠ¡å™¨æ”¶åˆ°çš„å†™æ“ä½œã€‚å½“æœåŠ¡é‡å¯æ—¶ï¼Œè¿™äº›æ“ä½œè®°å½•ä¼šè¢«é‡æ–°æ‰§è¡Œä»è€Œé‡å»ºæ•°æ®ã€‚ ä»ä¸Šé¢çš„æè¿°å¯ä»¥å‘ç°ä¸€ç‚¹ï¼ŒRDBçš„å¿«ç…§æŒä¹…åŒ–æ–¹å¼å¹¶ä¸æ˜¯å¾ˆå¯é ï¼Œå› ä¸ºå®ƒæ˜¯æ¯éš”ä¸€æ®µæ—¶é—´è¿›è¡Œä¸€æ¬¡å…¨é¢çš„å¿«ç…§ï¼Œä½†æ˜¯å¦‚æœåœ¨è¿™ä¸ªæ—¶é—´æ®µä¸­é—´æœåŠ¡å™¨å´©äº†ï¼Œé‚£ä¹ˆè·ç¦»ä¸Šæ¬¡ä¿å­˜å¿«ç…§ä»¥åçš„æ•°æ®å°±ä¼šä¸¢å¤±ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒAOFæŒä¹…åŒ–æ–¹å¼æ›´ä¸ºå¯é ï¼Œåªè¦æœ‰å¯¹æ•°æ®åº“çš„å†™æ“ä½œï¼Œä»–å°±è®°å½•ï¼Œè€Œä¸æ˜¯éš”ä¸€æ®µæ—¶é—´ä¸€ä¿å­˜ã€‚","categories":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"tags":[{"name":"redis","slug":"redis","permalink":"http://example.com/tags/redis/"}]},{"title":"MySQLçš„é”","slug":"MySQLçš„é”","date":"2020-01-06T03:12:07.000Z","updated":"2020-01-06T03:12:07.000Z","comments":true,"path":"2020/01/06/MySQLçš„é”/","link":"","permalink":"http://example.com/2020/01/06/MySQL%E7%9A%84%E9%94%81/","excerpt":"","text":"å…ˆçœ‹é”çš„åˆ†ç±»ï¼š æŒ‰ç…§æ˜¯å¦å…±äº«ï¼Œå¯ä»¥åˆ†ä¸ºï¼š å…±äº«é”ï¼ˆè¯»é”ï¼‰ æ’ä»–é”ï¼ˆå†™é”ï¼‰ æŒ‰ç…§é”çš„ç²’åº¦ï¼Œå¯ä»¥åˆ†ä¸ºï¼š è¡¨é” è¡Œé” è¦è°ˆé”ï¼Œæˆ‘è®¤ä¸ºæ˜¯è¦ç»“åˆäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸€èµ·è°ˆçš„ï¼ŒMySQLçš„äº‹åŠ¡éš”ç¦»çº§åˆ«æœ‰ï¼š Read Uncommitted Read Committed Repeatable Read Serializable InnoDBé»˜è®¤çš„æ˜¯è¡Œé”ï¼Œè€Œä¸”è¡Œé”æ˜¯åŠ ç»™ç´¢å¼•çš„ï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹Ÿå°±åªèƒ½è¢«è¿«å…¨è¡¨æ‰«æäº†ã€‚ å•çº¯çš„è¯´â€œè¦ç»™ä»€ä¹ˆè¯­å¥åŠ ä»€ä¹ˆé”â€ï¼Œè¿™å¥è¯æœ¬èº«æ˜¯é ä¸ä½çš„ï¼Œå› ä¸ºè¦ç»™æŸä¸ªè¯­å¥æ˜¯å¦åŠ é”ï¼ŒåŠ ä»€ä¹ˆé”ï¼Œå–å†³äºå¾ˆå¤šå› ç´ ï¼Œå¦‚ï¼š ä¸Šä¸‹æ–‡ï¼Œå³äº‹åŠ¡çš„éš”ç¦»çº§åˆ« è¿™æ¡è¯­å¥æœ¬èº«çš„ç‰¹æ€§ï¼šè¿™æ¡è¯­å¥æ˜¯å•çº¯çš„select,è¿˜æ˜¯select for update, select lock in share modeï¼Œè¿˜æ˜¯insert, update æˆ–è€…deleteï¼Œå¸¦æœ‰ä¿®æ”¹æ„å‘³çš„è¯­å¥ä¸€èˆ¬ä¼šè¢«åŠ Xé”ï¼Œæ™®é€šçš„è¯­å¥åŠ Sé”æˆ–è€…ä¸åŠ  æ‰§è¡Œæ—¶æœ‰æ²¡æœ‰ç”¨åˆ°ç´¢å¼•ï¼Œä½¿ç”¨äºŒçº§ç´¢å¼•å¯èƒ½ä¼šéœ€è¦å›è¡¨ï¼Œè¿™æ—¶å€™å¯¹ä¸€çº§ç´¢å¼•ä¹Ÿè¦åŠ é”ï¼Œä½¿ç”¨ä¸€çº§ç´¢å¼•è¿›è¡Œä¿®æ”¹äºŒçº§ç´¢å¼•åˆ™äºŒçº§ç´¢å¼•ä¹Ÿè¦åŠ é”ã€‚ åŒä¸€è¯­å¥åœ¨ä¸åŒçš„éš”ç¦»çº§åˆ«ä¸‹åŠ é”æƒ…å†µä¹Ÿä¸ä¸€æ ·ã€‚ åœ¨READ UNCOMMITTED å’Œ READ COMMITTEDéš”ç¦»çº§åˆ«ä¸‹ï¼Œå› ä¸ºä¸éœ€è¦é˜²æ­¢å¹»è¯»çš„é—®é¢˜ï¼Œæ‰€ä»¥åŠ é”ä¹Ÿéƒ½æ˜¯ä¸€æ¡è®°å½•ä¸€æ¡è®°å½•çš„åŠ ï¼Œä¸å­˜åœ¨èŒƒå›´é”ï¼ˆgapé”æˆ–è€…next-key lockï¼‰ ä½†æ˜¯åœ¨ REPEATABLE READ ä¸‹åˆ™ä¸ä¸€æ ·ï¼Œå› ä¸ºéœ€è¦é˜²æ­¢å¹»è¯»ï¼ŒåŠ é”çš„æ—¶å€™ä¸ä»…éœ€è¦åŠ é”è‡ªèº«ï¼Œè¿˜è¦é”å®šä¸€ä¸ªèŒƒå›´ã€‚","categories":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://example.com/tags/MySQL/"}]},{"title":"MySQLä¹‹MVCC","slug":"MySQLä¹‹MVCC","date":"2020-01-05T12:53:07.000Z","updated":"2020-01-05T12:53:07.000Z","comments":true,"path":"2020/01/05/MySQLä¹‹MVCC/","link":"","permalink":"http://example.com/2020/01/05/MySQL%E4%B9%8BMVCC/","excerpt":"","text":"è®¨è®ºMySQLçš„MVCCçš„åŒæ—¶è¿˜åº”è¯¥è®¨è®ºMySQLä¸­çš„é”ï¼Œä¸è¿‡æœ¬æ–‡å…ˆå°±MVCCè¿›è¡Œè®¨è®ºã€‚ MVCCå«åšå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œå®ƒä¸»è¦æ˜¯ä¸ºäº†å®ç°å¤šä¸ªäº‹åŠ¡ä¹‹é—´çš„éš”ç¦»æ€§è€Œæå‡ºçš„ä¸€ç§æ›´é«˜æ•ˆçš„æ–¹æ³•ï¼Œä¸ºä»€ä¹ˆè¯´æ›´é«˜æ•ˆå‘¢ï¼Œå› ä¸ºé”ä¹Ÿå¯ä»¥å®ç°ï¼Œåªä¸è¿‡ç›¸æ¯”ä¹‹ä¸‹æ¯”è¾ƒä½æ•ˆã€‚ MVCCçš„æ ¸å¿ƒæœ‰ä¸‰ï¼š MySQLæ¯ä¸€è¡Œè®°å½•çš„éšè—åˆ—ä¹‹DATA_TRX_ID MySQLæ¯ä¸€è¡Œè®°å½•çš„éšè—åˆ—ä¹‹``DATA_ROLL_PTR` READ VIEW æˆ‘ä»¬ä¸‹é¢ä¸€ä¸€è¿›è¡Œè§£é‡Šã€‚ MySQLçš„æ¯ä¸€è¡Œè®°å½•éƒ½æœ‰ä¸¤ä¸ªéšè—åˆ—ï¼ŒDATA_TRX_IDå’Œ``DATA_ROLL_PTRã€‚å…¶ä¸­DATA_TRX_IDè¡¨ç¤ºä¿®æ”¹è¯¥è¡Œçš„äº‹åŠ¡ID,è€ŒDATA_ROLL_PTR`åˆ™æŒ‡å‘è¯¥è¡Œçš„å†å²ä¿®æ”¹ï¼Œå®ƒæŠŠæ‰€æœ‰çš„å†å²ä¿®æ”¹è¿æˆä¸€ä¸ªé“¾è¡¨ï¼Œåƒè¿™æ · è€ŒRead Viewæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®ƒä¹Ÿæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œm_idsä¸Šé¢æˆ‘ä»¬è®²åˆ°ä¸åŒçš„äº‹åŠ¡å¯¹åŒä¸€è¡Œçš„æ“ä½œå½¢æˆäº†ä¸€ä¸ªé“¾è¡¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨æ‰§è¡Œä¸€æ¡SQLæ—¶åˆ°åº•åº”è¯¥é€‰æ‹©é“¾è¡¨ä¸­çš„å“ªä¸€æ¡ä½œä¸ºç»“æœå‘¢ï¼ŸRead Viewæ­£æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªäº‹æƒ…çš„ã€‚ Read Viewé‡Œå­˜æ”¾äº†æˆ‘ä»¬å½“å‰æ´»è·ƒçš„äº‹åŠ¡çš„é›†åˆï¼Œæ‰€è°“å½“å‰æ´»è·ƒï¼ŒæŒ‡çš„æ˜¯è¿™äº›äº‹åŠ¡è¿˜æœªè¢«æäº¤ï¼Œå½“åœ¨ä¸åŒçš„éš”ç¦»çº§åˆ«ä¸‹æ‰§è¡ŒSQLæ—¶ï¼Œé€šè¿‡æ£€æŸ¥ç‰ˆæœ¬é“¾ä¸­çš„äº‹åŠ¡IDå’ŒRead Viewä¸­çš„äº‹åŠ¡IDå¤§å°å°±å¯ä»¥å†³å®šè¦é€‰æ‹©ç‰ˆæœ¬é“¾ä¸­çš„å“ªä¸ªèŠ‚ç‚¹ä½œä¸ºæ‰§è¡Œç»“æœäº†ã€‚ å…·ä½“æ˜¯è¿™æ ·çš„ï¼š å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„trx_idå±æ€§å€¼å°äºm_idsåˆ—è¡¨ä¸­æœ€å°çš„äº‹åŠ¡idï¼Œè¡¨æ˜ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨ç”ŸæˆReadViewå‰å·²ç»æäº¤ï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®ã€‚ å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„trx_idå±æ€§å€¼å¤§äºm_idsåˆ—è¡¨ä¸­æœ€å¤§çš„äº‹åŠ¡idï¼Œè¡¨æ˜ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡åœ¨ç”ŸæˆReadViewåæ‰ç”Ÿæˆï¼Œæ‰€ä»¥è¯¥ç‰ˆæœ¬ä¸å¯ä»¥è¢«å½“å‰äº‹åŠ¡è®¿é—®ã€‚ å¦‚æœè¢«è®¿é—®ç‰ˆæœ¬çš„trx_idå±æ€§å€¼åœ¨m_idsåˆ—è¡¨ä¸­æœ€å¤§çš„äº‹åŠ¡idå’Œæœ€å°äº‹åŠ¡idä¹‹é—´ï¼Œé‚£å°±éœ€è¦åˆ¤æ–­ä¸€ä¸‹trx_idå±æ€§å€¼æ˜¯ä¸æ˜¯åœ¨m_idsåˆ—è¡¨ä¸­ï¼Œå¦‚æœåœ¨ï¼Œè¯´æ˜åˆ›å»ºReadViewæ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡è¿˜æ˜¯æ´»è·ƒçš„ï¼Œè¯¥ç‰ˆæœ¬ä¸å¯ä»¥è¢«è®¿é—®ï¼›å¦‚æœä¸åœ¨ï¼Œè¯´æ˜åˆ›å»ºReadViewæ—¶ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„äº‹åŠ¡å·²ç»è¢«æäº¤ï¼Œè¯¥ç‰ˆæœ¬å¯ä»¥è¢«è®¿é—®ã€‚ è¿˜æœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼š Read Viewæ˜¯ä¸SQLç»‘å®šçš„ï¼Œè€Œå¹¶ä¸æ˜¯äº‹åŠ¡ å¯¹äºä½¿ç”¨READ UNCOMMITTEDéš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œç›´æ¥è¯»å–è®°å½•çš„æœ€æ–°ç‰ˆæœ¬å°±å¥½äº†ï¼Œå¯¹äºä½¿ç”¨SERIALIZABLEéš”ç¦»çº§åˆ«çš„äº‹åŠ¡æ¥è¯´ï¼Œä½¿ç”¨åŠ é”çš„æ–¹å¼æ¥è®¿é—®è®°å½•ã€‚æ‰€ä»¥MVCCåªåœ¨å¯é‡å¤è¯»å’Œè¯»å·²æäº¤è¿™ä¸¤ä¸ªéš”ç¦»çº§åˆ«ä¸‹å·¥ä½œã€‚ æœ¬æ–‡è½¬è‡ªå…¬ä¼—å·ï¼šæˆ‘ä»¬éƒ½æ˜¯å°é’è›™ï¼Œä½œè€…å°å­©å­4919 å‚è€ƒï¼š https://mp.weixin.qq.com/s/SCW_3AypO-rSolMcjCxVtA","categories":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://example.com/tags/MySQL/"}]},{"title":"äºŒå‰æ ‘éå†","slug":"äºŒå‰æ ‘éå†","date":"2020-01-01T02:51:05.000Z","updated":"2020-01-01T02:51:05.000Z","comments":true,"path":"2020/01/01/äºŒå‰æ ‘éå†/","link":"","permalink":"http://example.com/2020/01/01/%E4%BA%8C%E5%8F%89%E6%A0%91%E9%81%8D%E5%8E%86/","excerpt":"","text":"äºŒå‰æ ‘çš„éå†æœ‰å±‚æ¬¡éå†ï¼Œå‰åºéå†ï¼Œä¸­åºéå†ä»¥åŠåç»­éå†ã€‚æœ¬æ–‡åˆ†åˆ«é€šè¿‡é€’å½’å’Œéé€’å½’çš„æ–¹æ³•æ¥å®ç°è¿™äº›éå†ã€‚ äºŒå‰æ ‘çš„æ•°æ®ç»“æ„ 123456789public class Node&#123; public int value ; public Node left ; public Node right ; public Node(int val)&#123; value = val ; &#125;&#125; é€’å½’çš„å†™æ³•å…¶å®å¾ˆç®€å•ï¼Œä¸»è¦æ˜¯å¾—æœ‰ä¸€ä¸ªç»ˆæ­¢æ¡ä»¶ï¼Œæœ‰äº†è¿™ä¸ªç»ˆæ­¢æ¡ä»¶åï¼Œä¸€åˆ‡éƒ½å¥½è¯´ã€‚ 1234567public void preOrderRecur(Node root)&#123; if(head == null) return ; System.out.println(root.value) ; preOrderRecur(root.left) ; preOrderRecur(root.right) ;&#125; 1234567public void inOrderRecur(Node root)&#123; if(head == null) return ; inOrderRecur(root.left) ; System.out.println(root.value) ; inOrderRecur(root.right) ;&#125; 1234567public void postOrderRecur(Node root)&#123; if(head == null) return ; postOrderRecur(root.left) ; postOrderRecur(root.rigth) ; System.out.println(root.value) ;&#125; ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œåªè¦å†™å¥½äº†ç»ˆæ­¢æ¡ä»¶ï¼Œå…¶ä»–çš„éƒ½å¾ˆå¥½è¯´ã€‚ä¸‹é¢ä¸»è¦ä»‹ç»éé€’å½’çš„å†™æ³•ã€‚ å‰åºéå†çš„é¡ºåºæ˜¯è·Ÿå·¦å³ï¼Œç„¶åï¼Œå¯¹äºä¸€æ£µäºŒå‰æ ‘ï¼Œå…¶å®ä¹Ÿå°±åªæœ‰ä¸‰ä¸ªèŠ‚ç‚¹ï¼šè·Ÿå·¦å³ï¼Œå½“ä½ è¿™ä¹ˆæƒ³çš„æ—¶å€™ï¼Œé—®é¢˜å°±å˜ç®€å•äº†ï¼šç”¨ä¸€ä¸ªæ ˆï¼Œé¦–å…ˆæ ¹èŠ‚ç‚¹å…¥æ ˆï¼Œå¥½ï¼Œæ­¤æ—¶æ ˆä¸­æœ‰å…ƒç´ äº†ï¼› è¿™æ—¶å€™æˆ‘ä»¬å‡ºæ ˆä¸€ä¸ªå…ƒç´ ï¼Œè®¿é—®å®ƒï¼Œç„¶åä»¥æ­¤å°†å®ƒçš„å³å­©å­ã€å·¦å­©å­å…¥æ ˆï¼Œç„¶åå‡ºæ ˆã€è®¿é—®ï¼Œç„¶åå³å­©å­ã€å·¦å­©å­å…¥æ ˆï¼Œå¦‚æ­¤é‡å¤ã€‚ ä¸ºä»€ä¹ˆå…¥æ ˆæ—¶è¦å…ˆå³å­©å­åå·¦å­©å­å‘¢ï¼Ÿå› ä¸ºæ˜¯æ ˆå•Šï¼Œå…ˆè¿›åå‡ºã€‚ 1234567891011121314151617181920public void preOrderIte(Node root)&#123; Stack&lt;Node&gt; stack = new Stack() ; Node cur = root ; if(cur != null) &#123; stack.push(cur) ; &#125; while (!stack.empty())&#123; cur = stack.pop(); System.out.println(cur.value); if(cur.right!=null)&#123; stack.push(cur.right) ; &#125; if(cur.left!=null)&#123; stack.push(cur.left) ; &#125; &#125; &#125; å†æ¥è€ƒè™‘ä¸€ä¸‹ä¸­åºéå†ï¼Œå·¦ã€æ ¹ã€å³ã€‚ å°±æ˜¯è¯´ï¼Œé¦–å…ˆæˆ‘éœ€è¦æ‰¾åˆ°æœ€å·¦ä¸‹æ–¹é‚£ä¸ªå…ƒç´ ï¼Œç„¶åä¾æ¬¡å·¦æ ¹å³åœ°éå†ã€‚é‚£ä¹ˆæˆ‘åœ¨å‘ä¸‹å¯»æ‰¾åœ°è¿‡ç¨‹ä¸­ç”¨ä¸€ä¸ªæ ˆæŠŠå®ƒåœ°è·¯å¾„éƒ½å­˜èµ·æ¥å²‚ä¸æ˜¯ç¾æ»‹æ»‹ã€‚ 1234567891011121314151617public void inOrderIte(Node root)&#123; Stack&lt;Node&gt; stack = new Stack&lt;&gt;() ; Node cur = root ; if(cur!=null) &#123; stack.push(cur); cur = cur.left; &#125; while (!stack.empty() || cur !=null) &#123; while (cur != null) &#123; //ä¸€ç›´ä¼¸åˆ°æœ€å·¦ä¸‹æ–¹ stack.push(cur); cur = cur.left; &#125; cur = stack.pop(); System.out.println(cur.value); cur = cur.right; &#125; &#125; å†æ¥çœ‹ä¸‹ååºéå†ï¼Œå·¦å³æ ¹ã€‚ åŒæ ·åœ°ï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™ä¸ªäºŒå‰æ ‘åªæœ‰ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œæ ¹ï¼Œå·¦ï¼Œå³ï¼Œæˆ‘ä»¬æœŸæœ›çš„éå†é¡ºåºæ˜¯ï¼šå·¦å³æ ¹ï¼Œå·¦å³æ ¹åè¿‡æ¥çš„é¡ºåºæ˜¯ä»€ä¹ˆï¼šæ ¹å³å·¦ï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹åƒå…ˆåºéå†ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆå°è¯•æä¸€ä¸ªå®ƒçš„é€†åºéå†æ ¹å³å·¦ï¼Œç„¶åæŠŠè¿™ä¸ªéå†é¡ºåºæ”¾åˆ°ä¸€ä¸ªæ ˆé‡Œé¢é‡æ–°è¾“å‡ºä¸€ä¸‹å°±å¯ä»¥äº†ã€‚ å…ˆé‡æ–°å®¡è§†ä¸€ä¸‹å…ˆåºéå†çš„ä»£ç  1234567891011121314151617181920public void preOrderIte(Node root)&#123; Stack&lt;Node&gt; stack = new Stack() ; Node cur = root ; if(cur != null) &#123; stack.push(cur) ; &#125; while (!stack.empty())&#123; cur = stack.pop(); System.out.println(cur.value); if(cur.right!=null)&#123; stack.push(cur.right) ; &#125; if(cur.left!=null)&#123; stack.push(cur.left) ; &#125; &#125; &#125; å¤§æ¦‚å°±æ˜¯å…ˆæ ¹èŠ‚ç‚¹å…¥æ ˆï¼Œç„¶åæ ¹èŠ‚ç‚¹å‡ºæ ˆï¼Œå³å­©å­å…¥æ ˆï¼Œå·¦å­©å­å…¥æ ˆã€‚ æˆ‘ä»¬åªéœ€è¦ç¨å¾®æ”¹åŠ¨ä¸€ä¸‹ï¼Œå°±å¯ä»¥å˜æˆååºéå†ã€‚ 1234567891011121314151617181920212223242526public void postOrderIte(Node root)&#123; Stack&lt;Node&gt; stack = new Stack() ; Stack&lt;Node&gt; stack2 = new Stack&lt;&gt;(); Node cur = root ; if(cur != null) &#123; stack.push(cur) ; &#125; while (!stack.empty())&#123; cur = stack.pop(); //æ¯æ¬¡s1çš„popéƒ½å¯¹åº”ç€s2çš„push stack2.push(cur); if(cur.left!=null)&#123; stack.push(cur.left) ; &#125; if(cur.right!=null)&#123; stack.push(cur.right) ; &#125; &#125; while (!stack2.empty())&#123; System.out.println(stack2.pop().value); &#125; &#125; åœ¨å…ˆåºé‡Œï¼Œæ¯æ¬¡s1çš„popéƒ½å¯¹åº”ç€ä¸€æ¬¡print, åœ¨ååºé‡Œï¼Œæ¯æ¬¡s1çš„popéƒ½å¯¹åº”ç€s2çš„push. è¿˜æœ‰å°±æ˜¯ï¼Œåœ¨å…ˆåºé‡Œï¼Œå…ˆå…¥æ ˆå³å­©å­ï¼Œå†å…¥æ ˆå·¦å­©å­ï¼Œåœ¨ååºé‡Œï¼Œç¿»äº†è¿‡æ¥ï¼Œåº”ä¸ºæˆ‘ä»¬æœ‰ä¸¤ä¸ªæ ˆã€‚","categories":[{"name":"æ•°æ®ç»“æ„ä¸ç®—æ³•","slug":"æ•°æ®ç»“æ„ä¸ç®—æ³•","permalink":"http://example.com/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"äºŒå‰æ ‘","slug":"äºŒå‰æ ‘","permalink":"http://example.com/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/"}]},{"title":"TCPå¦‚ä½•ä¿è¯å¯é ä¼ è¾“","slug":"TCPå¦‚ä½•ä¿è¯å¯é ä¼ è¾“","date":"2019-12-26T09:14:42.000Z","updated":"2019-12-26T09:14:42.000Z","comments":true,"path":"2019/12/26/TCPå¦‚ä½•ä¿è¯å¯é ä¼ è¾“/","link":"","permalink":"http://example.com/2019/12/26/TCP%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93/","excerpt":"","text":"é¦–å…ˆï¼Œå®ƒæ˜¯é¢å‘è¿æ¥çš„ï¼Œä¹Ÿå°±æ˜¯å®ƒçš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹ï¼Œä¿è¯äº†æ¯æ¬¡å‘é€æ•°æ®å‰å…ˆå»ºç«‹è¿æ¥ï¼Œå‘é€å®Œæ•°æ®åæ–­å¼€è¿æ¥ å®ƒçš„ç¡®è®¤å’Œé‡ä¼ æœºåˆ¶ã€‚å®ƒä¼šå¯¹æ¯æ¬¡å‘é€çš„æ•°æ®åŒ…è¿›è¡Œä¸€ä¸ªç¡®è®¤ï¼Œå¦‚æœè¿‡äº†å¾ˆä¹…å‘é€ç«¯è¿˜æ²¡æœ‰æ”¶åˆ°è¿™ä¸ªç¡®è®¤ï¼Œå°±ä¼šè¿›è¡Œé‡ä¼ ã€‚ æ•°æ®æ ¡éªŒã€‚å¤´éƒ¨æœ‰æ ¡éªŒå’Œï¼Œç”¨ä»¥æ£€éªŒæ•°æ®åŒ…çš„å®Œæ•´æ€§ã€‚ æµé‡æ§åˆ¶ï¼šé€šè¿‡æ»‘åŠ¨çª—å£ä»¥åŠè¿ç»­ARQåè®®è¿›è¡Œæ•°æ®åŒ…çš„æ¥æ”¶ï¼Œè€Œä¸”å½“æ¥æ”¶æ–¹æ¥ä¸åŠå¤„ç†å‘é€æ–¹çš„æ•°æ®ï¼Œèƒ½é€šè¿‡æ»‘åŠ¨çª—å£ï¼Œæç¤ºå‘é€æ–¹é™ä½å‘é€çš„é€Ÿç‡ï¼Œé˜²æ­¢åŒ…ä¸¢å¤±ã€‚ æ‹¥å¡æ§åˆ¶ï¼šå½“ç½‘ç»œæ‹¥å¡æ—¶ï¼Œé€šè¿‡æ‹¥å¡çª—å£ï¼Œå‡å°‘æ•°æ®çš„å‘é€ï¼Œé˜²æ­¢åŒ…ä¸¢å¤±","categories":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"http://example.com/categories/%E7%BD%91%E7%BB%9C/"}],"tags":[{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"}]},{"title":"TCPçš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹","slug":"TCPçš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹","date":"2019-12-23T08:08:26.000Z","updated":"2019-12-23T08:08:26.000Z","comments":true,"path":"2019/12/23/TCPçš„ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹/","link":"","permalink":"http://example.com/2019/12/23/TCP%E7%9A%84%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/","excerpt":"","text":"åœ¨è®¨è®ºTCPçš„ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹ä¹‹å‰ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£TCPæŠ¥æ–‡æ ¼å¼ï¼š è¿™é‡Œé¢éœ€è¦ç•™æ„çš„æœ‰ï¼š åºåˆ—å·ï¼šæ ‡è¯†æœ¬æ¬¡æ•°æ®åŒ…çš„åºå· ç¡®è®¤å·ï¼šå¯¹äºå‘é€å‘é€æ–¹æ•°æ®åŒ…çš„ç¡®è®¤ï¼Œå€¼æ˜¯æ”¶åˆ°çš„æ•°æ®åŒ…çš„åºåˆ—å·+1ï¼Œå³ä¸‹æ¬¡æœŸå¾…æ”¶åˆ°çš„æ•°æ®åŒ…åºåˆ—å· æ ‡å¿—ä½ï¼š ä¸‹å›¾å±•ç¤ºäº†ä¸‰æ¬¡æ¡æ‰‹ä»¥åŠå››æ¬¡å›æ”¶çš„è¿‡ç¨‹ï¼š è¿™é‡Œéœ€è¦æ³¨æ„å„ä¸ªé˜¶æ®µçš„çŠ¶æ€ã€‚ ä¸‹é¢åˆ†åˆ«è¿›è¡Œåˆ†æ ä¸‰æ¬¡æ¡æ‰‹é˜¶æ®µï¼š å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€SYNæ•°æ®åŒ…ï¼Œè¡¨ç¤ºæƒ³å’ŒæœåŠ¡ç«¯å»ºç«‹è¿æ¥ æœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ªæ•°æ®åŒ…åï¼Œç»™äºˆå®¢æˆ·ç«¯å›åº”ï¼Œæ‰€ä»¥ACK=1,è¡¨ç¤ºè‡ªå·±æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„æ•°æ®åŒ…ï¼ŒåŒæ—¶å®ƒä¹Ÿæƒ³å’Œå®¢æˆ·ç«¯å»ºç«‹è¿æ¥ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œå›ä¼ ä¸€ä¸ªSYN å®¢æˆ·ç«¯æ”¶åˆ°è¿™ä¸ªACK+SYNæ•°æ®åŒ…åï¼Œè¡¨æ˜å®ƒå¯ä»¥å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚å¹¶æ¥æ”¶å“åº”ï¼Œè‡³æ­¤å®ƒå•æ–¹é¢çš„è¿æ¥å·²ç»å»ºç«‹èµ·æ¥äº†ï¼Œå¯æ˜¯å¯¹äºæœåŠ¡ç«¯æ¥è¯´ï¼Œå®ƒåªæ˜¯æ‰å‘é€äº†ä¸€ä¸ªACK+SYNåŒ…ï¼Œè¿˜ä¸çŸ¥é“è‡ªå·±èƒ½ä¸èƒ½æ”¶åˆ°å®¢æˆ·ç«¯çš„å›åº”ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯éœ€è¦å†å›ä¸€ä¸ªACKè¡¨ç¤ºå®¢æˆ·ç«¯æ”¶åˆ°äº†æœåŠ¡ç«¯çš„ACK+SYNåŒ…ï¼Œè‡³æ­¤æœåŠ¡ç«¯ä¹Ÿå¯ä»¥ç¡®å®šè‡ªå·±èƒ½å‘å®¢æˆ·ç«¯å‘é€è¯·æ±‚å¹¶æ¥æ”¶å“åº”äº†ï¼Œæ‰€ä»¥æœåŠ¡ç«¯è¿™ä¸€æ–¹çš„è¿æ¥ä¹Ÿå»ºç«‹èµ·æ¥äº†ï¼Œè‡³æ­¤æ•´ä¸ªä¸‰æ¬¡æ¡æ‰‹å®Œæˆï¼Œè¿æ¥å»ºç«‹ã€‚ æ‰€ä»¥å›é¦–ä¸Šè¿°è¿‡ç¨‹ï¼Œä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡ï¼Ÿå› ä¸ºå‰ä¸¤æ¬¡å¯ä»¥ç¡®ä¿å®¢æˆ·ç«¯å¯ä»¥æ­£å¸¸å‘é€è¯·æ±‚å’Œæ¥æ”¶å“åº”ï¼Œåä¸¤æ¬¡å¯ä»¥ä¿è¯æœåŠ¡ç«¯å¯ä»¥å‘é€è¯·æ±‚å’Œæ¥æ”¶å“åº”ã€‚ å››æ¬¡æŒ¥æ‰‹é˜¶æ®µï¼š å½“å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å»ºç«‹å¥½è¿æ¥å¹¶é€šä¿¡ç»“æŸåï¼Œå®ƒä¿©å°±è¦è¯´say goodbyeäº†ï¼Œé‚£ä¹ˆæ€ä¹ˆå‘Šåˆ«å‘¢ï¼Ÿ åˆ†æ‰‹æ€»æœ‰ä¸€ä¸ªäººå…ˆè¯´å†è§ï¼Œåœ¨å››æ¬¡æŒ¥æ‰‹é‡Œï¼Œé¦–å…ˆå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªFINåŒ…ï¼Œæ„æ€æ˜¯â€œæœåŠ¡ç«¯ï¼Œæˆ‘å·²ç»è¯´å®Œäº†ï¼Œä½ è¿˜æœ‰ä»€ä¹ˆè¦è¯´çš„å—ï¼Ÿâ€æ­¤æ—¶å®¢æˆ·ç«¯å·²ç»æ— fuckè¯´ï¼Œå°±çœ‹æœåŠ¡ç«¯è¿˜æœ‰ä»€ä¹ˆè¦è¯´çš„ï¼Œå®¢æˆ·ç«¯æ­¤æ—¶è¿›å…¥FIN_WAIT1çŠ¶æ€ã€‚ æœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ªåŒ…åï¼ŒçŸ¥é“å®¢æˆ·ç«¯å·²ç»æ²¡æœ‰è¯å¯¹ä»–è®²äº†ï¼Œä½†æ˜¯ä¸‡ä¸€ä»–è¿˜æœ‰è¯å¯¹å®¢æˆ·ç«¯è®²å‘¢ï¼Ÿæ‰€ä»¥ä»–å…ˆå‘ä¸€ä¸ªACKåŒ…ç»™å®¢æˆ·ç«¯ï¼Œæ„æ€æ˜¯â€œå¥½çš„æˆ‘çŸ¥é“äº†ï¼Œä½†æ˜¯æˆ‘å¯èƒ½è¿˜æœ‰è¯è¦å¯¹ä½ è®²â€ã€‚ ç„¶åå‘¢æœåŠ¡ç«¯å°±è¿›è¡Œæœ€åçš„é“åˆ«ï¼Œè¯´å®Œæœ€åä¸€ç•ªè¯åï¼Œä»–å‘ä¸€ä¸ªFINåŒ…ç»™å®¢æˆ·ç«¯ï¼Œæ„æ€æ˜¯â€œæˆ‘å·²ç»è¯´å®Œäº†ï¼Œæˆ‘ä»¬å¯ä»¥æ‹œæ‹œäº†â€ã€‚ å®¢æˆ·ç«¯æ”¶åˆ°è¿™ä¸ªFINåŒ…åï¼Œå›ä¸€ä¸ªACKåŒ…ç»™æœåŠ¡ç«¯ï¼Œæ„æ€æ˜¯â€œå¥½çš„æˆ‘çŸ¥é“äº†ï¼Œsee you nalaâ€,æœåŠ¡ç«¯æ”¶åˆ°è¿™ä¸ªåŒ…åå°±å…ˆè¡ŒæŒ‚æ–­äº†ç”µè¯ï¼Œå®¢æˆ·ç«¯ç­‰ä¸€æ®µæ—¶é—´åå‘ç°ç¡®å®æ²¡éŸ³äº†è‡ªå·±ä¹Ÿå°±æŒ‚äº†ç”µè¯ï¼Œè‡³æ­¤å››æ¬¡æ¡æ‰‹ç»“æŸã€‚","categories":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"http://example.com/categories/%E7%BD%91%E7%BB%9C/"}],"tags":[{"name":"TCP/IP","slug":"TCP-IP","permalink":"http://example.com/tags/TCP-IP/"}]},{"title":"åŒæ­¥ä¸å¼‚æ­¥ï¼Œé˜»å¡ä¸éé˜»å¡","slug":"IOä¸­çš„åŒæ­¥å¼‚æ­¥ï¼Œé˜»å¡éé˜»å¡","date":"2019-12-20T14:13:46.000Z","updated":"2019-12-20T14:13:46.000Z","comments":true,"path":"2019/12/20/IOä¸­çš„åŒæ­¥å¼‚æ­¥ï¼Œé˜»å¡éé˜»å¡/","link":"","permalink":"http://example.com/2019/12/20/IO%E4%B8%AD%E7%9A%84%E5%90%8C%E6%AD%A5%E5%BC%82%E6%AD%A5%EF%BC%8C%E9%98%BB%E5%A1%9E%E9%9D%9E%E9%98%BB%E5%A1%9E/","excerpt":"","text":"åŒæ­¥ä¸å¼‚æ­¥ï¼Œé˜»å¡ä¸éé˜»å¡è¿™å‡ ä¸ªè¯å¯ä»¥è¯´æ˜¯å¾ˆå¸¸è§äº†ï¼Œä½†æ˜¯ç½‘ç»œä¸Šå…³äºå®ƒä»¬çš„è§£é‡Šå´åˆä¼—è¯´çº·çº­ï¼Œå…¶ä¸­ä¸€ä¸ªä¸»è¦åŸå› å°±æ˜¯æˆ‘ä»¬æ˜¯åœ¨è„±ç¦»äº†ä¸Šä¸‹æ–‡åœ¨è°ˆè®ºè¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥æœ¬æ–‡ä¸»è¦æ˜¯åŸºäºNetwork IOæ¥è®¨è®ºã€‚ åœ¨ã€ŠUNIXç½‘ç»œç¼–ç¨‹ï¼šå¥—æ¥å­—è”ç½‘APIã€‹ä¸€ä¹¦ä¸­ï¼Œä¸€å…±æ¯”è¾ƒäº†äº”ç§IOæ¨¡å‹ï¼š é˜»å¡å¼IO (blocking IO) éé˜»å¡å¼IO (non-blocking IO) IOå¤šè·¯å¤ç”¨ï¼ˆIO multiplexingï¼‰ ä¿¡å·é©±åŠ¨å¼IO () å¼‚æ­¥IO (asynchronous IO) åœ¨æ­£å¼å¼€å§‹è®¨è®ºè¿™äº”ç§IOæ¨¡å‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆæ˜ç¡®ä¸€ä»¶äº‹ï¼šä¸€ä¸ªIOæ“ä½œé€šå¸¸åŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µï¼š ç­‰å¾…æ•°æ®å‡†å¤‡å¥½ ä»å†…æ ¸å‘è¿›ç¨‹å¤åˆ¶æ•°æ® å¯¹åº”åˆ°Socket çš„è¾“å…¥æ“ä½œæ—¶ï¼Œå°±æ˜¯é¦–å…ˆç­‰å¾…æ•°æ®ä»ç½‘ç»œä¸­åˆ°è¾¾ï¼Œç„¶åå°†æ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°è¿›ç¨‹ç¼“å†²åŒº ï¼ˆçœ‹ä¸æ‡‚æ²¡å…³ç³»ï¼Œä¸‹é¢æœ‰å›¾çš„ï¼‰ã€‚ é˜»å¡å¼IOå¼€å±€ä¸€å¼ å›¾ï¼š è¿™é‡Œrecvfromæ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œå½“åº”ç”¨è¿›ç¨‹è°ƒç”¨äº†è¿™ä¸ªç³»ç»Ÿè°ƒç”¨åï¼Œå½“å‰è¿›ç¨‹ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œç„¶åå†…æ ¸å¼€å§‹IOçš„ç¬¬ä¸€é˜¶æ®µï¼šç­‰å¾…æ•°æ®ã€‚å½“æ•°æ®å‡†å¤‡å¥½ä¹‹åï¼ˆæ¯”å¦‚ä»ç½‘ç»œä¸Šæ¥æ”¶åˆ°äº†å®Œæ•´çš„æ•°æ®åŒ…ï¼‰ï¼Œæ­¤æ—¶æ•°æ®æ˜¯åœ¨å†…æ ¸ç¼“å†²åŒºçš„ï¼Œç„¶åæ“ä½œç³»ç»Ÿä¼šæŠŠæ•°æ®ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå¹¶è¿”å›æˆåŠŸæŒ‡ç¤ºã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ç­‰å¾…æ•°æ®å’Œæ‹·è´æ•°æ®é˜¶æ®µï¼Œåº”ç”¨è¿›ç¨‹éƒ½åœ¨é˜»å¡ã€‚ éé˜»å¡å¼IOç»§ç»­ä¸Šå›¾ï¼š æˆ‘ä»¬æŠŠéé˜»å¡å¼IOå’Œä¸Šé¢çš„é˜»å¡å¼IOå¯¹æ¯”æ¥çœ‹ã€‚å¯¹äºé˜»å¡å¼IOï¼Œåœ¨ç­‰å¾…æ•°æ®é˜¶æ®µï¼Œå¦‚æœæ•°æ®è¿˜æ²¡å‡†å¤‡å¥½ï¼Œå†…æ ¸è¿™è¾¹ä¹Ÿä¸å­å£°ï¼Œåº”ç”¨è¿›ç¨‹åœ¨é‚£æ­»ç­‰ ï¼ˆå³é˜»å¡åº”ç”¨è¿›ç¨‹ï¼‰ï¼Œç›´åˆ°è¿”å›ç»“æœã€‚ è€Œéé˜»å¡å¼åˆ™ä¸ä¸€æ ·ï¼Œå½“å†…æ ¸æ€è¿™è¾¹æ”¶åˆ°è¿™ä¸ªç³»ç»Ÿè°ƒç”¨åï¼Œå¦‚æœæ•°æ®è¿˜æ²¡å‡†å¤‡å¥½ï¼Œå®ƒä¼šå…ˆè¿”å›ç»™åº”ç”¨è¿›ç¨‹ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œå‘Šè¯‰åº”ç”¨è¿›ç¨‹æ•°æ®è¿˜æ²¡å‡†å¤‡å¥½ï¼Œåº”ç”¨è¿›ç¨‹çŸ¥é“åï¼Œå¯ä»¥å…ˆè½¬å»åšå…¶ä»–äº‹æƒ…ï¼Œå¾…ä¼šå„¿å†æ¥è¯¢é—®ä¸€ä¸‹ ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºè½®è¯¢ï¼Œpollingï¼‰ï¼Œå¦‚æ­¤åå¤ï¼Œç›´åˆ°æœ‰ä¸€å›æ•°æ®å‡†å¤‡å¥½äº†ï¼Œè¿™æ—¶å€™æ“ä½œç³»ç»Ÿå°†æ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå¹¶ä¸”åœ¨æ­¤æœŸé—´ï¼Œåº”ç”¨è¿›ç¨‹æ˜¯é˜»å¡çš„ã€‚ æ‰€ä»¥å¯¹äºéé˜»å¡å¼IOæ¥è¯´ï¼Œåœ¨æ•°æ®å‡†å¤‡é˜¶æ®µï¼Œåº”ç”¨è¿›ç¨‹ä¸é˜»å¡ï¼Œåœ¨æ•°æ®æ‹·è´é˜¶æ®µï¼Œä»ç„¶é˜»å¡ã€‚ IOå¤šè·¯å¤ç”¨IO multiplexing, æœ‰äº›åœ°æ–¹ä¹Ÿå« event driven IO. å…¶æ ¸å¿ƒåœ¨äºï¼šä½¿ç”¨å•ä¸ªè¿›ç¨‹å°±å¯å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªç½‘ç»œè¿æ¥çš„IOï¼Œå®ƒä¸»è¦æ˜¯åŸºäºselectå‡½æ•°æˆ–è€…pollå‡½æ•°æ¥å®ç°çš„ã€‚ åŸºæœ¬åŸç†æ˜¯è¿™æ ·çš„ï¼šä¸€ä¸ªselectå‡½æ•°å®ƒå¯ä»¥è´Ÿè´£ç›‘æ§å¤šä¸ªsocketï¼Œå‡†ç¡®çš„æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨selectå‘ŠçŸ¥å†…æ ¸æˆ‘ä»¬å¯¹å“ªäº›æè¿°ç¬¦ï¼ˆè¯»ã€å†™æˆ–å¼‚å¸¸ï¼‰æ„Ÿå…´è¶£ï¼Œç„¶åselectå›å»è½®è¯¢æˆ‘ä»¬æ„Ÿå…´è¶£çš„è¿™äº›äº‹ä»¶ï¼Œå½“å…¶ä¸­çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå®ƒå°±ä¼šå‘Šè¯‰é€šçŸ¥ä¸€ä¸‹åº”ç”¨è¿›ç¨‹è¯´ï¼šâ€œå—¨ï¼Œä½ æ„Ÿå…´è¶£çš„æŸæŸæŸå‡ºç°äº†â€ã€‚ç„¶åå¼•ç”¨è¿›ç¨‹æ­¤æ—¶å†å‘èµ·ç³»ç»Ÿè°ƒç”¨recvfromï¼Œæ­¤æ—¶å°±æ²¡æœ‰æ•°æ®å‡†å¤‡é˜¶æ®µäº†ï¼Œè€Œæ˜¯ç›´æ¥æ•°æ®æ‹·è´ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­åº”ç”¨è¿›ç¨‹ä¾ç„¶é˜»å¡ã€‚ å¯ä»¥çœ‹åˆ°çš„æ˜¯ï¼Œç›¸æ¯”äºé˜»å¡å¼IOï¼Œè¿™é‡Œçš„å¤šè·¯å¤ç”¨ä¼¼ä¹æ€§èƒ½æ›´å·®ï¼Œå› ä¸ºå®ƒæœ‰ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼ˆselect, recvfromï¼‰è€Œé˜»å¡å¼IOåªæœ‰ä¸€ä¸ªï¼ˆrecvfromï¼‰. å¤šè·¯å¤ç”¨çš„ä¼˜åŠ¿ä¸æ˜¯è¯´å¤„ç†å•ä¸ªè¿æ¥èƒ½æœ‰å¤šå¿«ï¼Œè€Œæ˜¯å¯ä»¥å•è¿›ç¨‹å¤„ç†å¤šä¸ªè¿æ¥ã€‚ ä¿¡å·é©±åŠ¨å¼IOæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¿¡å·ï¼Œè®©å†…æ ¸åœ¨æè¿°ç¬¦å°±ç»ªæ—¶å°±å‘é€SIGIOä¿¡å·é€šçŸ¥æˆ‘ä»¬ï¼Œè¿™ç§æ¨¡å‹ç§°ä¹‹ä¸ºä¿¡å·é©±åŠ¨å¼IOã€‚ é¦–å…ˆæˆ‘ä»¬éœ€è¦å¼€å¯å¥—æ¥å­—çš„ä¿¡å·é©±åŠ¨å¼IOåŠŸèƒ½ï¼Œå¹¶é€šè¿‡sigactionç³»ç»Ÿè°ƒç”¨å®‰è£…ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ã€‚è¯¥ç³»ç»Ÿè°ƒç”¨ç«‹å³è¿”å›ï¼Œåº”ç”¨è¿›ç¨‹ç»§ç»­å·¥ä½œ (å³æ²¡æœ‰è¢«é˜»å¡)ï¼Œå½“æ•°æ®å‡†å¤‡å¥½åï¼Œå†…æ ¸å‘é€SIGIOåˆ°åº”ç”¨è¿›ç¨‹ã€‚ç„¶ååº”ç”¨è¿›ç¨‹å†è°ƒç”¨recvfromè¯»å–æ•°æ®ã€‚ å®ƒçš„ä¼˜åŠ¿åœ¨äºåœ¨ç­‰å¾…æ•°æ®æœŸé—´åº”ç”¨è¿›ç¨‹ä¸è¢«é˜»å¡ã€‚ å¼‚æ­¥IOä¸Šé¢ä»‹ç»çš„å‡ ç§IOæ¨¡å‹ä¸­ï¼Œåœ¨ç¬¬äºŒä¸ªæ•°æ®æ‹·è´é˜¶æ®µéƒ½æ˜¯é˜»å¡çš„ã€‚å¼‚æ­¥IOåˆ™ä¸ç„¶ï¼Œå®ƒçš„å·¥ä½œæœºåˆ¶æ˜¯ï¼šå‘Šè¯‰å†…æ ¸å»å®ŒæˆæŸä¸ªåŠ¨ä½œï¼Œç„¶åå†…æ ¸å®Œæˆåå†å»å‘ŠçŸ¥åº”ç”¨è¿›ç¨‹ã€‚åœ¨è¿™æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œåº”ç”¨è¿›ç¨‹éƒ½æ˜¯æ²¡æœ‰è¢«é˜»å¡çš„ã€‚ å„ç§IOæ¨¡å‹æ¯”è¾ƒä¸‹å›¾å¯¹æ¯”äº†ä¸Šè¿°äº”ç§IOæ¨¡å‹çš„å¯¹æ¯”ã€‚å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºå‰å››ç§ï¼Œåœ¨ç¬¬äºŒé˜¶æ®µéƒ½æ˜¯é˜»å¡çš„ï¼Œè€Œå¼‚æ­¥IOåˆ™ä¸åŒï¼Œå®ƒå…¨ç¨‹æ— é˜»å¡ã€‚ åŒæ­¥IOï¼Ÿ å¼‚æ­¥IOï¼Ÿæˆ‘ä»¬å…ˆçœ‹ä¸‹POSIXå¯¹åŒæ­¥IOå’Œå¼‚æ­¥IOçš„å®šä¹‰ï¼š A synchronous I/O operation causes the requesting process to be blocked until that I/O operation completes;An asynchronous I/O operation does not cause the requesting process to be blocked; ç¿»è¯‘è¿‡æ¥å°±æ˜¯è¯´ï¼š åŒæ­¥IOï¼šå¯¼è‡´è¯·æ±‚è¿›ç¨‹é˜»å¡ï¼Œç›´åˆ°IOæ“ä½œå®Œæˆ å¼‚æ­¥IOï¼šä¸ä¼šé€ æˆè¯·æ±‚è¿›ç¨‹é˜»å¡ æŒ‰ç…§è¿™ä¸ªå®šä¹‰ï¼Œé‚£ä¹ˆä¸Šé¢çš„äº”ç§IOæ¨¡å‹ä¸­ï¼Œå“ªå‡ ä¸ªåœ¨IOæ“ä½œçš„æ—¶å€™ä¼šåº”ç”¨è¿›ç¨‹ä¼šè¢«é˜»å¡å‘¢ï¼Ÿ å‰å››ç§éƒ½æ˜¯ã€‚ï¼ˆè¿™é‡Œéœ€è¦æ³¨æ„ï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯IOæ“ä½œï¼Œå³recvfromè¿™ä¸€ç³»ç»Ÿè°ƒç”¨ï¼Œåœ¨æ•°æ®ä»å†…æ ¸å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œå‰å››ç§éƒ½æ˜¯é˜»å¡çš„ï¼Œé™¤äº†å¼‚æ­¥IOæ¨¡å‹ï¼‰ æ€»ç»“è®©æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ä¸Šé¢æåˆ°çš„å‡ ç§IOæ¨¡å‹ï¼š é˜»å¡å¼IOï¼šå…¨ç¨‹æ­»ç­‰ éé˜»å¡å¼IO: åº”ç”¨è¿›ç¨‹ä¸æ–­è½®è¯¢ç›´åˆ°æ•°æ®å‡†å¤‡å¥½ï¼Œç„¶åè¿›è¡Œæ•°æ®æ‹·è´ï¼Œåœ¨æ­¤æœŸé—´åº”ç”¨è¿›ç¨‹é˜»å¡ å¤šè·¯å¤ç”¨IO: å…¶å®å®ƒä¹Ÿæ˜¯ä¸€ç§è½®è¯¢ï¼Œä¸éé˜»å¡å¼IOä¸åŒçš„æ˜¯ï¼š éé˜»å¡å¼IOä¸­æ˜¯åº”ç”¨è¿›ç¨‹ä¸»åŠ¨è½®è¯¢ï¼Œè€Œå¤šè·¯å¤ç”¨IOä¸­æ˜¯é€šè¿‡selectç³»ç»Ÿè°ƒç”¨è®©å†…æ ¸å»è½®è¯¢çš„ï¼Œè½®è¯¢æœŸé—´åº”ç”¨è¿›ç¨‹è¢«selectç³»ç»Ÿè°ƒç”¨é˜»å¡ å¤šè·¯å¤ç”¨IOä¸­selectå¯ä»¥åŒæ—¶å…³æ³¨å¤šä¸ªsocketçš„IOï¼Œä»è€Œå®ç°äº†å•è¿›ç¨‹ç®¡ç†å¤šä¸ªsocket IO ä¿¡å·é©±åŠ¨å¼IOï¼šæ•°æ®å‡†å¤‡è¿‡ç¨‹ä¸­ä¸é˜»å¡ï¼Œæ•°æ®æ‹·è´è¿‡ç¨‹ä¸­é˜»å¡ã€‚ å¼‚æ­¥IOï¼šå…¨ç¨‹ä¸é˜»å¡ï¼Œå†…æ ¸å®Œæˆä»»åŠ¡åå‘ŠçŸ¥åº”ç”¨è¿›ç¨‹ä¸€å£°å°±å¥½ã€‚ è¿™é‡Œè®²çš„åŒæ­¥å¼‚æ­¥ï¼Œé˜»å¡éé˜»å¡åªæ˜¯é’ˆå¯¹Socket IOæ¥è®²çš„ï¼Œå¦‚æœæ¢ä¸ªèƒŒæ™¯ï¼Œå®šä¹‰å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚","categories":[{"name":"OS","slug":"OS","permalink":"http://example.com/categories/OS/"}],"tags":[{"name":"IOæ¨¡å‹","slug":"IOæ¨¡å‹","permalink":"http://example.com/tags/IO%E6%A8%A1%E5%9E%8B/"}]},{"title":"Javaåƒåœ¾æ”¶é›†çµé­‚ä¸‰é—®","slug":"Javaåƒåœ¾æ”¶é›†çµé­‚ä¸‰é—®","date":"2019-12-13T13:30:46.000Z","updated":"2019-12-13T13:30:46.000Z","comments":true,"path":"2019/12/13/Javaåƒåœ¾æ”¶é›†çµé­‚ä¸‰é—®/","link":"","permalink":"http://example.com/2019/12/13/Java%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%81%B5%E9%AD%82%E4%B8%89%E9%97%AE/","excerpt":"","text":"æœ€è¿‘åœ¨é‡æ–°çœ‹JVMçš„å†…å®¹ï¼Œè¿™ç¯‡æ–‡ç« é‡æ–°æ¢³ç†ä¸€ä¸‹åƒåœ¾å›æ”¶ä¸­çš„ç›¸å…³å†…å®¹ã€‚ Javaä¸­çš„åƒåœ¾å›æ”¶(Garbage Collection, GC)æŒ‡çš„æ˜¯å›æ”¶å †å’Œæ–¹æ³•åŒºä¸­ä¸å†ä½¿ç”¨è¢«ä½¿ç”¨åˆ°çš„å¯¹è±¡ï¼Œå³åƒåœ¾ã€‚ GCä¸­éœ€è¦è€ƒè™‘çš„ä¸‰ä¸ªä¸»è¦é—®é¢˜ï¼š ä»€ä¹ˆæ˜¯åƒåœ¾ï¼šå³å“ªäº›å¯¹è±¡å¯ä»¥è¢«å®šä¹‰ä¸ºåƒåœ¾ ä½•æ—¶å›æ”¶ å¦‚ä½•å›æ”¶ æœ¬æ–‡å°†é’ˆå¯¹ä¸Šè¿°ä¸‰ä¸ªé—®é¢˜ä¸€ä¸€è§£ç­”ã€‚ ä»€ä¹ˆæ˜¯åƒåœ¾ï¼Ÿè¿™é‡Œå°±æ¶‰åŠåˆ°ä¸¤ç§åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»çš„ç®—æ³•ï¼š å¼•ç”¨è®¡æ•°æ³•ç»™æ¯ä¸ªå¯¹è±¡æ·»åŠ ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå½“å®ƒè¢«æŸäº›åœ°æ–¹å¼•ç”¨æ˜¯ï¼Œè®¡æ•°å™¨åŠ ä¸€ï¼Œå¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å‡ä¸€ï¼Œé‚£äº›è®¡æ•°å™¨ä¸ºé›¶çš„å¯¹è±¡å°±æ˜¯åƒåœ¾äº†ã€‚è¿™ç§æ–¹æ³•çš„ä¸€ä¸ªå…³é”®é—®é¢˜æ˜¯ä¼šå‡ºç°å¾ªç¯å¼•ç”¨ï¼Œå³å¯¹è±¡Aé‡Œé¢çš„æˆå‘˜å¼•ç”¨äº†å¯¹è±¡Bï¼Œè€Œå¯¹è±¡Bé‡Œé¢çš„æˆå‘˜åˆå¼•ç”¨äº†å¯¹è±¡A å¯è¾¾æ€§åˆ†æç®—æ³•é€šè¿‡ä¸€ç³»åˆ—æˆä¸ºâ€œGC Rootsâ€çš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹å‘ä¸‹æœç´¢ï¼Œæœç´¢èµ°è¿‡çš„è·¯å¾„å«åšå¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ°GC Rootsæ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿æ—¶ï¼Œåˆ™è¯´æ˜è¿™ä¸ªå¯¹è±¡ä¸å¯ç”¨ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä»€ä¹ˆæ˜¯GC Root,å“ªäº›å¯¹è±¡å¯ä»¥æˆä¸ºGC Root? åœ¨Javaä¸­ï¼Œå¯ä»¥ä½œä¸ºGC Rootçš„å¯¹è±¡åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIå¼•ç”¨çš„å¯¹è±¡ å…¶å®ä¸Šé¢çš„GC Rootä¹Ÿæ˜¯æœ‰è§„å¾‹å¯å¾ªçš„ï¼Œåˆ†ä¸ºä¸¤ç§ï¼šä¸€ç§æ˜¯æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ï¼ˆåŒ…æ‹¬è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆï¼‰ï¼Œä¸€ç§åˆ™æ˜¯æ–¹æ³•åŒºä¸­çš„é™æ€å±æ€§å’Œå¸¸é‡å¼•ç”¨çš„å¯¹è±¡ å¦‚ä½•å›æ”¶æ ‡è®°æ¸…é™¤ç®—æ³•å†…å­˜ç¢ç‰‡è¿‡å¤š å¤åˆ¶ç®—æ³•é€šè¿‡æŠ˜åŠå†…å­˜ç©ºé—´æ¥é¿å…å‡ºç°å†…å­˜ç¢ç‰‡ æ ‡è®°æ•´ç†ç®—æ³•å†…å­˜å˜åŠ¨é¢‘ç¹ï¼Œéœ€è¦æ•´ç†æ‰€æœ‰å­˜æ´»å¯¹è±¡çš„å†…å­˜åœ°å€ åˆ†ä»£æ”¶é›†ç®—æ³•å°†å †ç©ºé—´åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œæ–°ç”Ÿä»£åˆåˆ†ä¸ºä¸€ä¸ªæ¯”è¾ƒå¤§çš„EdenåŒºå’Œä¸¤ä¸ªæ¯”è¾ƒå°çš„survivoråŒºã€‚ ä¸¤ä¸ªsurvivoråŒºèµ·çš„å°±æ˜¯ä¸€ä¸ªç¼“å†²çš„ä½œç”¨ã€‚ æ–°ç”Ÿä»£98%çš„å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œé‡‡ç”¨å¤åˆ¶ç®—æ³•ã€‚ è€å¹´ä»£é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚ ä½•æ—¶å›æ”¶å¸¸è§çš„åƒåœ¾æ”¶é›†å™¨ï¼š","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"JVM","slug":"JVM","permalink":"http://example.com/tags/JVM/"}]},{"title":"Javaä¸­çš„LongAdder","slug":"Javaä¸­çš„LongAdder","date":"2019-12-05T03:25:22.000Z","updated":"2019-12-05T03:25:22.000Z","comments":true,"path":"2019/12/05/Javaä¸­çš„LongAdder/","link":"","permalink":"http://example.com/2019/12/05/Java%E4%B8%AD%E7%9A%84LongAdder/","excerpt":"","text":"æœ€è¿‘å‘ç°JUCåŒ…é‡Œé™¤äº†AtomicLongå¤–è¿˜æœ‰LongAdderï¼Œæ‰€ä»¥æ‰“ç®—ç ”ç©¶ä¸€ä¸‹å®ƒä¿©çš„å¼‚åŒã€‚ AtomicLongAtomicLongæ˜¯JUCåŒ…ä¸­çš„åŸå­ç±»ï¼Œé€šè¿‡CASæ¥å®ç°longç±»å‹çš„åŠ å‡ã€‚ é‚£ä¹ˆæ—¢ç„¶éƒ½æœ‰AtomicLongç±»äº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰ä¸€ä¸ªLongAdderç±»ï¼Ÿå› ä¸ºä»åå­—æ¥çœ‹ï¼ŒLongAdderä¹Ÿæ˜¯ç”¨æ¥æ“ä½œlongç±»å‹çš„ã€‚ LongAdderçš„è®¾è®¡æ€æƒ³å…ˆç¿»è¯‘ä¸€æ®µå®˜æ–¹æ–‡æ¡£é‡Œçš„è§£é‡Šï¼š LongAdderæ˜¯é€šè¿‡å¤šä¸ªå˜é‡ä¸€èµ·æ¥ç»´æŠ¤ä¸€ä¸ªlongå‹æ€»å’Œã€‚ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå®ƒä¸»è¦æ˜¯ä¸ºäº†è®¡ç®—ä¸€äº›ç»Ÿè®¡ä¿¡æ¯çš„ï¼Œåœ¨å¤šçº¿ç¨‹ç«äº‰çš„åœºæ™¯ä¸‹ï¼Œå®ƒç»™æ¯ä¸ªçº¿ç¨‹éƒ½åˆ†é…ä¸€ä¸ªå˜é‡ï¼Œæ¯ä¸ªçº¿ç¨‹å„è‡ªä¿®æ”¹è‡ªå·±çš„å˜é‡ï¼Œç„¶åå®ƒæœ‰ä¸ªsum()æ–¹æ³•ï¼Œå¯ä»¥è®¡ç®—æ‰€æœ‰å˜é‡çš„æ€»å’Œï¼Œé€šè¿‡è¿™ç§æ–¹å¼æ¥å‡å°‘å¤šçº¿ç¨‹ä¹‹é—´çš„ç«äº‰ã€‚ å½“å¤šä¸ªçº¿ç¨‹å»æ›´æ–°ä¸€ä¸ªå…¬æœ‰çš„sumæ€»å’Œæ—¶ï¼Œæˆ‘ä»¬æ›´åå‘äºç”¨LongAdderè€ŒéAtomicLong. è¿™ä¸¤ä¸ªç±»ç‰¹æ€§ç›¸ä¼¼ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹ç«äº‰æ¿€çƒˆçš„åœºæ™¯ï¼ŒLongAdderå…·æœ‰æ›´å¥½çš„æ€§èƒ½ï¼ˆè¿™ä¸€ç‚¹ä¹Ÿå¯æƒ³è€ŒçŸ¥ï¼Œæ¯•ç«ŸAtomicLongä½¿ç”¨çš„æ˜¯CASï¼‰ã€‚ ä¸Šé¢çš„æè¿°ä¹Ÿå°±åŸºæœ¬ä¸Šè§£é‡Šäº†LongAdderçš„ç¼˜èµ·ç¼˜ç­äº†ï¼Œå®ƒä¸»è¦æ˜¯ä¸ºç»Ÿè®¡è€Œç”Ÿï¼Œè€Œéé‚£ç§ç»†ç²’åº¦çš„åŒæ­¥æ§åˆ¶ã€‚ å…¶å®è¿™ä¸ªä¹Ÿå°±ç›¸å½“äºä¸€ç§åˆ†æ²»ï¼Œéä¸­å¤®é›†æƒè€Œæ˜¯åˆ†è€Œæ²»ä¹‹ï¼Œè®©æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤è‡ªå·±çš„é‚£ä¸ªå˜é‡ï¼Œæœ€åç»¼åˆç»Ÿè®¡ä¸€ä¸‹ã€‚ è¯¦æƒ…æˆ‘ä»¬åœ¨è¿™é‡Œä»æºç è§’åº¦è®¨è®ºä¸€ä¸‹LongAdder. å…ˆçœ‹ä¸‹å®ƒçš„ç»§æ‰¿å…³ç³»ï¼š 1public class LongAdder extends Striped64 implements Serializable å®ƒæœ€æ ¸å¿ƒçš„ä¸€ä¸ªæ–¹æ³•å°±æ˜¯add()æ–¹æ³•äº† 123456789101112131415/** * Adds the given value. * * @param x the value to add */ public void add(long x) &#123; Cell[] as; long b, v; int m; Cell a; if ((as = cells) != null || !casBase(b = base, b + x)) &#123; boolean uncontended = true; if (as == null || (m = as.length - 1) &lt; 0 || (a = as[getProbe() &amp; m]) == null || !(uncontended = a.cas(v = a.value, v + x))) longAccumulate(x, null, uncontended); &#125; &#125; çœ‹ç€å¾ˆç®€å•ï¼Œä½†é‡Œé¢çš„é€»è¾‘åˆ¤æ–­å´ä¸å°‘ã€‚å…ˆç®€å•ä»‹ç»ä¸‹è¿™é‡Œé¢çš„ä¸€äº›é™Œç”Ÿç±»å‹å’Œæ–¹æ³•ã€‚ Cell[]ï¼šCellç±»é‡Œé¢å…¶å®å°±æ˜¯ç»´æŠ¤äº†ä¸€ä¸ªå˜é‡ï¼Œè¿™ä¸ªæ•°ç»„ç”¨æ¥å­˜åœ¨æ¯ä¸ªçº¿ç¨‹çš„è‡ªå·±ç»´æŠ¤çš„å˜é‡ã€‚å…·ä½“ç»†èŠ‚æ˜¯è¿™æ ·çš„ï¼šå¯¹æ¯ä¸ªçº¿ç¨‹è®¡ç®—hashï¼Œå°†å¾—åˆ°çš„hashå€¼ä½œä¸ºCellæ•°ç»„çš„ä¸‹æ ‡ã€‚ casBase()ï¼šå¯¹baseå˜é‡è¿›è¡ŒCAS,ä»€ä¹ˆæ˜¯baseå˜é‡å‘¢ï¼Ÿå½“æœ‰ç«äº‰æ˜¯ä½¿ç”¨Cell[]æ•°ç»„ç»™æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªå˜é‡ï¼Œå½“æ²¡æœ‰ç«äº‰æ˜¯LongAdderå°±åªæ“ä½œä¸€ä¸ªbaseå˜é‡å°±å¯ä»¥äº†ã€‚ getProbe()ï¼šå¾—åˆ°å½“å‰çº¿ç¨‹å¯¹åº”çš„å“ˆå¸Œå€¼ï¼Œå†å’Œæ•°ç»„é•¿åº¦è¿›è¡Œä¸è¿ç®—å°±å¾—åˆ°äº†å¯¹åº”çš„ä¸‹æ ‡ï¼ˆæœ‰æ²¡æœ‰ä¸€ç‚¹hashmapçš„å½±å­ï¼Ÿï¼‰. longAccumulate()ï¼šå½“åŸºæœ¬çš„æ“ä½œéƒ½å¤±è´¥æ—¶ï¼Œæ‰§è¡Œè¿™ä¸ªæ–¹æ³•ã€‚ ä¸ºäº†æ–¹ä¾¿ç†è§£ä»£ç é€»è¾‘ï¼Œæˆ‘ç”»äº†ä¸€ä¸ªæµç¨‹å›¾ï¼š å¯ä»¥çœ‹åˆ°å¤§æ¦‚æµç¨‹æ˜¯å…ˆæ“ä½œCellæ•°ç»„ï¼Œæ•°ç»„ç©ºçš„è¯å†æ“ä½œbase,å¦‚æœéƒ½æ²¡æˆåŠŸå†è€ƒè™‘longAccumulateï¼ˆï¼‰ï¼Œè™½ç„¶æˆ‘ä¹Ÿæ²¡ä»”ç»†ç ”ç©¶longAccumulate()é‡Œçš„ä»£ç ï¼Œä½†æ˜¯å¤§æ¦‚å¯ä»¥çŒœåˆ°ï¼Œå®ƒåº”è¯¥æ˜¯ä¸Šè¿°æœªæˆåŠŸæ“ä½œçš„plusç‰ˆï¼Œæ“ä½œé€æ¸å‡çº§ã€‚ è¿™ç§è®¾è®¡æ€æƒ³å¯ä»¥å­¦ä¹ ä¸€æ‰‹","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"http://example.com/tags/%E5%B9%B6%E5%8F%91/"}]},{"title":"Javaä¸­çš„å¹¶å‘å·¥å…·ç±»","slug":"Javaä¸­çš„å¹¶å‘å·¥å…·ç±»","date":"2019-12-02T03:28:28.000Z","updated":"2019-12-02T03:28:28.000Z","comments":true,"path":"2019/12/02/Javaä¸­çš„å¹¶å‘å·¥å…·ç±»/","link":"","permalink":"http://example.com/2019/12/02/Java%E4%B8%AD%E7%9A%84%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB/","excerpt":"","text":"CountDownLatchå¤šçº¿ç¨‹çš„ä½¿ç”¨ä¸­å¾€å¾€æœ‰è¿™æ ·çš„åœºæ™¯ï¼šæŸä¸ªçº¿ç¨‹éœ€è¦ç­‰åˆ°å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œå³çº¿ç¨‹çš„â€œç­‰å¾…å…¶ä»–çº¿ç¨‹â€çš„åŠŸèƒ½ï¼ˆæ³¨æ„è¿™é‡Œè¯´çš„ä¸æ˜¯wait()ï¼‰ã€‚è¿™æ—¶å€™å°±å¯ä»¥ç”¨CountDownLatchç±»æ¥å®ç°ï¼Œå½“ç„¶äº†ï¼ŒThread.join()æ–¹æ³•ä¹Ÿå…·æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œåªä¸è¿‡ç›¸æ¯”ä¹‹ä¸‹ï¼ŒCountDownLatchåŠŸèƒ½æ›´åŠ ä¸°å¯Œã€‚ é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥çœ‹ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940import java.util.concurrent.CountDownLatch;public class CountDownLatchTest &#123; static CountDownLatch cdl = new CountDownLatch(3) ; public static void main(String[] args) &#123; new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println(Thread.currentThread().getName()+&quot; is running&quot;); cdl.countDown(); &#125; &#125;).start(); new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println(Thread.currentThread().getName()+&quot; is running&quot;); cdl.countDown(); &#125; &#125;).start(); new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println(Thread.currentThread().getName()+&quot; is running&quot;); cdl.countDown(); &#125; &#125;).start(); try &#123; cdl.await(); System.out.println(&quot;sub thread executed&quot;); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;&#125; åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ–°å»ºäº†ä¸‰ä¸ªå­çº¿ç¨‹ï¼Œç°åœ¨æƒ³è¦ç­‰åˆ°ä¸‰ä¸ªå­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•äº†è¾“å‡ºä¸€å¥sub thread executed. æˆ‘ä»¬ä½¿ç”¨äº†CountDownLatchæ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚ 1static CountDownLatch cdl = new CountDownLatch(3) ; è¿™å¥è¯è®¾ç½®CountDownLatchè®¡æ•°å™¨çš„å€¼ä¸º3ï¼Œè¡¨ç¤ºå¯¹ä¸‰ä¸ªçº¿ç¨‹è¿›è¡Œè®¡æ•°ã€‚ 1cdl.countDown(); åœ¨æ¯ä¸ªçº¿ç¨‹é‡Œæ‰§è¡Œè¿™å¥è¯ï¼Œå°†è®¡æ•°å™¨çš„å€¼å‡ä¸€ã€‚ 1cdl.await(); åœ¨ä¸»çº¿ç¨‹ä¸­ä½¿ç”¨await()æ–¹æ³•ç­‰å¾…è®¡æ•°å™¨å€¼ä¸º0çš„æ—¶å€™å°±å¼€å§‹æ‰§è¡Œåç»­ä»£ç ã€‚ æ‰€ä»¥éœ€è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®è®¡æ•°å™¨å€¼ä¸º3ï¼Œä½†æ˜¯åœ¨å­çº¿ç¨‹ä¸­åªæ‰§è¡ŒåŠ›ä¸¤æ¬¡coutDown()ï¼Œé‚£ä¹ˆä¸»çº¿ç¨‹ä¸­çš„await()æ–¹æ³•åé¢çš„å†…å®¹æ°¸è¿œä¹Ÿä¸ä¼šè¢«æ‰§è¡Œåˆ°ã€‚ CyclicBarrierCyclicBarrierç”¨äºè®©ä¸€ç»„çº¿ç¨‹éƒ½åˆ°è¾¾æŸä¸ªçŠ¶æ€åç„¶åç»Ÿä¸€åŒæ—¶å¼€å§‹ç»§ç»­æ‰§è¡Œã€‚ä»åå­—æ¥çœ‹ï¼ŒCyclicBarrierå°±æ˜¯å¯ä»¥å¾ªç¯åˆ©ç”¨çš„å±éšœï¼Œæ‰€ä»¥å®ƒçš„ä½œç”¨ä¹Ÿå°±æ˜¯åœ¨çº¿ç¨‹æ‰§è¡Œä¸­æ’å…¥ä¸€ä¸ªå±éšœï¼Œå½“æ‰€æœ‰çš„çº¿ç¨‹éƒ½æ‰§è¡Œåˆ°å±éšœè¿™é‡Œåï¼Œæ‰èƒ½ç»Ÿä¸€ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚ é€šè¿‡ä¸‹é¢çš„ä»£ç æ¥çœ‹ï¼š 123456789101112131415161718192021222324252627public class CyclicBarrierTest &#123; static int THREAD_COUNT =3 ; public static void main(String[] args) &#123; CyclicBarrier cyclicBarrier = new CyclicBarrier(3); for (int i = 0; i &lt; THREAD_COUNT; i++) &#123; new Thread(new Runnable() &#123; @Override public void run() &#123; System.out.println(Thread.currentThread().getName() + &quot; åˆ°è¾¾å±éšœå‰&quot;); try &#123; cyclicBarrier.await(); System.out.println(Thread.currentThread().getName() + &quot; åˆ°è¾¾å±éšœå&quot;); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; catch (BrokenBarrierException e) &#123; e.printStackTrace(); &#125; &#125; &#125;).start(); &#125; &#125;&#125; åˆ›å»ºäº†ä¸‰ä¸ªçº¿ç¨‹ï¼ŒåŒæ—¶CyclicBarrierçš„è®¡æ•°å™¨ä¸º3ï¼Œåœ¨æ¯ä¸ªçº¿ç¨‹çš„æ‰§è¡Œä»£ç ä¸­æ’å…¥ä¸€å¥ï¼š 1cyclicBarrier.await(); é‚£ä¹ˆè¯¥ä»£ç åç»­çš„å†…å®¹éœ€è¦ç­‰åˆ°æ‰€æœ‰çº¿ç¨‹éƒ½æ‰§è¡Œåˆ°å±éšœè¿™é‡Œæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚ æ‰§è¡Œç»“æœï¼š 123456Thread-1 åˆ°è¾¾å±éšœå‰Thread-0 åˆ°è¾¾å±éšœå‰Thread-2 åˆ°è¾¾å±éšœå‰Thread-2 åˆ°è¾¾å±éšœåThread-1 åˆ°è¾¾å±éšœåThread-0 åˆ°è¾¾å±éšœå CyclicBarrierç›¸æ¯”äºCountDownLatchï¼ŒåŒºåˆ«ä¹‹ä¸€åœ¨äºå®ƒå¯ä»¥å¾ªç¯åˆ©ç”¨ï¼Œè¿™ä¹Ÿæ˜¯å®ƒåå­—é‡Œcyclicçš„æ„ä¹‰æ‰€åœ¨ï¼ŒCyclicBarrierçš„è®¡æ•°å™¨å¯ä»¥é€šè¿‡reset()é‡ç½®ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"http://example.com/tags/%E5%B9%B6%E5%8F%91/"}]},{"title":"Javaä¸­çš„ç­‰å¾…/å”¤é†’æœºåˆ¶","slug":"Javaä¸­çš„ç­‰å¾…-å”¤é†’æœºåˆ¶","date":"2019-11-28T11:40:52.000Z","updated":"2019-11-28T11:40:52.000Z","comments":true,"path":"2019/11/28/Javaä¸­çš„ç­‰å¾…-å”¤é†’æœºåˆ¶/","link":"","permalink":"http://example.com/2019/11/28/Java%E4%B8%AD%E7%9A%84%E7%AD%89%E5%BE%85-%E5%94%A4%E9%86%92%E6%9C%BA%E5%88%B6/","excerpt":"","text":"ç­‰å¾…/å”¤é†’æœºåˆ¶æ˜¯å¤šçº¿ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡ï¼ˆåŒæ­¥ï¼‰çš„ä¸€ç§æ–¹å¼ï¼Œè¿™é‡Œå¯¹å®ƒåœ¨Javaä¸­çš„ä½¿ç”¨åšä¸€ä¸ªæ€»ç»“ã€‚ Objectçš„wait()å’Œnotify()è¿™ä¸ªç®—æ˜¯æ¯”è¾ƒåŸå§‹çš„ä¸€ç§ç­‰å¾…/å”¤é†’æœºåˆ¶ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯Objectç±»ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªå¯¹è±¡éƒ½æ‹¥æœ‰è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚ å®ƒä»¬ä¸€èˆ¬éƒ½æ˜¯å’Œsynchronizedå…³é”®å­—é…åˆä½¿ç”¨çš„ã€‚ Conditionæ¥å£Conditionæ¥å£æ˜¯ä¸ºäº†å¯¹Lockçš„ä¸€ä¸ªç­‰å¾…/é€šçŸ¥æœºåˆ¶çš„å®ç°ã€‚è¿™é‡Œéœ€è¦æä¸€ä¸‹ï¼ŒLockæ¥å£æ˜¯åœ¨synchronizedåé¢æå‡ºçš„é”æœºåˆ¶ï¼Œç›¸æ¯”äºsynchronziedå…³é”®å­—ï¼Œå®ƒèƒ½å¤Ÿå“åº”ä¸­æ–­ã€‚è€ŒConditionæ­£æ˜¯ä¸ºLockä¸­æä¾›äº†ç­‰å¾…/é€šçŸ¥æœºåˆ¶ã€‚ é˜»å¡é˜Ÿåˆ—é˜»å¡é˜Ÿåˆ—ä¹Ÿæ˜¯ä¸€ç§çº¿ç¨‹é—´é€šä¿¡çš„æ–¹å¼ï¼Œå…¶æ ¸å¿ƒåœ¨äºä¸¤ä¸ªçº¿ç¨‹äº’ç›¸é€šä¿¡å»ä½¿ç”¨åŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œè€Œè¿™ä¸¤ä¸ªçº¿ç¨‹é—´çš„é€šä¿¡å°±æ˜¯é€šè¿‡ç­‰å¾…/é€šçŸ¥æœºåˆ¶å®Œæˆçš„ã€‚åœ¨é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœç”Ÿäº§è€…çº¿ç¨‹å‘ç°å½“å‰é˜Ÿåˆ—æ»¡äº†ï¼Œé‚£ä¹ˆä»–å°±ä¼šè°ƒç”¨await()æ–¹æ³•ï¼ŒæŒ‚èµ·ç”Ÿäº§è€…çº¿ç¨‹ã€‚å½“æ¶ˆè´¹è€…çº¿ç¨‹ä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹äº†å…ƒç´ åï¼Œç„¶åé€šè¿‡signal()æ–¹æ³•å”¤é†’ç”Ÿäº§çº¿ç¨‹ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}]},{"title":"Javaä¸­çš„Condition","slug":"Javaä¸­çš„Condition","date":"2019-11-12T05:26:50.000Z","updated":"2019-11-12T05:26:50.000Z","comments":true,"path":"2019/11/12/Javaä¸­çš„Condition/","link":"","permalink":"http://example.com/2019/11/12/Java%E4%B8%AD%E7%9A%84Condition/","excerpt":"","text":"å‰é¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†Javaä¸­çš„Lockæ¥å£ï¼Œä»¥åŠç›¸å…³çš„å®ç°ç±»ReentrantLockã€ReentrantReadWriteLockã€‚å®ƒä»¬éƒ½æ˜¯é€šè¿‡èšåˆä¸€ä¸ªAQSæ¥å®ç°çš„ã€‚åŒæ—¶è®¨è®ºäº†ä¸ºä»€ä¹ˆæœ‰äº†Synchronizedå…³é”®å­—ä¹‹åè¿˜è¦æœ‰Lockã€‚ æˆ‘ä»¬çŸ¥é“Synchronizedå…³é”®å­—æ˜¯Monitoræœºåˆ¶åœ¨Javaä¸­çš„ä¸€ç§å…·ä½“å®ç°ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰wait()ã€notify()å’ŒnotifyAll()æ–¹æ³•æ¥è¿›è¡Œçº¿ç¨‹é€šä¿¡ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œåœ¨æå‡ºäº†Lockä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨LockåŠ é”çš„æ—¶å€™æœ‰æ²¡æœ‰ç±»ä¼¼çš„ä¸€ç»„ç›‘è§†å™¨æ–¹æ³•å‘¢ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬ä»Šå¤©è¦è®¨è®ºçš„Conditionæ¥å£ã€‚Conditionæ¥å£å’ŒObjectç±»çš„ç›‘è§†å™¨æ–¹æ³•æœ‰ç›¸åŒåˆæœ‰ä¸åŒã€‚ å®šä¹‰å…ˆæ¥çœ‹ä¸‹Conditionæ¥å£é‡Œå®šä¹‰çš„æ–¹æ³•ï¼š æ˜¯ä¸æ˜¯å’ŒObjectä¸­å®šä¹‰çš„æ–¹æ³•å¾ˆç±»ä¼¼ã€‚ ä½¿ç”¨ConditionObjectç±»å®ç°äº†Conditionæ¥å£ï¼Œä½œä¸ºä¸€ä¸ªAQSçš„å†…éƒ¨ç±»ï¼Œæ‰€ä»¥å®ƒçš„åˆ›å»ºä¾é äºLockå¯¹è±¡ï¼Œé€šè¿‡newCondition()æ–¹æ³•åˆ›å»ºå®ƒã€‚ ä½¿ç”¨ä¹Ÿååˆ†ç®€å•ï¼Œä½†æ˜¯è®°å¾—ä½¿ç”¨æ—¶è¦åŠ é”ã€‚ 12345678910111213141516171819202122Lock lock = new ReentrantLock() ;Condition condition = lock.newCondition();//çº¿ç¨‹Alock.lock();try &#123; condition.await();&#125; catch (InterruptedException e) &#123; e.printStackTrace();&#125;finally &#123; lock.unlock();&#125;//çº¿ç¨‹Block.lock();try&#123; condition.signal();&#125;catch(InterruptedException e)&#123; e.printStackTrace();&#125;finally&#123; lock.unlock();&#125; é˜»å¡é˜Ÿåˆ—å°±æ˜¯ä½¿ç”¨Conditionæ¥å®ç°ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„é€šä¿¡çš„ å®ç°Conditionä½œä¸ºAQSçš„å†…éƒ¨ç±»è¢«å®ç°ï¼Œæ‰€ä»¥å®ƒæ˜¯å¯ä»¥å…±äº«ä¸€äº›AQSçš„èµ„æºçš„ã€‚ Conditionçš„å®ç°æœ‰ä¸‰ä¸ªå…³é”®ç‚¹ï¼šç­‰å¾…é˜Ÿåˆ—ã€ç­‰å¾…å’Œé€šçŸ¥ã€‚ åŒæ­¥é˜Ÿåˆ—å’Œç­‰å¾…é˜Ÿåˆ—åŒæ­¥é˜Ÿåˆ—ï¼šçº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€å¤±è´¥æ—¶ä¼šè¿›å…¥çš„é˜Ÿåˆ—ï¼Œé¦–èŠ‚ç‚¹è¡¨ç¤ºè·å–åŒæ­¥çŠ¶æ€æˆåŠŸçš„èŠ‚ç‚¹ã€‚ ç­‰å¾…é˜Ÿåˆ—ï¼šå­˜æ”¾è°ƒç”¨äº†Condition.await()æ–¹æ³•çš„çº¿ç¨‹èŠ‚ç‚¹ã€‚ await()å½“çº¿ç¨‹æ‰§è¡ŒCondition.await()æ—¶ï¼Œçº¿ç¨‹èŠ‚ç‚¹ä»åŒæ­¥é˜Ÿåˆ—ä¸­è¢«ç§»é™¤ï¼ŒåŠ å…¥å¯¹åº”Conditionçš„ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚ signal()å½“çº¿ç¨‹æ‰§è¡ŒCondition.signal()æ—¶ï¼Œå¯¹åº”Conditionç­‰å¾…é˜Ÿåˆ—ä¸­çš„é¦–èŠ‚ç‚¹è¢«ç§»é™¤ï¼Œè½¬è€ŒåŠ å…¥çš„åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºåŒä¸€ä¸ªLockï¼Œç­‰å¾…é˜Ÿåˆ—æ˜¯å¯ä»¥æœ‰å¤šä¸ªçš„ã€‚ åŒæ—¶å¯ä»¥å‘ç°ï¼Œå¯¹äºä¸€ä¸ªçº¿ç¨‹èŠ‚ç‚¹ï¼Œè¦ä¹ˆåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œè¦ä¹ˆåœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"Lock","slug":"Lock","permalink":"http://example.com/tags/Lock/"}]},{"title":"Javaåˆ›å»ºçº¿ç¨‹çš„æ–¹å¼","slug":"Javaåˆ›å»ºçº¿ç¨‹çš„æ–¹å¼","date":"2019-11-11T06:34:02.000Z","updated":"2019-11-11T06:34:02.000Z","comments":true,"path":"2019/11/11/Javaåˆ›å»ºçº¿ç¨‹çš„æ–¹å¼/","link":"","permalink":"http://example.com/2019/11/11/Java%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E7%9A%84%E6%96%B9%E5%BC%8F/","excerpt":"","text":"ç»§æ‰¿Threadç±»ç»§æ‰¿Threadç±»ï¼Œé‡å†™run()æ–¹æ³•ã€‚ 1234567891011public class ExtendThread extends Thread &#123; @Override public void run() &#123; super.run(); System.out.println(&quot;this is sub thread extends from Thread&quot;); &#125; public static void main(String[] args) &#123; new ExtendThread().start(); &#125;&#125; javaä¸­æ˜¯å•ç»§æ‰¿ï¼Œå¦‚æœä½¿ç”¨è¿™ç§æ–¹å¼çš„è¯ï¼Œæ¯ä¸ªç±»å³æ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚ å®ç°Runnableæ¥å£é‡å†™run()æ–¹æ³•ã€‚ 1234567891011121314public class RunnableThread implements Runnable &#123; @Override public void run() &#123; System.out.println(&quot;this is thread implements Runnable&quot;); &#125; public static void main(String[] args) &#123; Runnable runnable = new RunnableThread() ; new Thread(runnable).start(); &#125;&#125; Callable+Futureå…ˆçœ‹ä¸‹Callableæ¥å£çš„å®šä¹‰ 12345678910public interface Callable&lt;V&gt; &#123; /** * Computes a result, or throws an exception if unable to do so. * * @return computed result * @throws Exception if unable to compute a result */ V call() throws Exception;&#125; å†æ¥çœ‹ä¸‹Future 12345678public interface Future &#123; boolean cancel(boolean mayInterruptIfRunning); boolean isCancelled(); boolean isDone(); V get() throws InterruptedException, ExecutionException; V get(long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException;&#125; æˆ‘ä»¬ä¸€èˆ¬é…åˆçº¿ç¨‹æ± æ¥ä½¿ç”¨ï¼Œå› ä¸ºï¼š 1` Future submit(Callable task);`` Future submit(Runnable task, T result);``Future submit(Runnable task);` ä¾‹å­ï¼š 12345678910111213141516171819public class CallableThread implements Callable&lt;Integer&gt; &#123; @Override public Integer call() throws Exception &#123; int sum = 0; for (int i=0; i&lt;100; i++) sum += i ; return sum; &#125; public static void main(String[] args) throws ExecutionException, InterruptedException &#123; ExecutorService service = new ThreadPoolExecutor(5,10,60L, TimeUnit.SECONDS,new ArrayBlockingQueue(10)); Future future = service.submit(new CallableThread()) ; System.out.println(future.get()); &#125;&#125; ä¸Šé¢å®ç°Runnableæ¥å£å·²ç»æ¯”ç»§æ‰¿è‡ªThreadç±»çš„å®ç°æ–¹æ³•æ›´ä¸ºä¼˜é›…äº†ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ— æ³•è·å¾—å­çº¿ç¨‹çš„æ‰§è¡Œç»“æœã€‚è¿™æ—¶å€™å°±éœ€è¦Callableæ¥å£ï¼Œå®ƒå’ŒRunnableæ¥å£æ•ˆæœå·®ä¸å¤šï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯æœ‰è¿”å›å€¼ã€‚è¿™é‡Œé…åˆFutureæ¥æ¥æ”¶ã€‚ Callable+FutureTaskFutureTask 1public class FutureTask&lt;V&gt; implements RunnableFuture&lt;V&gt; 1public interface RunnableFuture&lt;V&gt; extends Runnable, Future&lt;V&gt; ä¾‹å­ï¼š 123456789101112131415161718192021222324public class FutureTaskThread implements Callable&lt;Integer&gt; &#123; @Override public Integer call() throws Exception &#123; int sum = 0; for (int i=0; i&lt;100; i++) sum += i ; return sum; &#125; public static void main(String[] args) &#123; FutureTask futureTask = new FutureTask(new FutureTaskThread()) ; ExecutorService service = new ThreadPoolExecutor(5,10,60L, TimeUnit.SECONDS,new ArrayBlockingQueue&lt;&gt;(10)); service.submit(futureTask) ; try &#123; System.out.println(futureTask.get()); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; catch (ExecutionException e) &#123; e.printStackTrace(); &#125; &#125;&#125;","categories":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}]},{"title":"Javaçº¿ç¨‹æ± ","slug":"Javaçº¿ç¨‹æ± ","date":"2019-11-07T12:44:46.000Z","updated":"2019-11-07T12:44:46.000Z","comments":true,"path":"2019/11/07/Javaçº¿ç¨‹æ± /","link":"","permalink":"http://example.com/2019/11/07/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0/","excerpt":"","text":"ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± çº¿ç¨‹æ± ï¼Œå’Œè¿æ¥æ± ã€å¸¸é‡æ± ä¸€æ ·ï¼Œæ˜¯ä¸€ç§æ± åŒ–æ€æƒ³ã€‚å¤§æ¦‚æ„æ€æ˜¯é¢„å…ˆæŠŠçº¿ç¨‹éƒ½åˆ›å»ºå¥½ï¼Œæ”¾åˆ°ä¸€ä¸ªæ± å­é‡Œï¼Œç”¨çš„æ—¶å€™å°±å»æ‹¿ï¼Œç”¨å®Œäº†å†ç»™ä¸‹ä¸€ä¸ªä»»åŠ¡ç”¨ï¼Œä»¥è¾¾åˆ°ä¸€ç§èµ„æºçš„é«˜æ•ˆåˆ©ç”¨ã€‚ ä¸ºä»€ä¹ˆè¦æœ‰çº¿ç¨‹æ± ä¸ºä»€ä¹ˆè¦æœ‰çº¿ç¨‹æ± ï¼Ÿå’Œè¿™ä¸ªé—®é¢˜ç›¸å¯¹åº”çš„ä¸€ä¸ªé—®é¢˜æ˜¯ä¸ç”¨çº¿ç¨‹æ± è¡Œä¸è¡Œï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨æƒ³ä½¿ç”¨å¤šçº¿ç¨‹çš„æ—¶å€™ç›´æ¥newä¸€ä¸ªThreadä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œé‚£ä¹ˆè¿™ä¸¤ç§æ–¹å¼æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿæ¯ç”¨ä¸€æ¬¡newä¸€æ¬¡è¿™æ ·æ€§èƒ½æ˜¯å¾ˆå·®çš„ï¼Œè€Œä¸”ç”¨ä¸€æ¬¡ï¼Œnewä¸€æ¬¡ï¼Œå¾ˆéº»çƒ¦ï¼Œè€Œä¸”è¿™äº›çº¿ç¨‹ä¹‹é—´å¾ˆéš¾ç»Ÿä¸€ç®¡ç†ã€‚å¦‚æœä½¿ç”¨çº¿ç¨‹æ± ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›çº¿ç¨‹é‡å¤åˆ©ç”¨ï¼Œé¿å…é‡å¤åˆ›å»ºï¼Œæµªè´¹ç³»ç»Ÿèµ„æºï¼ŒåŒæ—¶æ–¹ä¾¿æˆ‘ä»¬ç»Ÿä¸€ç®¡ç†ï¼Œæ¯”å¦‚å¹¶å‘æ•°é‡ï¼Œå®šæ—¶æ‰§è¡Œç­‰ã€‚ è®¾è®¡æ€æƒ³äº†è§£äº†ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ä»¥åŠä¸ºä»€ä¹ˆè¦æœ‰çº¿ç¨‹æ± ä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹åœ¨Javaä¸­æ˜¯å¦‚ä½•è®¾è®¡çº¿ç¨‹æ± çš„ã€‚ é¦–å…ˆçº¿ç¨‹æ± çº¿ç¨‹æ± ï¼Œæ—¢ç„¶æ˜¯ä¸ªæ± å­ï¼Œé‚£ä¹Ÿå°±æ˜¯ä¸ªå®¹å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸ªå®¹å™¨æ¥è£…è¿™äº›çº¿ç¨‹ï¼Œåœ¨Javaä¸­è¿™ä¸ªå®¹å™¨ï¼ˆæ± å­ï¼‰æ˜¯HashSet. çº¿ç¨‹æ± çš„è®¾è®¡ä¸­æœ‰ä¸‰ä¸ªä¸»è¦æ¨¡å—ï¼š æ ¸å¿ƒæ± ï¼ˆcore poolï¼‰ æœ€å¤§æ± (maximum pool) é˜Ÿåˆ—ï¼ˆBlockingQueueï¼‰ å¤§æ¦‚æ€æƒ³æ˜¯è¿™æ ·çš„ï¼Œå½“éœ€è¦åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œæˆ‘å…ˆæ£€æŸ¥æ± å­ä¸­å·²æœ‰çš„çº¿ç¨‹ï¼ˆWorkerï¼‰æ•°é‡æ˜¯å¦å¤§äºæ ¸å¿ƒæ± æ•°é‡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œç»§ç»­åœ¨æ ¸å¿ƒæ± é‡Œåˆ›å»ºçº¿ç¨‹ï¼ˆWorkerï¼‰. å¦‚æœæ ¸å¿ƒæ± å·²ç»æ»¡äº†ï¼Œé‚£å†æœ‰æ–°çš„çº¿ç¨‹éœ€è¦æ‰§è¡Œï¼Œæˆ‘å…ˆæŠŠå®ƒæ”¾åˆ°ä¸€ä¸ªé˜Ÿåˆ—é‡Œå€™ç€ã€‚ å¦‚æœé˜Ÿåˆ—ä¹Ÿæ»¡äº†ï¼Œç°åœ¨è€ƒè™‘å¾€æœ€å¤§æ± é‡Œåˆ›å»ºçº¿ç¨‹ï¼ˆWorkerï¼‰ã€‚å…³äºcore poolå’Œmaximum poolçš„å…³ç³»æ˜¯è¿™æ ·çš„ï¼Œcore poolç›¸å½“äºå…¬å¸çš„æ­£å¼å‘˜å·¥ï¼Œmaximum poolç›¸å½“äºä¸´æ—¶å·¥ã€‚å½“æœ‰é¡¾å®¢æ¥æ—¶ï¼Œå…ˆä»…ç€æ­£å¼å‘˜å·¥ç”¨ï¼Œæ­£å¼å‘˜å·¥ä¸å¤Ÿäº†ï¼Œè®©é¡¾å®¢å…ˆåœ¨å¤§å…ä¼‘æ¯ä¸€å“ˆï¼Œå¦‚æœå¤§å…ä¹Ÿæ»¡äº†ï¼Œå†è®©ä¸´æ—¶å·¥ä¹Ÿå·¥ä½œèµ·æ¥ã€‚ å¦‚æœmaximum poolä¹Ÿæ»¡äº†ï¼Œåˆ™æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚ æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæµç¨‹å›¾æ¥å±•ç¤ºä¸‹å®ƒçš„æ‰§è¡Œè¿‡ç¨‹ï¼š æºç åˆ†ææ¥ä¸‹æ¥æˆ‘ä»¬ä»æºç è§’åº¦æ›´ç»†è‡´åœ°åˆ†æä¸€ä¸‹ä¸Šè¿°è¿‡ç¨‹ã€‚ é¦–å…ˆçœ‹æ„é€ å‡½æ•° corePoolSize: æ ¸å¿ƒçº¿ç¨‹æ•°ã€‚ maximumPoolSize: æœ€å¤§çº¿ç¨‹æ•° workQueue: workeræ•°é‡è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°åè¦åŠ å…¥çš„é˜Ÿåˆ— keepAliveTime: ä¸´æ—¶å·¥çš„æœ€å¤§å­˜æ´»æ—¶é—´ï¼Œå¦‚æœä¸´æ—¶å·¥è¶…è¿‡è¿™ä¸ªæ—¶é—´è¿˜æ²¡æœ‰å·¥ä½œï¼Œå°±ä¼šè¢«é”€æ¯ã€‚ threadFactory: ç”¨æ¥åˆ›å»ºçº¿ç¨‹çš„å·¥å‚ã€‚ handler: çº¿ç¨‹æ± æ‹’ç»ç­–ç•¥ã€‚ å†æ¥çœ‹ä¸‹å…³äºçº¿ç¨‹æ± çŠ¶æ€å’Œçº¿ç¨‹æ•°é‡çš„ç›¸å…³å®šä¹‰ï¼š ä½¿ç”¨åŸå­å˜é‡ctlçš„é«˜ä¸‰ä½è¡¨ç¤ºçº¿ç¨‹çŠ¶æ€ï¼Œä½29ä½æ ‡è¯†çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡ã€‚ å†æ¥çœ‹ä¸‹çº¿ç¨‹æ± ä¸­æœ€é‡è¦çš„æ–¹æ³•execute(): å…¶å®æ³¨é‡Šå·²ç»è®²çš„å¾ˆæ¸…æ¥šäº†ï¼Œè¿™é‡Œä¸‰ä¸ªæ¡†åˆ†åˆ«ä»£è¡¨ä¸Šé¢ä¸€èŠ‚ä¸­çš„åŠ å…¥æ ¸å¿ƒæ± ï¼ŒåŠ å…¥é˜Ÿåˆ—ä»¥åŠåŠ å…¥æœ€å¤§æ± ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨åŠ å…¥é˜Ÿåˆ—çš„æ—¶å€™ï¼Œæ˜¯è¿›è¡Œäº†ä¸€ä¸ªdouble checkçš„ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨å°†ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—åé‡æ–°åˆ¤æ–­çº¿ç¨‹æ± æ˜¯å¦åœ¨è¿è¡Œï¼Œå¦‚æœä¸åœ¨è¿è¡Œåˆ™æ‰§è¡Œæ‹’ç»ç­–ç•¥ï¼Œå¦‚æœåœ¨è¿è¡Œä½†æ˜¯workeræ•°é‡ä¸ºé›¶åˆ™æ–°å¢éæ ¸å¿ƒçº¿ç¨‹ã€‚å¦å¤–ä¸€ä¸ªç‚¹å°±æ˜¯ä½•æ—¶æ‰§è¡Œæ‹’ç»ç­–ç•¥ï¼Ÿä¸¤ç§æƒ…å†µï¼šçº¿ç¨‹æ± shutdownæˆ–è€…çº¿ç¨‹æ± æ»¡ã€‚ å†æ¥çœ‹ä¸‹addWorker()æ–¹æ³•å¹²äº†äº›å•¥ï¼š ä½¿ç”¨å¸¸è§æœ‰ä¸¤ç§åˆ›å»ºæ–¹å¼ ä½¿ç”¨ThreadPoolExecutor()åˆ›å»º 1ExecutorService executorService = new ThreadPoolExecutor(5,10,60L,TimeUnit.SECONDS, new ArrayBlockingQueu(10)) æäº¤ä»»åŠ¡æ—¶ï¼š 123executorService.execute(new Runnable()&#123; //çœç•¥è‹¥å¹²è¡Œä»£ç &#125;) ä½¿ç”¨Executoræ¡†æ¶åˆ›å»º 1ExecutorService executorService1 = Executors.newFixedThreadPool(5); ä½†æ˜¯ï¼Œã€Šé˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œã€‹ä¸­æœ‰è¿™æ ·çš„è§„å®šï¼š æˆ‘ä»¬ä»¥FixedThreadPoolä¸ºä¾‹æ¥çœ‹ä¸‹ è¿™é‡Œçš„é˜Ÿåˆ—ç”¨çš„æ˜¯LinkedBlockingQueue&lt;&gt;ï¼Œ æ²¡æœ‰åˆå§‹åŒ–å®¹é‡ï¼Œåˆ™é»˜è®¤çš„å°±æ˜¯Integer.MAX_VALUEï¼Œå› æ­¤å¦‚æœä¸æ–­çš„å‘é˜Ÿåˆ—ä¸­å¡ä»»åŠ¡çš„è¯ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´OOM.","categories":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}],"tags":[{"name":"çº¿ç¨‹æ± ","slug":"çº¿ç¨‹æ± ","permalink":"http://example.com/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/"}]},{"title":"MySQLç´¢å¼•ç¯‡","slug":"MySQLç´¢å¼•ç¯‡","date":"2019-11-06T08:47:54.000Z","updated":"2019-11-06T08:47:54.000Z","comments":true,"path":"2019/11/06/MySQLç´¢å¼•ç¯‡/","link":"","permalink":"http://example.com/2019/11/06/MySQL%E7%B4%A2%E5%BC%95%E7%AF%87/","excerpt":"","text":"æåˆ°MySQLç´¢å¼•ï¼Œéƒ½ä¼šè®²åˆ°Bæ ‘å’ŒB+æ ‘ï¼Œä»Šå¤©æ¥æ¢³ç†ä¸€ä¸‹ã€‚ æœ€å¼€å§‹æ˜¯äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œä½†æ˜¯è¿™ç§æ ‘ä¸å¹³è¡¡ï¼Œæœ‰æ—¶å€™ä¼šé€€åŒ–æˆä¸€æ¡é“¾è¡¨ï¼Œä½¿å¾—æŸ¥æ‰¾æ—¶é—´è¾¹é•¿ï¼Œäºæ˜¯å°±æœ‰äº†äºŒå‰å¹³è¡¡æ ‘ã€‚ ç†è®ºä¸Šè®²ï¼ŒäºŒå‰å¹³è¡¡æ ‘å·²ç»èƒ½æ»¡è¶³ä¸€äº›æŸ¥æ‰¾éœ€æ±‚äº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰Bæ ‘å‘¢ï¼Ÿ å› ä¸ºæ•°æ®åº“åœ¨ç£ç›˜ä¸­ï¼Œè€ŒæŸ¥æ‰¾çš„æ—¶å€™éœ€è¦è¯»ä¸€éƒ¨åˆ†æ•°æ®åˆ°ç£ç›˜ä¸­ï¼Œè¿™å°±æ¶‰åŠåˆ°äº†IOï¼ŒIOçš„æ—¶å€™æ˜¯ä»¥ç£ç›˜å—ä¸ºå•ä½è¯»å–çš„ï¼Œæˆ–è€…è¯´æ˜¯ä»¥é¡µä¸ºå•ä½ã€‚æˆ‘ä»¬ä½¿ç”¨æ ‘è¿™ç§æ•°æ®ç»“æ„ï¼Œä¸€ä¸ªç£ç›˜å—åº”è¯¥åŒ…å«ä¸€ä¸ªæˆ–è€…è‹¥å¹²ä¸ªèŠ‚ç‚¹ï¼Œç„¶åä»¥èŠ‚ç‚¹ä¸ºå•ä½è¯»å…¥ã€‚é‚£ä¹ˆAVLæ ‘æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿå®ƒçš„æ¯ä¸ªèŠ‚ç‚¹å¤ªâ€œç˜¦å¼±â€äº†ï¼Œåªèƒ½è£…ä¸€ä¸ªé”®å€¼å¯¹ï¼Œå‡å¦‚ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªç£ç›˜å—çš„åŒ–ï¼Œè¿™å°±å¯¼è‡´æˆ‘ä»¬æŸ¥è¯¢çš„æ—¶å€™å¢å¤§IOæ¬¡æ•°ã€‚é‚£ä¹ˆæœ‰ä»€ä¹ˆå¯¹åº”åŠæ³•å‘¢ï¼Ÿå°±æ˜¯è®©æ¯ä¸ªèŠ‚ç‚¹â€œèƒ–ä¸€ç‚¹â€ï¼Œå³è®©æ¯ä¸ªèŠ‚ç‚¹å¤šè£…å‡ ä¸ªé”®å€¼å¯¹ã€‚è¿™å°±å¼•å‡ºäº†Bæ ‘ã€‚ Bæ ‘çªç ´äº†äºŒå‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰å¤šä¸ªé”®å€¼å¯¹ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒèŠ‚ç‚¹ä¸ªæ•°å‡å°‘ï¼Œæˆ‘ä»¬æŸ¥è¯¢çš„IOæ¬¡æ•°ä¹Ÿä¼šå‡å°‘ã€‚ é‚£è¿˜æœ‰æ²¡æœ‰ä¼˜åŒ–çš„ä½™åœ°å‘¢ï¼Ÿä¸Šé¢æˆ‘ä»¬è®²åˆ°æ¯ä¸ªèŠ‚ç‚¹éƒ½å«æœ‰å¤šä¸ªé”®å€¼å¯¹ï¼Œä¸ºäº†æ›´ä¸€æ­¥å……åˆ†åˆ©ç”¨èŠ‚ç‚¹çš„ç©ºé—´ï¼Œæˆ‘ä»¬å¯ä»¥è®©éå¶å­èŠ‚ç‚¹åªå«æœ‰é”®ï¼Œåªæœ‰å¶å­èŠ‚ç‚¹æ‰ä¼šåŒ…å«æ•°æ®ï¼Œä¹Ÿå°±æ˜¯é”®å¯¹åº”çš„å€¼ï¼Œè¿™ä¹ˆä¸€æ¥ï¼Œéå¶å­èŠ‚ç‚¹å°±èƒ½è£…æ›´å¤šçš„é”®äº†ï¼Œæ ‘çš„é«˜åº¦å’ŒèŠ‚ç‚¹æ•°å°±èƒ½æ›´è¿›ä¸€æ­¥è¢«é™ä½äº†ã€‚è¿™ç§åªç”¨å¶å­èŠ‚ç‚¹ä¿å­˜æ•°æ®çš„æ ‘å°±æ˜¯B+æ ‘äº†ã€‚ ä¸æ­¢å¦‚æ­¤ï¼Œåœ¨Bæ ‘çš„åŸºç¡€ä¸Šï¼ŒB+æ ‘çš„è¿˜ç”¨åŒå‘é“¾è¡¨é“¾æ¥èµ·äº†æ¯ä¸ªå¶å­èŠ‚ç‚¹ï¼Œè¿™æ ·æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿå¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ç°èŒƒå›´æŸ¥è¯¢ã€‚ è¿˜æœ‰ä¸€ä¸ªéœ€è¦äº†è§£çš„æ˜¯èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•ã€‚ æ‰€è°“èšç°‡ç´¢å¼•ï¼ŒæŒ‡çš„æ˜¯ä»¥ä¸»é”®ä½œä¸ºç´¢å¼•æ„å»ºB+æ ‘ï¼Œè€Œä¸”å¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®çš„ç´¢å¼•ç»“æ„ã€‚ éèšç°‡ç´¢å¼•ï¼Œé¦–å…ˆç´¢å¼•ä¸æ˜¯ä¸»é”®ï¼Œå…¶æ¬¡å®ƒçš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„ä¸æ˜¯æ•°æ®è€Œæ˜¯ç´¢å¼•å¯¹åº”çš„ä¸»é”®ï¼ˆéœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡ŒInnoDBå’ŒMyISAMå®ç°ç•¥æœ‰åŒºåˆ«ï¼ŒInnoDBå­˜æ”¾çš„æ˜¯ä¸»é”®ï¼Œè€ŒMyISAMå­˜å‚¨çš„æ˜¯æ–‡ä»¶åœ°å€ï¼Œæˆ‘ä»¬è¿™é‡Œä»¥InnoDBä¸ºä¸»è¿›è¡Œè®²è§£ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºéèšç°‡ç´¢å¼•ï¼Œä½ é¦–å…ˆéœ€è¦æ ¹æ®ç´¢å¼•æ‰¾åˆ°ä¸»é”®ï¼Œç„¶åå†æ ¹æ®ä¸»é”®è¿›è¡Œèšç°‡ç´¢å¼•æŸ¥æ‰¾ï¼Œè¿™ä¸€è¿‡ç¨‹æˆ‘ä»¬ç§°ä¹‹ä¸ºå›è¡¨ã€‚ æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ä½¿ç”¨ä¸»é”®è¿›è¡ŒæŸ¥è¯¢çš„å¥½å¤„ï¼šåªéœ€è¦æŸ¥è¯¢ä¸€é¢—B+æ ‘ï¼ˆè¿™é‡Œå†åŠ ä¸€ç‚¹ï¼Œå¯¹äºæ¯å¼ è¡¨æ¥è¯´ï¼Œæ¯ä¸ªç´¢å¼•å°±ç›¸å½“äºä¸€é¢—B+æ ‘ï¼‰ã€‚ åŒæ—¶ä¸€äº›æ–‡ç« é‡Œä¹Ÿä¼šæåˆ°ï¼Œé€šå¸¸è¦æ±‚æˆ‘ä»¬å»ºè¡¨çš„æ—¶å€™é€‰ä¸€ä¸ªè‡ªå¢ä¸»é”®ä½œä¸ºç´¢å¼•ï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·è¦æ±‚å‘¢ï¼Ÿå› ä¸ºç´¢å¼•åº•å±‚æ˜¯ç”±B+æ ‘å®ç°çš„ï¼Œè‡ªå¢ä¸»é”®å¯ä»¥ä½¿å¾—æˆ‘ä»¬å†æ’å…¥èŠ‚ç‚¹æ—¶å‡å°‘ä¸šåˆ†è£‚ï¼Œå½“å½“å‰é¡µæ»¡æ—¶åªéœ€è¦å†åˆ›å»ºä¸€ä¸ªæ–°é¡µç»§ç»­æ·»åŠ æ•°æ®å³å¯ï¼Œä¸ç”¨å¯¹ä¹‹å‰å·²æœ‰çš„é¡µè¿›è¡Œåˆ†è£‚ã€‚ é‚£ä¹ˆå°±åˆæœ‰ä¸€ä¸ªé—®é¢˜äº†ï¼Œè‡ªå¢ä¸»é”®å¦‚ä½•é€‰ï¼Ÿå‡å¦‚ä¸€ä¸ªè¡¨é‡Œæœ‰èº«ä»½è¯å·ï¼Œä¸”èƒ½å¤Ÿä¿è¯å®ƒæ˜¯è‡ªå¢çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒåšä¸»é”®å—ï¼Ÿå¯ä»¥æ˜¯å¯ä»¥ï¼Œä½†æ˜¯è¦çŸ¥é“ï¼Œæ™®é€šç´¢å¼•çš„å¶å­èŠ‚ç‚¹æ˜¯ä¸»é”®ï¼Œä½ ç”¨èº«ä»½è¯å·åšä¸»é”®ï¼Œè¿™æ„å‘³ç€å¶å­èŠ‚ç‚¹å°±å¾ˆå ç©ºé—´äº†ï¼Œè‚¯å®šæ²¡æœ‰æˆ‘ä»¬è‡ªå·±è®¾ç½®çš„è‡ªå¢ä¸»é”®åˆ’ç®—ã€‚ è”åˆç´¢å¼•ï¼Œè¦†ç›–ç´¢å¼•ï¼Œæœ€å·¦åŒ¹é…åŸåˆ™ã€‚ éƒ½è¯´åŠ ç´¢å¼•å¯ä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æŸ¥è¯¢æ—¶whereåé¢æœ‰å¤šä¸ªæ¡ä»¶æ—¶ï¼Œéš¾é“æˆ‘ä»¬è¦ä¸ºæ¯ä¸€åˆ—éƒ½åŠ ä¸ªç´¢å¼•å—ï¼Ÿå…¶å®ä¸æ˜¯çš„ï¼Œä¸€ç§æ›´å¥½çš„æ–¹æ³•æ˜¯å¯ä»¥åŠ è”åˆç´¢å¼•ï¼Œå¹¶ä¸”è”åˆç´¢å¼•æ˜¯æ»¡è¶³æœ€å·¦åŒ¹é…åŸåˆ™çš„ã€‚ä»€ä¹ˆæ„æ€å‘¢ï¼Œå‡å¦‚æˆ‘ä»¬å»ºç«‹äº†è”åˆç´¢å¼•key(a,b,c)ï¼Œé‚£ä¹ˆåœ¨ä»Šåçš„æŸ¥è¯¢ä¸­ï¼Œ(a), (a,b), (a,b,c)è¿™ä¸‰ç§æŸ¥è¯¢æ¡ä»¶éƒ½æ˜¯å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„è”åˆç´¢å¼•æ¥åŠ å¿«æŸ¥è¯¢é€Ÿåº¦çš„ã€‚ è¦†ç›–ç´¢å¼•ä¸»è¦æ˜¯é’ˆå¯¹éèšç°‡ç´¢å¼•å’Œè”åˆç´¢å¼•è¯´çš„ï¼ŒæŒ‡çš„æ˜¯å¶å­èŠ‚ç‚¹ä¸­å·²ç»åŒ…å«äº†æˆ‘ä»¬è¦æŸ¥è¯¢çš„åˆ—ï¼Œè¿™æ ·å°±å…çš„è¿›è¡Œå›è¡¨è¿™ä¸€æ“ä½œäº†ã€‚ æ€»ç»“ï¼š å…¶å®å¯ä»¥çœ‹åˆ°ï¼Œè¿™äº›æ•°æ®ç»“æ„éƒ½ä¸æ˜¯å‡­ç©ºäº§ç”Ÿï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸ºäº†æ»¡è¶³æŸä¸ªéœ€æ±‚æ‰è¢«äººä»¬åˆ›å»ºã€‚æ‰€ä»¥åœ¨æŸäº›ç¨‹åº¦ä¸Šï¼ŒçŸ¥é“ä¸€ç§æŠ€æœ¯ä¸ºä»€ä¹ˆå­˜åœ¨è¦æ¯”æŠ€æœ¯æœ¬èº«æ›´ä¸ºé‡è¦ï¼Œå¦åˆ™æ°¸è¿œåªèƒ½æ˜¯ä¸€ä¸ªæŠ€æœ¯çš„å­¦ä¹ è€…ï¼Œè€Œä¸æ˜¯ç¼”é€ è€…ã€‚","categories":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"tags":[{"name":"MySQL","slug":"MySQL","permalink":"http://example.com/tags/MySQL/"}]},{"title":"Spring IoC å®¹å™¨çš„å®ç°(ä¸€)","slug":"Spring-Iocå®¹å™¨çš„å®ç°-ä¸€","date":"2019-11-02T12:04:31.000Z","updated":"2019-11-02T12:04:31.000Z","comments":true,"path":"2019/11/02/Spring-Iocå®¹å™¨çš„å®ç°-ä¸€/","link":"","permalink":"http://example.com/2019/11/02/Spring-Ioc%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%9E%E7%8E%B0-%E4%B8%80/","excerpt":"","text":"æœ¬æ–‡å¼€é—¨è§å±±ï¼Œç›´æ¥è®¨è®ºSpring IoCå®¹å™¨çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚ å…³äºSpringå®¹å™¨ï¼Œæœ‰ä¸€ä¸ªæœ€åŸºæœ¬çš„æ¥å£ï¼Œå«åšBeanFacotory, å®ƒæä¾›äº†å®¹å™¨æœ€åŸºæœ¬çš„ä¸€äº›ç‰¹æ€§ã€‚æ‰€æœ‰çš„å®¹å™¨éƒ½æ˜¯åŸºäºå®ƒçš„ã€‚è¿˜æœ‰ä¸€ä¸ªè¾ƒä¸ºé«˜çº§ä¸€ç‚¹çš„å®¹å™¨æ¥å£ï¼Œå«åšApplicationContextï¼Œå®ƒåœ¨BeanFactoryçš„åŸºç¡€ä¸Šï¼Œåˆæä¾›äº†å…¶ä»–ä¸€äº›é«˜çº§ç‰¹æ€§ï¼Œæ¯”å¦‚è®¿é—®èµ„æºã€‚ æœ¬æ–‡ä»¥ApplicationContextçš„ä¸€ä¸ªå…·ä½“å®ç°ç±»FileSystemXmlApplicationContextä¸ºä¾‹ï¼Œæ¢ç©¶springå®¹å™¨çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚å…ˆæ¥çœ‹ä¸‹å®ƒçš„ä¸»è¦ä»£ç ã€‚ æ˜¾ç¤ºæ„é€ å‡½æ•°ï¼š 123456789public FileSystemXmlApplicationContext(String[] configLocations, boolean refresh, ApplicationContext parent) throws BeansException &#123; super(parent); setConfigLocations(configLocations); if (refresh) &#123; refresh(); &#125; &#125; è¿™é‡Œçš„refresh()æ–¹æ³•æ ‡å¿—ç€å®¹å™¨åˆå§‹åŒ–çš„å¯åŠ¨ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬åé¢åˆ†æçš„é‡ç‚¹ã€‚ è¿˜æœ‰ä¸€ä¸ªæ–¹æ³• 123456protected Resource getResourceByPath(String path) &#123; if (path != null &amp;&amp; path.startsWith(&quot;/&quot;)) &#123; path = path.substring(1); &#125; return new FileSystemResource(path); &#125; å®ƒä¼šåœ¨å¯åŠ¨å®¹å™¨çš„è¿‡ç¨‹ä¸­è°ƒç”¨ã€‚ å…ˆçœ‹ä¸‹FileSystemXmlApplicationContextçš„ç»§æ‰¿å…³ç³» ä¸‹é¢æ­£å¼åˆ†æBeanDefinitionçš„Resourceå®šä½ refresh()æ–¹æ³•åœ¨AbstractApplicationContextä¸­å®ç°ï¼š ä»£ç è™½é•¿ï¼Œå…¶å®åªåšäº†ä¸¤ä»¶äº‹ï¼šæ¡†å‡ºæ¥çš„éƒ¨åˆ†åˆ›å»ºå®¹å™¨ï¼Œå‰©ä½™éƒ¨åˆ†å¯¹åˆ›å»ºå¥½çš„å®¹å™¨è¿›è¡Œä¸€ç³»åˆ—è®¾ç½®ã€‚ç»§ç»­æ¥çœ‹åˆ›å»ºå®¹å™¨çš„éƒ¨åˆ†ï¼š è¿™é‡Œçš„refreshBeanFactory()æ˜¯ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œåœ¨AbstractRefreshableApplicationContextä¸­å®ç°ã€‚ AbstractRefreshableApplicationContext ç»§ç»­æ¥çœ‹createBeanFactory() 123protected DefaultListableBeanFactory createBeanFactory() &#123; return new DefaultListableBeanFactory(getInternalParentBeanFactory()); &#125; è¿”å›ä¸€ä¸ªDefaultListableBeanFactoryå®¹å™¨ å†çœ‹loadBeanDefinitions(), å®ƒåŒæ ·æ˜¯ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå®ƒåœ¨AbstractXmlApplicationContextä¸­å®ç° å®ƒå…ˆåˆ›å»ºä¸€ä¸ªreaderï¼Œç„¶åé€šè¿‡è¿™ä¸ªreaderåŠ è½½BeanDefinition,ç»§ç»­çœ‹å®ƒçš„é‡è½½æ–¹æ³• å¯¹äºxmlçš„ä¸Šä¸‹æ–‡æ¥è¯´ï¼Œå®ƒèµ°çš„åº”è¯¥æ˜¯ç¬¬äºŒä¸ªif, é‡Œé¢è°ƒç”¨äº†XmlBeanDefinitionReader çš„loadBeanDefinitions()æ–¹æ³•ï¼Œç»§ç»­çœ‹ ç»§ç»­çœ‹å®ƒçš„é‡è½½æ–¹æ³• ç»§ç»­æ¥çœ‹å…·ä½“æ˜¯å¦‚ä½•è·å–èµ„æºçš„ï¼š ResourceLoaderæ˜¯ä¸ªæ¥å£ï¼Œè¿™é‡Œä½¿ç”¨äº†DefaultResourceLoaderç±»å®ç°çš„æ–¹æ³• å¥½ï¼Œåˆ°æ­¤æ•´ä¸ªåˆ†æè¿‡ç¨‹å·®ä¸å¤šç»“æŸäº†ï¼Œé‡æ–°æ¢³ç†ä¸€ä¸‹ï¼š åœ¨BeanDefinitonçš„Resourceå®šä½ä¸­ï¼Œå§‹äºFileSystemXmlApplicationContextçš„refresh()æ–¹æ³•ï¼Œè¿™é‡Œæ˜¯å®¹å™¨åˆå§‹åŒ–çš„å¼€ç«¯ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å®šä½èµ„æºçš„å¼€ç«¯ã€‚ è¿™é‡Œçš„refresh()æ–¹æ³•æ¥è‡ªçˆ¶ç±»AbstractApplicationContext, è¿™ä¸ªæ–¹æ³•é‡Œé¢è·å¾—äº†å®¹å™¨å¹¶å¯¹å®¹å™¨è¿›è¡Œäº†ä¸€ç³»åˆ—æ“ä½œã€‚ è¿™é‡Œè·å¾—å®¹å™¨çš„æ–¹obtainFreshBeanFactory()ä½¿ç”¨äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œé‡Œé¢çš„æ¨¡æ¿æ–¹æ³•refreshBeanFactory()äº¤ç”±å…·ä½“å­ç±»å®ç°ï¼Œåœ¨è¿™é‡Œæ˜¯ç”±å­ç±»AbstractRefreshableApplicationContextå®ç°ã€‚ åœ¨AbstractRefreshableApplicationContextçš„refreshBeanFactory()ä¸­ï¼Œåˆ›å»ºäº†å®¹å™¨ï¼Œå¹¶è¿›è¡ŒBeanDefinitionçš„åŠ è½½ã€‚ è¿™ä¸ªåŠ è½½æ–¹æ³•loadBeanDefinitons()åŒæ ·æ˜¯æ¨¡æ¿æ–¹æ³•ï¼Œæ¶‰åŠä¸€ç³»åˆ—çš„è°ƒç”¨ã€‚å…·ä½“å®ƒæ˜¯é€šè¿‡ä¸€ä¸ªBeanDefinitonReaderæ¥åŠ è½½BeanDefinitionçš„ï¼ŒåŠ è½½çš„è¿‡ç¨‹ä¸­å°±æ¶‰åŠåˆ°å¯¹å„ç§å½¢å¼locationçš„è§£æã€‚è§£æå®Œä¹‹åå·®ä¸å¤šå°±çœŸæ­£å®Œæˆäº†å¯¹resourceçš„å®šä½äº†ã€‚ æ€»çš„æ¥è¯´ï¼Œåšäº†ä¸¤ä»¶äº‹ã€‚ç›®çš„æ˜¯åˆå§‹åŒ–å®¹å™¨ï¼Œé¦–å…ˆä½ å¾—æœ‰ä¸ªå®¹å™¨ï¼Œæ¯”å¦‚æ¡¶ï¼Œå…¶æ¬¡ä½ å¾—æœ‰æ°´ï¼Œé‚£ä¹ˆå°±å¾—æ‰¾åˆ°æ°´åœ¨å“ªï¼Œä¸Šé¢ä¸»è¦æè¿°çš„å°±æ˜¯ä¸€ä¸ªæ‰¾æ°´çš„è¿‡ç¨‹ã€‚ èµ·æºäºrefresh,ä½†æ˜¯è¦æ‰¾åˆ°æ°´ï¼Œè¿˜éœ€è¦é Reader ç›¸å½“äºä¸‹é¢è¿™ä¸ªè¿‡ç¨‹ 1234ClassPahtResource res = new ClassPathResouce(&quot;bean.xml&quot;) ;DefaultListableBeanFactory factory = new DefaultListableBeanFactory();XmlBeanDefinitionReader reader = new XmlBeanDefinionReader(factory);reader.loadBeanDifinition(res) ; ä½¿ç”¨IoCå®¹å™¨æ—¶ï¼Œéœ€è¦ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼ˆå³åˆå§‹åŒ–å®¹å™¨çš„æ­¥éª¤ï¼‰ï¼š åˆ›å»ºæŠ½è±¡èµ„æºï¼ŒåŒ…æ‹¬Iocé…ç½®æ–‡ä»¶ï¼ŒBeandefiniton åˆ›å»ºBeanFactory åˆ›å»ºreader,è¯»å–BeanDefinitionå¹¶å›ä¼ ç»™BeanFactory,å®Œæˆè½½å…¥å’Œæ³¨å†Œã€‚ ç”»ä¸€ä¸ªè°ƒç”¨çš„å…³ç³»å›¾å°±èƒ½æ›´å¥½çš„ç†è§£è¿™ä¸ªè¿‡ç¨‹äº†ã€‚ â€‹ å‚è€ƒã€ŠSpringæŠ€æœ¯å†…å¹•ã€‹","categories":[{"name":"æ¡†æ¶","slug":"æ¡†æ¶","permalink":"http://example.com/categories/%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"http://example.com/tags/Spring/"}]},{"title":"Spring Iocå®¹å™¨å®ç°ä¹‹BeanDefinitionçš„Resourceå®šä½","slug":"Spring-Iocå®¹å™¨å®ç°ä¹‹BeanDefinitionçš„Resourceå®šä½","date":"2019-11-02T12:03:58.000Z","updated":"2019-11-02T12:03:58.000Z","comments":true,"path":"2019/11/02/Spring-Iocå®¹å™¨å®ç°ä¹‹BeanDefinitionçš„Resourceå®šä½/","link":"","permalink":"http://example.com/2019/11/02/Spring-Ioc%E5%AE%B9%E5%99%A8%E5%AE%9E%E7%8E%B0%E4%B9%8BBeanDefinition%E7%9A%84Resource%E5%AE%9A%E4%BD%8D/","excerpt":"","text":"","categories":[],"tags":[]},{"title":"æ’åºæ€»ç»“","slug":"æ’åºæ€»ç»“","date":"2019-11-01T07:54:53.000Z","updated":"2019-11-01T07:54:53.000Z","comments":true,"path":"2019/11/01/æ’åºæ€»ç»“/","link":"","permalink":"http://example.com/2019/11/01/%E6%8E%92%E5%BA%8F%E6%80%BB%E7%BB%93/","excerpt":"","text":"åç§å¸¸è§ç»å…¸æ’åº æ¯”è¾ƒæ’åºï¼š é€šè¿‡æ¯”è¾ƒæ¥å†³å®šå…ƒç´ é—´çš„ç›¸äº’é¡ºåº éæ¯”è¾ƒæ’åºï¼š ï¼ˆå†’æ³¡æ’åºï¼Œå¿«æ’ï¼Œæ’å…¥ï¼Œé€‰æ‹©ï¼ŒåŸºæ•°ï¼Œæ¡¶ï¼Œå¸Œå°”ï¼Œå½’å¹¶ï¼Œå †ï¼‰ å†’æ³¡æ’åºç®—æ³•æ€æƒ³ç›¸é‚»å…ƒç´ ä¸¤ä¸¤æ¯”è¾ƒï¼Œå°†è¾ƒå¤§ï¼ˆè¾ƒå°ï¼‰çš„äº¤æ¢åˆ°åé¢ã€‚ ä»£ç 123456789101112public int[] bubbleSort(int[] arr)&#123; for(int i=0; i&lt;arr.length; i++)&#123; for(int j=0; j&lt;arr.length-i-1; j++)&#123; if(arr[j]&gt;arr[j+1])&#123; int t = arr[j] ; arr[j] = arr[j+1] ; arr[j+1] = t ; &#125; &#125; &#125; return arr ;&#125; å¤æ‚åº¦åˆ†ææ—¶é—´å¤æ‚åº¦ï¼š$O(n^2)$ ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$ æ˜¯å¦ç¨³å®šç¨³å®š é€‰æ‹©æ’åº1. ç®—æ³•æ€æƒ³å°†æ•´ä¸ªæ•°ç»„åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šæœ‰åºçš„å’Œæ— åºçš„ï¼Œæ¯æ¬¡ä»æ— åºçš„é‚£ä¸€éƒ¨åˆ†ä¸­é€‰æ‹©æœ€å°ï¼ˆæœ€å¤§ï¼‰çš„è¿½åŠ åœ¨æœ‰åºéƒ¨åˆ†çš„æœ«å°¾ã€‚ 2. ä»£ç 1234567891011121314public int[] selectionSort(int[] arr)&#123; for(int i=0; i&lt;arr.length; i++)&#123; int minIdx = i; //ç”¨æ¥å®šä½æ¯æ¬¡æœ€å°å€¼çš„ä½ç½® for(int j=i+1; j&lt;arr.length; j++)&#123; //å†…å±‚å¾ªç¯ç”¨æ¥é€‰æ‹©æœ€å°å€¼,æ¯ä¸ªå…ƒç´ å’Œå½“å‰æœ€å°å€¼æ¯”è¾ƒ if(arr[j]&lt;arr[minIdx])&#123; minIdx = j ; &#125; &#125; int t = arr[i] ; arr[i] = arr[minIdx] ; arr[minIdx] = t ; &#125; return arr ;&#125; 3. å¤æ‚åº¦åˆ†ææ—¶é—´å¤æ‚åº¦ï¼š$O(n^2)$ ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$ 4. æ˜¯å¦ç¨³å®šé€‰æ‹©æ’åºæ¶‰åŠåˆ°å½“å‰ä½ç½®å…ƒç´ å’ŒååŠæ®µæœ€å°å…ƒç´ çš„äº¤æ¢ï¼Œäº¤æ¢çš„ä¸¤ä¸ªå…ƒç´ ä¸ä¸€å®šç›¸é‚»ï¼Œä¸­é—´å¯èƒ½å¤¹æ‚ç€å’Œå®ƒä»¬ç›¸ç­‰çš„å…ƒç´ ï¼Œæ‰€ä»¥ä¸ç¨³å®šã€‚ æ’å…¥æ’åº ç®—æ³•æ€æƒ³ åŸºæœ¬æ€æƒ³å’Œé€‰æ‹©æ’åºç±»ä¼¼ï¼Œä¹Ÿæ˜¯å°†æ•´ä¸ªæ•°ç»„åˆ’åˆ†ä¸ºæœ‰åºå’Œæ— åºä¸¤ä¸ªç‰‡æ®µã€‚é€‰æ‹©æ’åºæ³¨é‡ä»æ— åºçš„ååŠæ®µé‡ŒæŒ‘å‡ºæœ€å°ï¼ˆæœ€å¤§ï¼‰çš„å…ƒç´ è¿½åŠ åˆ°æœ‰åºéƒ¨åˆ†çš„æœ«å°¾ï¼Œè€Œæ’å…¥æ’åºæ³¨é‡ä»æ— åºçš„ååŠæ®µéšä¾¿é€‰ä¸€ä¸ªç„¶åæŒ‰é¡ºåºæ’å…¥åˆ°æœ‰åºçš„å‰åŠæ®µã€‚æ‰€ä»¥é€‰æ‹©æ’åºé‡å¿ƒåœ¨ä»æ— åºçš„ååŠæ®µé€‰æ‹©ï¼Œè€Œæ’å…¥æ’åºé‡å¿ƒåœ¨äºå¾€æœ‰åºçš„å‰åŠæ®µæ’å…¥ã€‚ ä»£ç  1234567891011121314151617public int[] insertionSort(int[] arr)&#123; for(int i=1; i&lt;arr.length; i++)&#123; //å¤–å±‚å¾ªç¯è´Ÿè´£ä»æ— åºçš„ååŠæ®µæ‹¿å‡ºæ¥ä¸€ä¸ªæ•° int temp = arr[i] ; int j; for( j=i-1; j&gt;=0; j--)&#123;//å†…å±‚å¾ªç¯è´Ÿè´£å°†aar[i]æ’å…¥åˆ°å‰é¢ if(temp&lt;arr[j])&#123; arr[j+1] = arr[j] ; &#125; else &#123; arr[j+1] = temp ; break; &#125; &#125; arr[j+1] = temp ; &#125; return arr; &#125; ä»£ç çš„å…³é”®åœ¨äºéœ€è¦ç”¨ä¸€ä¸ªä¸´æ—¶å˜é‡å°†æ­£åœ¨æ¯”è¾ƒçš„æ— åºå…ƒç´ ä¿å­˜èµ·æ¥ï¼Œç„¶åä¾æ¬¡å‘åç§»åŠ¨æœ‰åºå…ƒç´ ï¼Œç­‰åˆ°æ‰¾åˆ°çœŸæ­£å±äºå®ƒçš„ä½ç½®æ—¶å†å°†å®ƒæ’å…¥ã€‚ ä»£ç äºŒï¼š 123456789101112131415public int[] insertionSort2(int[] arr)&#123; for(int i=1; i&lt;arr.length; i++) &#123; int temp = i ; for(int j=i-1; j&gt;=0; j--)&#123; if(arr[temp]&lt;arr[j])&#123; int t = arr[temp] ; arr[temp] = arr[j] ; arr[j] = t; temp=j; &#125; &#125; &#125; return arr; &#125; ä»£ç çš„å…³é”®åœ¨äºéœ€è¦ç”¨ä¸€ä¸ªä¸´æ—¶å˜é‡å°†æ­£åœ¨æ¯”è¾ƒçš„æ— åºå…ƒç´ ä¿å­˜èµ·æ¥ã€‚ç›¸æ¯”ä»£ç ä¸€ï¼Œè¿™é‡Œè¾¹æ¯”è¾ƒè¾¹äº¤æ¢ã€‚ å¤æ‚åº¦åˆ†æ æ—¶é—´å¤æ‚åº¦ï¼š$O(n^2)$ ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$ æ˜¯å¦ç¨³å®š ç¨³å®š å¸Œå°”æ’åº ç®—æ³•æ€æƒ³ å¸Œå°”æ’åºæ˜¯ä¸ªåŠ å¼ºç‰ˆçš„æ’å…¥æ’åºã€‚æŒ‰ç…§ä¸åŒçš„æ­¥é•¿å°†å…ƒç´ åˆ†ç»„ï¼Œæ¯”å¦‚æ­¥é•¿ä¸º2å°±ä»£è¡¨æ¯éš”ä¸¤ä¸ªå…ƒç´ ä¸ºä¸€ç»„ï¼Œç„¶åå¯¹æ¯ç»„è¿›è¡Œæ’å…¥æ’åºï¼Œç„¶åä¸æ–­ç¼©å°æ­¥é•¿ï¼Œæ’å…¥æ’åºï¼Œç›´è‡³æ­¥é•¿ä¸º1. ä»£ç  123456789101112131415161718public int[] shellSort(int[] arr)&#123; for(int gap=arr.length/2; gap&gt;0; gap/=2)&#123; //åˆ†æˆgapç»„ï¼Œç¬¬gapä¸ªå…ƒç´ è¡¨ç¤ºç¬¬1ç»„çš„ç¬¬äºŒä¸ªå…ƒç´  //è¿›è¡Œæ’å…¥æ’åº,éœ€è¦æ³¨æ„è¿™é‡Œå¹¶ä¸æ˜¯ä¸€ç»„ä¸€ç»„çš„æ’ï¼Œè€Œæ˜¯ä»ç¬¬gapä¸ªä¸€ç›´å¾€åéå†ï¼Œä¼šè½®è¯¢å¯¹æ¯ä¸ªç»„æ’åºï¼Œå› ä¸ºä»gapå¾€åéå†ï¼Œé‡åˆ°çš„å…ƒç´ è¦ä¹ˆæ˜¯ä»æœ¬ç»„ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹éå†åˆ°çš„ï¼Œè¦ä¹ˆæ˜¯å…¶ä»–ç»„çš„ä»ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹çš„ï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ’å…¥æ’åºã€‚ for(int i=gap; i&lt;arr.length; i++)&#123; int temp = i; for(int j=temp-gap; j&gt;=0; j-=gap)&#123; if(arr[temp]&lt;arr[j])&#123; int t = arr[temp] ; arr[temp] = arr[j] ; arr[j] = t; temp=j; &#125; &#125; &#125; &#125; return arr;&#125; å¤æ‚åº¦åˆ†æ æ—¶é—´å¤æ‚åº¦ï¼š$O(n^2)$ ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$ æ˜¯å¦ç¨³å®š ä¸ç¨³å®š å½’å¹¶æ’åº ç®—æ³•æ€æƒ³ å…¸å‹çš„åˆ†æ²»æ€æƒ³ï¼Œå…ˆå°†æ•°ç»„ä¸€åˆ†ä¸ºäºŒï¼Œæœ€æ¯ä¸ªå°æ•°ç»„åˆ†åˆ«æ’åºï¼Œæ’å¥½ä¹‹ååˆå¹¶ä¸¤ä¸ªå°æ•°ç»„å¾—åˆ°æœ€ç»ˆç»“æœã€‚ ä»£ç  ä½¿ç”¨é€’å½’ 123456789101112131415161718192021222324252627282930313233343536public class MergeSort &#123; public void mergeSort(int[] arr, int temp[], int start, int end)&#123; //å…ˆåˆ¤æ–­æ•°ç»„é•¿åº¦æ˜¯å¦å¤§äº2 if(end-start&lt;2)&#123; return arr; &#125; int mid = start+(end-start)/2 ; mergeSort(arr, temp, start, mid); mergeSort(arr, temp, mid, end); merge(arr, temp, start, mid, end) ; &#125; public void merge(int[] arr, int[] res, int start, int mid, int end)&#123; System.arraycopy(arr,start,res,start,end-start); int i= start; int j= mid; int k=start ; while(i&lt;mid &amp;&amp; j &lt; end)&#123; if(res[i] &lt; res[j])&#123; arr[k++] = res[i++] ; &#125; else&#123; arr[k++] = res[j++] ; &#125; &#125; while(i&lt;mid)&#123; arr[k++] = res[i++] ; &#125; while(j&lt;end)&#123; arr[k++] = res[j++] ; &#125; &#125;&#125; è¿™æ®µä»£ç ï¼Œå—¯ï¼Œæœ‰ç‚¹ä¸œè¥¿ï¼Œé¦–å…ˆä¸ºäº†ä¸¥æ ¼éµå®ˆç©ºé—´å¤æ‚åº¦ï¼Œä¸´æ—¶æ•°ç»„çš„åˆ›å»ºçš„æ˜¯åœ¨å½’å¹¶æ’åºå¤–é¢å®Œæˆçš„ï¼Œå¦åˆ™ä¼šå› ä¸ºé€’å½’ä¸æ–­åˆ›å»ºä¸´æ—¶æ•°ç»„ï¼Œç©ºé—´å¤æ‚åº¦å°±ä¼šè¶…è¿‡$O(n)$ã€‚å…¶æ¬¡ï¼Œéœ€è¦ä¿è¯æˆ‘ä»¬æ’åºä¹‹åå¼•ç”¨æŒ‡å‘çš„è¿˜æ˜¯åŸæ•°ç»„ï¼Œå³æ’åºå‰åæ•°ç»„å¼•ç”¨æŒ‡å‘çš„æ˜¯åŒä¸€å—ç©ºé—´ï¼Œè¿™ä¸€ç‚¹ä¹Ÿå¾ˆé‡è¦ï¼Œå¦åˆ™è™½ç„¶æ’åºæ•ˆæœè¾¾åˆ°äº†ï¼Œä½†æ˜¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡æ—©å·²ç‰©æ˜¯äººéï¼Œå¾ˆä¸ä¼˜é›…ã€‚ å¤æ‚åº¦åˆ†æ æ—¶é—´å¤æ‚åº¦ï¼š $$ \\begin{equation} \\begin{aligned} f(n) &amp;= 2f(\\frac{n}{2})+\\frac{n}{2}\\&amp; =2^2f(\\frac{n}{2^2})+\\frac{2}{2}n\\&amp;=2^3f(\\frac{n}{2^3})+\\frac{3}{2}n\\&amp;=2^kf(\\frac{n}{2^k})+\\frac{k}{2}n\\&amp;=n\\log{n}+\\frac{n}{2}\\log{n}\\&amp;=O(n\\log{n}) \\end{aligned} \\end{equation}$$ â€‹ ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$ æ˜¯å¦ç¨³å®š ç¨³å®šã€‚ å¿«é€Ÿæ’åº1. ç®—æ³•æ€æƒ³å¿«æ’çš„å…³é”®åœ¨äºæŠŠæ¢è½´ï¼ˆpivotï¼‰æ”¾åˆ°å¯¹åº”çš„ä½ç½®ï¼Œå³æ¢è½´å‰é¢çš„æ•°éƒ½æ¯”å®ƒå°ï¼Œåé¢çš„æ•°éƒ½æ¯”å®ƒå¤§ã€‚è¿™æ ·æ¢è½´å°±æŠŠæ•´ä¸ªæ•°ç»„åˆ’åˆ†æˆäº†ä¸¤éƒ¨åˆ†ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•æŠŠç¡®å®šæ¢è½´çœŸæ­£çš„ä½ç½®å‘¢ï¼Ÿå³å¦‚ä½•æŠŠæ¢è½´æ”¾åˆ°çœŸæ­£çš„ä½ç½®å‘¢ï¼Ÿ å‡è®¾å¯¹äºæ•°ç»„a 0 1 2 3 4 5 6 7 8 9 72 6 57 88 60 42 83 73 48 85 æˆ‘ä»¬åˆšå¼€å§‹è®¤ä¸ºa[0],ä»¤x=a[0]æ˜¯æ¢è½´ï¼Œé‚£æˆ‘ä»¬åˆ†åˆ«ç”¨j=9ä»åå¾€å‰éå†ï¼Œä»¥åŠç”¨i=1ä»å‰å¾€åéå†ã€‚ ä»åå¾€å‰éå†æ—¶ï¼Œé‡åˆ°æ¯”xå°çš„åˆ™æš‚æ—¶åœæ­¢ï¼Œ ä»å‰å¾€åéå†æ—¶ï¼Œé‡åˆ°æ¯”xå¤§çš„åˆ™æš‚æ—¶åœæ­¢ï¼Œ ç„¶åäº¤æ¢iå’Œjä½ç½®ä¸Šçš„å…ƒç´ ï¼Œç›´åˆ°iå’Œjç›¸é‡ï¼Œè¿™æ—¶çš„ä½ç½®å°±æ˜¯æ¢è½´çš„ä½ç½®ï¼Œæ­¤æ—¶äº¤æ¢å½“å‰ä½ç½®å…ƒç´ å’Œæ¢è½´å…ƒç´ ã€‚ æ€»ç»“ä¸€ä¸‹ï¼Œå¿«æ’çš„å…³é”®åœ¨äºï¼šä»ä¸¤è¾¹å‘ä¸­é—´è¿›è¡Œæœç´¢ï¼Œä»¥æ­¤ç¡®å®šæ¢è½´ä½ç½®ï¼Œç„¶åé€’å½’è¿›è¡Œæ­¤æ–¹æ³•ã€‚ 2. ä»£ç 12345678910111213141516171819202122232425262728293031323334public int quickSort(int[] arr, int left, int right) &#123; //å‡å¦‚é€‰æ‹©arr[0]ä½œä¸ºæ¢è½´ int i = left; int j = right; if (left &gt; right) return 0; int t = arr[left]; while (i &lt; j) &#123; while (i &lt; j &amp;&amp; arr[j] &gt;= t) &#123; j--; &#125; while (i &lt; j &amp;&amp; arr[i] &lt;= t) &#123; i++; &#125; //äº¤æ¢ if (i &lt; j) &#123; int t1 = arr[i]; arr[i] = arr[j]; arr[j] = t1; &#125; &#125; arr[left] = arr[i]; arr[i] = t; quickSort(arr, left, i - 1); quickSort(arr, i + 1, right); return 0; &#125; 3. å¤æ‚åº¦åˆ†æå¿«æ’çš„æ—¶é—´å¤æ‚åº¦å–å†³äºæ¢è½´é€‰æ‹©çš„å¥½åï¼Œå³åˆ’åˆ†çš„ä½ç½®ã€‚ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºï¼Œåˆ’åˆ†æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯$O(n)$ã€‚å½“åˆ’åˆ†çš„ä¸¤ä¸ªå­æ•°ç»„é•¿åº¦åˆ†åˆ«æ˜¯n-1å’Œ0æ—¶ï¼Œå¤æ‚åº¦æœ€é«˜ï¼Œé€’å½’å…¬å¼ä¸º$T(n)=T(n-1)+T(0)+O(n)$, è§£ä¸º$O(n^2)$. å½“ä¸¤ä¸ªæ•°ç»„é•¿åº¦æ¥è¿‘ç­‰é•¿æ—¶ï¼Œå¤æ‚åº¦æœ€ä½, é€’å½’å…¬å¼ä¸º$T(n)=2T(n/2)+O(n)$, è§£ä¸º$O(nlogn)$. å †æ’åº1. ç®—æ³•æ€æƒ³è¦ç†è§£å †æ’åºï¼Œé¦–å…ˆè¦ç†è§£ä»€ä¹ˆæ˜¯å †ï¼Œä»€ä¹ˆæ˜¯å¤§é¡¶å †ï¼Œä»€ä¹ˆæ˜¯å°é¡¶å †ã€‚ é¦–å…ˆï¼Œå †ä¹Ÿæ˜¯ä¸€ç§äºŒå‰æ ‘ï¼Œå…¶æ¬¡ï¼Œå †çš„çˆ¶èŠ‚ç‚¹æ€»æ˜¯æ¯”ä¸¤ä¸ªå­èŠ‚ç‚¹å¤§ï¼ˆå¤§é¡¶å †ï¼‰æˆ–æ¯”ä¸¤ä¸ªå­èŠ‚ç‚¹å°ï¼ˆå°é¡¶å †ï¼‰ã€‚ å †æ’åºçš„æ ¸å¿ƒåœ¨äºä¸¤ç‚¹ï¼š å †è°ƒæ•´ï¼šé¦–å…ˆå°†ä¸€ä¸ªæ— åºçš„æ•°ç»„åºåˆ—è°ƒæ•´æˆå¤§é¡¶å †ï¼Œè¿™æ ·ä¸€æ¥æ ¹èŠ‚ç‚¹å°±æ˜¯æ•´ä¸ªåºåˆ—çš„æœ€å¤§å€¼äº†ã€‚ äº¤æ¢å¹¶é‡æ–°è°ƒæ•´ï¼šå°†æ ¹èŠ‚ç‚¹å…ƒç´ å’Œå †æœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œè¿™æ ·ä¸€æ¥æœ€åä¸€ä¸ªå…ƒç´ å°±æ˜¯æœ€å¤§çš„äº†ï¼Œå‰©ä¸‹çš„å‰n-1ä¸ªå…ƒç´ æ˜¯æ— åºçš„ï¼Œé‡æ–°è°ƒæ•´ã€‚ é‚£ä¹ˆå°±æœ‰ä¸€ä¸ªé—®é¢˜äº†ï¼Œå¦‚ä½•è°ƒæ•´ï¼Ÿæˆ‘ä»¬ä»æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹ï¼Œæ¯”è¾ƒå®ƒå’Œå®ƒçš„ä¸¤ä¸ªå„¿å­çš„å¤§å°ï¼Œå¦‚æœå®ƒçš„å„¿å­æ¯”å®ƒå¤§ï¼Œåˆ™è¿›è¡Œäº¤æ¢ã€‚ é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼Œå¦‚ä½•ç¡®å®šéå¶å­èŠ‚ç‚¹ï¼Ÿå­¦è¿‡äºŒå‰æ ‘æ€§è´¨çš„æœ‹å‹åº”è¯¥çŸ¥é“ï¼Œæœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹çš„ä¸‹æ ‡åº”è¯¥æ˜¯$(a.length/2)-1$. 2. ä»£ç 1234567891011121314151617181920212223242526272829303132333435public void heapSort(int[] arr) &#123; //å…ˆè°ƒæ•´å † heapAdjust(arr, arr.length); //äº¤æ¢å¹¶é‡æ–°è°ƒæ•´ for (int i = 0; i &lt; arr.length; i++) &#123; int t = arr[0]; arr[0] = arr[arr.length - i - 1]; arr[arr.length - i - 1] = t; heapAdjust(arr, arr.length-i-1); &#125; &#125; //è°ƒæ•´å †ï¼Œä»å½“å‰èŠ‚ç‚¹ä¸€ç›´å‘ä¸‹æ¢ç´¢åˆ°å¶å­èŠ‚ç‚¹ public void heapAdjust(int[] arr, int len) &#123; for (int k = len / 2 - 1; k &gt;= 0; k--) &#123;//ä»æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹å¼€å§‹ int j = k ; for (int i = k * 2+1; i &lt; len; i =i*2+1) &#123;//æ‰¾åˆ°å·¦å­©å­çš„ä½ç½® if (i+1&lt;len &amp;&amp; arr[i] &lt; arr[i + 1]) //æ‰¾åˆ°ä¸¤ä¸ªå­©å­é‡Œé¢çš„è¾ƒå¤§è€… i += 1; if (arr[j] &lt; arr[i]) &#123; //æ¯”è¾ƒè¾ƒå¤§å­©å­ä¸çˆ¶èŠ‚ç‚¹çš„å¤§å° int t = arr[i]; //è¿›è¡Œäº¤æ¢ arr[i] = arr[j]; arr[j] = t; j=i; //äº¤æ¢å®Œä¹‹åè¦ç»§ç»­å‘ä¸‹æ¢ç´¢ï¼Œæ‰€ä»¥åœ¨æ­¤æ›´æ–°ä¸€ä¸‹çˆ¶èŠ‚ç‚¹çš„ä½ç½®ï¼Œå³æ›´æ–°çš„å­èŠ‚ç‚¹æˆäº†æ–°çš„çˆ¶èŠ‚ç‚¹ &#125; &#125; &#125; &#125; 3. å¤æ‚åº¦åˆ†æè®¡æ•°æ’åº1. æ€æƒ³å®ƒä¸æ˜¯é€šè¿‡æ¯”è¾ƒè¿›è¡Œæ’åºï¼Œè€Œæ˜¯é€šè¿‡é¢å¤–å¼€è¾Ÿä¸€å—ç©ºé—´ï¼Œé€šè¿‡ä¸‹æ ‡æ¥æš—ç¤ºè¿™é‡Œå­˜çš„æ˜¯å“ªä¸ªå…ƒç´ ï¼Œé€šè¿‡æ•°ç»„å€¼æ¥è¡¨ç¤ºå­˜çš„è¿™ä¸ªå…ƒç´ æœ‰å‡ ä¸ªã€‚ å…·ä½“æ“ä½œæ˜¯è¿™æ ·çš„ï¼š æ‰¾å‡ºå¾…æ’åºçš„æ•°ç»„ä¸­æœ€å¤§å’Œæœ€å°çš„å…ƒç´ ï¼› ç»Ÿè®¡æ•°ç»„ä¸­æ¯ä¸ªå€¼ä¸ºiçš„å…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œå­˜å…¥æ•°ç»„Cçš„ç¬¬ié¡¹ï¼› å¯¹æ‰€æœ‰çš„è®¡æ•°ç´¯åŠ ï¼ˆä»Cä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œæ¯ä¸€é¡¹å’Œå‰ä¸€é¡¹ç›¸åŠ ï¼‰ï¼› åå‘å¡«å……ç›®æ ‡æ•°ç»„ï¼šå°†æ¯ä¸ªå…ƒç´ iæ”¾åœ¨æ–°æ•°ç»„çš„ç¬¬C(i)é¡¹ï¼Œæ¯æ”¾ä¸€ä¸ªå…ƒç´ å°±å°†C(i)å‡å»1ã€‚ ä»£ç 12345678910111213141516171819202122232425262728293031public int[] countingSort(int[] arr)&#123; //å¯»æ‰¾æœ€å¤§å€¼å’Œæœ€å°å€¼ int min=arr[0], max = arr[0] ; for (int i=0; i&lt;arr.length; i++)&#123; if(arr[i] &gt; max) max = arr[i] ; if(arr[i] &lt; min) min = arr[i] ; &#125; //åˆ›å»ºé¢å¤–è®¡æ•°æ•°ç»„ int cntArr[] = new int[max-min+1] ; //å¼€å§‹è®¡æ•° for(int i=0; i&lt;arr.length; i++)&#123; cntArr[arr[i]-min]++; &#125; //è®¡æ•°æ•°ç»„ç´¯åŠ ,cntArr[i]è¡¨ç¤ºå°äºç­‰äºiçš„æ•°æœ‰å¤šå°‘ä¸ª for(int i=1; i&lt;cntArr.length; i++)&#123; cntArr[i] += cntArr[i-1] ; &#125; //è¾“å‡ºæ’åº int res[] = new int[arr.length] ; for(int i= arr.length-1; i&gt;=0; i--)&#123; res[cntArr[arr[i] - min]-1] = arr[i] ; &#125; return res ; &#125; 3. åˆ†æè¿™ç§æ’åºç®—æ³•é€‚ç”¨äºé‚£ç§å¾…æ’åºåºåˆ—æ¯”è¾ƒé›†ä¸­çš„æƒ…å†µï¼Œè¿™æ ·åˆ›å»ºçš„é¢å¤–æ•°ç»„ç©ºé—´æ¯”è¾ƒå°ï¼ŒèŠ‚çœèµ„æºã€‚ å®ƒæ˜¯ä¸€ç§ç¨³å®šæ’åºã€‚ æ¡¶æ’åº1. æ€æƒ³ä¸Šé¢çš„è®¡æ•°æ’åºæ ¸å¿ƒæ€æƒ³åœ¨äºæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªé¢å¤–çš„æ•°ç»„æ¥è¿›è¡Œè®¡æ•°ï¼Œæ¡¶æ’åºåœ¨æ€æƒ³ä¸Šå’Œè®¡æ•°æ’åºæœ‰æ‰€ç±»ä¼¼ï¼Œåªä¸è¿‡æ¡¶æ’åºä¸­çš„æ¡¶ç›´æ¥æ‹¿æ¥è£…å¾…æ’åºçš„å…ƒç´ äº†ã€‚åœ¨æ¡¶æ’åºä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æŸç§æ˜ å°„ï¼ŒæŠŠæŸäº›å…ƒç´ æ˜ å°„åˆ°æŸäº›æ¡¶é‡Œï¼Œç„¶åå¯¹æ¯ä¸ªæ¡¶ä¸­å…ƒç´ è¿›è¡Œæ’åºï¼Œæœ€åæŠŠæ‰€æœ‰æ¡¶è¿æ¥èµ·æ¥ã€‚åœ¨è¿™é‡Œï¼Œå¯¹æ¡¶ä¸­å…ƒç´ æ’åºæˆ‘ä»¬ä½¿ç”¨ç¨³å®šçš„æ’åºæ–¹æ³•ï¼Œå¦‚å¿«æ’ï¼Œè¿™æ ·æœ€åæˆ‘ä»¬çš„æ¡¶æ’åºä¹Ÿæ˜¯ç¨³å®šçš„ã€‚ 2. ä»£ç åŸºæ•°æ’åº1. æ€æƒ³ä»ä¸ªä½å¼€å§‹ï¼ŒæŒ‰ç…§æ¯ä¸ªè¿›åˆ¶ä½å¯¹å…ƒç´ è¿›è¡Œç¨³å®šæ’åºã€‚ å‚è€ƒåå¤§ç»å…¸æ’åºç®—æ³•ï¼ˆåŠ¨å›¾æ¼”ç¤ºï¼‰","categories":[{"name":"æ•°æ®ç»“æ„ä¸ç®—æ³•","slug":"æ•°æ®ç»“æ„ä¸ç®—æ³•","permalink":"http://example.com/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"æ’åº","slug":"æ’åº","permalink":"http://example.com/tags/%E6%8E%92%E5%BA%8F/"}]},{"title":"Javaæ³›å‹","slug":"Javaæ³›å‹","date":"2019-10-31T01:40:05.000Z","updated":"2019-10-31T01:40:05.000Z","comments":true,"path":"2019/10/31/Javaæ³›å‹/","link":"","permalink":"http://example.com/2019/10/31/Java%E6%B3%9B%E5%9E%8B/","excerpt":"","text":"ä¸ºä»€ä¹ˆè¦æœ‰æ³›å‹å®ƒçš„ä¸€ä¸ªä¸»è¦ç›®æ ‡æ˜¯å°†è¿è¡Œæ—¶æ‰èƒ½å‘ç°çš„é”™è¯¯è½¬ç§»åˆ°ç¼–è¯‘æœŸã€‚ æ³›å‹æ˜¯ä»€ä¹ˆæ‰€è°“æ³›å‹ï¼Œå°±æ˜¯å°†ç±»å‹å‚æ•°åŒ–ï¼Œå³æŠŠç±»å‹ä¹Ÿä½œä¸ºä¸€ç§å‚æ•°ã€‚å¦‚ä½•åšåˆ°è¿™ç‚¹å‘¢ï¼Ÿé€šè¿‡è§£è€¦ç±»æˆ–æ–¹æ³•ä¸æ‰€ä½¿ç”¨çš„ç±»å‹ä¹‹é—´çš„çº¦æŸã€‚ è¡¨é¢ä½¿ç”¨æ³›å‹ç±»1234567891011121314151617181920212223242526public class GenericsDemo &lt;T&gt; &#123; private T var ; public void setVar(T v)&#123; var = v ; &#125; public T getVar()&#123; return var; &#125; public static void main(String[] args) &#123; GenericsDemo demo1 = new GenericsDemo(); demo1.setVar(&quot;string&quot;); System.out.println(demo1.getVar()); demo1.setVar(1); System.out.println(demo1.getVar()); GenericsDemo&lt;Integer&gt; demo2 = new GenericsDemo&lt;Integer&gt;() ;// demo2.setVar(&quot;stirng&quot;); demo2.setVar(1); System.out.println(demo2.getVar()); &#125;&#125; å¯ä»¥çœ‹å‡ºï¼Œè™½ç„¶æˆ‘ä»¬å®šä¹‰äº†æ³›å‹ç±»ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨å®ƒçš„æ—¶å€™æ˜¯å¯ä»¥ä¸ä¼ å…¥æ³›å‹å®å‚çš„ï¼Œå¦‚æœä¸ä¼ ï¼Œ åœ¨æ³›å‹ç±»ä¸­ä½¿ç”¨æ³›å‹çš„æ–¹æ³•æˆ–æˆå‘˜å˜é‡å®šä¹‰çš„ç±»å‹å¯ä»¥ä¸ºä»»ä½•çš„ç±»å‹ã€‚ æ³›å‹æ¥å£å®šä¹‰æ–¹å¼å’Œæ³›å‹ç±»ç›¸ä¼¼ 123public interface Generator&lt;T&gt; &#123; T next() ;&#125; éœ€è¦æ³¨æ„çš„æ˜¯å½“æœ‰ä¸ªç±»å®ç°è¿™ä¸ªæ³›å‹æ¥å£æ—¶çš„æ“ä½œ å®ç°ç±»å’Œæ¥å£éƒ½æ²¡å†™æ³›å‹å‚æ•° 1234567public class FruitGenerator implements Generator &#123; @Override public Object next() &#123; return null; &#125;&#125; å¦‚æœæ¥å£å†™äº†æ³›å‹å‚æ•°ï¼Œä½†æ˜¯æ²¡æœ‰ä¼ å…¥å®å‚ï¼Œåˆ™å®ç°ç±»ä¹Ÿå¿…é¡»å†™ä¸Šï¼Œä¸ç„¶ä¼šæŠ¥é”™ 1234567public class FruitGenerator&lt;T&gt; implements Generator&lt;T&gt; &#123; @Override public T next() &#123; return null; &#125;&#125; å¦‚æœæ¥å£å†™äº†æ³›å‹å‚æ•°ï¼Œä¸”ä¼ å…¥äº†å®å‚ï¼Œé‚£ä¹ˆä½¿ç”¨æ¥å£ä¸­æ³›å‹çš„åœ°æ–¹éƒ½è¦æ¢æˆä¼ å…¥çš„å®å‚ç±»å‹ï¼Œä½†æ˜¯è¿™å¹¶ä¸å½±å“ç»™è¿™ä¸ªå®ç°ç±»æ·»åŠ è‡ªå·±çš„æ³›å‹ã€‚ 12345678public class FruitGenerator&lt;T&gt; implements Generator&lt;String&gt; &#123; private T fruitVar ; @Override public String next() &#123; return null; &#125;&#125; æ³›å‹æ–¹æ³•123public &lt;T&gt; T getData(T data)&#123; return data; &#125; æ³›å‹é€šé…ç¬¦é€šé…ç¬¦å°±æ˜¯?,æ˜¯ä¸€ä¸ªæ³›å‹å®å‚ï¼Œä»¥ä¸€ä¸ªæ³›å‹ç±»ä½œä¸ºå½¢å‚ä¸ºä¾‹ï¼š 1234567891011121314151617181920212223import java.util.*;public class Test &#123; public static void main(String[] args) &#123; List&lt;String&gt; name = new ArrayList&lt;String&gt;(); List&lt;Integer&gt; age = new ArrayList&lt;Integer&gt;(); List&lt;Number&gt; number = new ArrayList&lt;Number&gt;(); name.add(&quot;icon&quot;); age.add(18); number.add(314); getData(name); getData(age); getData(number); &#125; public static void getData(List&lt;?&gt; data) &#123; System.out.println(&quot;data :&quot; + data.get(0)); &#125;&#125; æˆ‘ä»¬åœ¨mainé‡Œå®šä¹‰äº†ä¸‰ä¸ªlist,æ¯ä¸ªlistè£…å…¥çš„ç±»å‹éƒ½ä¸ä¸€æ ·ï¼Œç°åœ¨æƒ³ç”¨ä¸€ä¸ªgetData()æ–¹æ³•æ¥è·å–è¿™ä¸‰ä¸ªlisté‡Œé¢çš„å€¼ï¼Œè¿™é‡Œçš„å…³é”®å°±åœ¨äºgetData()çš„å½¢å‚æ€ä¹ˆå†™äº†ï¼Œå¦‚æœç»™ä½œä¸ºå½¢å‚çš„listä¼ å…¥æ³›å‹å®å‚ï¼Œæ¯”å¦‚String,é‚£ä¹ˆageå’Œnumberè¿™ä¸¤ä¸ªlistå°±ä¸èƒ½ä½œä¸ºå®å‚ä¼ è¿›æ¥äº†ã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿä½¿ç”¨é€šé…ç¬¦ï¼Œç»™å½¢å‚çš„liståŠ äº†é€šé…ç¬¦ä¹‹åï¼Œå°±æ„å‘³ç€æµ·çº³ç™¾å·ï¼Œä¸ç®¡å®å‚æ˜¯ä»€ä¹ˆæ ·çš„listéƒ½èƒ½ä¼ è¿›æ¥ã€‚ å…¶å®ä½ ä¹Ÿä¼šå‘ç°ï¼Œå¦‚æœç»™å½¢å‚listä¸åŠ æ³›å‹ä¹Ÿå¯ä»¥ï¼Œå› ä¸ºåˆ°å¤´æ¥æ³›å‹éƒ½ä¼šè¢«æ“¦é™¤æ‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„é€šé…ç¬¦List&lt;?&gt;ï¼Œä»é€»è¾‘ä¸Šè®²ï¼Œå®ƒåº”è¯¥æ˜¯å…¶ä»–List&lt;å…·ä½“ç±»å‹å®å‚&gt;çš„çˆ¶ç±»ã€‚ å½“ç„¶äº†ï¼Œé€šå¸¸ä¹Ÿä¸ä¼šå•ç‹¬æ‹¿å‡ºæ¥ä¸€ä¸ªé€šé…ç¬¦æ¥ä½¿ç”¨çš„ï¼Œå®ƒä¸€èˆ¬éƒ½æ˜¯é…åˆä¸Šç•Œæˆ–ä¸‹ç•Œä¸€èµ·ä½¿ç”¨çš„ã€‚ å†…éƒ¨åŸç†â€‹ æ³›å‹åªåœ¨ç¼–è¯‘å™¨æœ‰æ•ˆï¼Œåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œæ­£ç¡®æ£€éªŒæ³›å‹ç»“æœåï¼Œ**ä¼šå°†æ³›å‹ç›¸å…³ä¿¡æ¯æ“¦é™¤ ï¼Œ å¹¶ä¸”åœ¨å¯¹è±¡è¿›å…¥å’Œç¦»å¼€æ–¹æ³•çš„è¾¹ç•Œå¤„æ·»åŠ ç±»å‹æ£€æŸ¥å’Œç±»å‹è½¬æ¢çš„æ–¹æ³• **ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"æ³›å‹","slug":"æ³›å‹","permalink":"http://example.com/tags/%E6%B3%9B%E5%9E%8B/"}]},{"title":"æµ·é‡æ•°æ®å¤„ç†","slug":"æµ·é‡æ•°æ®ä¸ç©ºé—´é™åˆ¶é¢è¯•é¢˜","date":"2019-10-30T06:59:07.000Z","updated":"2019-10-30T06:59:07.000Z","comments":true,"path":"2019/10/30/æµ·é‡æ•°æ®ä¸ç©ºé—´é™åˆ¶é¢è¯•é¢˜/","link":"","permalink":"http://example.com/2019/10/30/%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E4%B8%8E%E7%A9%BA%E9%97%B4%E9%99%90%E5%88%B6%E9%9D%A2%E8%AF%95%E9%A2%98/","excerpt":"","text":"æµ·é‡æ•°æ®ç›¸å…³çš„é¢è¯•é¢˜å·²ç»æ˜¯ä¸ªè€ç”Ÿå¸¸è°ˆçš„è¯é¢˜äº†ã€‚ç›¸æ¯”äºå°é‡æ•°æ®ï¼Œæµ·é‡æ•°æ®å­˜åœ¨ä¸¤ç‚¹é™åˆ¶ï¼šå†…å­˜è£…ä¸ä¸‹æˆ–è€…è¯»å–å¤ªæ…¢ã€‚ å…³äºæµ·é‡æ•°æ®çš„é¢è¯•é¢˜ä¸€èˆ¬æœ‰ä¸€ä¸‹å‡ ç§ï¼š å¯»æ‰¾å‡ºç°æ¬¡æ•°æœ€å¤š/æœ€å°‘/æ²¡æœ‰å‡ºç°çš„æ•° å¯¹äºæµ·é‡æ•°æ®çš„å¤„ç†æ–¹å¼ä¹Ÿä¸å¤–ä¹ä»¥ä¸‹å‡ ç§ï¼š åˆ†è€Œæ²»ä¹‹(å°†å¤§æ–‡ä»¶æ‹†åˆ†æˆå°æ–‡ä»¶) hash bitmap é¢˜ç›®1. æµ·é‡æ—¥å¿—æ•°æ®ï¼Œæå–å‡ºæŸæ—¥è®¿é—®ç™¾åº¦æ¬¡æ•°æœ€å¤šçš„é‚£ä¸ªIPæ€è·¯ è¿™æ˜¯ä¸€é“å…³äºç»Ÿè®¡æ¬¡æ•°çš„é¢˜ï¼Œä¸€èˆ¬ä½¿ç”¨hashmapæˆ–è€…bitmapå°±å¯ä»¥è§£å†³ï¼Œä½¿ç”¨hashmapæ—¶è¦æ³¨æ„ç©ºé—´æ˜¯å¦æ»¡è¶³è¦æ±‚ã€‚ è¿™ä¸ªé—®é¢˜æœ‰ä¸¤ä¸ªç‚¹ï¼šæµ·é‡æ•°æ®ï¼Œæ¬¡æ•°æœ€å¤šã€‚ å…ˆçœ‹ç¬¬äºŒä¸ªç‚¹ã€‚ æŠŠè¿™ä¸ªé—®é¢˜å†æå–ä¸€ä¸‹ï¼šå°±æ˜¯è®©ä½ åœ¨æµ·é‡æ•°æ®é‡Œå»æ‰¾å‡ºç°æ¬¡æ•°æœ€å¤šçš„é‚£ä¸ªæ•°ã€‚ å†æå–ä¸€ä¸‹ï¼šå°±æ˜¯ç»Ÿè®¡æ¬¡æ•°ã€‚é—®é¢˜å°±å¾ˆæ¸…æ¥šäº†ï¼Œä½¿ç”¨hashå°±å¯ä»¥è§£å†³ã€‚ ç„¶åå†çœ‹ç¬¬ä¸€ä¸ªç‚¹ã€‚ æµ·é‡æ•°æ®ï¼Œæ„å‘³ç€æ•°æ®å¤ªå¤šï¼Œä½ çš„hash mapå†…å­˜å¯èƒ½æ”¾ä¸ä¸‹ã€‚æ€ä¹ˆåŠï¼Ÿæ‹†åˆ†ï¼å°†è¿™ä¸ªæµ·é‡æ•°æ®æ‹†åˆ†æˆè‹¥å¹²ä¸ªå°æ–‡ä»¶ï¼Œç„¶ååœ¨æ¯ä¸ªå°æ–‡ä»¶é‡Œç»Ÿè®¡å‡ºç°æ¬¡æ•°æœ€å¤šçš„ï¼Œæœ€åç»¼åˆæ‰€æœ‰çš„å°æ–‡ä»¶ä¸­æ¬¡æ•°æœ€å¤šçš„ipæ‰¾åˆ°ç‹ä¸­ç‹ã€‚æ˜¯ä¸æ˜¯æœ‰ç‚¹åƒå½’å¹¶æ’åºï¼Ÿ é‚£ä¹ˆæ€ä¹ˆæ‹†åˆ†ï¼Ÿå‡è®¾è¦æ‹†åˆ†æˆNä¸ªæ–‡ä»¶ï¼Œå¯ä»¥è¿™ä¹ˆåšï¼šhash(IP)%N æ‹“å±•è¿™ä¸ªé—®é¢˜æ˜¯æ‰¾å‡ºç°æ¬¡æ•°æœ€å¤šçš„é‚£ä¸ªæ•°ã€‚é‚£ä¹ˆæ€ä¹ˆæ‰¾å‡ºç°äº†ä¸€æ¬¡çš„ï¼Ÿæˆ–è€…ï¼Œç»™å®šä¸€ä¸ªæ•°ï¼Œæ€ä¹ˆåˆ¤æ–­å®ƒæœ‰æ²¡æœ‰åœ¨æµ·é‡æ•°æ®ä¸­å‡ºç°è¿‡ï¼Ÿä¸‹é¢æˆ‘ä»¬ä¸€ä¸€æ¥çœ‹ã€‚ 2.5äº¿æ•´æ•°ä¸­æ‰¾å‡ºä¸é‡å¤çš„æ•´æ•°ã€‚ æ‰¾å‡ºä¸é‡å¤çš„æ•°ï¼Œå…¶å®ä¹Ÿæ˜¯ç»Ÿè®¡æ¬¡æ•°ï¼Œç»Ÿè®¡åªå‡ºç°ä¸€æ¬¡çš„é‚£äº›æ•°ï¼Œæ‰€ä»¥ä¸Šè¿°åˆ†å‰²+hashçš„ç®—æ³•ä¾ç„¶å¯ç”¨ï¼Œä¸è¿‡è¿™é‡Œæˆ‘ä»¬å†ç»™å‡ºå¦ä¸€ç§æ›´ç®€å•çš„æ–¹æ³•ï¼šåŸºäºbitmapçš„æ–¹æ³•ã€‚ å¯¹äºæ¯ä¸ªæ•°ï¼Œæˆ‘ä»¬ä½¿ç”¨2bitæ¥è¡¨ç¤ºï¼Œ00è¡¨ç¤ºå‡ºç°0æ¬¡ï¼Œ01è¡¨ç¤ºå‡ºç°1æ¬¡ï¼Œ10è¡¨ç¤ºå‡ºç°å¤šæ¬¡ã€‚ 2.5äº¿ä¸ªæ•´æ•°ï¼Œéœ€è¦å¤šå°‘bitæ‰èƒ½è¡¨ç¤ºå®Œå‘¢ï¼Œå‡è®¾è¿™äº›æ•´æ•°éƒ½æ˜¯intç±»å‹çš„ï¼Œé‚£ä¹ˆæœ€å¤šä¹Ÿå°±åªæœ‰$2^{32}$ç§æ•°ï¼Œå·²ç»èƒ½è¡¨ç¤º20å¤šäº¿äº†ï¼Œå®Œå…¨å¤Ÿåº”ä»˜è¿™é‡Œçš„2.5äº¿ï¼Œå†è€ƒè™‘åˆ°æ¯ä¸ªæ•°ç”¨2bitæ¥è¡¨ç¤ºå‡ºç°æ¬¡æ•°ï¼Œä¸€å…±éœ€è¦$2^{32}*2$bit=1GB.å°±å¯ä»¥è¡¨ç¤ºè¿™2.5äº¿ä¸ªæ•°çš„å‡ºç°æ¬¡æ•°äº†ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šé¢ç®—å‡ºæ¥çš„1Gå…¶å®ç®—æ˜¯å¤§çš„äº†ï¼Œå› ä¸ºçœŸæ­£çš„å¹¶æ²¡æœ‰$2^{32}$ä¸ªæ•°ï¼Œæ‰€ä»¥æ²¡å¿…è¦å¼€è¾Ÿè¿™ä¹ˆå¤§ç©ºé—´ï¼Œç°åœ¨çš„å¼€æºå®ç°å¦‚è°·æ­Œçš„EWAHCompressedBitmapå·²ç»å¯¹bitmapçš„å†…å­˜åˆ†é…åšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œå¯¹äºå¾ˆç¨€ç–çš„æµ·é‡æ•°æ®ï¼Œé‚£äº›ç¨€ç–æ•°æ®ä¹‹é—´çš„ç©ºç¼ºæ˜¯æ²¡å¿…è¦ç”³è¯·ç©ºé—´çš„ã€‚ ç»™å®šä¸€ä¸ªæ•°ï¼Œåˆ¤æ–­å…¶æ˜¯å¦åœ¨æµ·é‡æ•°æ®ä¸­ã€‚ åŒæ ·å¯ä»¥ä½¿ç”¨bitmapè§£å†³ã€‚ ç»™ä¸€ä¸²è¿ç»­çš„æ•°ï¼Œç¼ºå¤±äº†ä¸€ä¸ªï¼Œå¦‚ä½•æ‰¾å‡ºç¼ºå¤±çš„é‚£ä¸ªï¼Ÿ æ±‚å’Œå‘€ 32ä½æ— ç¬¦å·æ•´æ•°çš„èŒƒå›´æ˜¯0~4294967295ï¼Œç°åœ¨æœ‰40äº¿ä¸ªæ•°ï¼Œè®©ä½  ï¼ˆaï¼‰æ‰¾å‡ºæ‰€æœ‰ç¼ºå¤±çš„æ•° ï¼ˆbï¼‰åªæ‰¾å‡ºå…¶ä¸­ä¸€ä¸ªç¼ºå¤±çš„æ•° â€‹ åˆ’åˆ†åŒºé—´ï¼Œä½¿ç”¨åŒºé—´è®¡æ•°ç¡®å®šåŒºé—´ï¼Œç„¶åå†ç”¨bitmap","categories":[{"name":"æ•°æ®ç»“æ„ä¸ç®—æ³•","slug":"æ•°æ®ç»“æ„ä¸ç®—æ³•","permalink":"http://example.com/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"http://example.com/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/"}]},{"title":"Javaä¸­çš„finalizedæ–¹æ³•","slug":"Javaä¸­çš„finalizedæ–¹æ³•","date":"2019-10-27T07:31:44.000Z","updated":"2019-10-27T07:31:44.000Z","comments":true,"path":"2019/10/27/Javaä¸­çš„finalizedæ–¹æ³•/","link":"","permalink":"http://example.com/2019/10/27/Java%E4%B8%AD%E7%9A%84finalized%E6%96%B9%E6%B3%95/","excerpt":"","text":"finalizeæ˜¯ä»€ä¹ˆfinalize()æ˜¯å®šä¹‰åœ¨Objectç±»ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåƒåœ¾å›æ”¶ã€‚ finalizeåŸç†å½“JVMçš„GCæ‰“ç®—å›æ”¶æŸä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœè¿™ä¸ªå¯¹è±¡è¦†ç›–äº†finalize()æ–¹æ³•ï¼Œå¹¶ä¸”finalize()æ–¹æ³•æ²¡æœ‰è¢«æ‰§è¡Œè¿‡ï¼Œä¼šæŠŠè¿™ä¸ªå¯¹è±¡æ”¾åœ¨ä¸€ä¸ªå«åšF-Queueçš„é˜Ÿåˆ—ä¸­ï¼Œç¨åç”±ä¸€ä¸ªç”±è™šæ‹Ÿæœºè‡ªåŠ¨å»ºç«‹çš„ï¼Œä½ä¼˜å…ˆçº§çš„Finalizerçº¿ç¨‹å»è§¦å‘finalizeçš„æ‰§è¡Œã€‚ç¨åGCå°†å¯¹F-Queueä¸­çš„å¯¹è±¡è¿›è¡Œç¬¬äºŒæ¬¡å°è§„æ¨¡æ ‡è®°ï¼Œå¦‚æœè¿™ä¸ªå¯¹è±¡ä»ç„¶ä¸å¯è¾¾ï¼Œé‚£ä¹ˆå°±æŠŠå®ƒå›æ”¶äº†ï¼Œå¦‚æœåœ¨finalize()æ–¹æ³•ä¸­è¿™ä¸ªå¯¹è±¡å®ç°äº†è‡ªæ•‘â€”â€”å°†è‡ªå·±ä¸GC Rootå…³è”èµ·æ¥ï¼Œé‚£ä¹ˆå®ƒå°†ä¼šè¢«ç§»å‡ºé˜Ÿåˆ—ï¼Œä¸ä¼šè¢«å›æ”¶ã€‚ éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š finalize()åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ å¯¹è±¡ä¸ä¸€å®šè¢«åƒåœ¾å›æ”¶ï¼Œæ‰€ä»¥å¯¹åº”çš„ï¼Œfinalizeä¹Ÿä¸ä¸€å®šä¼šè¢«æ‰§è¡Œ ä¸ºä»€ä¹ˆè¦æœ‰finalizeåœ¨JNIä»£ç ä¸­åšæ¸…ç†å·¥ä½œ ä½œä¸ºç¡®ä¿æŸäº›éå†…å­˜èµ„æº(å¦‚Socketã€æ–‡ä»¶ç­‰)é‡Šæ”¾çš„ä¸€ä¸ªè¡¥å……","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"finalize","slug":"finalize","permalink":"http://example.com/tags/finalize/"}]},{"title":"Javaä¸­çš„å¼‚å¸¸","slug":"Javaä¸­çš„å¼‚å¸¸","date":"2019-10-27T06:26:42.000Z","updated":"2019-10-27T06:26:42.000Z","comments":true,"path":"2019/10/27/Javaä¸­çš„å¼‚å¸¸/","link":"","permalink":"http://example.com/2019/10/27/Java%E4%B8%AD%E7%9A%84%E5%BC%82%E5%B8%B8/","excerpt":"","text":"å‚è€ƒ Javaæé«˜ç¯‡â€”â€”Java å¼‚å¸¸å¤„ç†","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"å¼‚å¸¸","slug":"å¼‚å¸¸","permalink":"http://example.com/tags/%E5%BC%82%E5%B8%B8/"}]},{"title":"Javaä¸­çš„å†…éƒ¨ç±»","slug":"Javaä¸­çš„å†…éƒ¨ç±»","date":"2019-10-22T00:25:54.000Z","updated":"2019-10-22T00:25:54.000Z","comments":true,"path":"2019/10/22/Javaä¸­çš„å†…éƒ¨ç±»/","link":"","permalink":"http://example.com/2019/10/22/Java%E4%B8%AD%E7%9A%84%E5%86%85%E9%83%A8%E7%B1%BB/","excerpt":"","text":"åˆ†ç±»æˆå‘˜å†…éƒ¨ç±»å¾—å…ˆåˆ›å»ºå¤–éƒ¨ç±»ï¼Œç„¶åæ‰èƒ½åˆ›å»ºå†…éƒ¨ç±»ã€‚ ä¿å­˜äº†ä¸€ä¸ªæŒ‡å‘å¤–éƒ¨å¯¹è±¡çš„å¼•ç”¨ï¼Œæ‰€ä»¥å¯ä»¥è®¿é—®å¤–éƒ¨å¯¹è±¡çš„æˆå‘˜ã€‚ æ–¹æ³•å†…éƒ¨ç±»åŒ¿åå†…éƒ¨ç±»åŒ¿åç±»æ²¡æœ‰åå­—ï¼Œç»§æ‰¿è‡ªçˆ¶ç±»æˆ–è€…å®ç°äº†æŸä¸ªæ¥å£ï¼Œå®ƒæ˜¯æ²¡æœ‰æ„é€ å™¨çš„ï¼Œå› ä¸ºå®ƒè¿åå­—éƒ½æ²¡æœ‰ã€‚ é€šè¿‡ä½¿ç”¨å®ä¾‹åˆå§‹åŒ–ï¼Œå°±èƒ½è¾¾åˆ°ä¸ºåŒ¿åå†…éƒ¨ç±»åˆ›å»ºä¸€ä¸ªæ„é€ å™¨çš„æ•ˆæœï¼ˆå…¶å®å°±æ˜¯åœ¨å®šä¹‰ç±»çš„æ—¶å€™åœ¨å¤§æ‹¬å·é‡Œé¢å†åŠ ä¸ªå¤§æ‹¬å·å†™å…¥æƒ³è¦åˆå§‹åŒ–çš„å†…å®¹ï¼‰ã€‚ é™æ€å†…éƒ¨ç±»ï¼ˆåµŒå¥—ç±» Nested Classï¼‰åµŒå¥—ç±»çš„å¯¹è±¡å’Œå¤–éƒ¨ç±»çš„å¯¹è±¡æ²¡æœ‰å…³ç³»ã€‚ ä¸èƒ½è®¿é—®éé™æ€çš„å¤–éƒ¨ç±»å¯¹è±¡ã€‚ æ¥å£å†…éƒ¨ç±»å¦‚æœæƒ³è¦æŸäº›å…¬å…±ä»£ç ï¼Œå¯ä»¥è¢«æŸä¸ªæ¥å£çš„æ‰€æœ‰ä¸åŒå®ç°æ‰€å…±ç”¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ¥å£å†…éƒ¨çš„åµŒå¥—ç±»ã€‚ ä¸ºä»€ä¹ˆéœ€è¦å†…éƒ¨ç±»å…ˆæ‘˜æŠ„ä¸€æ®µã€ŠThink in Javaã€‹é‡Œçš„è§£é‡Šï¼š æ¯ä¸ªæ¥å£éƒ½èƒ½ç‹¬ç«‹çš„ç»§æ‰¿è‡ªä¸€ä¸ªï¼ˆæ¥å£çš„ï¼‰å®ç°ï¼Œæ‰€ä»¥æ— è®ºå¤–å›´ç±»æ˜¯å¦å·²ç»ç»§æ‰¿äº†æŸä¸ªï¼ˆæ¥å£çš„ï¼‰å®ç°ï¼Œå¯¹äºå†…éƒ¨ç±»éƒ½æ²¡æœ‰å½±å“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå†…éƒ¨ç±»å…è®¸ç»§æ‰¿å¤šä¸ªéæ¥å£ç±»å‹ã€‚ å†…éƒ¨ç±»å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹éƒ½æœ‰è‡ªå·±çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶ä¸”å…¶ä¸å¤–å›´ç±»å¯¹è±¡çš„ä¿¡æ¯ç›¸äº’ç‹¬ç«‹ã€‚ åœ¨å•ä¸ªå¤–å›´ç±»ä¸­ï¼Œå¯ä»¥è®©å¤šä¸ªå†…éƒ¨ç±»ä»¥ä¸åŒçš„æ–¹å¼å®ç°åŒä¸€ä¸ªæ¥å£ï¼Œæˆ–ç»§æ‰¿åŒä¸€ä¸ªç±»ã€‚ æˆ‘è‡ªå·±çš„ç†è§£ï¼š å¦‚æœè¯´ç±»æ˜¯Javaä¸­çš„ä¸€ä¸ªåŸºæœ¬å•å…ƒï¼Œé‚£ä¹ˆå†…éƒ¨ç±»çš„å­˜åœ¨å°±æ‰“ç ´äº†è¿™ç§è¯´æ³•ã€‚å†…éƒ¨ç±»çš„ç²’åº¦æ›´å°ï¼Œå®ƒå…è®¸åœ¨ç±»çš„å†…éƒ¨è¿›ä¸€æ­¥çš„DIY, æä¾›äº†æ›´é«˜çš„çµæ´»æ€§ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"å†…éƒ¨ç±»","slug":"å†…éƒ¨ç±»","permalink":"http://example.com/tags/%E5%86%85%E9%83%A8%E7%B1%BB/"}]},{"title":"Javaä¸­çš„ReentrantReadWriteLock","slug":"Javaä¸­çš„ReentrantReadWriteLock","date":"2019-10-17T13:59:10.000Z","updated":"2019-10-17T13:59:10.000Z","comments":true,"path":"2019/10/17/Javaä¸­çš„ReentrantReadWriteLock/","link":"","permalink":"http://example.com/2019/10/17/Java%E4%B8%AD%E7%9A%84ReentrantReadWriteLock/","excerpt":"","text":"ReentrantReadWriteLock çœ‹ä¸‹å®ƒçš„ç±»å›¾ å¯ä»¥çœ‹åˆ°ReentrantReadWriteLockå®ç°äº†ReadWriteLockæ¥å£ã€‚ReadWriteLockå°±æ˜¯è¯»å†™é”çš„æ„æ€ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆè¦æœ‰ä¸ªè¯»å†™é”å‘¢ï¼Ÿä¸ºä»€ä¹ˆè¦æŠŠè¯»é”å’Œå†™é”åˆ†å¼€å‘¢ï¼Ÿè¿™é‡Œå°±æ˜¯å‡ºäºå¯¹æ€§èƒ½çš„è€ƒè™‘äº†ï¼Œå¤šä¸ªçº¿ç¨‹ä¹‹é—´ï¼Œå¯ä»¥åŒæ—¶è¯»ï¼Œä½†æ˜¯ä¸å¯ä»¥åŒæ—¶å†™æˆ–è€…ä¸€ä¸ªè¯»ä¸€ä¸ªå†™ï¼Œæ‰€ä»¥åˆ†å¼€ä¹‹åï¼Œè¯»é”å’Œå†™é”å„å¸å…¶èŒï¼Œå¯ä»¥æé«˜æ•ˆç‡ã€‚ å’ŒReentrantLocké”çš„å®ç°æ–¹æ³•ä¸€æ ·ï¼ŒReentrantReadWriteLockä¹Ÿæ˜¯é€šè¿‡èšåˆäº†AQSçš„å®ç°ç±»æ¥æ¥å®åŠ é”å’Œé‡Šæ”¾é”çš„åŠŸèƒ½çš„ã€‚ åœ¨ReentrantReadWriteLocké‡Œé¢æœ‰ä¸‰ä¸ªæ¯”è¾ƒé‡è¦çš„å†…éƒ¨ç±»ï¼ŒSync,ReadLockå’ŒWriteLock. å…¶ä¸­SyncåŒæ ·ç»§æ‰¿è‡ªAQSï¼Œç”¨æ¥åšçº¿ç¨‹åŒæ­¥ï¼Œå®ƒèšåˆåˆ°äº†ReadLockå’ŒWriteLockçš„å®šä¹‰ä¸­ã€‚ ç„¶åReadLockå’ŒWriteLockä½œä¸ºé™æ€å†…éƒ¨ç±»ï¼Œéƒ½ç»§æ‰¿è‡ªLockæ¥å£ï¼Œåœ¨é‡Œé¢å®ç°å„è‡ªçš„åŠ é”è§£é”åŠŸèƒ½ã€‚ è¯»å†™çŠ¶æ€çš„è·å–32ä½çš„stateï¼Œé«˜16ä½è¡¨ç¤ºè¯»çŠ¶æ€ï¼Œä½16ä½æ ‡è¯†å†™çŠ¶æ€ å†™é”çš„è·å–ä¸é‡Šæ”¾ï¼ˆå¯é‡å…¥ï¼Œæ’ä»–é”ï¼‰å†™é”æ˜¯ä¸€ä¸ªæ”¯æŒé‡å…¥çš„æ’ä»–é”ã€‚ å¦‚æœæœ‰è¯»é”ï¼Œåˆ™è·å–å†™é”å¤±è´¥ã€‚ å¦‚æœæœ‰å…¶ä»–çº¿ç¨‹çš„å†™é”ï¼Œåˆ™è·å–å†™é”å¤±è´¥ è·å–å…¶å®æ³¨é‡Šå·²ç»å†™çš„å¾ˆæ¸…æ¥šäº†ï¼Œ å¦‚æœè¯»æ•°é‡éé›¶æˆ–è€…å†™æ•°é‡éé›¶ï¼Œæˆ–è€…é”çš„æ‹¥æœ‰è€…æ˜¯å…¶ä»–çº¿ç¨‹ï¼Œåˆ™è·å–é”å¤±è´¥ã€‚ å¦‚æœæ€»çš„çŠ¶æ€æ•°ï¼ˆè¯»æ•°é‡å’Œå†™æ•°é‡çš„æ€»å’Œï¼‰å¤§äºé˜ˆå€¼ï¼Œåˆ™è·å–é”å¤±è´¥ã€‚ å¦åˆ™è·å–é”æˆåŠŸï¼Œæ›´æ–°çŠ¶æ€ å½“å‰è·å–çŠ¶æ€ æ˜¯å¦æˆåŠŸ å½“å‰å†™ æˆåŠŸ å½“å‰è¯» å¤±è´¥ å…¶ä»–å†™ å¤±è´¥ å…¶ä»–è¯» å¤±è´¥ ç®€è¨€ä¹‹ï¼Œå¦‚æœé”è¢«è¯»çº¿ç¨‹ï¼ˆæ— è®ºæ˜¯ä¸æ˜¯å½“å‰çº¿ç¨‹ï¼‰æˆ–è€…å…¶ä»–å†™çº¿ç¨‹å ç”¨ï¼Œåˆ™è·å–å†™é”å¤±è´¥ é‡Šæ”¾ è¯»é”çš„è·å–ä¸é‡Šæ”¾è¯»é”æ˜¯ä¸€ä¸ªæ”¯æŒé‡å…¥çš„å…±äº«é”ã€‚ åªè¦å…¶ä»–å†™çº¿ç¨‹æ²¡æœ‰è·å–å†™é”ï¼Œåˆ™å½“å‰çº¿ç¨‹èƒ½å¤ŸæˆåŠŸè·å–è¯»é”ã€‚ å½“å‰è·å–çŠ¶æ€ æ˜¯å¦æˆåŠŸ å½“å‰å†™ æˆåŠŸ å½“å‰è¯» æˆåŠŸ å…¶ä»–å†™ å¤±è´¥ å…¶ä»–è¯» æˆåŠŸ å¦‚æœå†™é”è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼Œåˆ™å½“å‰çº¿ç¨‹è·å–è¯»é”å¤±è´¥ï¼›å¦‚æœå½“å‰çº¿ç¨‹è·å–äº†å†™é”æˆ–å†™é”æœªè¢«è·å–ï¼Œåˆ™å¢åŠ è¯»çŠ¶æ€ï¼ŒæˆåŠŸè·å–è¯»é”ã€‚ é”é™çº§æœ‰ç§ ä¸€ç¯å¥—ä¸€ç¯çš„æ„Ÿè§‰ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"Lock","slug":"Lock","permalink":"http://example.com/tags/Lock/"}]},{"title":"Javaä¸­çš„AQS","slug":"Javaä¸­çš„AQS","date":"2019-10-17T05:47:12.000Z","updated":"2019-10-17T05:47:12.000Z","comments":true,"path":"2019/10/17/Javaä¸­çš„AQS/","link":"","permalink":"http://example.com/2019/10/17/Java%E4%B8%AD%E7%9A%84AQS/","excerpt":"","text":"AbstractQueuedSynchronizer ç®€å†™AQS, é˜Ÿåˆ—åŒæ­¥å™¨ï¼Œæ˜¯ç”¨æ¥æ„å»ºé”æˆ–è€…å…¶ä»–åŒæ­¥ç»„ä»¶çš„åŸºç¡€æ¡†æ¶ï¼ŒLockæ¥å£çš„å®ç°ï¼Œå¦‚ReentrantLockç­‰éƒ½æœ‰å®ƒçš„èº«å½±ï¼Œéƒ½æ˜¯é€šè¿‡å®ƒæ¥å®ç°çº¿ç¨‹åŒæ­¥çš„ã€‚ä»åå­—å¯ä»¥çœ‹å‡ºï¼Œé¦–å…ˆå®ƒæ˜¯ä¸ªåŒæ­¥å™¨ï¼Œå…¶æ¬¡å®ƒé‡Œé¢è¿˜æœ‰ä¸ªé˜Ÿåˆ—ã€‚ AQSä½¿ç”¨äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œè¿™æ„å‘³ç€AQSç±»é‡Œé¢å¤§ä½“æœ‰ä¸¤ç§æ–¹æ³•ï¼šéœ€è¦è¢«å­ç±»é‡å†™çš„æ¶‰åŠåˆ°å…·ä½“ç»†èŠ‚çš„æ–¹æ³•å’Œæ¨¡æ¿æ–¹æ³•ï¼Œè€Œæ¨¡æ¿æ–¹æ³•å°±å¤§è‡´åˆ»ç”»äº†è¿™ä¸ªæ–¹æ³•çš„æ•´ä½“åŠŸèƒ½ã€‚ çœ‹ä¸‹AQSæä¾›çš„éœ€è¦é‡å†™çš„æ–¹æ³• éœ€è¦é‡å†™çš„æ–¹æ³•ç‹¬å å¼boolean tryAcquire(int arg) 123protected boolean tryAcquire(int arg) &#123; throw new UnsupportedOperationException(); &#125; ç‹¬å å¼è·å–çš„å…·ä½“æ“ä½œã€‚é€šè¿‡CASè®¾ç½®state boolean tryRelease(int arg) 123protected boolean tryRelease(int arg) &#123; throw new UnsupportedOperationException(); &#125; ç‹¬å å¼é‡Šæ”¾çš„å…·ä½“æ“ä½œã€‚å½“å‰çº¿ç¨‹é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œé˜Ÿåˆ—ä¸­æ¥ä¸‹æ¥çš„çº¿ç¨‹åˆ™æœ‰æœºä¼šè·å¾—åŒæ­¥çŠ¶æ€ã€‚ å…±äº«å¼int tryAcquireShared(int arg) 123protected int tryAcquireShared(int arg) &#123; throw new UnsupportedOperationException(); &#125; å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€ã€‚ boolean tryReleaseShared(int arg) 123protected boolean tryReleaseShared(int arg) &#123; throw new UnsupportedOperationException(); &#125; å…±äº«å¼é‡Šæ”¾åŒæ­¥çŠ¶æ€ ç•ªå¤–boolean isHeldExclusively() 123protected boolean isHeldExclusively() &#123; throw new UnsupportedOperationException(); &#125; åŒæ­¥å™¨æ˜¯å¦è¢«å½“å‰çº¿ç¨‹ç‹¬å  è€Œæ¨¡æ¿æ–¹æ³•åˆåˆ†ä¸ºä¸¤ç±»ï¼šå…±äº«å¼çš„é”æ“ä½œå’Œç‹¬å å¼çš„é”æ“ä½œï¼Œæ‰€è°“å…±äº«å¼ï¼ŒæŒ‡çš„æ˜¯å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è·å–åŒæ­¥çŠ¶æ€ï¼Œç‹¬å å¼æŒ‡çš„æ˜¯åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€ï¼Œå…¶ä»–æœªè·å–åˆ°åŒæ­¥çŠ¶æ€çš„çº¿ç¨‹åªèƒ½æ’é˜Ÿã€‚ ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹AQSæä¾›çš„æ¨¡æ¿æ–¹æ³•ï¼š æ¨¡æ¿æ–¹æ³•ç‹¬å å¼void acquire(int arg) 12345public final void acquire(int arg) &#123; if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) selfInterrupt(); &#125; ç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€ï¼Œä¸æˆåŠŸåˆ™è¿›å…¥åŒæ­¥é˜Ÿåˆ—ç­‰å¾…ï¼Œå¦‚æœè¿›å…¥é˜Ÿåˆ—ä¹Ÿå¤±è´¥äº†ï¼Œåˆ™ä¸­æ–­è‡ªå·±ã€‚ void acquireInterruptibly(int arg) 1234567public final void acquireInterruptibly(int arg) throws InterruptedException &#123; if (Thread.interrupted()) throw new InterruptedException(); if (!tryAcquire(arg)) doAcquireInterruptibly(arg); &#125; ä½œç”¨å’Œacquire()å·®ä¸å¤šï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯å®ƒèƒ½å¤Ÿå“åº”ä¸­æ–­ã€‚ boolean tryAcquireNanos(int arg, long nanosTimeout) 1234567public final boolean tryAcquireNanos(int arg, long nanosTimeout) throws InterruptedException &#123; if (Thread.interrupted()) throw new InterruptedException(); return tryAcquire(arg) || doAcquireNanos(arg, nanosTimeout); &#125; å¢åŠ äº†è¶…æ—¶é™åˆ¶ï¼Œå¦‚æœä¸€æ®µæ—¶é—´åè¿˜æ²¡è·å¾—åŒæ­¥çŠ¶æ€ï¼Œåˆ™è¿”å›false. boolean release(int arg) 123456789public final boolean release(int arg) &#123; if (tryRelease(arg)) &#123; Node h = head; if (h != null &amp;&amp; h.waitStatus != 0) unparkSuccessor(h); return true; &#125; return false; &#125; ç‹¬å å¼é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œå”¤é†’é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªçº¿ç¨‹ã€‚ å…±äº«å¼void acquireShared(int arg) 1234public final void acquireShared(int arg) &#123; if (tryAcquireShared(arg) &lt; 0) doAcquireShared(arg); &#125; å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœå¤±è´¥ï¼ŒåŠ å…¥é˜Ÿåˆ—ã€‚ void acquireSharedInterruptibly(int arg) 1234567public final void acquireSharedInterruptibly(int arg) throws InterruptedException &#123; if (Thread.interrupted()) throw new InterruptedException(); if (tryAcquireShared(arg) &lt; 0) doAcquireSharedInterruptibly(arg); &#125; å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€ï¼Œä¸”å“åº”ä¸­æ–­ã€‚ boolean tryAcquireSharedNanos(int arg, long nanosTimeout) 1234567public final boolean tryAcquireSharedNanos(int arg, long nanosTimeout) throws InterruptedException &#123; if (Thread.interrupted()) throw new InterruptedException(); return tryAcquireShared(arg) &gt;= 0 || doAcquireSharedNanos(arg, nanosTimeout); &#125; å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€ï¼Œä¸”æœ‰è¶…æ—¶é™åˆ¶ boolean releaseShared(int arg) 1234567public final boolean releaseShared(int arg) &#123; if (tryReleaseShared(arg)) &#123; doReleaseShared(); return true; &#125; return false; &#125; å…±äº«å¼é‡Šæ”¾åŒæ­¥çŠ¶æ€ã€‚ ç•ªå¤–Collection&lt;Thread&gt; getQueuedThreads() 123456789public final Collection&lt;Thread&gt; getQueuedThreads() &#123; ArrayList&lt;Thread&gt; list = new ArrayList&lt;Thread&gt;(); for (Node p = tail; p != null; p = p.prev) &#123; Thread t = p.thread; if (t != null) list.add(t); &#125; return list; &#125; æŸ¥è¯¢çº¿ç¨‹ä¸­çš„é˜Ÿåˆ—é›†åˆã€‚ é€šè¿‡ä¸Šè¿°åˆ†æå¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡æ¨¡æ¿æ¨¡å¼çš„è®¾è®¡ï¼Œå½“ç”¨æˆ·è‡ªå·±æƒ³è¦å®ç°ä¸€ä¸ªåŒæ­¥å™¨æ—¶ï¼Œåªéœ€è¦ç»§æ‰¿è‡ªAQS, å®ç°é‚£äº›éœ€è¦è¢«è¦†ç›–çš„æ–¹æ³•ï¼Œç„¶åå¯¹å¤–æä¾›ä¸€äº›æ¥å£å°±è¡Œäº†ï¼Œå°±åƒReentrantLockä¸€æ ·ï¼Œå®ƒçš„lock(),tryLock(),release()ç­‰æ–¹æ³•éƒ½æ˜¯è°ƒç”¨åŒæ­¥å™¨çš„acquire(),tryAcquire()å’Œrelease()æ–¹æ³•ï¼Œå¯¹å®ç°è€…å‹å¥½ï¼Œæ›´å¯¹ç”¨æˆ·å‹å¥½ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"Lock","slug":"Lock","permalink":"http://example.com/tags/Lock/"}]},{"title":"Javaä¸­çš„Lock","slug":"Javaä¸­çš„Lock","date":"2019-10-16T02:05:07.000Z","updated":"2019-10-16T02:05:07.000Z","comments":true,"path":"2019/10/16/Javaä¸­çš„Lock/","link":"","permalink":"http://example.com/2019/10/16/Java%E4%B8%AD%E7%9A%84Lock/","excerpt":"","text":"Lockæ˜¯JUCåŒ…ä¸­çš„ä¸€ä¸ªæ¥å£ï¼Œæ˜¯åœ¨synchronizedå…³é”®å­—ä¹‹åå‡ºç°çš„ï¼Œç”¨æ¥æä¾›é”çš„åŠŸèƒ½ï¼Œæœ¬æ–‡ä¸»è¦è®¨è®ºLockæ¥å£ä»¥åŠå…¶å®ç°ç±»ï¼Œä»¥åŠä¸ºä»€ä¹ˆæœ‰äº†synchronizedå…³é”®å­—äº†è¿˜è¦æœ‰Lock. synchronizedä½œä¸ºå†…åµŒçš„Javaå…³é”®å­—ï¼Œå…¶å¯ä»¥éšå¼åœ°è·å–å’Œé‡Šæ”¾é”ï¼Œå®ƒç®€åŒ–äº†åŒæ­¥çš„ç®¡ç†ï¼ŒåŒæ—¶ä¹Ÿå›ºåŒ–äº†é”çš„è·å–å’Œé‡Šæ”¾ï¼Œç¼ºå°‘çµæ´»æ€§ã€‚ åœ¨Java SE 5 ä¹‹åï¼Œæ–°å¢äº†Lockæ¥å£ï¼ˆä»¥åŠç›¸å…³å®ç°ç±»ï¼‰ï¼Œç›¸æ¯”äºSynchronizedå…³é”®å­—ï¼Œå®ƒéœ€è¦æ˜¾å¼çš„è·å–å’Œé‡Šæ”¾é”ï¼ŒåŒæ—¶å¢åŠ äº†è¶…æ—¶è·å–ã€å“åº”ä¸­æ–­ç­‰æ–¹æ³•ã€‚ å…ˆæ¥çœ‹ä¸‹å®ƒçš„å®ç°å…³ç³» æˆ‘ä»¬ä¼šä¸»è¦è®¨è®ºåœˆå‡ºæ¥çš„ä¸‰ä¸ªå®ç°ç±» å†æ¥çœ‹ä¸‹Lockæ¥å£çš„æˆå‘˜ å…¶ä¸­lock(),tryLock(),tryLock(ong, TimeUnit)ä»¥åŠlockInterruptibly()ç”¨æ¥åŠ é”ï¼Œunlock()ç”¨æ¥è§£é”ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœä½¿ç”¨lockInterruptibly()æ–¹æ³•æ¥è·å–é”çš„è¯ï¼Œå¦‚æœçº¿ç¨‹æ²¡æœ‰è·å–æˆåŠŸè€Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹æ˜¯å¯ä»¥å“åº”ä¸­æ–­çš„ï¼Œç›¸æ¯”åªä¸‹ï¼Œä½¿ç”¨synchronizedå…³é”®å­—è·å–é”æ—¶å¦‚æœè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œçº¿ç¨‹æ˜¯ä¸èƒ½å“åº”ä¸­æ–­çš„ã€‚ Lockæ¥å£åªæ˜¯å®šä¹‰äº†å®ç°é”çš„ä¸€ç³»åˆ—çº¦å®šï¼Œæ¯”å¦‚lock(),unLock()ä»¥åŠtryLock()ç­‰ï¼Œå…·ä½“çš„å®ç°éƒ½æ˜¯äº¤ç»™å®ƒçš„å®ç°ç±»å»åšçš„ï¼Œæ¯”å¦‚ReentrantLock,ReentrantReadWriteLock.ReadLockå’ŒReentrantReadWriteLock.WriteLockç­‰ã€‚è€Œè¿™äº›å®ç°ç±»èƒ½å¤Ÿå®ç°é”åŠŸèƒ½çš„å…³é”®ï¼Œåœ¨äºå®ƒä»¬éƒ½èšåˆäº†ä¸€ä¸ªAQSçš„å®ç°ç±»ï¼ŒAQSæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œé€šè¿‡æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œæä¾›äº†ä¸€ç³»åˆ—çŠ¶æ€åŒæ­¥çš„æ–¹æ³•ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"Lock","slug":"Lock","permalink":"http://example.com/tags/Lock/"}]},{"title":"httpsåè®®","slug":"httpsåè®®","date":"2019-10-15T13:51:10.000Z","updated":"2019-10-15T13:51:10.000Z","comments":true,"path":"2019/10/15/httpsåè®®/","link":"","permalink":"http://example.com/2019/10/15/https%E5%8D%8F%E8%AE%AE/","excerpt":"","text":"ç›¸æ¯”äºhttpçš„æ˜é—®ä¼ è¾“ï¼Œæ˜“è¢«ç¯¡æ”¹çš„ç‰¹ç‚¹ï¼Œæå‡ºäº†httpsã€‚ httpsåˆ©ç”¨äº†å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ï¼Œå¼•å…¥äº†ç¬¬ä¸‰æ–¹æœºæ„CA,è¯ä¹¦æƒå¨æœºæ„ åè®®ä¸Šè®²å®ƒåœ¨åº”ç”¨å±‚ä¸‹é¢åŠ äº†ä¸ªSSL/TLSå±‚ã€‚ é¦–å…ˆæœåŠ¡ç«¯ä¼šå‘ç¬¬ä¸‰æ–¹æœºæ„ç”³è¯·è¯ä¹¦ï¼Œå¦‚ä½•ç”³è¯·å‘¢ï¼ŸæœåŠ¡ç«¯å‘Šè¯‰è®¤è¯ä¸­å¿ƒè‡ªå·±çš„ä¸ªäººèº«ä»½ä¿¡æ¯ä»¥åŠå…¬é’¥ï¼Œè®¤è¯ä¸­å¿ƒç»è¿‡æ ¸å®åå‘ç»™æœåŠ¡ç«¯ä¸€ä¸ªè¯ä¹¦ã€‚è¯ä¹¦åŒ…å«äº†å“ªäº›å†…å®¹å‘¢ï¼Ÿ è¯ä¹¦é¢å‘æœºæ„åç§° è¯ä¹¦æœ¬èº«çš„æ•°å­—ç­¾åï¼ˆå…ˆhashå†ç”¨æœºæ„çš„ç§é’¥åŠ å¯†ï¼‰ è¢«æœºæ„ç§é’¥åŠ å¯†è¿‡çš„è¯ä¹¦æŒæœ‰è€…çš„å…¬é’¥ ç­¾åè¯ä¹¦ç”¨åˆ°çš„hashç®—æ³• æœåŠ¡ç«¯ç½‘å€ è¿˜æœ‰ä¸€ä¸ªå‰æï¼Œå°±æ˜¯ç°åœ¨çš„æµè§ˆå™¨éƒ½é»˜è®¤å†…ç½®äº†CAæ ¹è¯ä¹¦ï¼ŒåŒ…å«äº†CAçš„å…¬é’¥ã€‚ æœ‰äº†è¿™äº›ä¸œè¥¿åï¼Œå®¢æˆ·ç«¯ç°åœ¨æƒ³å’ŒæœåŠ¡ç«¯é€šä¿¡ï¼ŒæœåŠ¡ç«¯æŠŠè¯ä¹¦å‘ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ ¹æ®è‡ªå·±çš„æ ¹è¯ä¹¦é‡Œé¢çš„å…¬é’¥ï¼Œå» éªŒè¯è¯ä¹¦çœŸå‡ï¼ˆå…ˆæ‹¿è¯ä¹¦å…¬é’¥æŠŠç­¾åè§£å¯†å¾—åˆ°æ‘˜è¦Aï¼Œç„¶åæ ¹æ®ç›¸åº”hashç®—æ³•å¯¹è¯ä¹¦é‡æ–°è®¡ç®—æ‘˜è¦å¾—åˆ°æ‘˜è¦Bï¼Œçœ‹ä¸¤ä¸ªæ˜¯å¦ç›¸ç­‰ï¼‰ è¯ä¹¦æ˜¯çœŸçš„ä»¥åï¼Œç”¨æœºæ„å…¬é’¥è§£å¯†è¯ä¹¦æŒæœ‰è€…çš„å…¬é’¥ï¼ˆæ³¨æ„è¯ä¹¦æŒæœ‰è€…ä¹Ÿå°±æ˜¯æœåŠ¡ç«¯æœ‰ä¸€å¯¹å¯†é’¥ï¼Œè¯ä¹¦ä¹Ÿæœ‰ä¸€å¯¹ï¼‰ ç„¶åæ‹¿è§£å¯†å‡ºæ¥çš„å…¬é’¥åŠ å¯†åé¢çœŸæ­£é€šä¿¡æ—¶éœ€è¦ç”¨åˆ°çš„å¯¹ç§°åŠ å¯†çš„å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼Œå‘ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ‹¿è‡ªå·±çš„ç§é’¥è§£å¯†å¾—åˆ°å¯†é’¥ï¼Œå¼€å§‹é€šä¿¡ã€‚ æ€»ç»“ï¼šhttpsæ€æƒ³ä¸Šçš„åˆ›æ–°ç‚¹åœ¨å“ªé‡Œå‘¢ï¼Ÿå¼•å…¥äº†ç¬¬ä¸‰æ–¹æœºæ„å’Œéå¯¹ç§°åŠ å¯†ï¼Œæ‰€ä»¥è¯´å¦‚æœè¿™ä¸ªç¬¬ä¸‰æ–¹æœºæ„å‡‰äº†é‚£ä¹Ÿå°±çœŸå‡‰äº†ï¼Œåæ­£è¿™äº›åšæ³•éƒ½ä¸èƒ½è¯´ä»æ ¹æœ¬ä¸Šè§£å†³å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºæ€»æœ‰ä¸€ä¸ªèµ·å§‹ç‚¹æ˜¯ä¸å®‰å…¨çš„ã€‚æ®è¯´é‡å­å¯†ç å¯ä»¥çªç ´è¿™ä¸ªèµ·å§‹ç‚¹ï¼Ÿ","categories":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"http://example.com/categories/%E7%BD%91%E7%BB%9C/"}],"tags":[{"name":"https","slug":"https","permalink":"http://example.com/tags/https/"}]},{"title":"å¼ºåŒ–å­¦ä¹ ","slug":"å¼ºåŒ–å­¦ä¹ ","date":"2019-10-14T11:47:30.000Z","updated":"2019-10-14T11:47:30.000Z","comments":true,"path":"2019/10/14/å¼ºåŒ–å­¦ä¹ /","link":"","permalink":"http://example.com/2019/10/14/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/","excerpt":"","text":"å‰è¨€å¼ºåŒ–å­¦ä¹ æ˜¯ä¸€ç±»ç®—æ³•, æ˜¯è®©è®¡ç®—æœºå®ç°ä»ä¸€å¼€å§‹ä»€ä¹ˆéƒ½ä¸æ‡‚, è„‘è¢‹é‡Œæ²¡æœ‰ä¸€ç‚¹æƒ³æ³•, é€šè¿‡ä¸æ–­åœ°å°è¯•, ä»é”™è¯¯ä¸­å­¦ä¹ , æœ€åæ‰¾åˆ°è§„å¾‹, å­¦ä¼šäº†è¾¾åˆ°ç›®çš„çš„æ–¹æ³•ã€‚ é‚£è®¡ç®—æœºé€šè¿‡ä»€ä¹ˆæ¥å­¦ä¹ å‘¢? åŸæ¥è®¡ç®—æœºä¹Ÿéœ€è¦ä¸€ä½è™šæ‹Ÿçš„è€å¸ˆ, è¿™ä¸ªè€å¸ˆæ¯”è¾ƒåå•¬, ä»–ä¸ä¼šå‘Šè¯‰ä½ å¦‚ä½•ç§»åŠ¨, å¦‚ä½•åšå†³å®š, ä»–ä¸ºä½ åšçš„äº‹åªæœ‰ç»™ä½ çš„è¡Œä¸ºæ‰“åˆ†, é‚£æˆ‘ä»¬åº”è¯¥ä»¥ä»€ä¹ˆå½¢å¼å­¦ä¹ è¿™äº›ç°æœ‰çš„èµ„æº, æˆ–è€…è¯´æ€ä¹ˆæ ·åªä»åˆ†æ•°ä¸­å­¦ä¹ åˆ°æˆ‘åº”è¯¥æ€æ ·åšå†³å®šå‘¢? å¾ˆç®€å•, æˆ‘åªéœ€è¦è®°ä½é‚£äº›é«˜åˆ†, ä½åˆ†å¯¹åº”çš„è¡Œä¸º, ä¸‹æ¬¡ç”¨åŒæ ·çš„è¡Œä¸ºæ‹¿é«˜åˆ†, å¹¶é¿å…ä½åˆ†çš„è¡Œä¸ºã€‚ æ‰€ä»¥è¯´ï¼Œå¼ºåŒ–å­¦ä¹ å…·æœ‰åˆ†æ•°å¯¼å‘æ€§ã€‚ ä¸€äº›å†³ç­–æ€§çš„é—®é¢˜é€‚åˆç”¨å¼ºåŒ–å­¦ä¹ ã€‚ å¸¸ç”¨RLæ–¹æ³•ï¼š Model-Free RL Q Learning Sarsa Model-Based RL Q-Learningå…³é”®åœ¨äºQè¡¨","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"http://example.com/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"å¼ºåŒ–å­¦ä¹ ","slug":"å¼ºåŒ–å­¦ä¹ ","permalink":"http://example.com/tags/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/"}]},{"title":"Javaä¸­çš„finalå…³é”®å­—","slug":"Javaä¸­çš„finalå…³é”®å­—","date":"2019-10-11T07:54:43.000Z","updated":"2019-10-11T07:54:43.000Z","comments":true,"path":"2019/10/11/Javaä¸­çš„finalå…³é”®å­—/","link":"","permalink":"http://example.com/2019/10/11/Java%E4%B8%AD%E7%9A%84final%E5%85%B3%E9%94%AE%E5%AD%97/","excerpt":"","text":"ç”¨æ³•ä¿®é¥°å˜é‡ä¿®é¥°åŸºæœ¬ç±»å‹ï¼šåŸºæœ¬ç±»å‹çš„å€¼ä¸å¯è¢«æ”¹å˜ ä¿®é¥°å¼•ç”¨ï¼šå¼•ç”¨çš„æŒ‡å‘ä¸èƒ½è¢«æ”¹å˜ è¢«finalä¿®é¥°çš„åŸºæœ¬ç±»å‹å’ŒStringç±»å‹ä¼šåœ¨ç¼–è¯‘å™¨è¢«æ”¾åˆ°å¸¸é‡æ±  ä¿®é¥°æ–¹æ³•æ–¹æ³•ä¸å¯è¢«è¦†ç›– ä¿®é¥°ç±»ç±»ä¸å¯è¢«ç»§æ‰¿ åŸç†æˆ‘ä»¬åç¼–è¯‘å¦‚ä¸‹ä»£ç ï¼š 123456789public final class Tiger &#123; private final String name =&quot;tiget&quot; ; private final int a = 1; public final void run()&#123; System.out.println(&quot;tiger is running&quot;); &#125;&#125; å¾—åˆ°ï¼š","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"å…³é”®å­—","slug":"å…³é”®å­—","permalink":"http://example.com/tags/%E5%85%B3%E9%94%AE%E5%AD%97/"}]},{"title":"Javaä¸­newå¯¹è±¡æ—¶åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆ","slug":"Javaä¸­newå¯¹è±¡æ—¶åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆ","date":"2019-10-10T08:12:49.000Z","updated":"2023-05-29T14:17:39.311Z","comments":true,"path":"2019/10/10/Javaä¸­newå¯¹è±¡æ—¶åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆ/","link":"","permalink":"http://example.com/2019/10/10/Java%E4%B8%ADnew%E5%AF%B9%E8%B1%A1%E6%97%B6%E5%88%B0%E5%BA%95%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/","excerpt":"","text":"Javaä¸­æœ‰è®¸å¤šåˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œæ¯”å¦‚ä½¿ç”¨newå…³é”®å­—ï¼Œä½¿ç”¨åå°„ï¼Œä½¿ç”¨åºåˆ—åŒ–/ååºåˆ—åŒ–ï¼Œä½¿ç”¨å…‹éš†ï¼Œå…¶å†…éƒ¨åŸç†ä¹Ÿéƒ½ä¸ä¸€æ ·ï¼Œæœ¬æ–‡ä¸»è¦è®¨è®ºåœ¨ä½¿ç”¨newå…³é”®å­—åˆ›å»ºå¯¹è±¡çš„å‰å‰ååJVMéƒ½åšäº†é‚£äº›äº‹ã€‚è¦è®²æ¸…æ¥šè¿™ä¸ªäº‹æƒ…ï¼Œéœ€è¦äº†è§£ä¸€å®šçš„JVMå†…å­˜æ¨¡å‹ï¼Œä»¥åŠç±»åŠ è½½æœºåˆ¶ã€‚ ###ç¼˜èµ· é¦–å…ˆè¦æ˜ç™½ï¼Œåˆ›å»ºå¯¹è±¡è¿™æ˜¯ä¸€ä¸ªè¿è¡ŒæœŸçš„åŠ¨ä½œï¼Œåœ¨è¿è¡ŒæœŸå‰é¢ï¼Œè¿˜æœ‰ä¸€ä¸ªç¼–è¯‘æœŸã€‚ç¼–è¯‘æœŸå°±æ˜¯å°†æˆ‘ä»¬å†™çš„javaæ–‡ä»¶ç¼–è¯‘æˆclassæ–‡ä»¶çš„è¿‡ç¨‹ï¼Œè¿è¡ŒæœŸæŒ‡çš„æ˜¯JVMåŠ¨æ€åŠ è½½classæ–‡ä»¶å¹¶æ‰§è¡Œçš„è¿‡ç¨‹ã€‚åœ¨è®¨è®ºåˆ›å»ºå¯¹è±¡ä¹‹å‰ï¼Œé¦–å…ˆè¦ç»è¿‡ç¼–è¯‘å™¨ï¼Œç”Ÿæˆäº†éœ€è¦çš„classæ–‡ä»¶ã€‚å…³äºclassæ–‡ä»¶çš„ä»‹ç»å¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« ã€‚ ###ä½¿ç”¨newåˆ›å»ºå¯¹è±¡ è¿™ä¸€è¿‡ç¨‹æ¶‰åŠåˆ°è®¸å¤šç±»åŠ è½½çš„çŸ¥è¯†ã€‚ä½¿ç”¨newå…³é”®å­—åˆ›å»ºå¯¹è±¡æ—¶ï¼Œä¸»è¦ç»è¿‡ä»¥ä¸‹å‡ ä¸ªè¿‡ç¨‹ï¼š è™šæ‹Ÿæœºé‡åˆ°newæŒ‡ä»¤ï¼Œåˆ°å¸¸é‡æ± å®šä½åˆ°è¿™ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ã€‚ æ£€æŸ¥ç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦è¢«åŠ è½½ã€è§£æã€åˆå§‹åŒ–è¿‡ã€‚ è™šæ‹Ÿæœºä¸ºå¯¹è±¡åˆ†é…å†…å­˜ã€‚ è™šæ‹Ÿæœºå°†åˆ†é…åˆ°çš„å†…å­˜ç©ºé—´éƒ½åˆå§‹åŒ–ä¸ºé›¶å€¼ã€‚ æ‰§è¡Œæ–¹æ³•ï¼Œæˆå‘˜å˜é‡è¿›è¡Œåˆå§‹åŒ–ã€‚ æˆ‘ä»¬å†™ä¸€æ®µç®€å•çš„ä»£ç æ¥å¸®åŠ©ç†è§£ä¸Šè¿°è¿‡ç¨‹ï¼š Father.java 1234567891011121314public class Father &#123; private String privateFiled = &quot;privateField&quot; ; protected String protectedField = &quot;protectedField&quot; ; public String publicField = &quot;publicField&quot; ; private void privateMethod()&#123; &#125; protected void protectedMethod()&#123; &#125; public void publicMethod()&#123; &#125;&#125; Son.java 1234567public class Son extends Father &#123; private String name ; public void introduce()&#123; System.out.println(&quot;I&#x27;m son&quot;); &#125;&#125; Test.java 12345public class Test &#123; public static void main(String[] args) &#123; Father son = new Son(); &#125;&#125; ä¸‹é¢æˆ‘ä»¬æ¥é€ä¸€è§£é‡Šè¿™å‡ ä¸ªè¿‡ç¨‹ã€‚ ####è™šæ‹Ÿæœºé‡åˆ°newæŒ‡ä»¤ï¼Œåˆ°å¸¸é‡æ± å®šä½åˆ°è¿™ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ æˆ‘ä»¬åœ¨Test.javaä¸­çš„mainæ–¹æ³•ä¸­ä½¿ç”¨newå…³é”®å­—åˆ›å»ºSonå¯¹è±¡ï¼Œæˆ‘ä»¬åç¼–è¯‘ä¸€ä¸‹Test.javaï¼š å¸¸é‡æ± ï¼š æŒ‡ä»¤ï¼š å¯ä»¥çœ‹åˆ°åœ¨mainæ–¹æ³•é¦–å…ˆå°±æ˜¯newæŒ‡ä»¤ï¼Œéœ€è¦newä¸€ä¸ªSonå¯¹è±¡ï¼Œè¿™æ—¶å€™JVMå›å»å¸¸é‡æ± ä¸­å¯»æ‰¾è¿™ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ã€‚å¯ä»¥çœ‹åˆ°è¿™ä¸ªç¬¦å·å¼•ç”¨åœ¨å¸¸é‡æ± ä¸­ç´¢å¼•ä¸º2ï¼Œç»§ç»­åœ¨å¸¸é‡æ± ä¸­æŸ¥çœ‹ç¬¬äºŒä¸ªå¸¸é‡ï¼Œå‘ç°å®ƒæ˜¯ä¸€ä¸ªclass,å¹¶ä¸”classçš„åå­—å­˜å‚¨åœ¨ç¬¬15ä¸ªå¸¸é‡ï¼Œç¬¬15ä¸ªå¸¸é‡æ˜¯ä¸ªå­—ç¬¦ä¸²ï¼Œå†…å®¹æ˜¯Sonï¼Œç”±æ­¤å°±æ‰¾åˆ°äº†éœ€è¦åˆ›å»ºçš„ç±»çš„ç¬¦å·å¼•ç”¨ã€‚ æ£€æŸ¥ç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦è¢«åŠ è½½ã€è§£æã€åˆå§‹åŒ–è¿‡ä¸Šä¸€æ­¥ä¸­æˆ‘ä»¬å·²ç»çŸ¥é“äº†éœ€è¦newå‡ºä¸€ä¸ªSonå¯¹è±¡ï¼Œè¿™ä¸€æ­¥çš„ç›®çš„å°±æ˜¯æ£€æŸ¥ä»£è¡¨Sonçš„å¯¹åº”ç±»æœ‰æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œè¿™é‡Œå…¶å®æ˜¯ç±»åŠ è½½çš„å†…å®¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦æƒ³åœ¨è¿è¡ŒæœŸä½¿ç”¨æŸä¸ªç±»ï¼Œåœ¨æ­¤ä¹‹å‰å¿…é¡»æŠŠè¿™ä¸ªç±»å¯¹åº”çš„classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒã€è§£æå’Œåˆå§‹åŒ–ï¼Œæ‰èƒ½è½¬æ¢æˆå¯ä»¥è¢«JVMç›´æ¥ä½¿ç”¨çš„Javaç±»å‹ã€‚å¦‚æœè¿™ä¸ªç±»è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œåˆ™æ‰§è¡Œç±»åŠ è½½è¿‡ç¨‹è¿›è¡Œåˆå§‹åŒ–ã€‚ è™šæ‹Ÿæœºä¸ºå¯¹è±¡åˆ†é…å†…å­˜å¥½ï¼Œç»è¿‡ä¸Šè¿°æ­¥éª¤ï¼Œæˆ‘ä»¬å’Œç±»ç›¸å…³çš„å·¥ä½œå·²ç»åšå®Œäº†ï¼Œç°åœ¨å†…å­˜ä¸­ä¹Ÿæœ‰äº†JVMå¯ä»¥ç”¨çš„javaç±»å‹äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å‡†å¤‡å¯¹è±¡ç›¸å…³äº‹å®œã€‚ é¦–å…ˆå°±æ˜¯ç»™å¯¹è±¡åˆ†é…å†…å­˜ï¼Œé‚£ä¹ˆåˆ†é…å¤šå°‘å‘¢ï¼Ÿå…¶å®å¯¹è±¡çš„å¤§å°åœ¨ç±»åŠ è½½å®Œæˆåå°±å·²ç»ç¡®å®šäº†ï¼Œ è¿™é‡Œè¦åšçš„åªä¸è¿‡æ˜¯æŠŠäººå®¶éœ€è¦çš„ç©ºé—´ç»™åˆ†é…å‡ºæ¥å°±è¡Œã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯å¯¹è±¡çš„ç»“æ„ï¼Œæœ‰å¯¹è±¡å¤´ã€å®ä¾‹å­—æ®µå’Œå¯¹é½å¡«å……å­—æ®µï¼Œæ‰€ä»¥åˆ†é…çš„ç©ºé—´è‚¯å®šæ˜¯è¦æ¯”æˆ‘ä»¬æ‰€èƒ½çœ‹åˆ°çš„ç©ºé—´å¤§çš„ã€‚ å…³äºç»§æ‰¿ï¼Œæ˜¯å¦‚ä½•åˆ†é…å†…å­˜çš„ å¯¹äºç»§æ‰¿è‡ªçˆ¶ç±»çš„å­ç±»æ¥è¯´ï¼Œåœ¨åˆ›å»ºå­ç±»çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šåˆ›å»ºçˆ¶ç±»ï¼Œåªä¸è¿‡æ˜¯åœ¨è°ƒç”¨è‡ªç±»çš„æ„é€ æ–¹æ³•çš„æ—¶å€™ä¼šè°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•è¿›è¡Œæˆå‘˜å˜é‡çš„åˆå§‹åŒ–ï¼Œä»…æ­¤è€Œå·²ã€‚è¯•æƒ³ä¸€ä¸‹ä»»ä½•ç±»éƒ½ç»§æ‰¿è‡ªObjectç±»ï¼Œå¦‚æœæ¯æ¬¡åˆ›å»ºè‡ªç±»çš„æ—¶å€™éƒ½è¦åˆ›å»ºä¸€ä¸ªçˆ¶ç±»ï¼Œé‚£å°†ä¼šé€ æˆå¤šå°‘å†—ä½™ã€‚ é‚£æ—¢ç„¶æ²¡æœ‰åˆ›å»ºçˆ¶ç±»ï¼Œæˆ‘ä»¬è®²çš„å­ç±»èƒ½è®¿é—®ç»§æ‰¿è‡ªçˆ¶ç±»çš„éprivateçš„æˆå‘˜å˜é‡å’Œæ–¹æ³•åˆæ˜¯å“ªæ¥çš„å‘¢ï¼Ÿå…¶å®åœ¨åˆ†é…å†…å­˜çš„æ—¶å€™ï¼ŒJVMä¼šç»™å­ç±»è‡ªèº«ä»¥åŠä»çˆ¶ç±»ç»§æ‰¿ä¸‹æ¥çš„å„ç§å±æ€§å’Œæ–¹æ³•éƒ½åˆ†é…ç©ºé—´çš„ï¼Œæ³¨æ„æ˜¯å„ç§ã€‚è™½ç„¶å®˜æ–¹æ–‡æ¡£é‡Œè®²çš„æ˜¯è¢«privateä¿®é¥°çš„æˆå‘˜å˜é‡ä¸ä¼šè¢«ç»§æ‰¿ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡publicçš„getterå’Œsetteræ¥è·å¾—å’Œä¿®æ”¹ï¼Œä½†æ˜¯ç¬”è€…è®¤ä¸ºï¼Œå…¶å®privateå˜é‡ä¹Ÿè¢«ç»§æ‰¿ä¸‹æ¥äº†ï¼Œåªä¸è¿‡ç›´æ¥è®¿é—®ä¸åˆ°è€Œå·²ã€‚ åˆ†é…å†…å­˜æ—¶æ˜¯å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨çš„ åœ¨åˆ†é…å†…å­˜çš„æ—¶å€™ï¼Œéƒ½ä¼šç»™æ¯ä¸ªçº¿ç¨‹é¢„å…ˆåˆ’åˆ†å¥½ä¸€å°å—å†…å­˜ï¼Œå«åšTLAB(Thread Local Allocation Buffer),è¿™éƒ¨åˆ†å†…å­˜æ˜¯æœ¬åœ°çº¿ç¨‹ç‹¬äº«çš„ï¼Œä»¥æ­¤æ¥é˜²æ­¢å¤šä¸ªçº¿ç¨‹ç»™åŒä¸€å—åœ°å€ç©ºé—´ä¸Šåˆ†é…å¯¹è±¡ã€‚ å†…å­˜ä¸€å®šæ˜¯åˆ†é…åœ¨å †ä¸Šå— é€ƒé€¸åˆ†æã€æ ˆä¸Šåˆ†é…ã€æ ‡é‡æ›¿æ¢ç­‰æŠ€æœ¯ä½¿å¾—ä¸é‚£ä¹ˆä¸€å®šäº†ã€‚ å¦‚æœåˆ†é…åˆ°å †ä¸Šï¼Œåˆ†é…åˆ°å †ä¸Šçš„å“ªé‡Œ çœ‹æ˜¯å°å¯¹è±¡è¿˜æ˜¯å¤§å¯¹è±¡ã€‚å°å¯¹è±¡åˆ†é…åˆ°Eden,å¤§å¯¹è±¡æ”¾åˆ°Old Gen. è™šæ‹Ÿæœºå°†åˆ†é…åˆ°çš„å†…å­˜ç©ºé—´éƒ½åˆå§‹åŒ–ä¸ºé›¶å€¼éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„åˆå§‹åŒ–ä¸ºé›¶å€¼å¹¶ä¸æ˜¯æˆ‘ä»¬è‡ªå·±å†™çš„ä»£ç é‡Œçš„èµ‹å€¼æ“ä½œï¼Œè€Œæ˜¯JVMè‡ªå¸¦çš„æ“ä½œã€‚ æ‰§è¡Œæ–¹æ³•ï¼Œæˆå‘˜å˜é‡è¿›è¡Œåˆå§‹åŒ–è¿™é‡Œæ‰æ˜¯çœŸæ­£æ‰§è¡Œæˆ‘ä»¬è‡ªå·±çš„æ„é€ æ–¹æ³•ï¼Œåœ¨æ„é€ æ–¹æ³•é‡Œè¦å…ˆè°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œä¸€ç›´å‘ä¸Šå›æº¯ä¸€ç›´åˆ°æœ€æ ¹æºï¼Œä»æœ€æ ¹æºçš„çˆ¶ç±»æ„é€ æ–¹æ³•å¼€å§‹ä¾æ¬¡å‘ä¸‹è°ƒç”¨ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæ ‡é¢˜å†™çš„æ˜¯æˆå‘˜å˜é‡åˆå§‹åŒ–ï¼Œè€Œæˆ‘å†…å®¹å†™çš„æ˜¯æ‰§è¡Œæ„é€ æ–¹æ³•ï¼Œä½†äº‹å®æ˜¯ï¼Œæœ‰äº›æˆå‘˜å˜é‡çš„åˆå§‹åŒ–å·¥ä½œå¹¶ä¸æ˜¯å†™åœ¨æ„é€ æ–¹æ³•é‡Œé¢çš„ï¼Œé‚£è¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ å®é™…ä¸Šï¼Œå¦‚æœæˆ‘ä»¬å¯¹å®ä¾‹å˜é‡ç›´æ¥èµ‹å€¼æˆ–è€…ä½¿ç”¨å®ä¾‹ä»£ç å—èµ‹å€¼ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šå°†å…¶ä¸­çš„ä»£ç æ”¾åˆ°ç±»çš„æ„é€ å‡½æ•°ä¸­å»ï¼Œå¹¶ä¸”è¿™äº›ä»£ç ä¼šè¢«æ”¾åœ¨å¯¹è¶…ç±»æ„é€ å‡½æ•°çš„è°ƒç”¨è¯­å¥ä¹‹å(è¿˜è®°å¾—å—ï¼ŸJavaè¦æ±‚æ„é€ å‡½æ•°çš„ç¬¬ä¸€æ¡è¯­å¥å¿…é¡»æ˜¯è¶…ç±»æ„é€ å‡½æ•°çš„è°ƒç”¨è¯­å¥)ï¼Œæ„é€ å‡½æ•°æœ¬èº«çš„ä»£ç ä¹‹å‰ã€‚ ä¸‹é¢è¿™æ®µä»£ç  12345678910111213141516171819202122public class Test2 &#123; private int i = 1; private int j = i + 1; public Test2(int var)&#123; System.out.println(i); System.out.println(j); this.i = var; System.out.println(i); System.out.println(j); &#125; &#123; // å®ä¾‹ä»£ç å— j += 3; &#125; public static void main(String[] args) &#123; new Test2(8); &#125;&#125; ç»è¿‡ç¼–è¯‘å™¨ä¼˜åŒ–åçš„æ„é€ å‡½æ•°å°±å˜æˆäº† 12345678910public Test2(int var)&#123; i = 1 ; j = i + 1 ; j += 3 ; System.out.println(i); System.out.println(j); this.i = var; System.out.println(i); System.out.println(j); &#125; æ‰€ä»¥è¾“å‡ºåº”è¯¥æ˜¯ 12341585 ä»&lt;clinit&gt;() &lt;init&gt;()çš„è§’åº¦å†æ¬¡è€ƒè™‘è€ƒè™‘ä¸¤ä¸ªæ¦‚å¿µï¼š ç±»åˆå§‹åŒ– æŒ‡çš„æ˜¯ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„æœ€åä¸€ä¸ªé˜¶æ®µã€‚ ç±»å®ä¾‹åŒ– æŒ‡çš„æ˜¯åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ã€‚ åœ¨Javaä¸­ï¼Œ åˆ›å»ºä¸€ä¸ªå¯¹è±¡å¸¸å¸¸éœ€è¦ç»å†å¦‚ä¸‹å‡ ä¸ªè¿‡ç¨‹ï¼šçˆ¶ç±»çš„ç±»æ„é€ å™¨() -&gt; å­ç±»çš„ç±»æ„é€ å™¨() -&gt; çˆ¶ç±»çš„æˆå‘˜å˜é‡å’Œå®ä¾‹ä»£ç å— -&gt; çˆ¶ç±»çš„æ„é€ å‡½æ•° -&gt; å­ç±»çš„æˆå‘˜å˜é‡å’Œå®ä¾‹ä»£ç å— -&gt; å­ç±»çš„æ„é€ å‡½æ•°ã€‚ &lt;clinit&gt;()æ˜¯ä»€ä¹ˆ clinitæ˜¯classç±»æ„é€ å™¨å¯¹é™æ€å˜é‡ï¼Œé™æ€ä»£ç å—è¿›è¡Œåˆå§‹åŒ–ã€‚ç”±æ‰€æœ‰é™æ€å­—æ®µçš„èµ‹å€¼æ“ä½œä»¥åŠé™æ€ä»£ç å—æŒ‰å‡ºç°é¡ºåºæ„æˆã€‚å‚è€ƒè¿™ç¯‡æ–‡ç«  &lt;init&gt;()æ˜¯ä»€ä¹ˆ initæ˜¯instanceå®ä¾‹æ„é€ å™¨ï¼Œå¯¹éé™æ€å˜é‡è§£æåˆå§‹åŒ– ã€‚ç”±æ‰€æœ‰å®ä¾‹å˜é‡çš„èµ‹å€¼ï¼Œæ‰€æœ‰å®ä¾‹ä»£ç å—ä»¥åŠæ„é€ å‡½æ•°é‡Œé¢çš„ä»£ç æ„æˆã€‚å…¶ä¸­å®ä¾‹å˜é‡çš„èµ‹å€¼ä»¥åŠå®ä¾‹ä»£ç å—æ˜¯æ”¾åœ¨æœ€å‰é¢æ‰§è¡Œçš„ã€‚ ä¸‹é¢ä»¥ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜&lt;clinit&gt;()å’Œ&lt;init&gt;() è€ƒè™‘ä¸‹é¢è¿™æ®µä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334public class StaticTest &#123; public static void main(String[] args) &#123; staticFunction(); &#125; static StaticTest st = new StaticTest(); static &#123; //é™æ€ä»£ç å— System.out.println(&quot;1&quot;); &#125; &#123; // å®ä¾‹ä»£ç å— System.out.println(&quot;2&quot;); &#125; StaticTest() &#123; // å®ä¾‹æ„é€ å™¨ System.out.println(&quot;3&quot;); System.out.println(&quot;a=&quot; + a + &quot;,b=&quot; + b); &#125; public static void staticFunction() &#123; // é™æ€æ–¹æ³• System.out.println(&quot;4&quot;); &#125; int a = 110; // å®ä¾‹å˜é‡ static int b = 112; // é™æ€å˜é‡&#125;/* Output: 2 3 a=110,b=0 1 4 *///:~ æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼ŒstaticFunction()æ˜¯ä¸ªé™æ€æ–¹æ³•ï¼Œå¯¹å®ƒçš„è°ƒç”¨å°±ç”¨åˆ°äº†invokestaticæŒ‡ä»¤ï¼Œæ‰€ä»¥ä¼šè¿›è¡Œç±»åŠ è½½ï¼Œæ¶‰åŠåˆ°åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–å‡ ä¸ªé˜¶æ®µï¼Œå…¶ä¸­åœ¨åˆå§‹åŒ–é˜¶æ®µä¼šè°ƒç”¨&lt;clinit&gt;()è¿›è¡Œç±»å˜é‡çš„åˆå§‹åŒ–ï¼Œè€Œ&lt;clinit&gt;()ç”±é™æ€å­—æ®µçš„èµ‹å€¼æ“ä½œä»¥åŠé™æ€ä»£ç å—æŒ‰ç…§å‡ºç°é¡ºåºç»„æˆï¼Œæ‰€ä»¥&lt;clinit&gt;()å†…å®¹å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š 12345static StaticTest st = new StaticTest();static &#123; //é™æ€ä»£ç å— System.out.println(&quot;1&quot;);&#125;static int b = 112; æ³¨æ„ï¼è¯·çœ‹æˆ‘çš„æ‰‹æ³•ï¼åœ¨è¿™é‡Œç¥å¥‡çš„äº‹æƒ…å‘ç”Ÿäº†ï¼Œæˆ‘ä»¬è¯´ä¸Šé¢è¿™æ®µä»£ç æ˜¯&lt;clinit&gt;()çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯ç±»åŠ è½½è¿‡ç¨‹ä¸­åˆå§‹åŒ–é˜¶æ®µçš„å†…å®¹ï¼Œä½†æ˜¯ï¼ä½ ä¼šå‘ç°åœ¨ç±»åˆå§‹åŒ–çš„æ—¶å€™å·²ç»æ··è¿›æ¥äº†ç±»å®ä¾‹åŒ–çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªç±»å¯èƒ½è¿˜æ²¡æœ‰åˆ›å»ºå¥½å‘¢ä½†æ˜¯å°±å·²ç»å¼€å§‹è¿›è¡Œå®ä¾‹åŒ–äº†ï¼Œå¹¶ä¸”å®ä¾‹åŒ–çš„ä»£ç è¿˜æ”¾åœ¨äº†&lt;clinit&gt;()ä»£ç çš„å¼€å¤´ï¼Œå¯ä»¥è¿™æ ·åšå—ï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯è¿™æ ·å°±ä¼šé€ æˆä¸€ä¸ªé—®é¢˜ï¼Œä½ åœ¨å®ä¾‹åŒ–ä»£ç æ—¶æ‰§è¡Œæ„é€ å‡½æ•°é‡Œé¢çš„å†…å®¹æ—¶ï¼Œé‡Œé¢çš„é™æ€å˜é‡å…¶å®éƒ½è¿˜æ²¡æœ‰è¢«æ¥å¾—åŠèµ‹å€¼ã€‚æˆ‘ä»¬å…ˆå°†ä¸Šè¿°ä»£ç è¿›ä¸€æ­¥ç»†åŒ–, å°†é™æ€å˜é‡stçš„èµ‹å€¼åˆ†è§£ä¸ºä¸¤ä¸ªæ“ä½œï¼šåˆ›å»ºå¯¹è±¡å’Œèµ‹å€¼ã€‚ 123456789int a = 110;System.out.println(&quot;2&quot;);// å®ä¾‹ä»£ç å—System.out.println(&quot;3&quot;);//å®ä¾‹æ„é€ å™¨System.out.println(&quot;a=&quot; + a + &quot;,b=&quot; + b);//å®ä¾‹æ„é€ å™¨ç»™é™æ€å˜é‡stèµ‹å€¼ System.out.println(&quot;1&quot;); //é™æ€ä»£ç å—static int b = 112; è¿™ä¸ªå°±æ˜¯å®Œæ•´çš„&lt;clinit&gt;()çš„å†…å®¹äº†ï¼Œå¯ä»¥çœ‹å‡ºï¼Œåœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œè¾“å‡ºï¼š 123423a=110,b=01 åˆå§‹åŒ–ç»“æŸï¼Œè°ƒç”¨staticFunction(),è¾“å‡º 14 æ‰€ä»¥ï¼Œæœ€åè¾“å‡ºä¸ºï¼š 1234523a=110,b=014 åœ¨ç¨‹åºæœ€åçš„ä¸€è¡Œï¼Œå¢åŠ ä»¥ä¸‹ä»£ç è¡Œï¼š 1static StaticTest st1 = new StaticTest(); é‚£ä¹ˆï¼Œæ­¤æ—¶ç¨‹åºçš„è¾“å‡ºåˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ åŠ å…¥è¿™è¡Œä»£ç åï¼Œ&lt;clinit&gt;()å†…å®¹å˜ä¸ºï¼š 123456789101112131415int a = 110;System.out.println(&quot;2&quot;);// å®ä¾‹ä»£ç å—System.out.println(&quot;3&quot;);//å®ä¾‹æ„é€ å™¨System.out.println(&quot;a=&quot; + a + &quot;,b=&quot; + b);//å®ä¾‹æ„é€ å™¨ç»™é™æ€å˜é‡stèµ‹å€¼ System.out.println(&quot;1&quot;); //é™æ€ä»£ç å—static int b = 112;int a = 110;System.out.println(&quot;2&quot;);// å®ä¾‹ä»£ç å—System.out.println(&quot;3&quot;);//å®ä¾‹æ„é€ å™¨System.out.println(&quot;a=&quot; + a + &quot;,b=&quot; + b);//å®ä¾‹æ„é€ å™¨ç»™é™æ€å˜é‡st1èµ‹å€¼ æ‰€ä»¥åˆå§‹åŒ–é˜¶æ®µè¾“å‡ºä¸ºï¼š 123456723a=110,b=0123a=110,b=112 åˆå§‹åŒ–ç»“æŸï¼Œè°ƒç”¨staticFunction(),è¾“å‡º 14 æ‰€ä»¥ï¼Œæœ€åè¾“å‡ºä¸ºï¼š 1234567823a=110,b=0123a=110,b=1124 æ€»ç»“å¥½ï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹: è¦newå‡ºä¸€ä¸ªå¯¹è±¡ï¼Œé¦–å…ˆæ˜¯éœ€è¦è¿™ä¸ªå¯¹è±¡çš„ç±»å‹ä¿¡æ¯çš„ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”çš„ç±»ï¼Œå¦‚æœå†…å­˜ä¸­è¿˜æ²¡æœ‰è¿™ä¸ªç±»å‹ä¿¡æ¯çš„è¯ï¼ŒJVMè¦å…ˆæ‰§è¡Œç±»åŠ è½½è¿‡ç¨‹ï¼Œå°†classæ–‡ä»¶åŠ è½½è¿›å†…å­˜ï¼Œå¹¶ä¸”ç»è¿‡å‡†å¤‡é˜¶æ®µã€è§£æé˜¶æ®µä»¥åŠåˆå§‹åŒ–é˜¶æ®µï¼Œæœ€åå˜æˆèƒ½è¢«JVMä½¿ç”¨çš„ç±»å‹ï¼ˆåŠ è½½è¿›æ¥çš„ä¸œè¥¿éƒ½æ”¾åœ¨æ–¹æ³•åŒºï¼Œä¹Ÿå°±æ˜¯è¯´æ–¹æ³•åŒºæ”¾çš„æ˜¯ç±»ä¿¡æ¯ï¼‰ã€‚å¦‚æˆ‘ä»¬å‰é¢æ‰€è¯´ï¼Œä¸‡äº‹ä¸‡ç‰©çš†å¯¹è±¡ï¼Œå…¶å®classæ–‡ä»¶åœ¨è¢«è½½å…¥å†…å­˜åˆå§‹åŒ–åä¹Ÿæ˜¯ä¸ªç±»ï¼Œå«åšClassç±»ï¼Œæ‰€ä»¥è¯å¥è¯è¯´ï¼Œè¦newä¸€ä¸ªå¯¹è±¡ï¼Œé¦–å…ˆè¦çœ‹å†…å­˜ä¸­æœ‰æ²¡æœ‰è¿™ä¸ªå¯¹è±¡å¯¹åº”çš„Classç±»ã€‚ç„¶åå°±æ˜¯åˆ†é…å†…å­˜ï¼ˆè¿™é‡Œè¦æ³¨æ„ç»§æ‰¿æƒ…å†µä¸‹å†…å­˜æ˜¯å¦‚ä½•åˆ†é…çš„ï¼‰ã€åˆå§‹åŒ–é›¶å€¼ä»¥åŠæ‰§è¡Œæ„é€ æ–¹æ³•ã€‚ å‚è€ƒæ·±å…¥ç†è§£Javaå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼šç±»çš„åˆå§‹åŒ–ä¸å®ä¾‹åŒ– JVMç±»ç”Ÿå‘½å‘¨æœŸæ¦‚è¿°ï¼šåŠ è½½æ—¶æœºä¸åŠ è½½è¿‡ç¨‹ ä¸‡ä¸‡æ²¡æƒ³åˆ°ï¼ŒJVMå†…å­˜ç»“æ„çš„é¢è¯•é¢˜å¯ä»¥é—®çš„è¿™ä¹ˆéš¾ï¼Ÿ","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"JVM","slug":"JVM","permalink":"http://example.com/tags/JVM/"}]},{"title":"ä¸€æ¬¡ç”±ç»§æ‰¿å¼•å‘çš„æ€è€ƒ","slug":"ä¸€æ¬¡ç”±ç»§æ‰¿å¼•å‘çš„æ€è€ƒ","date":"2019-10-10T02:20:30.000Z","updated":"2019-10-10T02:20:30.000Z","comments":true,"path":"2019/10/10/ä¸€æ¬¡ç”±ç»§æ‰¿å¼•å‘çš„æ€è€ƒ/","link":"","permalink":"http://example.com/2019/10/10/%E4%B8%80%E6%AC%A1%E7%94%B1%E7%BB%A7%E6%89%BF%E5%BC%95%E5%8F%91%E7%9A%84%E6%80%9D%E8%80%83/","excerpt":"","text":"æœ¬æ–‡ä¸»è¦è®¨è®ºï¼Œæˆ‘åœ¨è€ƒè™‘javaç§privateä¿®é¥°çš„å±æ€§å’Œæ–¹æ³•åˆ°åº•æœ‰æ²¡æœ‰è¢«ç»§æ‰¿ä¸‹æ¥çš„ä¸€ç³»åˆ—æ€è€ƒã€‚ ä½¿ç”¨åå°„ï¼Ÿè§‚å¯Ÿclassæ–‡ä»¶ï¼Ÿnewä¸€ä¸ªå¯¹è±¡æ—¶åˆ°åº•å‘ç”Ÿäº†å•¥ï¼Ÿåˆ›å»ºä¸€ä¸ªå¯¹è±¡å¸¸å¸¸éœ€è¦ç»å†å¦‚ä¸‹å‡ ä¸ªè¿‡ç¨‹ï¼šçˆ¶ç±»çš„ç±»æ„é€ å™¨() -&gt; å­ç±»çš„ç±»æ„é€ å™¨() -&gt; çˆ¶ç±»çš„æˆå‘˜å˜é‡å’Œå®ä¾‹ä»£ç å— -&gt; çˆ¶ç±»çš„æ„é€ å‡½æ•° -&gt; å­ç±»çš„æˆå‘˜å˜é‡å’Œå®ä¾‹ä»£ç å— -&gt; å­ç±»çš„æ„é€ å‡½æ•°ã€‚ å…ˆä¾æ¬¡æ‰§è¡Œå®ä¾‹å˜é‡åˆå§‹åŒ–å’Œå®ä¾‹ä»£ç å—åˆå§‹åŒ–ï¼Œå†æ‰§è¡Œæ„é€ å‡½æ•°åˆå§‹åŒ–ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¼–è¯‘å™¨ä¼šå°†å®ä¾‹å˜é‡åˆå§‹åŒ–å’Œå®ä¾‹ä»£ç å—åˆå§‹åŒ–ç›¸å…³ä»£ç æ”¾åˆ°ç±»çš„æ„é€ å‡½æ•°ä¸­å»ï¼Œå¹¶ä¸”è¿™äº›ä»£ç ä¼šè¢«æ”¾åœ¨å¯¹è¶…ç±»æ„é€ å‡½æ•°çš„è°ƒç”¨è¯­å¥ä¹‹åï¼Œæ„é€ å‡½æ•°æœ¬èº«çš„ä»£ç ä¹‹å‰ã€‚ ç±»çš„å®ä¾‹åŒ–æ˜¯æŒ‡åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹(å¯¹è±¡)çš„è¿‡ç¨‹ï¼› ç±»çš„åˆå§‹åŒ–æ˜¯æŒ‡ä¸ºç±»ä¸­å„ä¸ªç±»æˆå‘˜(è¢«staticä¿®é¥°çš„æˆå‘˜å˜é‡)èµ‹åˆå§‹å€¼çš„è¿‡ç¨‹ï¼Œæ˜¯ç±»ç”Ÿå‘½å‘¨æœŸä¸­çš„ä¸€ä¸ªé˜¶æ®µã€‚ å‚è€ƒæ·±å…¥ç†è§£Javaå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼šç±»çš„åˆå§‹åŒ–ä¸å®ä¾‹åŒ–","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"ç»§æ‰¿","slug":"ç»§æ‰¿","permalink":"http://example.com/tags/%E7%BB%A7%E6%89%BF/"}]},{"title":"HashMapä¸­çš„hashæ–¹æ³•","slug":"Mapä¸­çš„hashæ–¹æ³•","date":"2019-10-08T12:50:13.000Z","updated":"2019-10-08T12:50:13.000Z","comments":true,"path":"2019/10/08/Mapä¸­çš„hashæ–¹æ³•/","link":"","permalink":"http://example.com/2019/10/08/Map%E4%B8%AD%E7%9A%84hash%E6%96%B9%E6%B3%95/","excerpt":"","text":"åœ¨HashMap,HashTableå’ŒConcurrentHashMapä¸­ï¼Œhash()æ–¹æ³•ä¸»è¦æ˜¯æ‹¿æ¥åšå®šä½ï¼Œå³é€šè¿‡å¯¹keyè¿›è¡Œæ•£åˆ—ï¼Œä»è€Œç¡®å®šè¿™ä¸ªentryçš„å­˜å‚¨ä½ç½®ã€‚ä½†æ˜¯ä¸ºäº†é¿å…å‘ç”Ÿç¢°æ’ï¼Œjavaä¸­çš„hashæ–¹æ³•è¿˜æ˜¯æœ‰è®¸å¤šç»†èŠ‚æ“ä½œçš„ã€‚ HashMapjdk 7ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314final int hash(Object k) &#123; int h = hashSeed; if (0 != h &amp;&amp; k instanceof String) &#123; return sun.misc.Hashing.stringHash32((String) k); &#125; h ^= k.hashCode(); // This function ensures that hashCodes that differ only by // constant multiples at each bit position have a bounded // number of collisions (approximately 8 at default load factor). h ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12); return h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4); &#125; 1234static int indexFor(int h, int length) &#123; // assert Integer.bitCount(length) == 1 : &quot;length must be a non-zero power of 2&quot;; return h &amp; (length-1); &#125; ä¸Šè¿°ä»£ç ä¸­ï¼Œhash()æ–¹æ³•è´Ÿè´£ç”Ÿæˆå“ˆå¸Œç ï¼ŒindexFor()æ–¹æ³•è´Ÿè´£ç¡®å®šåœ°å€ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå“ˆå¸Œç çš„ç”Ÿæˆä¸»è¦é€šè¿‡éšæœºç§å­å’ŒhashCodeè¿›è¡Œå¼‚æˆ–ï¼Œåé¢çš„ä¸¤è¡Œä»£ç æ˜¯ä¸ºäº†è¿›è¡Œæ··æ·†ã€‚å› ä¸ºæœ€ç»ˆç´¢å¼•ï¼ˆå­˜å‚¨åœ°å€ï¼‰æ˜¯é€šè¿‡å“ˆå¸Œç å–æ¨¡æ•°ç»„é•¿åº¦å¾—åˆ°çš„ï¼Œè¿™æ„å‘³ç€åªæœ‰æœ‰é™æ¯”ç‰¹ä½ï¼ˆlength-1 ä¸ªæ¯”ç‰¹ä½ï¼‰ä¼šå½±å“åˆ°æœ€ç»ˆç»“æœï¼Œæ··æ·†çš„ä½œç”¨å°±æ˜¯ä¸ºäº†å°½åŠ›è®©å“ˆå¸Œç çš„æ¯ä¸ªä½ç½®åœ¨ç¡®å®šç´¢å¼•æ—¶éƒ½å‘æŒ¥ä½œç”¨ã€‚ è¯´åˆ°è¿™é‡Œï¼Œè¯·ç•™æ„ä¸‹hashCodeæ–¹æ³•ï¼Œè¿™æ˜¯Objectç±»çš„ä¸€ä¸ªnativeæ–¹æ³•ï¼Œè¿”å›çš„æ˜¯å¯¹è±¡çš„åœ°å€ï¼Œåœ¨HashMapä¸­è¢«é‡å†™äº† 1234public final int hashCode() &#123; return Objects.hashCode(getKey()) ^ Objects.hashCode(getValue());&#125; å½“ç„¶equalsæ–¹æ³•ä¹Ÿè¢«é‡å†™äº†ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚ jdk 81234static final int hash(Object key) &#123; int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16); &#125; ç›´æ¥æ‹¿hashCodeå’Œé«˜16ä½å¼‚æˆ–ã€‚ HashTablejdk 7ç›¸æ¯”äºHashMapï¼ŒHashTableæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œä¸”å®ƒçš„hashæ–¹æ³•ä¹Ÿæ˜¾å¾—å¾ˆæœ´å®æ— åï¼Œæ²¡æœ‰æ·»åŠ æ‰°åŠ¨ï¼Œ 1234private int hash(Object k) &#123; // hashSeed will be zero if alternative hashing is disabled. return hashSeed ^ k.hashCode(); &#125; å®ƒæ²¡æœ‰indexForæ–¹æ³•ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä¸€å¥ä»£ç  1int index = (hash &amp; 0x7FFFFFFF) % tab.length; ä¸ºä»€ä¹ˆæ²¡åŠ æ‰°åŠ¨å‘¢ï¼Œæˆ‘æ˜¯è¿™ä¹ˆè€ƒè™‘çš„ã€‚ ä»æ€§èƒ½è§’åº¦è€ƒè™‘ï¼ŒHashMapé‡‡ç”¨2çš„æ¬¡å¹‚ä½œä¸ºå®¹é‡æœ‰ä¸€éƒ¨åˆ†æ˜¯å‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œä½¿ç”¨2çš„æ¬¡å¹‚åï¼Œæ— è®ºæ˜¯æ‰©å®¹è¿˜æ˜¯indexFor,éƒ½å¯ä»¥é€šè¿‡ä½è¿ç®—åŠ å¿«è¿ç®—é€Ÿåº¦ã€‚ è€ŒHashTableé€šè¿‡synchronizedå…³é”®å­—æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå®ƒåœ¨æ€§èƒ½ä¸Šå·²ç»è½åHashMapäº†ï¼Œæ‰€ä»¥å¯¹2çš„æ¬¡å¹‚è¦æ±‚ä¸æ˜¯å¾ˆé«˜ã€‚å†è€…ï¼ŒHashTableåˆå§‹å®¹é‡ä¸º11ï¼ŒæŒ‰ç…§$2n+1$æ‰©å®¹ï¼Œå®¹é‡ä¸€ç›´æ˜¯ç´ æ•°ï¼Œè€Œè¿™ä¸ªç´ æ•°æ°å¥½èƒ½ä½¿å¾—åœ¨å–æ¨¡çš„è¿‡ç¨‹ä¸­è®©keyåˆ†æ•£å‡åŒ€ä¸€äº›ï¼Œæ‰€ä»¥ä¹Ÿå°±æ²¡æœ‰åŠ æ‰°åŠ¨ã€‚ jdk 812int hash = key.hashCode();int index = (hash &amp; 0x7FFFFFFF) % tab.length; åˆ†åˆ«å°†hashæ–¹æ³•å’ŒindexForæ–¹æ³•å˜æˆäº†ä¸¤å¥è¯ã€‚ï¼ˆå¯ä»¥çœ‹åˆ°1.8ä¸­HashMapå’ŒHashTableéƒ½æ‘’å¼ƒäº†hashSeed. ConcurrentHashMapjdk 7123456789101112131415161718private int hash(Object k) &#123; int h = hashSeed; if ((0 != h) &amp;&amp; (k instanceof String)) &#123; return sun.misc.Hashing.stringHash32((String) k); &#125; h ^= k.hashCode(); // Spread bits to regularize both segment and index locations, // using variant of single-word Wang/Jenkins hash. h += (h &lt;&lt; 15) ^ 0xffffcd7d; h ^= (h &gt;&gt;&gt; 10); h += (h &lt;&lt; 3); h ^= (h &gt;&gt;&gt; 6); h += (h &lt;&lt; 2) + (h &lt;&lt; 14); return h ^ (h &gt;&gt;&gt; 16); &#125; å’ŒHashMapä¸­åšæ³•å·®ä¸å¤šï¼Œåªä¸è¿‡åŠ çš„ä¸æ˜¯åŒä¸€ç§æ‰°åŠ¨ã€‚ jdk 81234static final int spread(int h) &#123; return (h ^ (h &gt;&gt;&gt; 16)) &amp; HASH_BITS;&#125; æ„ˆå‘ç®€æ´ï¼Œå‚è€ƒ1.8ä¸­çš„HashMap,å’Œé«˜16ä½å¼‚æˆ–ï¼Œç„¶åä¸äº†HASH_BITS,ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢å‡ºç°è´Ÿæ•°ã€‚ 1static final int HASH_BITS = 0x7fffffff; // usable bits of normal node hash å¯ä»¥çœ‹åˆ°ï¼Œ1.8ä¸­HashMapå’ŒConcurrentHashMapçš„hashè®¾è®¡éƒ½ç®€å•äº†è®¸å¤šï¼Œå…¶å®ä¸€å®šç¨‹åº¦ä¸Šä¹Ÿå’Œçº¢é»‘æ ‘çš„å¼•å…¥æœ‰å…³ç³»ï¼Œ1.8ç‰ˆæœ¬å¼•å…¥äº†çº¢é»‘æ ‘ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†å“ˆå¸Œå†²çªåçš„æ£€ç´¢è€—æ—¶ï¼Œæ‰€ä»¥åœ¨æ•£åˆ—çš„å°½å¯èƒ½å‡åŒ€ä¸Šä¸‹åŠŸå¤«ä¸å¤šã€‚ å‚è€ƒå…¨ç½‘æŠŠMapä¸­çš„hash()åˆ†æçš„æœ€é€å½»çš„æ–‡ç« ï¼Œåˆ«æ— äºŒå®¶","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"HashMap","slug":"HashMap","permalink":"http://example.com/tags/HashMap/"}]},{"title":"HashMapä¸­çš„å®¹é‡","slug":"HashMapä¸­çš„å®¹é‡","date":"2019-10-08T12:16:14.000Z","updated":"2019-10-08T12:16:14.000Z","comments":true,"path":"2019/10/08/HashMapä¸­çš„å®¹é‡/","link":"","permalink":"http://example.com/2019/10/08/HashMap%E4%B8%AD%E7%9A%84%E5%AE%B9%E9%87%8F/","excerpt":"","text":"ä¸ºä»€ä¹ˆå»ºè®®åˆå§‹åŒ–å®¹é‡çœŸæ­£çš„å®¹é‡æ˜¯å¤šå°‘ä¸ºä»€ä¹ˆæ˜¯2çš„æ¬¡å¹‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"HashMap","slug":"HashMap","permalink":"http://example.com/tags/HashMap/"}]},{"title":"Springçš„ä¸€ç‚¹æ€è€ƒ","slug":"Springçš„ä¸€ç‚¹æ€è€ƒ","date":"2019-10-02T11:55:38.000Z","updated":"2019-10-02T11:55:38.000Z","comments":true,"path":"2019/10/02/Springçš„ä¸€ç‚¹æ€è€ƒ/","link":"","permalink":"http://example.com/2019/10/02/Spring%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%9D%E8%80%83/","excerpt":"","text":"ä½•ä¸ºæ§åˆ¶åè½¬ä»¥å‰å¯¹äºæœ‰ä¾èµ–å…³ç³»çš„ç±»ï¼Œæ¯”å¦‚ç±»Aä¾èµ–ç±»Bï¼Œé‚£ä¹ˆä½¿ç”¨æ—¶ä¸€èˆ¬æ˜¯è¦åœ¨Aé‡Œé¢newä¸ªBï¼Œå¦‚æœä½¿ç”¨spring,åˆ™å°†æ§åˆ¶æƒäº¤ç»™IoCå®¹å™¨ï¼Œè®©IoCå®¹å™¨è´Ÿè´£beançš„åˆ›å»ºä»¥åŠä¾èµ–å…³ç³»çš„è°ƒè§£ï¼ˆå³ä¾èµ–æ³¨å…¥ï¼‰ã€‚ ä½•ä¸ºä¾èµ–æ³¨å…¥ä¸ºä¸€ä¸ªå¯¹è±¡è·å–å®ƒæ‰€ä¾èµ–çš„å¯¹è±¡çš„å¼•ç”¨ï¼ˆåœ¨æ­¤ä¹‹å‰ï¼Œè‚¯å®šè¦æŠŠè¿™ä¸ªbeanæ³¨å…¥åˆ°springå®¹å™¨ä¸­ï¼‰ã€‚ å¦‚ä½•ä¾èµ–æ³¨å…¥ é€šè¿‡setter é€šè¿‡æ„é€ æ–¹æ³• é€šè¿‡æ¥å£ ä½•ä¸ºé¢å‘åˆ‡é¢ç¼–ç¨‹","categories":[{"name":"JavaWeb","slug":"JavaWeb","permalink":"http://example.com/categories/JavaWeb/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"http://example.com/tags/Spring/"}]},{"title":"è®°ä¸€æ¬¡Http 415çš„ç»å†","slug":"è®°ä¸€æ¬¡Http-415çš„ç»å†","date":"2019-10-01T05:45:19.000Z","updated":"2019-10-01T05:45:19.000Z","comments":true,"path":"2019/10/01/è®°ä¸€æ¬¡Http-415çš„ç»å†/","link":"","permalink":"http://example.com/2019/10/01/%E8%AE%B0%E4%B8%80%E6%AC%A1Http-415%E7%9A%84%E7%BB%8F%E5%8E%86/","excerpt":"","text":"é—®é¢˜é‡ç°ï¼š ä½¿ç”¨spring mvcå®ç°ä¸€ä¸ªç®€å•çš„ç™»å½•åŠŸèƒ½ï¼Œå‰åç«¯åˆ†ç¦»ï¼Œä½¿ç”¨nginxåå‘ä»£ç†å®ç°è·¨åŸŸè¯·æ±‚ è¿™ä¸ªé—®é¢˜å›°æ‰°äº†æˆ‘ä¸€å¤©å¤šï¼Œä»æœ€å¼€å§‹æ£€æŸ¥nginxé…ç½®åˆ°æ£€æŸ¥è¡¨å•æäº¤å†åˆ°æŸ¥çœ‹httpè¯·æ±‚å¤´å†åˆ°æ£€æŸ¥åç«¯springç›¸å…³é…ç½®ä»¥åŠæ³¨è§£çš„é—®é¢˜ï¼Œæœ€åç»ˆäºæ‰¾åˆ°é—®é¢˜ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­é™¤äº†415å½“ç„¶è¿˜è¹¦å‡ºäº†å…¶ä»–å„ç§é”™è¯¯ï¼Œå¦‚400ï¼Œ405ï¼Œ500ï¼Œä¸è¿‡415é”™è¯¯ä¸€ç›´æ–­æ–­ç»­ç»­è´¯ç©¿å§‹ç»ˆã€‚ä¸‹é¢æ¥å¤ç›˜ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹ã€‚ ä»å®é™…ç”Ÿäº§è§’åº¦è€ƒè™‘ï¼Œæˆ‘éœ€è¦å®ç°ä¸€ä¸ªå‰åç«¯åˆ†ç¦»çš„ç³»ç»Ÿï¼Œç”±äºé™æ€èµ„æºå’Œåç«¯æœåŠ¡å¯èƒ½ä¸åœ¨åŒä¸€ä¸ªç«¯å£ï¼Œç”šè‡³ä¸åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ‰€ä»¥å¿…ç„¶å­˜åœ¨è·¨åŸŸçš„é—®é¢˜ï¼Œè·¨åŸŸæ˜¯ç”±äºæµè§ˆå™¨çš„åŒæºç­–ç•¥å¯¼è‡´çš„ï¼Œä¸ºäº†ä¿è¯å…¶å®‰å…¨æ€§ï¼Œè¿™é‡Œæš‚ä¸å»è®¨è®ºåŒæºç­–ç•¥æ˜¯ä»€ä¹ˆã€‚è§£å†³è·¨åŸŸçš„æ–¹æ³•å¾ˆå¤šï¼Œä½†å¤§å¤šæ•°éƒ½æ˜¯è¦ä¿®æ”¹å‰ç«¯ä»£ç æˆ–è€…åç«¯ä»£ç ï¼Œè¿™æ˜¯å¾ˆä¸ä¼˜é›…çš„ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©äº†ä½¿ç”¨nginxçš„åå‘ä»£ç†åŠŸèƒ½æ¥å®ç°è¿™ä¸€éœ€æ±‚ï¼Œå°†é™æ€èµ„æºæ”¾åœ¨nginxä¸Šã€‚ nginxæ’æŸ¥éƒ¨åˆ†nginxé…ç½®ï¼š 1234567891011listen 8800; server_name localhost; #charset koi8-r; #access_log logs/host.access.log main; location /api/ &#123; proxy_pass http://localhost:8080/; &#125; location / &#123; root E:\\SimpleMall-Admin-Web; index login.html; &#125; é™æ€èµ„æºurl: localhost:8800 åç«¯æœåŠ¡ï¼šlocalhost:8080 è¯·æ±‚url: /api/login åˆšå¼€å§‹ä¸€ç›´ä»¥ä¸ºæ˜¯nginxé…ç½®æœ‰é—®é¢˜ï¼Œå› ä¸ºæˆ‘çœ‹åˆ°è¯·æ±‚çš„urlä¸€ç›´éƒ½æ˜¯localhost:8800/api/loginï¼Œæˆ‘å½“æ—¶ä»¥ä¸ºå‘èµ·è¯·æ±‚ååº”è¯¥æ˜¯localhost:8080/loginï¼Œä»¥ä¸ºä¼šæœ‰ä¸ªè·³è½¬çš„åŠ¨ä½œï¼Œåæ¥æˆ‘å‘ç°æ˜¯è‡ªå·±å¯¹åå‘ä»£ç†ç†è§£æœ‰è¯¯ï¼Œè¿™ä¸ªä»£ç†è¿‡ç¨‹å¯¹ç”¨æˆ·é€æ˜ï¼Œæ‰€ä»¥æˆ‘ä»¬æ˜¯çœ‹ä¸åˆ°urlçš„å˜åŒ–çš„ã€‚ ajax è¡¨å•æäº¤ç„¶åæ£€æŸ¥ajaxæäº¤è¡¨å•è¿‡ç¨‹ ä¸ºä»€ä¹ˆä½¿ç”¨ajaxå‘¢ï¼Ÿå› ä¸ºè¿™æ˜¯ä¸ªå‰åç«¯åˆ†ç¦»çš„ç³»ç»Ÿï¼Œæ‰€ä»¥é¡µé¢åº”è¯¥è·³åˆ°å“ªé‡Œè¿™äº›äº‹åç«¯åº”è¯¥æ˜¯ä¸çŸ¥é“çš„ï¼Œå®ƒåªéœ€è¦æ ¹æ®è¯·æ±‚è¿”å›ä¸€äº›jsonå°±å¯ä»¥äº†ã€‚ ç„¶åå‘ç°ï¼Œè¡¨å•æäº¤è¿™æœ‰æˆ‘ä¸çŸ¥é“çš„ä¸œè¥¿ï¼š å…³äºæäº¤æŒ‰é’®çš„ä¸¤ç§å†™æ³•ï¼š å†™æ³•ä¸€ï¼š 1&lt;input id=&quot;commit&quot; type=&quot;submit&quot; onclick=&quot;login()&quot; /&gt; å†™æ³•äºŒï¼š 1&lt;input id=&quot;commit&quot; type=&quot;button&quot; onclick=&quot;login()&quot; /&gt; å½“ç„¶è¿˜å¯ä»¥å†™æˆbuttonæ ‡ç­¾çš„å½¢å¼ï¼Œä¸è¿‡æäº¤ä½œç”¨å’Œç¬¬ä¸€ç§å†™æ³•æ˜¯ä¸€æ ·çš„ã€‚ å¯¹äºè¿™ä¸¤ç§å†™æ³•ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰å†™è¿™ä¸ªonclickäº‹ä»¶ï¼Œ å¯¹äºå†™æ³•ä¸€ï¼šæˆ‘ä»¬ç‚¹å‡»è¿™ä¸ªæŒ‰é’®ä»–ä¼šè‡ªåŠ¨æäº¤æ•´ä¸ªform,å³ä½¿formé‡Œé¢actionä¹Ÿæ²¡å†™å®ƒä¹Ÿä¼šæäº¤ï¼Œæ–¹æ³•é»˜è®¤ä¸ºGET,ä¸”ä¼šåˆ·æ–°æ•´ä¸ªé¡µé¢ï¼Œé™¤éæŠŠformçš„onsubmitäº‹ä»¶è®¾ç½®æˆè¿”å›false. å¯¹äºå†™æ³•äºŒï¼šå¿…é¡»æˆ‘ä»¬è‡ªå·±å†™è¿™ä¸ªonclickäº‹ä»¶åå®ƒæ‰ä¼šæäº¤. ä½†æ˜¯å¦‚æœæˆ‘ä»¬éƒ½å†™äº†onclickäº‹ä»¶ï¼Œé‚£ä¹ˆä»–ä¿©åœ¨è¯·æ±‚ä¸Šæ˜¯æ²¡æœ‰åŒºåˆ«çš„ã€‚ å› ä¸ºæˆ‘ä»¬éƒ½è‡ªå·±å®ç°äº†onclickäº‹ä»¶ï¼Œæ‰€ä»¥ä¸‹é¢é€‰å…¶ä¸€ï¼Œä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ã€‚ æˆ‘ä»¬åœ¨jsé‡Œé¢ä½¿ç”¨ajaxæ¥å®ç°æäº¤çš„åŠ¨ä½œï¼š 12345678910111213141516171819202122function login()&#123; var usn = $(&quot;#userName&quot;).val(); var pwd = $(&quot;#passWord&quot;).val(); var datas = &#123;&quot;userName&quot;:usn,&quot;passWord&quot;:pwd&#125; $.ajax(&#123; //å‡ ä¸ªå‚æ•°éœ€è¦æ³¨æ„ä¸€ä¸‹ type: &quot;POST&quot;,//æ–¹æ³•ç±»å‹ dataType: &quot;text&quot;,//é¢„æœŸæœåŠ¡å™¨è¿”å›çš„æ•°æ®ç±»å‹ url: &quot;/api/login&quot; ,//url data: datas, success: function (result) &#123; alert(result) console.log(result);//æ‰“å°æœåŠ¡ç«¯è¿”å›çš„æ•°æ®(è°ƒè¯•ç”¨) if (result.resultCode == 200) &#123; alert(&quot;SUCCESS&quot;); &#125; &#125;, error : function() &#123; alert(&quot;å¼‚å¸¸ï¼&quot;); &#125; &#125;); &#125; åŒæ—¶åœ¨åç«¯ä½¿ç”¨@RequestBodyæ³¨è§£æ¥è§£æã€‚ 12345678910@Controllerpublic class AdminController &#123; @RequestMapping(value = &quot;/login&quot;,method = RequestMethod.POST,consumes = &quot;application/json&quot;) public @ResponseBody String login(@RequestBody Administrator administrator)&#123; String userName = administrator.getUserName(); String passWord = administrator.getPassWord(); System.out.println(userName+&quot;================&quot;+passWord); return &quot;dddddd&quot; ; &#125;&#125; data ä¸ºjså¯¹è±¡ï¼Œæ— ContentType 1234567891011121314151617$.ajax(&#123; //å‡ ä¸ªå‚æ•°éœ€è¦æ³¨æ„ä¸€ä¸‹ type: &quot;POST&quot;,//æ–¹æ³•ç±»å‹ dataType: &quot;text&quot;,//é¢„æœŸæœåŠ¡å™¨è¿”å›çš„æ•°æ®ç±»å‹ url: &quot;/api/login&quot; ,//url data: datas, success: function (result) &#123; alert(result) console.log(result);//æ‰“å°æœåŠ¡ç«¯è¿”å›çš„æ•°æ®(è°ƒè¯•ç”¨) if (result.resultCode == 200) &#123; alert(&quot;SUCCESS&quot;); &#125; &#125;, error : function() &#123; alert(&quot;å¼‚å¸¸ï¼&quot;); &#125; &#125;); æŠ¥é”™415ï¼Œè¯·æ±‚å¤´å¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°ï¼Œè¯·æ±‚å¤´çš„Content-Typeæ˜¯é»˜è®¤çš„application/x-www-form-urlencodedå½¢å¼ï¼Œè€ŒRequestBodyæ³¨è§£æ˜¯æŒ‰ç…§Content-Typeæ¥å¯»æ‰¾å¯¹åº”çš„è½¬æ¢å™¨è¿›è¡Œè§£æçš„ï¼Œå¹¶ä¸”å®ƒæ— æ³•è§£æè¿™ç§å½¢å¼ï¼ˆè‡³äºä¸ºä»€ä¹ˆä¸èƒ½æˆ‘ä»¬åé¢å†åˆ†æï¼‰ã€‚ æ‰€ä»¥æˆ‘ä»¬ä¿®æ”¹ContentType dataä¸ºjså¯¹è±¡ï¼ŒContentTypeä¸ºjson 123456789101112131415161718$.ajax(&#123; //å‡ ä¸ªå‚æ•°éœ€è¦æ³¨æ„ä¸€ä¸‹ type: &quot;POST&quot;,//æ–¹æ³•ç±»å‹ dataType: &quot;text&quot;,//é¢„æœŸæœåŠ¡å™¨è¿”å›çš„æ•°æ®ç±»å‹ url: &quot;/api/login&quot; ,//url data: datas, contentType: &#x27;application/json;charset=utf-8&#x27;, success: function (result) &#123; alert(result) console.log(result);//æ‰“å°æœåŠ¡ç«¯è¿”å›çš„æ•°æ®(è°ƒè¯•ç”¨) if (result.resultCode == 200) &#123; alert(&quot;SUCCESS&quot;); &#125; &#125;, error : function() &#123; alert(&quot;å¼‚å¸¸ï¼&quot;); &#125; &#125;); æŠ¥é”™400ï¼Œè¯·æ±‚å¤´ å› ç¼ºæ€å…ï¼ŒContent-Typeå˜æˆäº†json,è€Œè¯·æ±‚ä½“å˜æˆäº†æ‹¼æ¥å½¢å¼ï¼Œåˆå‘ç°æŠ¥çš„æ˜¯400é”™è¯¯ï¼Œè¯´æ˜æˆ‘ä»¬è¯·æ±‚æ— æ•ˆï¼Œè¿™ä¸ªæ— æ•ˆé€šå¸¸æœ‰ä¸¤ç§åŸå› ï¼š å‰ç«¯æäº¤æ•°æ®çš„å­—æ®µåç§°æˆ–è€…æ˜¯å­—æ®µç±»å‹å’Œåå°çš„å®ä½“ç±»ä¸ä¸€è‡´ï¼Œå¯¼è‡´æ— æ³•å°è£…ï¼› å‰ç«¯æäº¤çš„åˆ°åå°çš„æ•°æ®åº”è¯¥æ˜¯jsonå­—ç¬¦ä¸²ç±»å‹ï¼Œè€Œå‰ç«¯æ²¡æœ‰å°†å¯¹è±¡è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼› å¾ˆæ˜æ˜¾ï¼Œåç«¯æ˜¯æŒ‰ç…§ContentTypeæ¥è§£æçš„ï¼Œä¸”RequenstBodyæ˜¯å¯ä»¥è§£æjsonç±»å‹çš„ï¼Œé‚£ä¹ˆé—®é¢˜å°±åªèƒ½æ˜¯å‡ºç°åœ¨äº†ç¬¬äºŒç§ã€‚å¯ä»¥å‘ç°ï¼Œå‰ä¸€æ¬¡å’Œè¿™ä¸€æ¬¡æˆ‘ä»¬ä¼ ç»™dataçš„éƒ½æ˜¯ä¸€ä¸ªjacascriptå¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªjsonå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†jså¯¹è±¡è½¬æˆjsonå­—ç¬¦ä¸²å†è¯•è¯•ã€‚ data ä¸ºjsonå­—ç¬¦ä¸²ï¼ŒContentTypeä¸ºjson 123456789101112131415161718$.ajax(&#123; //å‡ ä¸ªå‚æ•°éœ€è¦æ³¨æ„ä¸€ä¸‹ type: &quot;POST&quot;,//æ–¹æ³•ç±»å‹ dataType: &quot;text&quot;,//é¢„æœŸæœåŠ¡å™¨è¿”å›çš„æ•°æ®ç±»å‹ contentType: &#x27;application/json;charset=utf-8&#x27;, url: &quot;/api/login&quot; ,//url data: JSON.stringify(datas), success: function (result) &#123; alert(result) console.log(result);//æ‰“å°æœåŠ¡ç«¯è¿”å›çš„æ•°æ®(è°ƒè¯•ç”¨) if (result.resultCode == 200) &#123; alert(&quot;SUCCESS&quot;); &#125; &#125;, error : function() &#123; alert(&quot;å¼‚å¸¸ï¼&quot;); &#125; &#125;); è¿”å›200ï¼Œè®¿é—®æˆåŠŸ æ³¨æ„ï¼šæ­¤æ—¶è¿˜æ˜¯è¦å†™Content Typeçš„ï¼Œä¸ç„¶å°±ä¼š415. å¯¹äºè¡¨å•æäº¤æ¥è¯´ï¼Œå½“ç„¶ä¹Ÿä¸æ˜¯éç”¨jsonä¼ å€¼ä¸å¯ï¼Œåªæ˜¯æˆ‘è§‰å¾—å®ƒæ¯”è¾ƒæ–¹ä¾¿ï¼Œåœ¨è¿™é‡Œä¹Ÿæ˜¯å¯ä»¥ç›´æ¥å°†è¡¨å•æ•°æ®åºåˆ—åŒ–ç„¶åä¼ ç»™åç«¯çš„ã€‚ æˆ‘ä»¬å°†å‰ç«¯æ”¹æˆè¿™æ ·ï¼š 1234567891011121314151617$.ajax(&#123; //å‡ ä¸ªå‚æ•°éœ€è¦æ³¨æ„ä¸€ä¸‹ type: &quot;POST&quot;,//æ–¹æ³•ç±»å‹ dataType: &quot;text&quot;,//é¢„æœŸæœåŠ¡å™¨è¿”å›çš„æ•°æ®ç±»å‹ url: &quot;/api/login&quot; ,//url data: $(&quot;form&quot;).serialize(), success: function (result) &#123; alert(result) console.log(result);//æ‰“å°æœåŠ¡ç«¯è¿”å›çš„æ•°æ®(è°ƒè¯•ç”¨) if (result.resultCode == 200) &#123; alert(&quot;SUCCESS&quot;); &#125; &#125;, error : function() &#123; alert(&quot;å¼‚å¸¸ï¼&quot;); &#125; &#125;); åç«¯æ”¹æˆè¿™æ ·ï¼š 123456public @ResponseBody String login(String userName,String passWord)&#123; System.out.println(userName+&quot;================&quot;+passWord); Administrator adm = new Administrator(); return &quot;ddddddddddddddd&quot; ; &#125; ç„¶åå°±å¯ä»¥å¿«ä¹çš„æ¥æ”¶æ•°æ®å•¦ å¯ä»¥çœ‹å‡ºï¼Œå› ä¸ºæ•°æ®æ ¼å¼æ˜¯é»˜è®¤çš„è¿™ç§æ¨¡å¼ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨RequestBodyè§£æï¼Œåªèƒ½è¿™æ ·æŒ¨ä¸ªæ¥æ”¶ï¼Œå¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºå•¥æˆ‘æƒ³ç”¨jsonçš„åŸå› ã€‚ ä¸‹é¢æ¥åˆ†æä¸€ä¸‹@RequestBodyåˆ°åº•å¹²äº†å•¥ RequestBodyè®²åˆ°è¿™é‡Œï¼Œå¤§æ¦‚èƒ½é‡åˆ°çš„é—®é¢˜å·®ä¸å¤šéƒ½è®²é“ç†ï¼Œç„¶è€Œå›°æ‰°æˆ‘æœ€ä¹…çš„ï¼Œä»¥ä¸Šéƒ½ä¸æ˜¯ï¼Œè€Œæ˜¯ï¼š ç¼–è¯‘æ–‡ä»¶æ²¡æœ‰å³ä½¿æ›´æ–°ï¼æˆ‘å½“æ—¶å†…å¿ƒçœŸæ˜¯ã€‚ã€‚ã€‚","categories":[{"name":"åç«¯","slug":"åç«¯","permalink":"http://example.com/categories/%E5%90%8E%E7%AB%AF/"}],"tags":[{"name":"RequestBody","slug":"RequestBody","permalink":"http://example.com/tags/RequestBody/"}]},{"title":"Javaä¸­çš„fail fast","slug":"Javaä¸­çš„fail-fast","date":"2019-09-29T11:32:50.000Z","updated":"2019-09-29T11:32:50.000Z","comments":true,"path":"2019/09/29/Javaä¸­çš„fail-fast/","link":"","permalink":"http://example.com/2019/09/29/Java%E4%B8%AD%E7%9A%84fail-fast/","excerpt":"","text":"ä¸çŸ¥é“åˆ°å¤§å®¶åœ¨æ“ä½œJavaé›†åˆç±»çš„æ—¶å€™æœ‰æ²¡æœ‰é‡åˆ°è¿‡ConcurrentModificationExceptionå¼‚å¸¸ï¼Œåæ­£æˆ‘æ˜¯é‡åˆ°è¿‡ï¼Œä»Šå¤©å°±æ¥èŠä¸€ä¸‹è¿™ä¸ªå¼‚å¸¸çš„ç¼˜èµ·ç¼˜ç­ã€‚ fail fastä¸Šè¿°å¼‚å¸¸éƒ½æ˜¯ç”±è¿™ä¸ªå«åšfail fastçš„æœºåˆ¶å¯¼è‡´çš„ï¼Œfail fastæ˜¯Javaé›†åˆç±»çš„ä¸€ç§å¼‚å¸¸æ£€æµ‹æœºåˆ¶ï¼Œå½“å¤šä¸ªçº¿ç¨‹å¹¶å‘ä¿®æ”¹ä¸€ä¸ªé›†åˆç±»çš„ç»“æ„æ—¶ï¼Œå°±æœ‰å¯èƒ½è§¦å‘ä¸Šè¿°å¼‚å¸¸ã€‚æˆ‘ä»¬ä»¥ArrayListä¸ºä¾‹æ¥æ¢ç©¶ä¸€ä¸‹ã€‚ ArrayListä¸­æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡å«åšmodCountï¼Œjdk8æ–‡æ¡£é‡Œé¢æ˜¯è¿™ä¹ˆä»‹ç»å®ƒçš„ï¼š The number of times this list has been structurally modified. Structural modifications are those that change the size of the list, or otherwise perturb it in such a fashion that iterations in progress may yield incorrect results. This field is used by the iterator and list iterator implementation returned by the iterator and listIterator methods. If the value of this field changes unexpectedly, the iterator (or list iterator) will throw a ConcurrentModificationException in response to the next, remove, previous, set or add operations. This provides fail-fast behavior, rather than non-deterministic behavior in the face of concurrent modification during iteration. å¤§æ¦‚æ„æ€å°±æ˜¯è¯´ï¼šå®ƒæ˜¯ç”¨æ¥è®°å½•è¿™ä¸ªlistè¢«ç»“æ„æ€§ä¿®æ”¹çš„æ¬¡æ•°ï¼Œæ‰€è°“ç»“æ„æ€§ä¿®æ”¹æŒ‡çš„æ˜¯é‚£äº›è®©å®ƒçš„å¤§å°å‘ç”Ÿæ”¹å˜çš„æ“ä½œã€‚å¹¶ä¸”ï¼Œè¿™ä¸ªå­—æ®µæ˜¯è¢«iteratorä½¿ç”¨çš„ã€‚ iteratoræˆ‘ä»¬å†æ¥çœ‹ä¸‹iterator. æˆ‘ä»¬åœ¨é›†åˆç±»ä¸­ä¸€èˆ¬æ˜¯è¿™æ ·ä½¿ç”¨é›†åˆç±»çš„ï¼š å¯ä»¥å‘ç°ï¼Œå®ƒè¿™é‡Œæœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯iterator,è¿˜æœ‰ä¸€ç§æ˜¯listIteratorï¼Œæœ‰iteratoræ–¹æ³•å¾ˆå¥½ç†è§£ï¼Œæ˜¯å› ä¸ºArrayListå®ç°äº†Iterableæ¥å£ï¼Œè€Œiteratoræ–¹æ³•å°±æ˜¯è¿™ä¸ªæ¥å£é‡Œçš„æ–¹æ³• Iterableæ¥å£ è¿™ä¸‰ä¸ªæ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªlistIterator()æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªListItrå¯¹è±¡ï¼Œiteratoræ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªItrå¯¹è±¡ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸¤ä¸ªå¯¹è±¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼š Itrå¯¹è±¡ ListItrå¯¹è±¡ çœ‹æ¥è¿™ä¸¤ä¸ªå†…éƒ¨ç±»åœ¨AbstractListä¸­å°±æœ‰äº†ï¼Œåªä¸è¿‡åœ¨è¿™é‡Œè¿›è¡Œäº†ä¼˜åŒ–ã€‚ä¸‹é¢è¿™å¼ ç±»å›¾å°±å¾ˆèƒ½è¯´è¯´æ˜é—®é¢˜äº†ï¼š å¯ä»¥çœ‹å‡ºï¼ŒListItrå°±ç›¸å½“äºæ˜¯ä¸“é—¨ç»™liståšçš„ä¸€ä¸ªiterator,æä¾›äº†ä¸€äº›ä¸‹æ ‡è®¿é—®çš„æ–¹æ³•ï¼Œä½†æ˜¯å¹³æ—¶ç”¨çš„è¿˜æ˜¯æ¯”è¾ƒå°‘ã€‚ å¥½ï¼Œçœ‹å®Œäº†iterator,æˆ‘ä»¬æ¥æ­£å¼çœ‹ä¸‹ConcurrentModificationExceptionæ˜¯æ€ä¹ˆè‚¥å›› ConcurrentModificationExceptionfail fastå‡ºç°åœ¨å“ªé‡Œçš„ï¼Œæ ¹æ®ä¸Šè¿°é—®çš„æè¿°ï¼Œå‡ºç°åœ¨å‘ç”Ÿç»“æ„æ€§ä¿®æ”¹çš„åœ°æ–¹ï¼Œå¥½ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹add(),remove()çš„ä»£ç ï¼š å¯ä»¥çœ‹åˆ°ï¼Œå‘ç”Ÿç»“æ„æ€§ä¿®æ”¹çš„åœ°æ–¹ï¼Œéƒ½ä¼šæœ‰modount++çš„æ“ä½œã€‚å¯æ˜¯è¿™é‡Œä¹Ÿæ²¡æœ‰çœ‹åˆ°æŠ›å‡ºå¼‚å¸¸çš„ä»£ç å‘€ã€‚åˆ«æ€¥ï¼Œå…¶å®éƒ½è—åœ¨Iteratoré‡Œé¢ï¼Œè¿™é‡Œä»¥å†…éƒ¨ç±»Iträ¸ºä¾‹ï¼š è¯·æ³¨æ„å›¾ä¸­æˆ‘åœˆå‡ºæ¥çš„åœ°æ–¹ï¼Œè¿™ä¸ªå†…éƒ¨ç±»æœ‰ä¸ªå­—æ®µå«åšexpectedModCountï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æœŸæœ›è¢«ä¿®æ”¹çš„æ¬¡æ•°ï¼Œå®ƒè¢«èµ‹å€¼æˆmodCountï¼Œç„¶åï¼Œå¯¹äºè¿™ä¸ªå†…éƒ¨ç±»é‡Œé¢çš„æ¯ä¸€ä¸ªæ–¹æ³•ï¼Œéƒ½åŒ…å«äº†ä¸€ä¸ªå«åšcheckForComodification()çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åšäº†ä»€ä¹ˆå‘¢ï¼Ÿ å¯ä»¥çœ‹åˆ°ï¼Œå®ƒåšçš„äº‹æƒ…å°±æ˜¯æ¯”è¾ƒmodCountå’ŒexpectModCountæ˜¯å¦ç›¸ç­‰ï¼Œä¸ç­‰çš„è¯å°±æŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ã€‚åœ¨Itrç±»é‡Œé¢ï¼Œåªæœ‰ä¸€ä¸ªåœ°æ–¹ä¿®æ”¹äº†expectedModCountç±»ï¼š é‚£ä¹ˆä»€ä¹ˆæ—¶å€™ä»–ä¿©æ‰ä¼šä¸ç­‰å‘¢ï¼Ÿ è¿™ä¸ªå†…éƒ¨ç±»é‡Œé¢å¯¹expectedModCountåˆå§‹åŒ–çš„å€¼å°±æ˜¯modCountçš„å€¼ï¼Œå¦‚æœè¯´è¦ä¸ç­‰ï¼Œé‚£ä¹ˆå¯èƒ½æœ‰è¿™ä¹ˆä¸¤ç§æƒ…å†µï¼š ä¿®æ”¹äº†expectedModCountï¼Œæ²¡æœ‰ä¿®æ”¹modCount ä¿®æ”¹äº†modCouontï¼Œæ²¡æœ‰ä¿®æ”¹expectedModCount å…¶å®çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„ç–‘æƒ‘å¤§æ¦‚ä¹Ÿå°±è§£å¼€äº†ï¼Œåœ¨Itrç±»é‡Œé¢ï¼Œå¯¹expectedModCountçš„ä¿®æ”¹åªæœ‰ä¸Šé¢é‚£ä¸€å¤„ï¼Œè€Œä¸”è¿˜æ˜¯å°†modCountèµ‹å€¼ç»™ä»–ï¼Œè¿™æ„å‘³ç€ï¼Œè¦å‘ç”Ÿè¿™ä¸ªå¼‚å¸¸ï¼Œåªèƒ½æ˜¯æˆ‘ä»¬åœ¨åˆ«å¤„ï¼ˆIteratorä»¥å¤–çš„åœ°æ–¹ï¼‰å¯¹listè¿›è¡Œäº†ç»“æ„æ€§ä¿®æ”¹ï¼Œè¿™æ—¶å€™åªæ”¹äº†modCountï¼Œç„¶ååˆä½¿ç”¨Itrè¿›è¡Œéå†æ“ä½œï¼Œè¿™æ—¶å€™è¿™ä¸¤ä¸ªå€¼å°±ä¸ç›¸ç­‰äº†ï¼Œè¿™é‡Œæ¨èé˜…è¯»Hå¤§çš„è¿™ç¯‡æ–‡ç« ï¼Œè®²çš„å¾ˆæ¸…æ¥šï¼šä¸ºä»€ä¹ˆé˜¿é‡Œå·´å·´ç¦æ­¢åœ¨ foreach å¾ªç¯é‡Œè¿›è¡Œå…ƒç´ çš„ remove/add æ“ä½œ å½“ç„¶äº†ï¼Œä¸Šè¿°åªæ˜¯å‘ç”Ÿè¿™ä¸ªå¼‚å¸¸çš„ä¸€ç§åŸå› å•¦ï¼Œå…¶å®æŸ¥çœ‹æºä»£ç ä½ ä¼šå‘ç°å…¶ä»–åœ°æ–¹ä¹Ÿæœ‰è¿™ä¸ªå¼‚å¸¸ï¼Œæ¯”å¦‚ä½ ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œéå†æˆ–è€…ä¿®æ”¹çš„æ—¶å€™ï¼Œå› ä¸ºæ•°ç»„è¶Šç•Œä¹Ÿæœ‰å¯èƒ½è§¦å‘è¿™ä¸ªå¼‚å¸¸ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"fail fast","slug":"fail-fast","permalink":"http://example.com/tags/fail-fast/"}]},{"title":"Nginxæ•™ç¨‹","slug":"Nginxæ•™ç¨‹","date":"2019-09-27T12:10:02.000Z","updated":"2019-09-27T12:10:02.000Z","comments":true,"path":"2019/09/27/Nginxæ•™ç¨‹/","link":"","permalink":"http://example.com/2019/09/27/Nginx%E6%95%99%E7%A8%8B/","excerpt":"","text":"å‰æéœ€è¦ï¼š ç¼–è¯‘å™¨åŠç›¸å…³å·¥å…·ï¼šgccç¼–è¯‘å™¨ï¼Œmakeå·¥å…· ç”±äºå‘½ä»¤apt-get install gcc gcc-c++æŠ¥é”™Couldn&#39;t find any package by regex &#39;gcc-c+, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥è£…apt-get -y install build-essential æ¨¡å—ä¾èµ–æ€§ï¼š pcreåº“ï¼ˆæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„åº“ï¼‰ï¼Œzlibåº“ï¼ˆå‹ç¼©ç”¨çš„ï¼‰ï¼Œopensslåº“ï¼ˆå®‰å…¨å¥—æ¥å­—åº“ï¼‰ è¿™äº›éƒ½å®‰è£…åœ¨/usr/lcal/srcä¸­ è¿™é‡Œæˆ‘ä½¿ç”¨wgetå‘½ä»¤å®‰è£…ã€‚ä»¥pcreä¸ºä¾‹ï¼š 123456wget ftp://ftp.pcre.org/pub/pcre/pcre2-10.33.tar.gztar -zxvf pcre2-10.33.tar.gzcd pcre2-10.33./Configuremakemake install åŒæ ·çš„æ–¹æ³•å®‰è£… zlib,openssl å®‰è£…nginx: 12345wget http://nginx.org/download/nginx-1.16.1.tar.gztar -xzf nginx-1.16.1.tar.gz./configure --with-pcre=../pcre2-10.33makemake install å› ä¸ºè¿™é‡Œçš„å®‰è£…éœ€è¦ä¸Šé¢çš„ä¸€äº›ä¾èµ–åº“ï¼Œæˆ‘è¿™é‡ŒåªåŠ ä¸Špcreå°±å¯ä»¥äº†ï¼Œå…·ä½“æƒ…å†µå¯èƒ½å’Œç‰ˆæœ¬æœ‰å…³ç³»ï¼Œéœ€è¦æ³¨æ„ã€‚ 12345apt install nginx-coreapt install nginx-extrasapt install nginx-fullapt install nginx-light è£…å¥½çš„ç›®å½•é•¿è¿™æ ·ï¼š 1234CHANGES LICENSE README conf contrib man srcCHANGES.ru Makefile auto configure html objs é”™è¯¯é›†é”¦ï¼š 1src/core/ngx_regex.h:15:10: fatal error: pcre.h: No such file or directory pcre2æ¢æˆpcre","categories":[{"name":"æ•™ç¨‹","slug":"æ•™ç¨‹","permalink":"http://example.com/categories/%E6%95%99%E7%A8%8B/"}],"tags":[{"name":"Nginx","slug":"Nginx","permalink":"http://example.com/tags/Nginx/"}]},{"title":"Javaä¸­çš„ç±»åŠ è½½","slug":"Javaä¸­çš„ç±»åŠ è½½","date":"2019-09-24T11:10:35.000Z","updated":"2019-09-24T11:10:35.000Z","comments":true,"path":"2019/09/24/Javaä¸­çš„ç±»åŠ è½½/","link":"","permalink":"http://example.com/2019/09/24/Java%E4%B8%AD%E7%9A%84%E7%B1%BB%E5%8A%A0%E8%BD%BD/","excerpt":"","text":"æœ¬æ–‡ä¸»è¦è®¨è®ºä¸¤ä¸ªé—®é¢˜ï¼šä½•æ—¶ç±»åŠ è½½ï¼Ÿå¦‚ä½•ç±»åŠ è½½ï¼Ÿ ä½•ä¸ºç±»åŠ è½½ç±»åŠ è½½æ—¶æœºç±»åŠ è½½çš„è¿‡ç¨‹åºï¼šjavaæ–‡ä»¶è¢«ç¼–è¯‘æˆ.classæ–‡ä»¶æ”¾åœ¨ç£ç›˜ä¸­ åŠ è½½é˜¶æ®µï¼š æ ¹æ®ç±»çš„å…¨é™å®šåå°†å­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ï¼ŒåŠ è½½åˆ°å†…å­˜å“ªé‡Œå‘¢ï¼Ÿæ–¹æ³•åŒºï¼ å¯ä»¥è®¤ä¸ºï¼Œ.classæ–‡ä»¶æ˜¯ç±»çš„é™æ€ç»“æ„ï¼Œè€ŒåŠ è½½é˜¶æ®µå°±æ˜¯æŠŠè¿™ç§é™æ€ç»“æ„ç¼–ç¨‹åŠ¨æ€çš„è¿è¡Œæ—¶ç»“æ„ æ ¹æ®è¿™ä¸ªå­—èŠ‚ç ç”Ÿæˆä¸€ä¸ªjava.lang.Classå¯¹è±¡ æˆ‘ä»¬è®²è¿‡ï¼Œä¸‡ç‰©çš†å¯ä¸ºå¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å£å£å£°å£°æ‰€è®²çš„ç±»ä¹Ÿæ˜¯å¯¹è±¡ è¿™ä¸€é˜¶æ®µæœ‰è®¸å¤šç±»åŠ è½½å™¨çš„ä½œç”¨ï¼š å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰: åŠ è½½&lt;JAVA_HOME&gt;\\libä¸­çš„ç±»åº“åˆ°è™šæ‹Ÿæœº æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰:è´Ÿè´£åŠ è½½&lt;JAVA_HOME&gt;\\lib\\extä¸­çš„ç±»åº“ åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰ï¼šè´Ÿè´£åŠ è½½ç”¨æˆ·ç±»åº“ä¸Šæ‰€æŒ‡å®šçš„ç±»åº“ã€‚ åˆ¤æ–­ä¸¤ä¸ªç±»ç›¸ç­‰ï¼Œä¸ä»…è¦å®ƒä»¬çš„å…¨é™å®šåç›¸åŒï¼Œè€Œä¸”è¦åŠ è½½å®ƒä»¬çš„ç±»åŠ è½½å™¨ä¹Ÿç›¸åŒï¼Œ åŒäº²å§”æ´¾æ¨¡å‹ï¼š â€‹ è¿™æ˜¯ä¸€ç§å±‚æ¬¡ç»“æ„ï¼Œæˆ–è€…è¯´æ˜¯æ ‘çŠ¶ç»“æ„ï¼Œå…¶ç›®çš„ï¼Œæ˜¯è®©è¶ŠåŸºç¡€çš„ç±»è¢«è¶ŠåŸºç¡€çš„ç±»åŠ å™¨åŠ è½½ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¯¹äºjava.lang.Objectç±»ï¼Œå®ƒå­˜åœ¨äºrt.jarä¸­ï¼Œå®ƒæ˜¯ä¸‡ç±»ä¹‹ç¥–ï¼Œæ‰€ä»¥æ— è®ºå‡ºç°åœ¨ç¨‹åºä¸­çš„å“ªé‡Œï¼Œå®ƒåº”è¯¥éƒ½æ˜¯åŒä¸€ä¸ªObjectç±»ï¼Œä½¿ç”¨åŒäº²å¤–æ´¾æ¨¡å‹å°±å¯ä»¥å¾ˆå¥½çš„å®ç°è¿™ä¸ªæ•ˆæœï¼šæ— è®ºæˆ‘ä»¬ä½¿ç”¨å“ªä¸ªç±»åŠ è½½å™¨åŠ è½½å®ƒï¼Œæœ€ç»ˆéƒ½ä¼šä¼ é€’ç»™å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ï¼Œä»è€Œä¿è¯äº†Objectç±»çš„å”¯ä¸€æ€§ã€‚ éªŒè¯é˜¶æ®µï¼šâ€‹ ä¸»è¦ä»å®‰å…¨æ€§çš„è§’åº¦è€ƒè™‘ï¼ŒéªŒè¯classæ–‡ä»¶ä¸­çš„å­—èŠ‚æµæ˜¯å¦å®‰å…¨ï¼Œæ˜¯å¦åˆæ³•ã€‚ å‡†å¤‡é˜¶æ®µï¼šâ€‹ ä¸ºç±»å˜é‡åˆ†é…ç©ºé—´ï¼Œå¹¶è®¾ç½®åˆå§‹å€¼ è¿™ä¸ªé˜¶æ®µåªç»™ç±»å˜é‡åˆ†é…ï¼Œå®ä¾‹å˜é‡è¿˜åœ¨åå¤´ã€‚ æ³¨æ„æ˜¯è®¾ç½®åˆå§‹å€¼ï¼Œä¸æ˜¯èµ‹å€¼ï¼Œåˆå§‹å€¼éƒ½æ˜¯é»˜è®¤ä¸º0 ç±»å˜é‡æ”¾åœ¨å“ªï¼Ÿ æ–¹æ³•åŒºï¼ è§£æé˜¶æ®µï¼šâ€‹ å°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨å˜ä¸ºç›´æ¥å¼•ç”¨ï¼Œå…³äºå¸¸é‡æ± ï¼Œç¬¦å·å¼•ç”¨ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ã€‚ç¬¦å·å¼•ç”¨ä¸»è¦æœ‰ï¼š ç±»å’Œæ¥å£çš„å…¨é™å®šåï¼ˆè¿™ä¸ªå¸¸é‡åœ¨ç±»ç´¢å¼•æˆ–è€…çˆ¶ç±»ç´¢å¼•ä¸­å°±ä¼šç”¨åˆ°ï¼‰ å­—æ®µçš„åç§°å’Œæè¿°ç¬¦ ï¼ˆè¿™ä¸ªåœ¨å­—æ®µè¡¨é›†åˆä¸­ä¼šè¢«ç”¨åˆ°ï¼‰ æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦ï¼ˆè¿™ä¸ªåœ¨æ–¹æ³•è¡¨é›†åˆä¸­ä¼šè¢«ç”¨åˆ°ï¼‰ æ‰€ä»¥è¯´ï¼Œè§£æé˜¶æ®µå°±æ˜¯å°†ä¸Šè¿°ä¸‰ç§ç¬¦å·å¼•ç”¨è§£ææˆç›´æ¥å¼•ç”¨ã€‚ ç±»æˆ–è€…æ¥å£è§£æï¼š â€‹ ä¸»è¦éœ€è¦åˆ¤æ–­å½“å‰æŒ‡å‘ç±»æˆ–è€…æ¥å£çš„å¼•ç”¨æ˜¯ä¸æ˜¯æ•°ç»„ï¼Œå¦‚æœä¸æ˜¯æ•°ç»„ï¼Œé‚£å°±ç›´æ¥åŠ è½½å¯¹åº”çš„ç±»æˆ–è€…æ¥å£ï¼› å¦‚æœæ˜¯æ•°ç»„ï¼Œä¸”æ•°ç»„å…ƒç´ ä¹Ÿæ˜¯å¯¹è±¡ï¼Œåˆ™éœ€è¦å…ˆåŠ è½½å…ƒç´ ï¼Œæœ€åç”Ÿæˆæ•°ç»„å¯¹è±¡ å­—æ®µè§£æï¼š â€‹ é¦–å…ˆæ ¹æ®å­—æ®µè¡¨ä¸­çš„ä¿¡æ¯æ‰¾åˆ°å…¶æ‰€åœ¨ç±»æˆ–è€…æ¥å£ï¼Œç„¶åä¸€ç›´ä»å½“å‰ç±»å‘ä¸Šå›æº¯ï¼Œç›´åˆ°æ‰¾åˆ°å¯¹åº”å­—æ®µï¼Œå¦åˆ™è¿”å›NoSuchFieldError ç±»æˆ–è€…æ¥å£æ–¹æ³•è§£æï¼š â€‹ é¦–å…ˆæ ¹æ®å­—æ®µè¡¨ä¸­çš„ä¿¡æ¯æ‰¾åˆ°å…¶æ‰€åœ¨ç±»æˆ–è€…æ¥å£ï¼Œå¦‚æœå½“å‰æ˜¯ç±»æ–¹æ³•ï¼Œä½†æ‰¾åˆ°çš„æ˜¯æ¥å£ï¼Œå‡ºé”™ï¼Œå¦‚æœå½“å‰æ˜¯æ¥å£æ–¹æ³•ï¼Œæ‰¾åˆ°çš„æ˜¯ä¸ªç±»ï¼Œä¹Ÿå‡ºé”™ï¼ŒIncompatibleClassChangeErrorï¼Œï¼ˆä¸ºä»€ä¹ˆè¿™æ ·çš„ï¼Œå› ä¸ºå¸¸é‡æ± ä¸­å¯¹ç±»å’Œæ–¹æ³•ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªè¡¨ç»“æ„å®šä¹‰çš„ï¼Œæ‰€ä»¥æœ‰æ—¶å€™å¯èƒ½ä¼šæœ‰æ­§ä¹‰ï¼Œéœ€è¦è¿™æ ·åˆ¤æ–­ï¼‰ ä¸Šè¿°æ¡ä»¶æ»¡è¶³åï¼Œä»å½“å‰ç±»æˆ–è€…æ¥å£ä¸€ç›´å›æº¯å‘ä¸Šæ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°å¯¹åº”æ–¹æ³• åˆå§‹åŒ–é˜¶æ®µï¼šâ€‹ ç±»åŠ è½½çš„æœ€åä¸€ä¸ªé˜¶æ®µã€‚è¿™ä¸€é˜¶æ®µï¼ŒJVMæ‰çœŸæ­£å¼€å§‹æ‰§è¡Œæˆ‘ä»¬å†™çš„javaä»£ç ã€‚æ¢ä¸ªè§’åº¦è®²ï¼Œè¿™ä¸ªé˜¶æ®µï¼Œjvmæ‰§è¡Œç±»æ„é€ å™¨&lt;clinit&gt;()æ–¹æ³•ã€‚ &lt;clinit&gt;()ç±»æ„é€ å™¨æ–¹æ³•ï¼Œ&lt;init&gt;()å¯¹è±¡æ„é€ å™¨æ–¹æ³•, æ‰€ä»¥ï¼Œ&lt;clinit&gt;()ç”¨æ¥åˆå§‹åŒ–ç±»å˜é‡ï¼ŒåŒ…æ‹¬è¢«staticä¿®é¥°çš„å˜é‡å’ŒåŒ…å«åœ¨staticè¯­å¥å—ä¸­çš„å˜é‡ï¼Œè€Œ&lt;init&gt;()æ–¹æ³•ä¿®é¥°éé™æ€å˜é‡ã€‚ å…³äº&lt;clinit&gt;()çš„æ‰§è¡Œè§„åˆ™ &lt;clinit&gt;()æ–¹æ³•æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€è¯­å¥å—ä¸­çš„è¯­å¥åˆå¹¶äº§ç”Ÿçš„ï¼Œç¼–è¯‘å™¨æ”¶é›†çš„é¡ºåºæ˜¯ç”±è¯­å¥åœ¨æºæ–‡ä»¶ä¸­å‡ºç°çš„é¡ºåºæ‰€å†³å®šçš„ï¼Œé™æ€è¯­å¥å—ä¸­åªèƒ½è®¿é—®åˆ°å®šä¹‰åœ¨é™æ€è¯­å¥å—ä¹‹å‰çš„å˜é‡ï¼Œå®šä¹‰åœ¨å®ƒä¹‹åçš„å˜é‡ï¼Œåœ¨å‰é¢çš„é™æ€è¯­å¥ä¸­å¯ä»¥èµ‹å€¼ï¼Œä½†æ˜¯ä¸èƒ½è®¿é—®ã€‚ &lt;clinit&gt;()æ–¹æ³•ä¸å®ä¾‹æ„é€ å™¨&lt;init&gt;()æ–¹æ³•ï¼ˆç±»çš„æ„é€ å‡½æ•°ï¼‰ä¸åŒï¼Œå®ƒä¸éœ€è¦æ˜¾å¼åœ°è°ƒç”¨çˆ¶ç±»æ„é€ å™¨ï¼Œè™šæ‹Ÿæœºä¼šä¿è¯åœ¨å­ç±»çš„&lt;clinit&gt;()æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼Œçˆ¶ç±»çš„&lt;clinit&gt;()æ–¹æ³•å·²ç»æ‰§è¡Œå®Œæ¯•ã€‚å› æ­¤ï¼Œåœ¨è™šæ‹Ÿæœºä¸­ç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œçš„&lt;clinit&gt;()æ–¹æ³•çš„ç±»è‚¯å®šæ˜¯java.lang.Objectã€‚ä¹Ÿå°±æ„å‘³ç€çˆ¶ç±»ä¸­å®šä¹‰çš„é™æ€è¯­å¥å—/é™æ€å˜é‡çš„åˆå§‹åŒ–è¦ä¼˜å…ˆäºå­ç±»çš„é™æ€è¯­å¥å—/é™æ€å˜é‡çš„åˆå§‹åŒ–æ‰§è¡Œ &lt;clinit&gt;()æ–¹æ³•å¯¹äºç±»æˆ–æ¥å£æ¥è¯´å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœä¸€ä¸ªç±»ä¸­æ²¡æœ‰é™æ€è¯­å¥å—ï¼Œä¹Ÿæ²¡æœ‰å¯¹ç±»å˜é‡çš„èµ‹å€¼æ“ä½œï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å¯ä»¥ä¸ä¸ºè¿™ä¸ªç±»ç”Ÿæˆ&lt;clinit&gt;()æ–¹æ³•ã€‚ æ¥å£ä¸­ä¸èƒ½ä½¿ç”¨é™æ€è¯­å¥å—ï¼Œä½†ä»ç„¶æœ‰ç±»å˜é‡ï¼ˆfinal staticï¼‰åˆå§‹åŒ–çš„èµ‹å€¼æ“ä½œï¼Œå› æ­¤æ¥å£ä¸ç±»ä¸€æ ·ä¼šç”Ÿæˆ&lt;clinit&gt;()æ–¹æ³•ã€‚ä½†æ˜¯æ¥å£ä¸ç±»ä¸åŒçš„æ˜¯ï¼šæ‰§è¡Œæ¥å£çš„&lt;clinit&gt;()æ–¹æ³•ä¸éœ€è¦å…ˆæ‰§è¡Œçˆ¶æ¥å£çš„&lt;clinit&gt;()æ–¹æ³•ï¼Œåªæœ‰å½“çˆ¶æ¥å£ä¸­å®šä¹‰çš„å˜é‡è¢«ä½¿ç”¨æ—¶ï¼Œçˆ¶æ¥å£æ‰ä¼šè¢«åˆå§‹åŒ–ã€‚å¦å¤–ï¼Œæ¥å£çš„å®ç°ç±»åœ¨åˆå§‹åŒ–æ—¶ä¹Ÿä¸€æ ·ä¸ä¼šæ‰§è¡Œæ¥å£çš„&lt;clinit&gt;()æ–¹æ³•ã€‚ è™šæ‹Ÿæœºä¼šä¿è¯ä¸€ä¸ªç±»çš„&lt;clinit&gt;()æ–¹æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è¢«æ­£ç¡®åœ°åŠ é”å’ŒåŒæ­¥ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶å»åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œé‚£ä¹ˆåªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œè¿™ä¸ªç±»çš„&lt;clinit&gt;()æ–¹æ³•ï¼Œå…¶ä»–çº¿ç¨‹éƒ½éœ€è¦é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°æ´»åŠ¨çº¿ç¨‹æ‰§è¡Œ&lt;clinit&gt;()æ–¹æ³•å®Œæ¯•ï¼Œä½†å¦‚æœæ‰§è¡Œ&lt;clinit&gt;()æ–¹æ³•çš„é‚£æ¡çº¿ç¨‹æ¨å‡ºåï¼Œå…¶ä»–çº¿ç¨‹å”¤é†’ä¹‹åä¸ä¼šå†æ¬¡è¿›å…¥/æ‰§è¡Œ&lt;clinit&gt;()ï¼Œå› ä¸ºåœ¨åŒä¸€ä¸ªç±»åŠ è½½å™¨ä¸‹ï¼Œä¸€ä¸ªç±»å‹åªä¼šè¢«åˆå§‹åŒ–ä¸€æ¬¡ï¼ˆå•ä¾‹æ¨¡å¼ç§å°±æœ‰åˆ©ç”¨è¿™ç§ç±»åŠ è½½æœºåˆ¶å»å®ç°çš„ï¼‰ã€‚å¦‚æœåœ¨ä¸€ä¸ªç±»çš„&lt;clinit&gt;()æ–¹æ³•ä¸­æœ‰è€—æ—¶å¾ˆé•¿çš„æ“ä½œï¼Œé‚£å°±å¯èƒ½é€ æˆå¤šä¸ªçº¿ç¨‹é˜»å¡ï¼Œåœ¨å®é™…åº”ç”¨ä¸­è¿™ç§é˜»å¡å¾€å¾€æ˜¯å¾ˆéšè”½çš„ã€‚ ä»ä¸Šè¿°è§„åˆ™æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹ç»“è®ºï¼š â€‹ 1. é™æ€å˜é‡ç¡®å®æ˜¯å…ˆäºå®ä¾‹å˜é‡è¢«åˆ›å»ºçš„ï¼ˆè¿™ç‚¹å¾ˆé‡è¦ï¼åé¢è®²åˆ°çš„å•ä¾‹æ¨¡å¼çš„å®ç°å°±ä¼šç”¨åˆ°è¿™ä¸€ç‚¹ï¼‰ï¼Œç±»å˜é‡åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±è¢«èµ‹å€¼äº†ã€‚è€Œå®ä¾‹å˜é‡è¦ç­‰åˆ°newçš„æ—¶å€™ã€‚ å‚è€ƒï¼š ã€Šæ·±å…¥ç†è§£javaè™šæ‹Ÿæœºã€‹","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"ç±»åŠ è½½","slug":"ç±»åŠ è½½","permalink":"http://example.com/tags/%E7%B1%BB%E5%8A%A0%E8%BD%BD/"}]},{"title":"Javaä¸­çš„volatileå…³é”®å­—","slug":"Javaä¸­çš„volatileå…³é”®å­—","date":"2019-09-17T12:55:18.000Z","updated":"2019-09-17T12:55:18.000Z","comments":true,"path":"2019/09/17/Javaä¸­çš„volatileå…³é”®å­—/","link":"","permalink":"http://example.com/2019/09/17/Java%E4%B8%AD%E7%9A%84volatile%E5%85%B3%E9%94%AE%E5%AD%97/","excerpt":"","text":"æœ¬æ–‡éœ€è¦äº†è§£ï¼šJavaå†…å­˜æ¨¡å‹ ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ä¸ºäº†æé«˜CPUä»å†…å­˜ä¸­è¯»å†™çš„é€Ÿåº¦ï¼Œåœ¨CPUå’Œå’Œå†…å­˜ä¸­é—´æ·»åŠ äº†ç¼“å­˜ï¼Œæœ‰ä¸€çº§ç¼“å­˜ï¼ŒäºŒçº§ç¼“å­˜ï¼Œç”šè‡³ä¸‰çº§ç¼“å­˜ï¼Œä»ä¸€çº§åˆ°ä¸‰çº§ï¼Œå®¹é‡å˜å¤§ï¼Œé€Ÿåº¦å˜ä½ã€‚å¯¹äºå¤šä¸ªCPUåœºæ™¯ï¼Œä¸€èˆ¬æ˜¯æ¯ä¸ªCPUéƒ½æœ‰è‡ªå·±çš„ä¸€çº§å’ŒäºŒçº§ç¼“å­˜è€Œå…¬ç”¨ä¸‰çº§ç¼“å­˜ã€‚ åœ¨å¤šCPUå¤šçº¿ç¨‹çš„è¯»å†™åœºæ™¯ä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹æœ‰å¯èƒ½ä¼šè®¿é—®åŒä¸€å—å†…å­˜åŒºåŸŸï¼Œä»¥å†™æ“ä½œä¸ºä¾‹ï¼Œå¤šä¸ªçº¿ç¨‹éƒ½ä¼šæŠŠå†…å­˜ä¸­çš„å€¼è¯»åˆ°è‡ªå·±çš„CPUä¸­ï¼Œç„¶åä¿®æ”¹ï¼Œç„¶åæš‚æ—¶æ”¾åˆ°è‡ªå·±çš„ç¼“å­˜ä¸­ï¼Œè¿™æ ·å°±å¯¼è‡´æ¯ä¸ªçº¿ç¨‹ä¿çš„ç¼“å­˜ä¸­å¯¹åŒä¸€å˜é‡å¯èƒ½æœ‰ä¸åŒå€¼çš„ç°è±¡ï¼Œå³ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ã€‚ ç¼“å­˜ä¸€è‡´æ€§åè®®ä¸ºäº†è§£å†³ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼Œé€šå¸¸æœ‰ä¸¤ç§æ–¹æ³•ï¼š åœ¨æ€»çº¿åŠ LOCKé” ç¼“å­˜ä¸€è‡´æ€§åè®® åœ¨æ€»çº¿åŠ é”æ˜¯ä¸€ç§é˜»å¡çš„æ–¹å¼ï¼Œæ˜¾ç„¶æ˜¯ä¸é«˜æ•ˆçš„ã€‚ ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼ˆCache Coherence Protocolï¼‰ï¼Œæœ€å‡ºåçš„å°±æ˜¯Intel çš„MESIåè®®ï¼ŒMESIåè®®ä¿è¯äº†æ¯ä¸ªç¼“å­˜ä¸­ä½¿ç”¨çš„å…±äº«å˜é‡çš„å‰¯æœ¬æ˜¯ä¸€è‡´çš„ã€‚ MESIçš„æ ¸å¿ƒçš„æ€æƒ³æ˜¯ï¼šå½“CPUå†™æ•°æ®æ—¶ï¼Œå¦‚æœå‘ç°æ“ä½œçš„å˜é‡æ˜¯å…±äº«å˜é‡ï¼Œå³åœ¨å…¶ä»–CPUä¸­ä¹Ÿå­˜åœ¨è¯¥å˜é‡çš„å‰¯æœ¬ï¼Œä¼šå‘å‡ºä¿¡å·é€šçŸ¥å…¶ä»–CPUå°†è¯¥å˜é‡çš„ç¼“å­˜è¡Œç½®ä¸ºæ— æ•ˆçŠ¶æ€ï¼Œå› æ­¤å½“å…¶ä»–CPUéœ€è¦è¯»å–è¿™ä¸ªå˜é‡æ—¶ï¼Œå‘ç°è‡ªå·±ç¼“å­˜ä¸­ç¼“å­˜è¯¥å˜é‡çš„ç¼“å­˜è¡Œæ˜¯æ— æ•ˆçš„ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šä»å†…å­˜é‡æ–°è¯»å–ã€‚ volatileå…³é”®å­—å†…å­˜è¯­ä¹‰ å¯è§æ€§ æœ‰åºæ€§ ä¸‹é¢è¿™æ®µè¯æ‘˜è‡ªã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ï¼š â€œè§‚å¯ŸåŠ å…¥volatileå…³é”®å­—å’Œæ²¡æœ‰åŠ å…¥volatileå…³é”®å­—æ—¶æ‰€ç”Ÿæˆçš„æ±‡ç¼–ä»£ç å‘ç°ï¼ŒåŠ å…¥volatileå…³é”®å­—æ—¶ï¼Œä¼šå¤šå‡ºä¸€ä¸ªlockå‰ç¼€æŒ‡ä»¤â€ lockå‰ç¼€æŒ‡ä»¤å®é™…ä¸Šç›¸å½“äºä¸€ä¸ªå†…å­˜å±éšœï¼ˆä¹Ÿæˆå†…å­˜æ …æ ï¼‰ï¼Œå†…å­˜å±éšœä¼šæä¾›3ä¸ªåŠŸèƒ½ï¼š 1ï¼‰å®ƒç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ä¸ä¼šæŠŠå…¶åé¢çš„æŒ‡ä»¤æ’åˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®ï¼Œä¹Ÿä¸ä¼šæŠŠå‰é¢çš„æŒ‡ä»¤æ’åˆ°å†…å­˜å±éšœçš„åé¢ï¼›å³åœ¨æ‰§è¡Œåˆ°å†…å­˜å±éšœè¿™å¥æŒ‡ä»¤æ—¶ï¼Œåœ¨å®ƒå‰é¢çš„æ“ä½œå·²ç»å…¨éƒ¨å®Œæˆï¼› 2ï¼‰å®ƒä¼šå¼ºåˆ¶å°†å¯¹ç¼“å­˜çš„ä¿®æ”¹æ“ä½œç«‹å³å†™å…¥ä¸»å­˜ï¼› 3ï¼‰å¦‚æœæ˜¯å†™æ“ä½œï¼Œå®ƒä¼šå¯¼è‡´å…¶ä»–CPUä¸­å¯¹åº”çš„ç¼“å­˜è¡Œæ— æ•ˆã€‚ volatileæ˜¯ä¸èƒ½ä¿è¯åŸå­æ€§çš„ï¼Œåœ¨æŒ‡ä»¤å±‚é¢ï¼ŒåŸå­æ€§æ˜¯é€šè¿‡monitorenterå’Œmonitorexitä¸¤ä¸ªæŒ‡ä»¤å®ç°çš„ï¼Œè€Œvolatileçš„æŒ‡ä»¤å±‚é¢åªæœ‰lockæŒ‡ä»¤. åœ¨ä»¥ä¸‹ä¸¤ä¸ªåœºæ™¯ä¸­å¯ä»¥ä½¿ç”¨volatileæ¥ä»£æ›¿synchronizedï¼š 1ã€è¿ç®—ç»“æœå¹¶ä¸ä¾èµ–å˜é‡çš„å½“å‰å€¼ï¼Œæˆ–è€…èƒ½å¤Ÿç¡®ä¿åªæœ‰å•ä¸€çš„çº¿ç¨‹ä¼šä¿®æ”¹å˜é‡çš„å€¼ã€‚ 2ã€å˜é‡ä¸éœ€è¦ä¸å…¶ä»–çŠ¶æ€å˜é‡å…±åŒå‚ä¸ä¸å˜çº¦æŸã€‚ æ¯”å¦‚è¯´ï¼Œä½œä¸ºçº¿ç¨‹é€€å‡ºçš„æ ‡è®°é‡ï¼Œæˆ–è€…DCLçš„å•ä¾‹æ¨¡å¼ä¸­çš„ä½¿ç”¨ã€‚ æ—¢ç”Ÿsynchronizedï¼Œä½•ç”Ÿvolatileè¯´åˆ°åº•ï¼Œsynchronizedæ˜¯é€šè¿‡åŠ é”æ¥å®ç°åŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§çš„ã€‚æ—¢ç„¶æ˜¯é”ï¼Œè‚¯å®šæ˜¯æœ‰å¼€é”€çš„ï¼Œè™½ç„¶è¯´è‡ª1.6å¼€å§‹åˆç»™synchronizedæ·»åŠ äº†è½»é‡çº§é”ï¼Œåå‘é”ï¼Œä½†æ€§èƒ½æŸè€—è¿˜æ˜¯æœ‰çš„ã€‚è€Œä¸”ï¼ŒåŠ é”å…¶å®æ˜¯ä¸€ä¸ªé˜»å¡çš„è¿‡ç¨‹ã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼Œå…³äºäºŒè€…çš„æ€§èƒ½å¯¹æ¯”ï¼Œç”±äºè™šæ‹Ÿæœºå¯¹é”å®è¡Œçš„è®¸å¤šæ¶ˆé™¤å’Œä¼˜åŒ–ï¼Œä½¿å¾—æˆ‘ä»¬å¾ˆéš¾é‡åŒ–è¿™ä¸¤è€…ä¹‹é—´çš„æ€§èƒ½å·®è·ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç¡®å®šçš„ä¸€ä¸ªåŸºæœ¬åŸåˆ™æ˜¯ï¼švolatileå˜é‡çš„è¯»æ“ä½œçš„æ€§èƒ½æ¶ˆè€—ä¸æ™®é€šå˜é‡å‡ ä¹æ— å·®åˆ«ï¼Œä½†æ˜¯å†™æ“ä½œç”±äºéœ€è¦æ’å…¥å†…å­˜å±éšœæ‰€ä»¥ä¼šæ…¢ä¸€äº›ï¼Œå³ä¾¿å¦‚æ­¤ï¼Œvolatileåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ä¹Ÿæ¯”é”çš„å¼€é”€è¦ä½ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"volatile","slug":"volatile","permalink":"http://example.com/tags/volatile/"}]},{"title":"Javaä¸­çš„ReentrantLock","slug":"Javaä¸­çš„ReentrantLock","date":"2019-09-17T06:56:35.000Z","updated":"2019-09-17T06:56:35.000Z","comments":true,"path":"2019/09/17/Javaä¸­çš„ReentrantLock/","link":"","permalink":"http://example.com/2019/09/17/Java%E4%B8%AD%E7%9A%84ReentrantLock/","excerpt":"","text":"ReentrantLock, ä»åå­—æ¥çœ‹ï¼Œå¯é‡å…¥é”ï¼Œä»Šå¤©æ¥çœ‹ä¸‹å®ƒçš„å…·ä½“å®ç°ã€‚ ç‰¹æ€§ï¼šæ’ä»–é”ï¼Œå†…éƒ¨å®ç°äº†å…¬å¹³é”å’Œéå…¬å¹³é”ã€‚ å®ƒçš„ç»§æ‰¿å…³ç³»å¦‚ä¸‹ï¼š ä»¥åŠè¿˜æœ‰ä¸‰ä¸ªå†…éƒ¨ç±»ï¼šSync, NonfairSync , FairSync.å…¶ä¸­åä¸¤ä¸ªéƒ½ç»§æ‰¿è‡ªSyncï¼Œè€ŒSyncåˆç»§æ‰¿è‡ªAQS å¯ä»¥çœ‹å‡ºï¼ŒReentryLockæ˜¯åœ¨è‡ªå·±å†…éƒ¨å®ç°äº†å…¬å¹³é”å’Œéå…¬å¹³é”çš„ã€‚ å¯ä»¥çœ‹åˆ°ï¼ŒReentryLockç»§æ‰¿çš„Lockæ¥å£å®ç°äº†lock,tryLock, unLockç­‰æ–¹æ³•, è¿™ä¹Ÿæ˜¯æœ¬æ–‡è®¨è®ºçš„é‡ç‚¹ã€‚ å…ˆæ¥ä»æ•´ä½“ä¸ŠæŠŠæ¡ä¸€ä¸‹ReentrantLock, ReentrantLockä¹‹æ‰€ä»¥èƒ½æœ‰é”çš„åŠŸèƒ½ï¼Œæ˜¯å› ä¸ºå®ƒèšåˆäº†AQSç±»ï¼ˆå½“ç„¶è¿™ä¹Ÿæ˜¯AQSç±»è®¾è®¡çš„åˆè¡·ï¼ŒAQSé€šè¿‡æ¨¡æ¿æ–¹å¼æ¨¡å¼å®ç°ï¼Œè®¾è®¡è€…å¸Œæœ›æˆ‘ä»¬è‡ªå·±è®¾è®¡çš„çŠ¶æ€åŒæ­¥ç»„ä»¶é‡å†™å…·ä½“çš„ç»†èŠ‚ç±»ï¼Œç„¶åå°†è¿™ä¸ªçŠ¶æ€åŒæ­¥ç»„ä»¶èšåˆåˆ°æˆ‘ä»¬çš„é”é‡Œé¢ï¼‰ï¼ŒReentrantLockä¹Ÿæ­£æ˜¯è¿™ä¹ˆåšçš„ã€‚ ReentrantLockçš„è®¾è®¡é€»è¾‘æ˜¯è¿™æ ·çš„ï¼š åœ¨AQSä¸­ï¼Œæœ‰æ¨¡æ¿æ–¹æ³•å’Œéœ€è¦é‡å†™çš„ç»†èŠ‚æ–¹æ³•ã€‚æ¨¡æ¿æ–¹æ³•è´Ÿè´£æ­å»ºè·å–é”å’Œé‡Šæ”¾é”çš„æ¡†æ¶ï¼Œç»†èŠ‚æ–¹æ³•å»¶è¿Ÿåˆ°å­ç±»ä¸­å»å®ç°ã€‚ ä¸Šå›¾AQSç±»ä¸­ï¼Œè“è‰²æ–¹æ³•ä¸ºæ¨¡æ¿æ–¹æ³•ï¼Œç»¿è‰²æ–¹æ³•ä¸ºå¯èƒ½éœ€è¦è¦†ç›–çš„æ–¹æ³•ï¼Œå³åœ¨è“è‰²æ–¹æ³•ä¸­è°ƒç”¨äº†ç»¿è‰²æ–¹æ³•ã€‚Syncç»§æ‰¿è‡ªAQS, è€ŒNonfairSyncå’ŒFairSyncç»§æ‰¿äº†Sync,ç›¸å½“äºæœ€ç»ˆè¦åœ¨å…¬å¹³é”å’Œéå…¬å¹³é”ä¸­å®ç°ç»†èŠ‚æ–¹æ³•ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå…±äº«å¼çš„è·å–é”å’Œé‡Šæ”¾é”æ˜¯æ²¡æœ‰è¢«å®ç°çš„ï¼Œæ‰€ä»¥è¯´ï¼ŒReentrantLockæ˜¯ç‹¬å é”ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸‹Syncçš„å®šä¹‰ã€‚ è¿™é‡ŒSyncç»§æ‰¿è‡ªAQS, ç”¨æ¥å®ç°çŠ¶æ€åŒæ­¥ã€‚ æˆ‘ä»¬çœ‹ä¸‹NonfairSyncçš„å®ç° å®ƒå®ç°äº†çˆ¶ç±»çš„lockæ–¹æ³•ï¼Œé¦–å…ˆé€šè¿‡CASè®¾ç½®çº¿ç¨‹æŒæœ‰é”çš„çŠ¶æ€ï¼Œå¦‚æœä¿®æ”¹æˆåŠŸï¼Œåˆ™é”å±äºå½“å‰çº¿ç¨‹ï¼Œå¦åˆ™ï¼Œè°ƒç”¨acquire()æ–¹æ³•. acquire()æ–¹æ³•åœ¨AQSç±»ä¸­å®ç°ï¼Œ 12345public final void acquire(int arg) &#123; if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) selfInterrupt(); &#125; å¦‚æœä½¿ç”¨tryAcquire()è·å–é”å¤±è´¥ï¼Œåˆ™æŠŠè¿™ä¸ªçº¿ç¨‹åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚ï¼ˆtryAcquire()åˆæ˜¯åœ¨NonFairSyncä¸­å®ç°çš„ï¼Œæœ‰ç‚¹ç»•ï¼Œå®ƒçš„å®ç°åˆè°ƒç”¨äº†çˆ¶ç±»Syncä¸­çš„nonfairTryAcquire()æ–¹æ³•ï¼‰ å…¬å¹³é”FairSync å¯ä»¥çœ‹åˆ°ï¼Œç›¸æ¯”äºéå…¬å¹³é”çš„lockæ–¹æ³•ï¼Œå…¬å¹³é”çš„lockæ–¹æ³•ä¸€å¼€å§‹æ‰§è¡Œå°±æ˜¯æ’é˜Ÿï¼Œå³acquire()æ–¹æ³•ï¼Œè€Œéå…¬å¹³é”çš„lockæ–¹æ³•ä¸Šæ¥äºŒè¯ä¸è¯´å°±æ˜¯å…ˆæ’é˜Ÿï¼Œå³é€šè¿‡CASæ”¹å˜è‡ªèº«æŒæœ‰è¯¥é”çš„çŠ¶æ€ å¯¹äºtryAcquire()æ–¹æ³•ï¼Œå…¬å¹³é”çš„åˆ¤æ–­æ¡ä»¶é‡Œå¤šäº†ä¸€ä¸ªè‡ªå·±æ˜¯å¦åœ¨é˜Ÿåˆ—é¦–çš„åˆ¤æ–­ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"Lock","slug":"Lock","permalink":"http://example.com/tags/Lock/"}]},{"title":"å‰‘æŒ‡offeré¢˜è§£","slug":"å‰‘æŒ‡offeré¢˜è§£","date":"2019-09-15T09:25:15.000Z","updated":"2019-09-15T09:25:15.000Z","comments":true,"path":"2019/09/15/å‰‘æŒ‡offeré¢˜è§£/","link":"","permalink":"http://example.com/2019/09/15/%E5%89%91%E6%8C%87offer%E9%A2%98%E8%A7%A3/","excerpt":"","text":"é‡å»ºäºŒå‰æ ‘å‰åºéå†ç”¨æ¥ç¡®å®šæ ¹èŠ‚ç‚¹ï¼Œä¸­åºéå†ç”¨æ¥ç¡®å®šå·¦å³å­æ ‘ä»¥åŠå¤§å° 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283class TreeNode &#123; int val; TreeNode left; TreeNode right; TreeNode(int x) &#123; val = x; &#125;&#125;public class ReconsBinTree &#123; public static void main(String[] args) &#123; int[] pre=&#123;1,2,4,7,3,5,6,8&#125;; int[] in = &#123;4,7,2,1,5,3,6,8&#125;; TreeNode root = reConstructBinaryTree(pre,in);// System.out.println(root); lastOrder(root); &#125; //å‰åºéå†æä¾›è·ŸèŠ‚ç‚¹ï¼Œä¸­åºéå†æä¾›åˆ‡åˆ†ä»¥åŠå·¦å³å­æ ‘çš„å¤§å° public static TreeNode reConstructBinaryTree(int[] pre, int[] in) &#123;// TreeNode root = new TreeNode(pre[0]); TreeNode root = reconstruct(pre[0],pre,0,pre.length,in,0,in.length); return root; &#125; public static TreeNode reconstruct(int rootVal,int[] pre,int preStart, int preEnd, int[] in, int inStart, int inEnd)&#123; TreeNode root = new TreeNode(rootVal); int rootIdxAtPre = getIndex(pre,preStart,preEnd,root.val) ; int rootIdxAtIn = getIndex(in,inStart,inEnd,root.val); if(rootIdxAtIn&gt;0)&#123; //è¯´æ˜æœ‰å·¦å­©å­ï¼Œç´¢å¼•ä»¥å·¦å°±æ˜¯å·¦å­©å­ int lidx = rootIdxAtPre+1;// TreeNode left = new TreeNode(pre[preStart+lidx]);// root.left=left; root.left = reconstruct(pre[preStart+lidx],pre,preStart+1,preStart+1+rootIdxAtIn,in,inStart,inStart+rootIdxAtIn); &#125; else root.left=null; if(inStart+rootIdxAtIn&lt;inEnd-1)&#123; int ridx = rootIdxAtIn+1;// TreeNode right = new TreeNode(pre[preStart+ridx]);// root.right=right; root.right = reconstruct(pre[preStart+ridx], pre,preStart+rootIdxAtIn+1,preEnd,in,inStart+rootIdxAtIn+1,inEnd); &#125; else root.right=null; return root; &#125; //è¿”å›ç›¸å¯¹ä½ç½®ç´¢å¼• public static int getIndex(int[] arr, int start, int end, int val)&#123; for(int i=start; i&lt;end; i++)&#123; if(arr[i]==val) return i-start; &#125; return -1; &#125; //åç»­éå†æµ‹è¯• public static void lastOrder(TreeNode root)&#123; if(root!=null) &#123; if (root.left != null) lastOrder(root.left); if (root.right != null) lastOrder(root.right); &#125; System.out.println(root.val); &#125;&#125; ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—123456789101112131415161718192021222324252627282930313233343536373839import java.util.Stack;/** * æ€è·¯ï¼šä»stack1 push,ä»stack2 pop. */public class Stack2Q &#123; static Stack&lt;Integer&gt; stack1 = new Stack&lt;Integer&gt;(); static Stack&lt;Integer&gt; stack2 = new Stack&lt;Integer&gt;(); public static void push(int node) &#123; stack1.push(node) ; &#125; public static int pop() &#123; int node ; //stack2ä¸­æœ‰çš„è¯ç›´æ¥pop if(!stack2.isEmpty())&#123; node = stack2.pop(); &#125; else &#123;//æ²¡æœ‰çš„è¯å…ˆä»stack1è½¬ç§»åˆ°stack2 while (!stack1.isEmpty())&#123; int tnode = stack1.pop(); stack2.push(tnode); &#125; node = stack2.pop(); &#125; return node ; &#125; public static void main(String[] args) &#123; push(1); push(2); push(3); push(4); System.out.println(pop()); System.out.println(pop()); &#125;&#125; æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—1234567891011121314151617181920212223242526272829303132333435363738/** * åˆ©ç”¨æ—‹è½¬æ•°ç»„çš„ç‰¹æ€§ï¼Œä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼š * å¦‚æœä¸­é—´æ•°å¤§äºarray[start]ä¸”å¤§äºarray[end],åŒºååŠæ®µ * å¦‚æœä¸­é—´æ•°å¤§äºarray[start]ä¸”å°äºarray[end]ï¼Œå–å‰åŠæ®µ * å¦‚æœä¸­é—´æ•°å°äºarray[start]ï¼Œå–å‰åŠæ®µ * * éœ€è¦æ³¨æ„ä¸‹æ ‡çš„å–æ³• */public class MinNumInRotateArray &#123; public static int minNumberInRotateArray(int[] array) &#123; int min = binSearch(array,0,array.length-1); return min; &#125; static int binSearch(int[] arr, int start, int end)&#123; int res; if(end-start&lt;=0)&#123; res = arr[start]; return res; &#125; int mid = (start+end)/2; if(arr[mid]&gt;=arr[start] &amp;&amp; arr[mid] &gt;=arr[end] )&#123; res = binSearch(arr,mid+1,end);//åé¢ &#125; else &#123; res = binSearch(arr,start,mid);//å‰é¢ &#125; return res; &#125; public static void main(String[] args) &#123; int[] array=&#123;3,4,5,1,2&#125;; System.out.println(minNumberInRotateArray(array)); &#125;&#125; è·³å°é˜¶ä¸€é“å…¸å‹çš„åŠ¨æ€è§„åˆ’é—®é¢˜ï¼Œå¯¹äºè·³ä¸Šç¬¬nä¸ªå°é˜¶ï¼Œåªæœ‰ä¸¤ç§è·³æ³•ï¼š ä»ç¬¬n-1ä¸ªå°é˜¶è·³ä¸€æ­¥ä¸Šå» ä»ç¬¬n-2ä¸ªå°é˜¶è·³ä¸¤æ­¥ä¸Šå» æ‰€ä»¥æˆ‘ä»¬æœ‰ $$ f(n)=\\left{\\begin{aligned}&amp;1 &amp; n=1 \\&amp;2 &amp; n=2 \\&amp;f(n-1)+f(n-2) &amp; n \\ge 3\\end{aligned}\\right.$$ å…¶å®å°±æ˜¯ä¸ªFibonaciæ•°åˆ—ï¼Œå¯ä»¥ç”¨é€’å½’æ±‚è§£ï¼Œä½†æ˜¯å¤ªéº»çƒ¦ï¼Œæˆ‘ä»¬ç”¨DPæ¥æ±‚è§£ æ•°ç»„ç‰ˆ12345678910111213141516171819202122232425public class JumpFloor &#123;//public static int JumpFloor(int target) &#123; if(target==1)&#123; return 1; &#125; if(target==2)&#123; return 2; &#125; int[] dp = new int[target+1]; dp[1]=1; dp[2]=2; for (int i=3; i&lt;=target; i++)&#123; dp[i]=dp[i-1]+dp[i-2]; &#125; return dp[target];&#125; public static void main(String[] args) &#123; System.out.println(JumpFloor(3)); System.out.println(JumpFloor(4)); &#125;&#125; ç²¾ç®€ç‰ˆ12345678910111213141516171819202122public class JumpFloor &#123; public static int JumpFloor(int target) &#123; if(target==1)&#123; return 1; &#125; if(target==2)&#123; return 2; &#125; int pre=1,cur=2,res=0; for(int i=3; i&lt;=target; i++)&#123; res = pre+cur; pre=cur; cur=res; &#125; return res; &#125; public static void main(String[] args) &#123; System.out.println(JumpFloor(3)); System.out.println(JumpFloor(4)); &#125;&#125; å˜æ€è·³å°é˜¶é¢˜ç›®æè¿°: ä¸€åªé’è›™ä¸€æ¬¡å¯ä»¥è·³ä¸Š1çº§å°é˜¶ï¼Œä¹Ÿå¯ä»¥è·³ä¸Š2çº§â€¦â€¦å®ƒä¹Ÿå¯ä»¥è·³ä¸Šnçº§ã€‚æ±‚è¯¥é’è›™è·³ä¸Šä¸€ä¸ªnçº§çš„å°é˜¶æ€»å…±æœ‰å¤šå°‘ç§è·³æ³•ã€‚ è§£æï¼š åŒæ ·çš„ï¼Œå…ˆå†™å‡ºé€’å½’æ–¹ç¨‹ï¼Œç„¶åç”¨é€’å½’æˆ–è€…DPæ¥æ±‚è§£ã€‚ ç›¸æ¯”äºä¸Šé¢é‚£ä¸€é“æ™®é€šè·³å°é˜¶ï¼Œè¿™é‡Œåªä¸è¿‡æ˜¯èƒ½è·³çš„å°é˜¶å¤šäº†ä¸€äº›ã€‚ çŸ©å½¢è¦†ç›–é¢˜ç›®æè¿°æˆ‘ä»¬å¯ä»¥ç”¨21çš„å°çŸ©å½¢æ¨ªç€æˆ–è€…ç«–ç€å»è¦†ç›–æ›´å¤§çš„çŸ©å½¢ã€‚è¯·é—®ç”¨nä¸ª21çš„å°çŸ©å½¢æ— é‡å åœ°è¦†ç›–ä¸€ä¸ª2*nçš„å¤§çŸ©å½¢ï¼Œæ€»å…±æœ‰å¤šå°‘ç§æ–¹æ³•ï¼Ÿ è§£æåŒæ ·çš„ï¼Œå…ˆå†™çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š $$ f(n)=\\left{\\begin{aligned}&amp;1 &amp; n=1 \\&amp;2 &amp; n=2 \\&amp;f(n-1)+f(n-2) &amp; n \\ge 3\\end{aligned}\\right.$$ ä¾ç„¶æ˜¯ä¸ªæ–æ³¢é‚£å¥‘æ•°åˆ—é—®é¢˜ å¯ä»¥ç”¨é€’å½’å’ŒDPè§£å†³ å…¶å®è®²é“ç†ï¼Œæˆ‘è§‰å¾—è¿™é“é¢˜ä¹Ÿå¯ä»¥ç”¨æ’åˆ—ç»„åˆæ¥æ±‚è§£çš„ ä»£ç 1234567public int RectCover(int target) &#123; if (target == 1) return 1; if (target == 2) return 2; return RectCover(target - 1) + RectCover(target - 2); &#125; DP: 123456789101112131415161718public int RectCover(int target) &#123; int sum,p1,p2 ; if(target &lt;=0) return 0; if (target == 1) return 1; if (target == 2) return 2; p1=1; p2=2; sum=0; for (int i = 3; i&lt;=target; i++)&#123; sum = p1 +p2 ; p1 = p2 ; p2 = sum ; &#125; return sum; &#125; äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°é¢˜ç›®æè¿° è¾“å…¥ä¸€ä¸ªæ•´æ•°nï¼Œè¾“å‡ºè¯¥æ•°äºŒè¿›åˆ¶è¡¨ç¤ºä¸­1çš„ä¸ªæ•°ã€‚å…¶ä¸­è´Ÿæ•°ç”¨è¡¥ç è¡¨ç¤ºã€‚ è§£ææ–¹æ³•ä¸€ï¼š æ— ç¬¦å·å³ç§»è¾“å…¥çš„æ•°å­—ï¼Œç„¶åå’Œ1é€»è¾‘ä¸ æ–¹æ³•äºŒï¼šä¿æŒè¾“å…¥ä¸åŠ¨ï¼Œæ¯æ¬¡å³ç§»æ•°å­—1ç„¶åé€»è¾‘ä¸ æ–¹æ³•ä¸‰ï¼šå°†nå’Œn-1é€»è¾‘ä¸ï¼Œæ¶ˆé™¤ä¸€ä¸ªnæœ€å³è¾¹çš„æ•°å­—1 ä»£ç æ–¹æ³•ä¸€ï¼š 123456789101112131415public class NumberOf1 &#123; public int NumberOf1(int n) &#123; int count = 0; while (n!=0)&#123; count += (n&amp;1) ; n = n&gt;&gt;&gt;1; &#125; return count; &#125; public static void main(String[] args) &#123; System.out.println(new NumberOf1().NumberOf1(0x80000000)); &#125;&#125; æ•°å€¼çš„æ•´æ•°æ¬¡æ–¹é¢˜ç›®æè¿°ç»™å®šä¸€ä¸ªdoubleç±»å‹çš„æµ®ç‚¹æ•°baseå’Œintç±»å‹çš„æ•´æ•°exponentã€‚æ±‚baseçš„exponentæ¬¡æ–¹ã€‚ ä¿è¯baseå’Œexponentä¸åŒæ—¶ä¸º0 è§£æ æ–¹æ³•ä¸€ï¼šforå¾ªç¯æš´åŠ›è¾“å‡ºï¼Œéœ€è¦è€ƒè™‘åˆ°æŒ‡æ•°ä¸ºè´Ÿæ•°ç­‰è¾¹ç•Œæƒ…å†µ æ–¹æ³•äºŒï¼šä½¿ç”¨é€’å½’å°†æŒ‡æ•°æ‹†è§£è¿›è¡Œè®¡ç®—ã€‚ è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢é¢˜ç›®æè¿°è¾“å…¥ä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œå®ç°ä¸€ä¸ªå‡½æ•°æ¥è°ƒæ•´è¯¥æ•°ç»„ä¸­æ•°å­—çš„é¡ºåºï¼Œä½¿å¾—æ‰€æœ‰çš„å¥‡æ•°ä½äºæ•°ç»„çš„å‰åŠéƒ¨åˆ†ï¼Œæ‰€æœ‰çš„å¶æ•°ä½äºæ•°ç»„çš„ååŠéƒ¨åˆ†ï¼Œå¹¶ä¿è¯å¥‡æ•°å’Œå¥‡æ•°ï¼Œå¶æ•°å’Œå¶æ•°ä¹‹é—´çš„ç›¸å¯¹ä½ç½®ä¸å˜ã€‚ è§£æè¿™ä¸ªé—®é¢˜ä½¿ç”¨å†’æ³¡æ’åºçš„æ€æƒ³ä¹Ÿå¯ä»¥è§£å†³ï¼Œç›¸é‚»å…ƒç´ æ¯”è¾ƒå¹¶äº¤æ¢ï¼Œé—®é¢˜åœ¨äºè¿™æ ·åšçš„è¯æ— è°“çš„æ¯”è¾ƒå’Œäº¤æ¢æ¯”è¾ƒå¤šã€‚æ¯”å¦‚è¯´æœ‰ä¸€é•¿ä¸²éƒ½æ˜¯å¥‡æ•°æˆ–è€…å¶æ•°ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬å°±å¯ä»¥è·³è¿‡äº†ï¼Œå…¶å®æ˜¯æœ‰ç‚¹ç±»ä¼¼ä¸KMPç®—æ³•çš„ã€‚ æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡å‘å½“å‰å‡ºç°çš„ç¬¬ä¸€ä¸ªå¶æ•°ï¼Œä¸€ä¸ªæŒ‡å‘ç¬¬ä¸€ä¸ªå¶æ•°å‡ºç°åçš„ç¬¬ä¸€ä¸ªå¥‡æ•°ï¼Œç„¶åå¥‡æ•°æ”¾åœ¨å¶æ•°ä½ï¼Œå¶æ•°ä»¬ä¾æ¬¡åç§»ã€‚ ä»£ç 1234567891011121314151617181920212223242526272829303132333435public void reOrderArray(int [] array) &#123; int feven=0; //ç¬¬ä¸€ä¸ªå¶æ•°çš„ä½ç½® int fodd=1; // ç¬¬ä¸€ä¸ªå¶æ•°åç¬¬ä¸€ä¸ªå¥‡æ•°çš„ä½ç½® int i=0; if(array==null || array.length==1) return ; while(fodd&lt;=array.length)&#123; for(; feven&lt;array.length; feven++)&#123; //å¯»æ‰¾ç¬¬ä¸€ä¸ªå¶æ•°çš„ä½ç½® if(isEven(array[feven]))&#123; break; &#125; &#125; for(fodd=feven+1; fodd&lt;array.length; fodd++)&#123;//æ‰¾åˆ°å¶æ•°åç¬¬ä¸€ä¸ªå¥‡æ•°çš„ä½ç½® if(!isEven(array[fodd]))&#123; break; &#125; &#125; if(fodd&gt;=array.length) break; int t = array[fodd] ; for(int j = fodd-1; j&gt;=feven; j--)&#123; array[j+1] = array[j]; &#125; array[feven] = t ; &#125; &#125; public boolean isEven(int e)&#123; return e%2==0 ; &#125; æˆ–è€… 12345678910111213public class Solution &#123; public void reOrderArray(int [] array) &#123; for(int i= 0;i&lt;array.length-1;i++)&#123; for(int j=0;j&lt;array.length-1-i;j++)&#123; if(array[j]%2==0&amp;&amp;array[j+1]%2==1)&#123; int t = array[j]; array[j]=array[j+1]; array[j+1]=t; &#125; &#125; &#125; &#125;&#125; å¾ˆç±»ä¼¼äºå†’æ³¡æ’åºï¼Œæ¯ä¸€è½®å†’æ³¡ä¿è¯è‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´ å½’ä½ã€‚ å…¶å®å°±æ˜¯ä¸ªå†’æ³¡æ’åºï¼Œåªä¸è¿‡æˆ‘ä»¬å¸¸è§çš„å†’æ³¡æ’åºé‡Œé¢æ¯”è¾ƒçš„æ˜¯å…ƒç´ å¤§å°ï¼Œè¿™é‡Œæ¯”è¾ƒçš„æ˜¯å…ƒç´ å¥‡å¶ï¼Œè¿˜æœ‰å¾ˆé‡è¦çš„ä¸€ç‚¹å°±æ˜¯å†’æ³¡æ’åºæ˜¯ç¨³å®šçš„ï¼Œå¯¹åº”åˆ°é¢˜ç›®ä¸­å°±æ˜¯ä¿è¯å¥‡æ•°å’Œå¥‡æ•°ï¼Œå¶æ•°å’Œå¶æ•°ä¹‹é—´çš„ç›¸å¯¹ä½ç½®ä¸å˜ã€‚ è¿™é‡Œç›¸å½“äºæ˜¯ä¸€ä¸ªé€šç”¨æ€§çš„å†’æ³¡æ’åºï¼Œè‡³äºæŒ‰ç…§ä»€ä¹ˆæ¡ä»¶è¿›è¡Œç›¸é‚»å…ƒç´ æ¯”è¾ƒæ˜¯å¯æ’æ‹”çš„ï¼Œå®åœ¨æ˜¯å¦™å•Šã€‚ æ‰€ä»¥ç†è®ºä¸Šè®²ï¼Œè¿™é“é¢˜åªè¦æ˜¯ç¨³å®šçš„æ’åºç®—æ³•åº”è¯¥æ˜¯éƒ½å¯ä»¥ç”¨çš„ã€‚ é‚£å“ªäº›æ’åºç¨³å®šå“ªäº›æ’åºä¸ç¨³å®šå‘¢ï¼Ÿ ä¸€è¨€ä»¥è”½ä¹‹ï¼šæ¶‰åŠåˆ°éç›¸é‚»äº¤æ¢çš„æ’åºéƒ½æ˜¯ä¸ç¨³å®šçš„ï¼Œæ¯”å¦‚é€‰æ‹©æ’åºï¼Œæ¯”å¦‚å¿«é€Ÿæ’åºï¼Œå¸Œå°”æ’åºï¼Œæ¯”å¦‚å †æ’åºã€‚ é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªç»“ç‚¹é¢˜ç›®æè¿°è¾“å…¥ä¸€ä¸ªé“¾è¡¨ï¼Œè¾“å‡ºè¯¥é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªç»“ç‚¹ã€‚ åˆ†æç”¨æ ‡å°ºæ³•å°±å¯ä»¥è§£å†³ã€‚ ä»£ç 12345678910111213141516171819202122232425262728293031323334/*public class ListNode &#123; int val; ListNode next = null; ListNode(int val) &#123; this.val = val; &#125;&#125;*/public class Solution &#123; public ListNode FindKthToTail(ListNode head,int k) &#123; ListNode cur = head ; if(head == null)&#123; return null ; &#125; if(k==0)&#123; return null; &#125; ListNode post = cur.next ; int i = 1 ; while(post != null &amp;&amp; i&lt;k)&#123; post = post.next ; i++; &#125; if(i&lt;k)&#123; return null ; &#125; while(post !=null)&#123; cur = cur.next; post = post.next ; &#125; return cur ; &#125;&#125; æ ‘çš„å­ç»“æ„é¢˜ç›®æè¿°è¾“å…¥ä¸¤æ£µäºŒå‰æ ‘Aï¼ŒBï¼Œåˆ¤æ–­Bæ˜¯ä¸æ˜¯Açš„å­ç»“æ„ã€‚ï¼ˆpsï¼šæˆ‘ä»¬çº¦å®šç©ºæ ‘ä¸æ˜¯ä»»æ„ä¸€ä¸ªæ ‘çš„å­ç»“æ„ï¼‰ é—®é¢˜åˆ†æå­¦ä¼šæŠŠé—®é¢˜åˆ†è§£ã€‚å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œåˆ†æˆä¸¤ä¸ªå­é—®é¢˜ï¼š1. éå†Aæ ‘ï¼Œçœ‹å½“å‰èŠ‚ç‚¹å’ŒBæ ‘çš„æ ¹èŠ‚ç‚¹æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰ï¼Œç»§ç»­çœ‹Aå½“å‰èŠ‚ç‚¹çš„å·¦å³å­æ ‘å’ŒBçš„å·¦å³å­æ ‘ç»“æ„æ˜¯å¦ä¸€æ ·ï¼Œæ³¨æ„æ˜¯ç»“æ„æ˜¯å¦ä¸€æ ·è€Œä¸æ˜¯åˆ¤æ–­å·¦å³å­æ ‘æ˜¯å¦ç›¸ç­‰ï¼Œå› ä¸ºé¢˜ç›®é—®çš„æ˜¯å­ç»“æ„ï¼Œè€Œä¸æ˜¯å­æ ‘ã€‚ äºŒå‰æ ‘é•œåƒé¢˜ç›®æè¿°æ“ä½œç»™å®šçš„äºŒå‰æ ‘ï¼Œå°†å…¶å˜æ¢ä¸ºæºäºŒå‰æ ‘çš„é•œåƒã€‚ è¾“å…¥æè¿°:123456789101112äºŒå‰æ ‘çš„é•œåƒå®šä¹‰ï¼šæºäºŒå‰æ ‘ 8 / \\ 6 10 / \\ / \\ 5 7 9 11 é•œåƒäºŒå‰æ ‘ 8 / \\ 10 6 / \\ / \\ 11 9 7 5 é—®é¢˜åˆ†æäºŒå‰æ ‘æ˜¯ä¸€ç§é€’å½’ç»“æ„ï¼Œå…³äºå®ƒçš„é—®é¢˜ä¸€èˆ¬éƒ½æ˜¯æœ‰æ¡†æ¶å¯å¾ªçš„ï¼Œæ— è®ºæ˜¯è¿™é“ç¿»è½¬äºŒå‰æ ‘è¿˜æ˜¯ä¸Šé¢çš„å­ç»“æ„ã€‚å…¶æ¡†æ¶å¤§æ¦‚æ˜¯ï¼š å½“å‰èŠ‚ç‚¹åšå¥½å½“å‰èŠ‚ç‚¹çš„äº‹ï¼Œå…¶ä»–çš„äº¤ç»™é€’å½’ã€‚ é‚£ä¹ˆè¿™é“é¢˜ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå¯¹äºå½“å‰èŠ‚ç‚¹ï¼Œäº¤æ¢ä¸€ä¸‹å·¦å³æŒ‡é’ˆå°±è¡Œï¼Œå…¶ä»–çš„äº¤ç»™é€’å½’ã€‚ ä»£ç 1234567891011121314151617181920212223242526 /**public class TreeNode &#123; int val = 0; TreeNode left = null; TreeNode right = null; public TreeNode(int val) &#123; this.val = val; &#125;&#125;*/public class Solution &#123; public void Mirror(TreeNode root) &#123; if(root==null) return ; if(root!=null)&#123; TreeNode temp = root.left ; root.left= root.right; root.right = temp ; &#125; Mirror(root.left) ; Mirror(root.right) ; &#125;&#125; é¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µé¢˜ç›®æè¿°è¾“å…¥ä¸€ä¸ªçŸ©é˜µï¼ŒæŒ‰ç…§ä»å¤–å‘é‡Œä»¥é¡ºæ—¶é’ˆçš„é¡ºåºä¾æ¬¡æ‰“å°å‡ºæ¯ä¸€ä¸ªæ•°å­—ï¼Œä¾‹å¦‚ï¼Œå¦‚æœè¾“å…¥å¦‚ä¸‹4 X 4çŸ©é˜µï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 åˆ™ä¾æ¬¡æ‰“å°å‡ºæ•°å­—1,2,3,4,8,12,16,15,14,13,9,5,6,7,11,10. é—®é¢˜åˆ†ææ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºå››æ­¥ï¼Œä»å·¦åˆ°å³ï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œä»å³åˆ°å·¦ï¼Œä»ä¸‹åˆ°ä¸Šã€‚ é¡ºåºæ˜¯ä¸å˜çš„ï¼Œå˜çš„æ˜¯ä¸Šä¸‹å·¦å³çš„è¾¹ç•Œï¼Œæ¯”å¦‚ç¬¬ä¸€æ¬¡ä»å·¦åˆ°å³éå†å®Œåï¼Œé‚£ä¹ˆä¸Šç•Œå°±å¢åŠ äº†ä¸€ï¼Œä»ä¸Šåˆ°ä¸‹éå†å®Œåï¼Œåç•Œå°±ç¼©å°äº†ä¸€ï¼Œä»¥æ­¤ç±»æ¨ã€‚ ä»£ç 12345678910111213141516171819202122232425262728293031323334353637import java.util.ArrayList;public class Solution &#123; public ArrayList&lt;Integer&gt; printMatrix(int [][] matrix) &#123; ArrayList res = new ArrayList() ; int up = 0; int down = matrix.length-1 ; int left = 0 ; int right = matrix[0].length-1 ; while(true)&#123; for(int col=left; col&lt;=right; col++)&#123; res.add(matrix[up][col]) ; &#125; up++ ; if(up&gt;down) break ; for(int row=up; row&lt;=down; row++)&#123; res.add(matrix[row][right]); &#125; right--; if(right&lt;left) break ; for(int col=right; col&gt;=left; col--)&#123; res.add(matrix[down][col]); &#125; down-- ; if(down&lt;up) break ; for(int row=down; row&gt;=up; row--)&#123; res.add(matrix[row][left]) ; &#125; left++ ; if(left&gt;right) break ; &#125; return res; &#125;&#125; å­—ç¬¦ä¸²çš„æ’åˆ— é¢˜è§£åœæ›´äº†å¾ˆä¹…ï¼Œæœ€è¿‘é‡æ–°åˆ·çš„æ—¶å€™æ„Ÿè§‰æœ‰äº›ä¸œè¥¿è¿˜æ˜¯è¦æ€»ç»“ï¼Œæ‰€ä»¥ç»§ç»­å¼€å§‹ã€‚ é¢˜ç›®æè¿°è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²,æŒ‰å­—å…¸åºæ‰“å°å‡ºè¯¥å­—ç¬¦ä¸²ä¸­å­—ç¬¦çš„æ‰€æœ‰æ’åˆ—ã€‚ä¾‹å¦‚è¾“å…¥å­—ç¬¦ä¸²abc,åˆ™æ‰“å°å‡ºç”±å­—ç¬¦a,b,cæ‰€èƒ½æ’åˆ—å‡ºæ¥çš„æ‰€æœ‰å­—ç¬¦ä¸²abc,acb,bac,bca,cabå’Œcbaã€‚ é—®é¢˜åˆ†æè¿™é“é¢˜è¯´åˆ°åº•ï¼Œè¿˜æ˜¯ä¸ªå›æº¯çš„é—®é¢˜ï¼Œå›æº¯è§£æ³•ä¹‹å‰ä¹Ÿå†™åˆ°è¿‡ï¼Œæœ€éœ€è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å›æº¯å®Œä¹‹åè®°å¾—å›é€€ï¼è¿™ç‚¹å¾ˆé‡è¦ï¼Œå…·ä½“å›é€€çš„åœ°æ–¹å°±åœ¨æˆ‘ä»¬é€’å½’å‡½æ•°ç»“æŸçš„ä¸‹ä¸€è¡Œï¼Œè¿™å…¶å®å°±æ˜¯labuladongè€å“¥è®²çš„æ¡†æ¶ï¼æ¡†æ¶ï¼æ¡†æ¶ï¼å…«çš‡åé—®é¢˜ä¹Ÿæ˜¯å›æº¯ï¼Œéƒ½æ˜¯æœ‰æ¡†æ¶çš„ã€‚è¯´åˆ°è¿™é‡Œï¼Œå®‰åˆ©ä¸€æ³¢å…¬ä¼—å· labuladong, ä»¥åŠè¿™ç¯‡è®²å›æº¯çš„æ–‡ç«  ,å…¶ä¸­è¿˜æ¶‰åŠåˆ°äº†å…«çš‡åé—®é¢˜ï¼Œéå¸¸æ£’ï¼ ç„¶åç›®å‰ä¸‹é¢çš„è§£æ³•å¹¶ä¸æ˜¯æœ€ä¼˜è§£ï¼Œå› ä¸ºæœ‰é‡å¤å­—ç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘å…ˆæŠŠå­—ç¬¦æ”¾åœ¨seté‡Œå†æ“ä½œï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘é‡å¤æ‰§è¡Œçš„æ¬¡æ•°äº†ã€‚ ä»£ç 1234567891011121314151617181920212223242526272829303132333435363738394041import java.util.ArrayList;import java.util.TreeSet;public class Solution &#123;// private ArrayList&lt;String&gt; res = new ArrayList(); TreeSet&lt;String&gt; res = new TreeSet(); private StringBuilder ele = new StringBuilder(); public ArrayList&lt;String&gt; Permutation(String str) &#123; StringBuilder sb = new StringBuilder(str); for(int i=0; i&lt;sb.length(); i++)&#123; traverse(sb,i); ele.deleteCharAt(ele.length()-1); &#125; return new ArrayList&lt;&gt;(res); &#125; public void traverse(StringBuilder sbd, int loc)&#123; char prefix = sbd.charAt(loc); StringBuilder sb = new StringBuilder(sbd).deleteCharAt(loc); if(sb.length()==0)&#123; ele.append(prefix); res.add(new String(ele)); // ele.deleteCharAt(ele.length()-1); return; &#125; ele.append(prefix); for(int i=0; i&lt;sb.length(); i++)&#123; traverse(sb,i); ele.deleteCharAt(ele.length()-1); &#125; &#125; public static void main(String[] args) &#123; ArrayList&lt;String&gt; res =new Solution().Permutation(&quot;aac&quot;); for (String str: res) &#123; System.out.println(str); &#125; &#125;&#125;","categories":[{"name":"æ•°æ®ç»“æ„ä¸ç®—æ³•","slug":"æ•°æ®ç»“æ„ä¸ç®—æ³•","permalink":"http://example.com/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"å‰‘æŒ‡offer","slug":"å‰‘æŒ‡offer","permalink":"http://example.com/tags/%E5%89%91%E6%8C%87offer/"}]},{"title":"Javaä¸­çš„synchronizedå…³é”®å­—","slug":"Javaä¸­çš„synchronizedå…³é”®å­—","date":"2019-09-13T08:51:50.000Z","updated":"2023-05-29T14:17:39.315Z","comments":true,"path":"2019/09/13/Javaä¸­çš„synchronizedå…³é”®å­—/","link":"","permalink":"http://example.com/2019/09/13/Java%E4%B8%AD%E7%9A%84synchronized%E5%85%B3%E9%94%AE%E5%AD%97/","excerpt":"","text":"æœ¬æ–‡ä¸»è¦ä»ä¸¤ä¸ªæ–¹é¢è®²è§£synchronizedå…³é”®å­—ï¼Œç¬¬ä¸€ä¸ªæ˜¯ç”¨æ³•ï¼Œç¬¬äºŒä¸ªæ˜¯åŸç†ï¼Œå³ä¸ºä»€ä¹ˆsynchronizedå…³é”®å­—èƒ½å¤Ÿä¿æŒçº¿ç¨‹åŒæ­¥ã€‚ ç”¨æ³•synchronizedçš„ä¿®é¥°å¯¹è±¡ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š ä¿®é¥°ä¸€ä¸ªä»£ç å—ã€‚ synchronized(this|object) &#123;&#125;:è·å¾—å¯¹è±¡çº§çš„é”ã€‚å½“å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€å¯¹è±¡å†…çš„åŒæ­¥ä»£ç å—æ—¶ï¼Œåªèƒ½äº’æ–¥è®¿é—® synchronized(ç±».class) &#123;&#125;:è·å¾—ç±»çº§åˆ«çš„é”ã€‚å½“å¤šä¸ªçº¿ç¨‹è®¿é—®ç”±è¿™ä¸ªç±»å®šä¹‰çš„æ‰€æœ‰å¯¹è±¡çš„çš„åŒæ­¥æ–¹æ³•æ—¶ï¼Œåªèƒ½äº’æ–¥è®¿é—®ã€‚ ä¿®é¥°ä¸€ä¸ªæ–¹æ³•ã€‚ ä¿®é¥°éé™æ€æ–¹æ³•ã€‚è·å¾—å¯¹è±¡çº§çš„é”ï¼Œå½“å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€å¯¹è±¡çš„åŒæ­¥æ–¹æ³•æ—¶ï¼Œåªèƒ½äº’æ–¥è®¿é—®ã€‚ ä¿®é¥°é™æ€æ–¹æ³•ã€‚è·å¾—ç±»çº§çš„é”ï¼Œå½“å¤šä¸ªçº¿ç¨‹è®¿é—®ç”±è¿™ä¸ªç±»å®šä¹‰çš„æ‰€æœ‰å¯¹è±¡çš„çš„åŒæ­¥æ–¹æ³•æ—¶ï¼Œåªèƒ½äº’æ–¥è®¿é—®ã€‚ ä¿®é¥°ä»£ç å—è·å–å¯¹è±¡é” å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€å¯¹è±¡çš„åŒæ­¥ä»£ç å— 12345678910111213141516171819202122232425262728293031class SynTest implements Runnable &#123; @Override public void run() &#123; synchronized (this) &#123; for (int i = 0; i &lt; 5; i++) &#123; System.out.println(Thread.currentThread().getName() + &quot; &quot; + i); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;&#125;public class Test &#123; public static void main(String[] args) &#123; //å®šä¹‰å¯¹è±¡ SynTest synTest = new SynTest(); //ä¸¤ä¸ªthreadä¼ å…¥çš„æ˜¯åŒä¸€å¯¹è±¡ Thread thread1 = new Thread(synTest); Thread thread2 = new Thread(synTest); thread1.start(); thread2.start(); &#125;&#125; è¾“å‡ºï¼š 12345678910Thread-0 0Thread-0 1Thread-0 2Thread-0 3Thread-0 4Thread-1 0Thread-1 1Thread-1 2Thread-1 3Thread-1 4 å¯ä»¥çœ‹åˆ°å¯¹äºåŒä¸€å¯¹è±¡çš„åŒæ­¥ä»£ç å—ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å»è®¿é—®ã€‚ å¤šä¸ªçº¿ç¨‹è®¿é—®ä¸åŒå¯¹è±¡çš„åŒæ­¥ä»£ç å— æˆ‘ä»¬ç¨å¾®ä¿®æ”¹ä»¥ä¸‹ä¸Šè¿°ä»£ç ï¼Œåˆ†åˆ«å®šä¹‰ä¸¤ä¸ªSyntTestå¯¹è±¡ 1234567891011121314151617public class Test &#123; public static void main(String[] args) &#123; //å®šä¹‰ä¸¤ä¸ªå¯¹è±¡ SynTest synTest1 = new SynTest(); SynTest synTest2 = new SynTest(); //ä¸¤ä¸ªthreadä¼ å…¥çš„æ˜¯ä¸åŒå¯¹è±¡ Thread thread1 = new Thread(synTest1); Thread thread2 = new Thread(synTest2); thread1.start(); thread2.start(); &#125;&#125; è¾“å‡ºï¼š 12345678910Thread-0 0Thread-1 0Thread-1 1Thread-0 1Thread-0 2Thread-1 2Thread-0 3Thread-1 3Thread-1 4Thread-0 4 å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è·å–åˆ°çš„æ˜¯å¯¹è±¡çº§çš„é”ï¼Œè€Œä¸¤ä¸ªçº¿ç¨‹è®¿é—®çš„æ˜¯ä¸¤ä¸ªå¯¹è±¡é‡Œä¸åŒçš„åŒæ­¥æ–¹æ³•ï¼Œæ‰€ä»¥ä¸å­˜åœ¨åŒæ­¥é—®é¢˜ã€‚ å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€å¯¹è±¡çš„åŒæ­¥ä»£ç å—å’ŒéåŒæ­¥ä»£ç å— 123456789101112131415161718192021222324252627282930313233343536373839404142434445class SynTest implements Runnable &#123; void print1() &#123; synchronized (this) &#123; System.out.println(&quot;this is thread1&quot;); try &#123; Thread.sleep(10000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; void print2() &#123; System.out.println(&quot;this is thread2&quot;); &#125; @Override public void run() &#123; if(Thread.currentThread().getName().equals(&quot;thread1&quot;))&#123; print1(); &#125;else &#123; print2(); &#125; &#125;&#125;public class Test &#123; public static void main(String[] args) &#123; SynTest synTest = new SynTest(); //ä¸¤ä¸ªthreadä¼ å…¥çš„æ˜¯åŒä¸€å¯¹è±¡ Thread thread1 = new Thread(synTest, &quot;thread1&quot;); Thread thread2 = new Thread(synTest, &quot;thread2&quot;); thread1.start(); try &#123; Thread.sleep(5000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; thread2.start(); &#125;&#125; æˆ‘ä»¬è®©thread1åœ¨synchronizedä»£ç æ®µä¸­åœç•™åç§’é’Ÿï¼Œå¦‚æœæœ‰é˜»å¡ï¼Œé‚£ä¹ˆè¿™æ®µæ—¶é—´thread2åº”è¯¥æ˜¯ä¸ä¼šæœ‰è¾“å‡ºçš„ï¼Œå¾—ç­‰åˆ°thread1è¾“å‡ºå®Œå®ƒæ‰è¾“å‡ºã€‚è€Œäº‹å®æ˜¯ï¼š 12this is thread2this is thread1 è¯´æ˜ä¸åŒçº¿ç¨‹æ‰§è¡ŒåŒä¸€å¯¹è±¡çš„åŒæ­¥ä»£ç æ®µå’ŒéåŒæ­¥ä»£ç æ®µæ˜¯äº’ç›¸ä¸å—å¹²æ‰°çš„ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šé¢çš„ä»£ç ä¸­synchronizedä¿®é¥°çš„éƒ½æ˜¯thisï¼Œæ„å‘³è¿™è®¿é—®åŒæ­¥ä»£ç æ®µçš„çº¿ç¨‹æŒæœ‰äº†è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œé‚£ä¹ˆæ‹¬å·é‡Œçš„å¯¹è±¡å¯ä»¥æ¢æˆå…¶ä»–çš„Objectå—ï¼Œç­”æ¡ˆæ˜¯å¯ä»¥çš„ã€‚ä¸¥æ ¼æ¥è®²ï¼Œå¯¹äºä»£ç å—çš„ä½¿ç”¨åœºæ™¯æ˜¯è¿™æ ·çš„ï¼šè¿™æ¥ä¸‹æ¥çš„ä¸€å—ä»£ç é‡Œï¼Œå¯èƒ½ä¼šå¹¶å‘ä¿®æ”¹æŸä¸ªå¯¹è±¡çš„é—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥ç»™è¿™ä¸ªå¯¹è±¡åŠ é”ï¼Œä¹Ÿå°±æ˜¯æ‹¬å·é‡Œåº”è¯¥å†™çš„æ˜¯è¿™ä¸ªå¯¹è±¡ã€‚ä½†äº‹å®æ˜¯ï¼Œä½ å¯ä»¥éšä¾¿æŒ‡å®šä¸€ä¸ªå¯¹è±¡åŒ…å«çš„å˜é‡ï¼Œéƒ½å¯ä»¥èµ·åˆ°åŠ é”çš„ä½œç”¨ï¼Œæ¯”å¦‚ï¼š 1234567891011121314class Test implements Runnable&#123; private byte[] lock = new byte[0]; // ç‰¹æ®Šçš„instanceå˜é‡ public void method() &#123; synchronized(lock) &#123; // todo åŒæ­¥ä»£ç å— &#125; &#125; public void run() &#123; &#125;&#125; è‡³äºæ˜¯ä¸ºä»€ä¹ˆï¼Œæˆ‘ä»¬åœ¨åŸç†éƒ¨åˆ†ä¼šè®²åˆ°ã€‚ è·å–ç±»é” ä¸åŒçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªç±»ä¸åŒå®ä¾‹çš„åŒæ­¥ä»£ç å— 12345678910111213141516171819202122232425262728293031class SynTest implements Runnable &#123; @Override public void run() &#123; synchronized (SynTest.class) &#123; for (int i = 0; i &lt; 5; i++) &#123; System.out.println(Thread.currentThread().getName() + &quot; &quot; + i); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;&#125;public class Test &#123; public static void main(String[] args) &#123; //å®šä¹‰å¯¹è±¡ SynTest synTest1 = new SynTest(); SynTest synTest2 = new SynTest(); //ä¸¤ä¸ªthreadä¼ å…¥çš„æ˜¯ä¸åŒå¯¹è±¡ Thread thread1 = new Thread(synTest1); Thread thread2 = new Thread(synTest2); thread1.start(); thread2.start(); &#125;&#125; è¾“å‡ºï¼š 12345678910Thread-0 0Thread-0 1Thread-0 2Thread-0 3Thread-0 4Thread-1 0Thread-1 1Thread-1 2Thread-1 3Thread-1 4 å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶ä¸¤ä¸ªçº¿ç¨‹ä¼ å…¥çš„æ˜¯ä¸åŒçš„å¯¹è±¡ï¼Œä½†æ˜¯å› ä¸ºæˆ‘ä»¬çš„åŒæ­¥ä»£ç å—ä¿®é¥°çš„æ˜¯ä¸€ä¸ªç±»è€Œä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥åªè¦æ˜¯è¿™ä¸ªç±»å®šä¹‰çš„å¯¹è±¡ï¼Œåœ¨è¢«çº¿ç¨‹è®¿é—®æ—¶éƒ½éœ€è¦è·å–é”ã€‚ ä¿®é¥°æ–¹æ³•ä¿®é¥°æ–¹æ³•å’Œä¿®é¥°ä»£ç æ˜¯å·®ä¸å¤šçš„ï¼Œä»ç„¶åˆ†ä¸ºè·å–å¯¹è±¡é”å’Œè·å–ç±»é”ï¼Œåªä¸è¿‡ç²’åº¦è–›å¾®å¤§äº†ç‚¹ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°å•¦ã€‚ å®ç°ç»™å‡ºä¸‹é¢ä¸€æ®µä»£ç ï¼Œ 12345678910111213public class Test &#123; public synchronized void synMethod()&#123; System.out.println(&quot;this is a sync method&quot;); &#125; public void method2()&#123; synchronized (this)&#123; System.out.println(&quot;this is a sync block&quot;); &#125; &#125;&#125; åç¼–è¯‘åå¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºsynchronizedä¿®é¥°çš„æ–¹æ³•ï¼ŒJVMä½¿ç”¨ACC_SYNCHRONIZEDæ ‡è®°ç¬¦æ¥å®ç°åŒæ­¥ã€‚é¡ºä¾¿ä¸€æï¼Œè¿™ä¸ªæ–¹æ³•çš„æ ‡è®°ç¬¦æ˜¯ä½œä¸ºç¬¦å·å¼•ç”¨æ”¾åœ¨å¸¸é‡æ± ä¸­çš„ï¼Œå‚è€ƒè¿™ç¯‡æ–‡ç« ã€‚ å¯¹äºsynchronizedä¿®é¥°çš„ä»£ç å—ï¼Œåˆ™æ˜¯ä½¿ç”¨monitorenterå’Œmonitorexitä¸¤ä¸ªæŒ‡ä»¤æ¥å®ç°åŒæ­¥ã€‚ åŸç†å¥½ï¼Œè®²å®Œäº†synchronizedçš„ç”¨æ³•ä¹‹åï¼Œæˆ‘ä»¬å†æ¥è€ƒè™‘ä¸€ä¸‹ï¼Œsynchronizedæ˜¯å¦‚ä½•ä¿æŒçº¿ç¨‹åŒæ­¥çš„ï¼Œä¸Šæ–‡ä¸­ä¸€ç›´è®²åˆ°çš„è·å–é”ï¼Œåˆæ˜¯ä¸ªä»€ä¹ˆæ“ä½œå‘¢ã€‚ å…ˆè¯´ä¸¤ä¸ªç»“è®ºï¼š synchronizedåŸºäºmonitoræœºåˆ¶å®ç° ä»»ä½•å¯¹è±¡å‡å¯ä½œä¸ºé” è‡³äºåŸå› ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥è§£é‡Šã€‚ è¦è¯´æ˜è¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆæˆ‘ä»¬è¦ç†è§£Monitoræœºåˆ¶å’ŒJavaçš„å¯¹è±¡æ¨¡å‹ã€‚ Monitormonitorï¼Œè¢«ç¿»è¯‘æˆç›‘è§†å™¨ï¼Œæˆ–è€…ç®¡ç¨‹ã€‚å®ƒæ˜¯ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œåœ¨ä¸åŒçš„è¯­è¨€é‡Œï¼Œæœ‰ä¸åŒçš„å®ç°ã€‚ä½†æ˜¯æ— è®ºå“ªç§è¯­è¨€å®ç°ï¼Œå®ƒçš„æ ¸å¿ƒå…ƒç´ æœ‰ä»¥ä¸‹å››ç§ï¼š ç›‘è§†è€…å¯¹è±¡ (Monitor Object): è´Ÿè´£å®šä¹‰å…¬å…±çš„æ¥å£æ–¹æ³•ï¼Œè¿™äº›å…¬å…±çš„æ¥å£æ–¹æ³•ä¼šåœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹è¢«è°ƒç”¨æ‰§è¡Œã€‚ åŒæ­¥æ–¹æ³•ï¼šè¿™äº›æ–¹æ³•æ˜¯ç›‘è§†è€…å¯¹è±¡æ‰€å®šä¹‰ã€‚ä¸ºäº†é˜²æ­¢ç«äº‰æ¡ä»¶ï¼Œæ— è®ºæ˜¯å¦åŒæ—¶æœ‰å¤šä¸ªçº¿ç¨‹å¹¶å‘è°ƒç”¨åŒæ­¥æ–¹æ³•ï¼Œè¿˜æ˜¯ç›‘è§†è€…å¯¹è±¡å«æœ‰å¤šä¸ªåŒæ­¥æ–¹æ³•ï¼Œåœ¨ä»»ä¸€æ—¶é—´å†…åªæœ‰ç›‘è§†è€…å¯¹è±¡çš„ä¸€ä¸ªåŒæ­¥æ–¹æ³•èƒ½å¤Ÿè¢«æ‰§è¡Œã€‚ ç›‘è§†é” (Monitor Lock): æ¯ä¸€ä¸ªç›‘è§†è€…å¯¹è±¡éƒ½ä¼šæ‹¥æœ‰ä¸€æŠŠç›‘è§†é”ã€‚ ç›‘è§†æ¡ä»¶ (Monitor Condition): åŒæ­¥æ–¹æ³•ä½¿ç”¨ç›‘è§†é”å’Œç›‘è§†æ¡ä»¶æ¥å†³å®šæ–¹æ³•æ˜¯å¦éœ€è¦é˜»å¡æˆ–é‡æ–°æ‰§è¡Œã€‚ ä»ä¸Šé¢synchronizedå…³é”®å­—çš„ç”¨æ³•ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®synchronizedå¾€å¾€éœ€è¦æŒ‡å®šä¸€ä¸ªå¯¹è±¡ä¸ä¹‹å…³è”ï¼Œå³ä½¿å®ƒä¿®é¥°éé™æ€æ–¹æ³•ï¼Œå…³è”çš„å…¶å®æ˜¯thisã€‚è¿™é‡Œå…³è”çš„å¯¹è±¡å°±æ˜¯ç›‘è§†å™¨å¯¹è±¡monitor object, å¹¶ä¸”æˆ‘ä»¬åœ¨è¿™ä¸ªå¯¹è±¡ä¸­å®šä¹‰äº†å¾ˆå¤šç®¡ç†å’Œå”¤é†’çº¿ç¨‹çš„æ–¹æ³•ï¼Œæ¯”å¦‚wait, notify. ä½ æ˜¯ä¸æ˜¯å‘ç°äº†ä»€ä¹ˆï¼Œæ˜¯çš„æ²¡é”™ï¼Œåœ¨javaå®ç°çš„monitoræœºåˆ¶ä¸­ï¼ˆæˆ‘ä»¬ä¸Šé¢è®²äº†ä¸åŒçš„è¯­è¨€å¯¹moitoræœ‰ä¸åŒçš„å®ç°ï¼‰ï¼Œmonitor objectå…¶å®å°±æ˜¯æˆ‘ä»¬çš„java.lang.Objectç±»å®šä¹‰çš„å¯¹è±¡ã€‚ ç»§ç»­è®²ï¼Œè¿™ä¸ªç›‘è§†å™¨å¯¹è±¡æ‹¥æœ‰ä¸€æŠŠé”ï¼Œæ‰€ä»¥å¯¹äºä¸‹é¢è¿™ä¸ªä»£ç  123synchronized(obj)&#123; do something&#125; ä»»ä½•çº¿ç¨‹æƒ³è¦è®¿é—®è¿™æ®µä¸´ç•ŒåŒºï¼Œéƒ½è¦å…ˆè·å–objå¯¹è±¡çš„é”ã€‚ æˆ‘ä»¬ä¸Šé¢è®²çš„è¿™äº›ï¼Œåœ¨jvmå†…éƒ¨éƒ½æœ‰å…·ä½“çš„å®ç°ï¼Œæ˜¯åŸºäºä¸€ç§å«åšObjectMonitorçš„æ¨¡å¼å®ç°çš„ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹å®ƒçš„å¤§æ¦‚åŸç†ï¼š å½“ä¸€ä¸ªçº¿ç¨‹éœ€è¦è·å– Object çš„é”æ—¶ï¼Œä¼šè¢«æ”¾å…¥ EntrySet ä¸­è¿›è¡Œç­‰å¾…ï¼Œå¦‚æœè¯¥çº¿ç¨‹è·å–åˆ°äº†é”ï¼Œæˆä¸ºå½“å‰é”çš„ ownerã€‚å¦‚æœæ ¹æ®ç¨‹åºé€»è¾‘ï¼Œä¸€ä¸ªå·²ç»è·å¾—äº†é”çš„çº¿ç¨‹ç¼ºå°‘æŸäº›å¤–éƒ¨æ¡ä»¶ï¼Œè€Œæ— æ³•ç»§ç»­è¿›è¡Œä¸‹å»ï¼ˆä¾‹å¦‚ç”Ÿäº§è€…å‘ç°é˜Ÿåˆ—å·²æ»¡æˆ–è€…æ¶ˆè´¹è€…å‘ç°é˜Ÿåˆ—ä¸ºç©ºï¼‰ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹å¯ä»¥é€šè¿‡è°ƒç”¨ wait æ–¹æ³•å°†é”é‡Šæ”¾ï¼Œè¿›å…¥ wait set ä¸­é˜»å¡è¿›è¡Œç­‰å¾…ï¼Œå…¶å®ƒçº¿ç¨‹åœ¨è¿™ä¸ªæ—¶å€™æœ‰æœºä¼šè·å¾—é”ï¼Œå»å¹²å…¶å®ƒçš„äº‹æƒ…ï¼Œä»è€Œä½¿å¾—ä¹‹å‰ä¸æˆç«‹çš„å¤–éƒ¨æ¡ä»¶æˆç«‹ï¼Œè¿™æ ·å…ˆå‰è¢«é˜»å¡çš„çº¿ç¨‹å°±å¯ä»¥é‡æ–°è¿›å…¥ EntrySet å»ç«äº‰é”ã€‚è¿™ä¸ªå¤–éƒ¨æ¡ä»¶åœ¨ monitor æœºåˆ¶ä¸­ç§°ä¸ºæ¡ä»¶å˜é‡ã€‚ è®²åˆ°è¿™é‡Œä¹Ÿå°±å¤§æ¦‚è§£é‡Šäº†ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸Šé¢è¯´synchronizedæ˜¯åŸºäºmonitorå®ç°çš„äº†ï¼Œè¦è®°ä½ï¼Œmonitorä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„ä¸œè¥¿ï¼Œå®ƒæ˜¯ä¸€ç§æœºåˆ¶ï¼Œæˆ–è€…è¯´ä¸€ç§æ–¹æ³•è®ºï¼Œä¸åŒçš„è¯­è¨€æœ‰ä¸åŒçš„å®ç°ï¼Œåœ¨javaä¸­ï¼Œsynchronizedå…³é”®å­—å°±æ˜¯monitorçš„å…·ä½“å®ç°ã€‚åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œsynchronizedé”çš„ä¸æ˜¯åˆ«çš„ï¼Œæ˜¯å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½åªæœ‰ä¸€æŠŠé”ï¼Œå½“è¢«ä¸€ä¸ªçº¿ç¨‹è·å–åï¼Œå…¶ä»–çº¿ç¨‹æ‰§è¡Œåˆ°è¿™é‡Œä¹Ÿå°±åªèƒ½ç­‰äº†ã€‚ é‚£ä¹ˆæ€ä¹ˆæ‰ç®—ä¸€ä¸ªçº¿ç¨‹è·å–äº†é”å‘¢ï¼Œè¿™äº›ä¿¡æ¯æ˜¯å­˜å‚¨åœ¨Javaå¯¹è±¡çš„å¯¹è±¡å¤´ä¸­çš„ã€‚ Javaå¯¹è±¡æ¨¡å‹Javaå¯¹è±¡ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå¯¹è±¡å¤´ï¼Œå®ä¾‹æ•°æ®ï¼Œå¡«å……æ•°æ®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å®ä¾‹æ•°æ®å°±æ˜¯æˆ‘ä»¬è‡ªå·±codingæ—¶å†™çš„é‚£éƒ¨åˆ†ï¼Œå¡«å……æ•°æ®ä¸»è¦æ˜¯ä¸ºäº†å­—èŠ‚å¯¹é½è€Œè®¾ç½®çš„ï¼Œå°±åƒç½‘ç»œä¸­æ•°æ®æŠ¥æ ¼å¼ä¸€æ ·ã€‚è€Œå’Œsynchronizedç›¸å…³çš„ç„æœºï¼Œéƒ½è—åœ¨å¯¹è±¡å¤´é‡Œäº†ã€‚ å¯¹è±¡å¤´ç”±ä¸¤éƒ¨æ„æˆï¼šmark wordå’Œclass meta data address,å¦‚æœå¯¹è±¡æ˜¯æ•°ç»„ç±»å‹ï¼Œè¿˜ä¼šæœ‰ä¸€éƒ¨åˆ†æ¥æè¿°æ•°ç»„é•¿åº¦ã€‚ é•¿åº¦ å†…å®¹ è¯´æ˜ 1 Word Mark Word å­˜å‚¨å¯¹è±¡çš„hashcode,åˆ†ä»£å¹´é¾„å’Œé”æ ‡è®°ç­‰ä¿¡æ¯ 1 Word Class Metadata Address å­˜å‚¨æŒ‡å‘å¯¹è±¡ç±»å‹æ•°æ®çš„æŒ‡é’ˆ 1 Word Array length æ•°ç»„é•¿åº¦ å¯ä»¥çœ‹åˆ°ï¼Œå’Œé”ç›¸å…³çš„ä¿¡æ¯çš„éƒ½åœ¨Mark Wordä¸­ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬é‡ç‚¹åˆ†æçš„å¯¹è±¡ã€‚é¡ºä¾¿ä¸€æï¼ŒClass Metadata AddressæŒ‡é’ˆæŒ‡å‘å­˜å‚¨å¯¹è±¡ç±»å‹ä¿¡æ¯çš„ä½ç½®ï¼Œé‚£å¯¹è±¡ç±»å‹ä¿¡æ¯æ”¾åœ¨å“ªé‡Œå‘¢ï¼Œç†Ÿæ‚‰JVMå†…å­˜ç»“æ„çš„æœ‹å‹åº”è¯¥çŸ¥é“ï¼Œæ˜¯æ”¾åœ¨æ–¹æ³•åŒºçš„ã€‚ ä¸‹é¢æˆ‘ä»¬é‡ç‚¹ç ”ç©¶Mark Word. ä¸Šé¢æˆ‘ä»¬è¯´åˆ°ï¼Œmark wordé‡Œé¢å­˜å‚¨äº†ç›¸å…³çš„é”ä¿¡æ¯ï¼Œé‚£å…·ä½“çš„ç»“æ„æ˜¯æ€æ ·çš„å‘¢ã€‚ ä¸‹å›¾æè¿°äº†32ä½è™šæ‹Ÿæœºä¸Šï¼Œå¯¹è±¡åœ¨ä¸åŒçŠ¶æ€ä¸‹mark wordé‡Œé¢çš„æƒ…å†µï¼š å…¶ä¸­è½»é‡çº§é”å’Œåå‘é”æ˜¯Java 6 å¯¹ synchronized é”è¿›è¡Œä¼˜åŒ–åæ–°å¢åŠ çš„ã€‚ æ— é” æ— é”æ²¡æœ‰å¯¹èµ„æºè¿›è¡Œé”å®šï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½èƒ½è®¿é—®å¹¶ä¿®æ”¹åŒä¸€ä¸ªèµ„æºï¼Œä½†åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹æˆåŠŸã€‚ æ— é”çš„ç‰¹ç‚¹å°±æ˜¯ä¿®æ”¹æ“ä½œåœ¨å¾ªç¯å†…è¿›è¡Œï¼Œçº¿ç¨‹ä¼šä¸æ–­çš„å°è¯•ä¿®æ”¹å…±äº«èµ„æºã€‚å¦‚æœæ²¡æœ‰å†²çªå°±ä¿®æ”¹æˆåŠŸå¹¶é€€å‡ºï¼Œå¦åˆ™å°±ä¼šç»§ç»­å¾ªç¯å°è¯•ã€‚å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹ä¿®æ”¹åŒä¸€ä¸ªå€¼ï¼Œå¿…å®šä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹æˆåŠŸï¼Œè€Œå…¶ä»–ä¿®æ”¹å¤±è´¥çš„çº¿ç¨‹ä¼šä¸æ–­é‡è¯•ç›´åˆ°ä¿®æ”¹æˆåŠŸã€‚ä¸Šé¢æˆ‘ä»¬ä»‹ç»çš„CASåŸç†åŠåº”ç”¨å³æ˜¯æ— é”çš„å®ç°ã€‚æ— é”æ— æ³•å…¨é¢ä»£æ›¿æœ‰é”ï¼Œä½†æ— é”åœ¨æŸäº›åœºåˆä¸‹çš„æ€§èƒ½æ˜¯éå¸¸é«˜çš„ã€‚ åå‘é” åå‘é”æ˜¯æŒ‡ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¼šè‡ªåŠ¨è·å–é”ï¼Œé™ä½è·å–é”çš„ä»£ä»·ã€‚ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œæ‰€ä»¥å‡ºç°äº†åå‘é”ã€‚å…¶ç›®æ ‡å°±æ˜¯åœ¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥ä»£ç å—æ—¶èƒ½å¤Ÿæé«˜æ€§èƒ½ã€‚ å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç å—å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨Mark Wordé‡Œå­˜å‚¨é”åå‘çš„çº¿ç¨‹IDã€‚åœ¨çº¿ç¨‹è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸å†é€šè¿‡CASæ“ä½œæ¥åŠ é”å’Œè§£é”ï¼Œè€Œæ˜¯æ£€æµ‹Mark Wordé‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚å¼•å…¥åå‘é”æ˜¯ä¸ºäº†åœ¨æ— å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹å°½é‡å‡å°‘ä¸å¿…è¦çš„è½»é‡çº§é”æ‰§è¡Œè·¯å¾„ï¼Œå› ä¸ºè½»é‡çº§é”çš„è·å–åŠé‡Šæ”¾ä¾èµ–å¤šæ¬¡CASåŸå­æŒ‡ä»¤ï¼Œè€Œåå‘é”åªéœ€è¦åœ¨ç½®æ¢ThreadIDçš„æ—¶å€™ä¾èµ–ä¸€æ¬¡CASåŸå­æŒ‡ä»¤å³å¯ã€‚ åå‘é”åªæœ‰é‡åˆ°å…¶ä»–çº¿ç¨‹å°è¯•ç«äº‰åå‘é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ï¼Œçº¿ç¨‹ä¸ä¼šä¸»åŠ¨é‡Šæ”¾åå‘é”ã€‚åå‘é”çš„æ’¤é”€ï¼Œéœ€è¦ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹ï¼ˆåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šæ²¡æœ‰å­—èŠ‚ç æ­£åœ¨æ‰§è¡Œï¼‰ï¼Œå®ƒä¼šé¦–å…ˆæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œåˆ¤æ–­é”å¯¹è±¡æ˜¯å¦å¤„äºè¢«é”å®šçŠ¶æ€ã€‚æ’¤é”€åå‘é”åæ¢å¤åˆ°æ— é”ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ01â€ï¼‰æˆ–è½»é‡çº§é”ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ00â€ï¼‰çš„çŠ¶æ€ã€‚ åå‘é”åœ¨JDK 6åŠä»¥åçš„JVMé‡Œæ˜¯é»˜è®¤å¯ç”¨çš„ã€‚å¯ä»¥é€šè¿‡JVMå‚æ•°å…³é—­åå‘é”ï¼š-XX:-UseBiasedLocking=falseï¼Œå…³é—­ä¹‹åç¨‹åºé»˜è®¤ä¼šè¿›å…¥è½»é‡çº§é”çŠ¶æ€ã€‚ è½»é‡çº§é” æ˜¯æŒ‡å½“é”æ˜¯åå‘é”çš„æ—¶å€™ï¼Œè¢«å¦å¤–çš„çº¿ç¨‹æ‰€è®¿é—®ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚ åœ¨ä»£ç è¿›å…¥åŒæ­¥å—çš„æ—¶å€™ï¼Œå¦‚æœåŒæ­¥å¯¹è±¡é”çŠ¶æ€ä¸ºæ— é”çŠ¶æ€ï¼ˆé”æ ‡å¿—ä½ä¸ºâ€œ01â€çŠ¶æ€ï¼Œæ˜¯å¦ä¸ºåå‘é”ä¸ºâ€œ0â€ï¼‰ï¼Œè™šæ‹Ÿæœºé¦–å…ˆå°†åœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ä¸ªåä¸ºé”è®°å½•ï¼ˆLock Recordï¼‰çš„ç©ºé—´ï¼Œç”¨äºå­˜å‚¨é”å¯¹è±¡ç›®å‰çš„Mark Wordçš„æ‹·è´ï¼Œç„¶åæ‹·è´å¯¹è±¡å¤´ä¸­çš„Mark Wordå¤åˆ¶åˆ°é”è®°å½•ä¸­ã€‚ æ‹·è´æˆåŠŸåï¼Œè™šæ‹Ÿæœºå°†ä½¿ç”¨CASæ“ä½œå°è¯•å°†å¯¹è±¡çš„Mark Wordæ›´æ–°ä¸ºæŒ‡å‘Lock Recordçš„æŒ‡é’ˆï¼Œå¹¶å°†Lock Recordé‡Œçš„owneræŒ‡é’ˆæŒ‡å‘å¯¹è±¡çš„Mark Wordã€‚ å¦‚æœè¿™ä¸ªæ›´æ–°åŠ¨ä½œæˆåŠŸäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±æ‹¥æœ‰äº†è¯¥å¯¹è±¡çš„é”ï¼Œå¹¶ä¸”å¯¹è±¡Mark Wordçš„é”æ ‡å¿—ä½è®¾ç½®ä¸ºâ€œ00â€ï¼Œè¡¨ç¤ºæ­¤å¯¹è±¡å¤„äºè½»é‡çº§é”å®šçŠ¶æ€ã€‚ å¦‚æœè½»é‡çº§é”çš„æ›´æ–°æ“ä½œå¤±è´¥äº†ï¼Œè™šæ‹Ÿæœºé¦–å…ˆä¼šæ£€æŸ¥å¯¹è±¡çš„Mark Wordæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„æ ˆå¸§ï¼Œå¦‚æœæ˜¯å°±è¯´æ˜å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œé‚£å°±å¯ä»¥ç›´æ¥è¿›å…¥åŒæ­¥å—ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™è¯´æ˜å¤šä¸ªçº¿ç¨‹ç«äº‰é”ã€‚ è‹¥å½“å‰åªæœ‰ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼Œåˆ™è¯¥çº¿ç¨‹é€šè¿‡è‡ªæ—‹è¿›è¡Œç­‰å¾…ã€‚ä½†æ˜¯å½“è‡ªæ—‹è¶…è¿‡ä¸€å®šçš„æ¬¡æ•°ï¼Œæˆ–è€…ä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰é”ï¼Œä¸€ä¸ªåœ¨è‡ªæ—‹ï¼Œåˆæœ‰ç¬¬ä¸‰ä¸ªæ¥è®¿æ—¶ï¼Œè½»é‡çº§é”å‡çº§ä¸ºé‡é‡çº§é”ã€‚ é‡é‡çº§é” å‡çº§ä¸ºé‡é‡çº§é”æ—¶ï¼Œé”æ ‡å¿—çš„çŠ¶æ€å€¼å˜ä¸ºâ€œ10â€ï¼Œæ­¤æ—¶Mark Wordä¸­å­˜å‚¨çš„æ˜¯æŒ‡å‘é‡é‡çº§é”çš„æŒ‡é’ˆï¼Œæ­¤æ—¶ç­‰å¾…é”çš„çº¿ç¨‹éƒ½ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ã€‚ æ•´ä½“çš„é”çŠ¶æ€å‡çº§æµç¨‹å¦‚ä¸‹ï¼š ç»¼ä¸Šï¼Œåå‘é”é€šè¿‡å¯¹æ¯”Mark Wordè§£å†³åŠ é”é—®é¢˜ï¼Œé¿å…æ‰§è¡ŒCASæ“ä½œã€‚è€Œè½»é‡çº§é”æ˜¯é€šè¿‡ç”¨CASæ“ä½œå’Œè‡ªæ—‹æ¥è§£å†³åŠ é”é—®é¢˜ï¼Œé¿å…çº¿ç¨‹é˜»å¡å’Œå”¤é†’è€Œå½±å“æ€§èƒ½ã€‚é‡é‡çº§é”æ˜¯å°†é™¤äº†æ‹¥æœ‰é”çš„çº¿ç¨‹ä»¥å¤–çš„çº¿ç¨‹éƒ½é˜»å¡ã€‚ å†…å­˜è¯­ä¹‰ä»¥ä¸‹å†…å®¹æ¶‰åŠåˆ°Javaå†…å­˜æ¨¡å‹ã€‚ å¯è§æ€§å¯è§æ€§æŒ‡çš„æ˜¯ä¸€ä¸ªçº¿ç¨‹å¯¹å˜é‡çš„ä¿®æ”¹èƒ½å¤Ÿç«‹å³è¢«å¦ä¸€ä¸ªçº¿ç¨‹çœ‹è§ã€‚ ä¸ºäº†ä¿è¯å¯è§æ€§ï¼Œå¯¹synchronizedä¿®é¥°çš„ä»£ç æœ‰è¿™æ ·ä¸€æ¡è§„åˆ™ï¼šå¯¹ä¸€ä¸ªå˜é‡è§£é”ä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠæ­¤å˜é‡åŒæ­¥å›ä¸»å­˜ä¸­ã€‚è¿™æ ·è§£é”åï¼Œåç»­çº¿ç¨‹å°±å¯ä»¥è®¿é—®åˆ°è¢«ä¿®æ”¹åçš„å€¼ã€‚ åŸå­æ€§synchronizedå¯¹è¦è®¿é—®çš„ä»£ç æ®µåŠ é”ï¼Œè®¿é—®ç»“æŸå†é‡Šæ”¾é”ï¼Œåœ¨æ­¤æœŸé—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è®¿é—®ä»£ç å—ï¼Œå¯ä»¥å®ç°åŸå­æ€§ã€‚ æœ‰åºæ€§synchronizedä¿è¯çš„æœ‰åºæ€§æ˜¯å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„æœ‰åºæ€§ï¼Œå³è¢«åŠ é”çš„å†…å®¹è¦æŒ‰ç…§é¡ºåºè¢«å¤šä¸ªçº¿ç¨‹æ‰§è¡Œã€‚ä½†æ˜¯å…¶å†…éƒ¨çš„åŒæ­¥ä»£ç è¿˜æ˜¯ä¼šå‘ç”Ÿé‡æ’åºï¼Œåªä¸è¿‡ç”±äºç¼–è¯‘å™¨å’Œå¤„ç†å™¨éƒ½éµå¾ªas-if-serialè¯­ä¹‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¤ä¸ºè¿™äº›é‡æ’åºåœ¨å•çº¿ç¨‹å†…éƒ¨å¯å¿½ç•¥ã€‚ å‚è€ƒæ¢ç´¢ Java åŒæ­¥æœºåˆ¶ Java ä¸­çš„ Monitor æœºåˆ¶ ä¸å¯ä¸è¯´çš„Javaâ€œé”â€äº‹ æ—¢ç”Ÿsynchronizedï¼Œä½•ç”Ÿvolatile","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"å…³é”®å­—","slug":"å…³é”®å­—","permalink":"http://example.com/tags/%E5%85%B3%E9%94%AE%E5%AD%97/"}]},{"title":"Javaä¸­çš„é”","slug":"Javaä¸­çš„é”","date":"2019-09-13T02:08:56.000Z","updated":"2019-09-13T02:08:56.000Z","comments":true,"path":"2019/09/13/Javaä¸­çš„é”/","link":"","permalink":"http://example.com/2019/09/13/Java%E4%B8%AD%E7%9A%84%E9%94%81/","excerpt":"","text":"æœ¬æ–‡è½¬è‡ªï¼šä¸å¯ä¸è¯´çš„Javaâ€œé”â€äº‹ å‰è¨€Javaæä¾›äº†ç§ç±»ä¸°å¯Œçš„é”ï¼Œæ¯ç§é”å› å…¶ç‰¹æ€§çš„ä¸åŒï¼Œåœ¨é€‚å½“çš„åœºæ™¯ä¸‹èƒ½å¤Ÿå±•ç°å‡ºéå¸¸é«˜çš„æ•ˆç‡ã€‚æœ¬æ–‡æ—¨åœ¨å¯¹é”ç›¸å…³æºç ï¼ˆæœ¬æ–‡ä¸­çš„æºç æ¥è‡ªJDK 8å’ŒNetty 3.10.6ï¼‰ã€ä½¿ç”¨åœºæ™¯è¿›è¡Œä¸¾ä¾‹ï¼Œä¸ºè¯»è€…ä»‹ç»ä¸»æµé”çš„çŸ¥è¯†ç‚¹ï¼Œä»¥åŠä¸åŒçš„é”çš„é€‚ç”¨åœºæ™¯ã€‚ Javaä¸­å¾€å¾€æ˜¯æŒ‰ç…§æ˜¯å¦å«æœ‰æŸä¸€ç‰¹æ€§æ¥å®šä¹‰é”ï¼Œæˆ‘ä»¬é€šè¿‡ç‰¹æ€§å°†é”è¿›è¡Œåˆ†ç»„å½’ç±»ï¼Œå†ä½¿ç”¨å¯¹æ¯”çš„æ–¹å¼è¿›è¡Œä»‹ç»ï¼Œå¸®åŠ©å¤§å®¶æ›´å¿«æ·çš„ç†è§£ç›¸å…³çŸ¥è¯†ã€‚ä¸‹é¢ç»™å‡ºæœ¬æ–‡å†…å®¹çš„æ€»ä½“åˆ†ç±»ç›®å½•ï¼š 1. ä¹è§‚é” VS æ‚²è§‚é”ä¹è§‚é”ä¸æ‚²è§‚é”æ˜¯ä¸€ç§å¹¿ä¹‰ä¸Šçš„æ¦‚å¿µï¼Œä½“ç°äº†çœ‹å¾…çº¿ç¨‹åŒæ­¥çš„ä¸åŒè§’åº¦ã€‚åœ¨Javaå’Œæ•°æ®åº“ä¸­éƒ½æœ‰æ­¤æ¦‚å¿µå¯¹åº”çš„å®é™…åº”ç”¨ã€‚ å…ˆè¯´æ¦‚å¿µã€‚å¯¹äºåŒä¸€ä¸ªæ•°æ®çš„å¹¶å‘æ“ä½œï¼Œæ‚²è§‚é”è®¤ä¸ºè‡ªå·±åœ¨ä½¿ç”¨æ•°æ®çš„æ—¶å€™ä¸€å®šæœ‰åˆ«çš„çº¿ç¨‹æ¥ä¿®æ”¹æ•°æ®ï¼Œå› æ­¤åœ¨è·å–æ•°æ®çš„æ—¶å€™ä¼šå…ˆåŠ é”ï¼Œç¡®ä¿æ•°æ®ä¸ä¼šè¢«åˆ«çš„çº¿ç¨‹ä¿®æ”¹ã€‚Javaä¸­ï¼Œsynchronizedå…³é”®å­—å’ŒLockçš„å®ç°ç±»éƒ½æ˜¯æ‚²è§‚é”ã€‚ è€Œä¹è§‚é”è®¤ä¸ºè‡ªå·±åœ¨ä½¿ç”¨æ•°æ®æ—¶ä¸ä¼šæœ‰åˆ«çš„çº¿ç¨‹ä¿®æ”¹æ•°æ®ï¼Œæ‰€ä»¥ä¸ä¼šæ·»åŠ é”ï¼Œåªæ˜¯åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™å»åˆ¤æ–­ä¹‹å‰æœ‰æ²¡æœ‰åˆ«çš„çº¿ç¨‹æ›´æ–°äº†è¿™ä¸ªæ•°æ®ã€‚å¦‚æœè¿™ä¸ªæ•°æ®æ²¡æœ‰è¢«æ›´æ–°ï¼Œå½“å‰çº¿ç¨‹å°†è‡ªå·±ä¿®æ”¹çš„æ•°æ®æˆåŠŸå†™å…¥ã€‚å¦‚æœæ•°æ®å·²ç»è¢«å…¶ä»–çº¿ç¨‹æ›´æ–°ï¼Œåˆ™æ ¹æ®ä¸åŒçš„å®ç°æ–¹å¼æ‰§è¡Œä¸åŒçš„æ“ä½œï¼ˆä¾‹å¦‚æŠ¥é”™æˆ–è€…è‡ªåŠ¨é‡è¯•ï¼‰ã€‚ ä¹è§‚é”åœ¨Javaä¸­æ˜¯é€šè¿‡ä½¿ç”¨æ— é”ç¼–ç¨‹æ¥å®ç°ï¼Œæœ€å¸¸é‡‡ç”¨çš„æ˜¯CASç®—æ³•ï¼ŒJavaåŸå­ç±»ä¸­çš„é€’å¢æ“ä½œå°±é€šè¿‡CASè‡ªæ—‹å®ç°çš„ã€‚ æ ¹æ®ä»ä¸Šé¢çš„æ¦‚å¿µæè¿°æˆ‘ä»¬å¯ä»¥å‘ç°ï¼š æ‚²è§‚é”é€‚åˆå†™æ“ä½œå¤šçš„åœºæ™¯ï¼Œå…ˆåŠ é”å¯ä»¥ä¿è¯å†™æ“ä½œæ—¶æ•°æ®æ­£ç¡®ã€‚ ä¹è§‚é”é€‚åˆè¯»æ“ä½œå¤šçš„åœºæ™¯ï¼Œä¸åŠ é”çš„ç‰¹ç‚¹èƒ½å¤Ÿä½¿å…¶è¯»æ“ä½œçš„æ€§èƒ½å¤§å¹…æå‡ã€‚ å…‰è¯´æ¦‚å¿µæœ‰äº›æŠ½è±¡ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä¹è§‚é”å’Œæ‚²è§‚é”çš„è°ƒç”¨æ–¹å¼ç¤ºä¾‹ï¼š 12345678910111213141516// ------------------------- æ‚²è§‚é”çš„è°ƒç”¨æ–¹å¼ -------------------------// synchronizedpublic synchronized void testMethod() &#123; // æ“ä½œåŒæ­¥èµ„æº&#125;// ReentrantLockprivate ReentrantLock lock = new ReentrantLock(); // éœ€è¦ä¿è¯å¤šä¸ªçº¿ç¨‹ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªé”public void modifyPublicResources() &#123; lock.lock(); // æ“ä½œåŒæ­¥èµ„æº lock.unlock();&#125;// ------------------------- ä¹è§‚é”çš„è°ƒç”¨æ–¹å¼ -------------------------private AtomicInteger atomicInteger = new AtomicInteger(); // éœ€è¦ä¿è¯å¤šä¸ªçº¿ç¨‹ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªAtomicIntegeratomicInteger.incrementAndGet(); //æ‰§è¡Œè‡ªå¢1 é€šè¿‡è°ƒç”¨æ–¹å¼ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æ‚²è§‚é”åŸºæœ¬éƒ½æ˜¯åœ¨æ˜¾å¼çš„é”å®šä¹‹åå†æ“ä½œåŒæ­¥èµ„æºï¼Œè€Œä¹è§‚é”åˆ™ç›´æ¥å»æ“ä½œåŒæ­¥èµ„æºã€‚é‚£ä¹ˆï¼Œä¸ºä½•ä¹è§‚é”èƒ½å¤Ÿåšåˆ°ä¸é”å®šåŒæ­¥èµ„æºä¹Ÿå¯ä»¥æ­£ç¡®çš„å®ç°çº¿ç¨‹åŒæ­¥å‘¢ï¼Ÿæˆ‘ä»¬é€šè¿‡ä»‹ç»ä¹è§‚é”çš„ä¸»è¦å®ç°æ–¹å¼ â€œCASâ€ çš„æŠ€æœ¯åŸç†æ¥ä¸ºå¤§å®¶è§£æƒ‘ã€‚ CASå…¨ç§° Compare And Swapï¼ˆæ¯”è¾ƒä¸äº¤æ¢ï¼‰ï¼Œæ˜¯ä¸€ç§æ— é”ç®—æ³•ã€‚åœ¨ä¸ä½¿ç”¨é”ï¼ˆæ²¡æœ‰çº¿ç¨‹è¢«é˜»å¡ï¼‰çš„æƒ…å†µä¸‹å®ç°å¤šçº¿ç¨‹ä¹‹é—´çš„å˜é‡åŒæ­¥ã€‚java.util.concurrentåŒ…ä¸­çš„åŸå­ç±»å°±æ˜¯é€šè¿‡CASæ¥å®ç°äº†ä¹è§‚é”ã€‚ CASç®—æ³•æ¶‰åŠåˆ°ä¸‰ä¸ªæ“ä½œæ•°ï¼š éœ€è¦è¯»å†™çš„å†…å­˜å€¼ Vã€‚ è¿›è¡Œæ¯”è¾ƒçš„å€¼ Aã€‚ è¦å†™å…¥çš„æ–°å€¼ Bã€‚ å½“ä¸”ä»…å½“ V çš„å€¼ç­‰äº A æ—¶ï¼ŒCASé€šè¿‡åŸå­æ–¹å¼ç”¨æ–°å€¼Bæ¥æ›´æ–°Vçš„å€¼ï¼ˆâ€œæ¯”è¾ƒ+æ›´æ–°â€æ•´ä½“æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼‰ï¼Œå¦åˆ™ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œâ€œæ›´æ–°â€æ˜¯ä¸€ä¸ªä¸æ–­é‡è¯•çš„æ“ä½œã€‚ ä¹‹å‰æåˆ°java.util.concurrentåŒ…ä¸­çš„åŸå­ç±»ï¼Œå°±æ˜¯é€šè¿‡CASæ¥å®ç°äº†ä¹è§‚é”ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿›å…¥åŸå­ç±»AtomicIntegerçš„æºç ï¼Œçœ‹ä¸€ä¸‹AtomicIntegerçš„å®šä¹‰ï¼š æ ¹æ®å®šä¹‰æˆ‘ä»¬å¯ä»¥çœ‹å‡ºå„å±æ€§çš„ä½œç”¨ï¼š unsafeï¼š è·å–å¹¶æ“ä½œå†…å­˜çš„æ•°æ®ã€‚ valueOffsetï¼š å­˜å‚¨valueåœ¨AtomicIntegerä¸­çš„åç§»é‡ã€‚ valueï¼š å­˜å‚¨AtomicIntegerçš„intå€¼ï¼Œè¯¥å±æ€§éœ€è¦å€ŸåŠ©volatileå…³é”®å­—ä¿è¯å…¶åœ¨çº¿ç¨‹é—´æ˜¯å¯è§çš„ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŸ¥çœ‹AtomicIntegerçš„è‡ªå¢å‡½æ•°incrementAndGet()çš„æºç æ—¶ï¼Œå‘ç°è‡ªå¢å‡½æ•°åº•å±‚è°ƒç”¨çš„æ˜¯unsafe.getAndAddInt()ã€‚ä½†æ˜¯ç”±äºJDKæœ¬èº«åªæœ‰Unsafe.classï¼Œåªé€šè¿‡classæ–‡ä»¶ä¸­çš„å‚æ•°åï¼Œå¹¶ä¸èƒ½å¾ˆå¥½çš„äº†è§£æ–¹æ³•çš„ä½œç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡OpenJDK 8 æ¥æŸ¥çœ‹Unsafeçš„æºç ï¼š 123456789101112131415161718192021222324// ------------------------- JDK 8 -------------------------// AtomicInteger è‡ªå¢æ–¹æ³•public final int incrementAndGet() &#123; return unsafe.getAndAddInt(this, valueOffset, 1) + 1;&#125;// Unsafe.classpublic final int getAndAddInt(Object var1, long var2, int var4) &#123; int var5; do &#123; var5 = this.getIntVolatile(var1, var2); &#125; while(!this.compareAndSwapInt(var1, var2, var5, var5 + var4)); return var5;&#125;// ------------------------- OpenJDK 8 -------------------------// Unsafe.javapublic final int getAndAddInt(Object o, long offset, int delta) &#123; int v; do &#123; v = getIntVolatile(o, offset); &#125; while (!compareAndSwapInt(o, offset, v, v + delta)); return v;&#125; æ ¹æ®OpenJDK 8çš„æºç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒgetAndAddInt()å¾ªç¯è·å–ç»™å®šå¯¹è±¡oä¸­çš„åç§»é‡å¤„çš„å€¼vï¼Œç„¶ååˆ¤æ–­å†…å­˜å€¼æ˜¯å¦ç­‰äºvã€‚å¦‚æœç›¸ç­‰åˆ™å°†å†…å­˜å€¼è®¾ç½®ä¸º v + deltaï¼Œå¦åˆ™è¿”å›falseï¼Œç»§ç»­å¾ªç¯è¿›è¡Œé‡è¯•ï¼Œç›´åˆ°è®¾ç½®æˆåŠŸæ‰èƒ½é€€å‡ºå¾ªç¯ï¼Œå¹¶ä¸”å°†æ—§å€¼è¿”å›ã€‚æ•´ä¸ªâ€œæ¯”è¾ƒ+æ›´æ–°â€æ“ä½œå°è£…åœ¨compareAndSwapInt()ä¸­ï¼Œåœ¨JNIé‡Œæ˜¯å€ŸåŠ©äºä¸€ä¸ªCPUæŒ‡ä»¤å®Œæˆçš„ï¼Œå±äºåŸå­æ“ä½œï¼Œå¯ä»¥ä¿è¯å¤šä¸ªçº¿ç¨‹éƒ½èƒ½å¤Ÿçœ‹åˆ°åŒä¸€ä¸ªå˜é‡çš„ä¿®æ”¹å€¼ã€‚ åç»­JDKé€šè¿‡CPUçš„cmpxchgæŒ‡ä»¤ï¼Œå»æ¯”è¾ƒå¯„å­˜å™¨ä¸­çš„ A å’Œ å†…å­˜ä¸­çš„å€¼ Vã€‚å¦‚æœç›¸ç­‰ï¼Œå°±æŠŠè¦å†™å…¥çš„æ–°å€¼ B å­˜å…¥å†…å­˜ä¸­ã€‚å¦‚æœä¸ç›¸ç­‰ï¼Œå°±å°†å†…å­˜å€¼ V èµ‹å€¼ç»™å¯„å­˜å™¨ä¸­çš„å€¼ Aã€‚ç„¶åé€šè¿‡Javaä»£ç ä¸­çš„whileå¾ªç¯å†æ¬¡è°ƒç”¨cmpxchgæŒ‡ä»¤è¿›è¡Œé‡è¯•ï¼Œç›´åˆ°è®¾ç½®æˆåŠŸä¸ºæ­¢ã€‚ CASè™½ç„¶å¾ˆé«˜æ•ˆï¼Œä½†æ˜¯å®ƒä¹Ÿå­˜åœ¨ä¸‰å¤§é—®é¢˜ï¼Œè¿™é‡Œä¹Ÿç®€å•è¯´ä¸€ä¸‹ï¼š ABAé—®é¢˜ ã€‚CASéœ€è¦åœ¨æ“ä½œå€¼çš„æ—¶å€™æ£€æŸ¥å†…å­˜å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œæ²¡æœ‰å‘ç”Ÿå˜åŒ–æ‰ä¼šæ›´æ–°å†…å­˜å€¼ã€‚ä½†æ˜¯å¦‚æœå†…å­˜å€¼åŸæ¥æ˜¯Aï¼Œåæ¥å˜æˆäº†Bï¼Œç„¶ååˆå˜æˆäº†Aï¼Œé‚£ä¹ˆCASè¿›è¡Œæ£€æŸ¥æ—¶ä¼šå‘ç°å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯æœ‰å˜åŒ–çš„ã€‚ABAé—®é¢˜çš„è§£å†³æ€è·¯å°±æ˜¯åœ¨å˜é‡å‰é¢æ·»åŠ ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å˜é‡æ›´æ–°çš„æ—¶å€™éƒ½æŠŠç‰ˆæœ¬å·åŠ ä¸€ï¼Œè¿™æ ·å˜åŒ–è¿‡ç¨‹å°±ä»â€œAï¼Bï¼Aâ€å˜æˆäº†â€œ1Aï¼2Bï¼3Aâ€ã€‚ JDKä»1.5å¼€å§‹æä¾›äº†AtomicStampedReferenceç±»æ¥è§£å†³ABAé—®é¢˜ï¼Œå…·ä½“æ“ä½œå°è£…åœ¨compareAndSet()ä¸­ã€‚compareAndSet()é¦–å…ˆæ£€æŸ¥å½“å‰å¼•ç”¨å’Œå½“å‰æ ‡å¿—ä¸é¢„æœŸå¼•ç”¨å’Œé¢„æœŸæ ‡å¿—æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœéƒ½ç›¸ç­‰ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†å¼•ç”¨å€¼å’Œæ ‡å¿—çš„å€¼è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚ å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§ã€‚CASæ“ä½œå¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šå¯¼è‡´å…¶ä¸€ç›´è‡ªæ—‹ï¼Œç»™CPUå¸¦æ¥éå¸¸å¤§çš„å¼€é”€ã€‚ åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ ã€‚å¯¹ä¸€ä¸ªå…±äº«å˜é‡æ‰§è¡Œæ“ä½œæ—¶ï¼ŒCASèƒ½å¤Ÿä¿è¯åŸå­æ“ä½œï¼Œä½†æ˜¯å¯¹å¤šä¸ªå…±äº«å˜é‡æ“ä½œæ—¶ï¼ŒCASæ˜¯æ— æ³•ä¿è¯æ“ä½œçš„åŸå­æ€§çš„ã€‚ Javaä»1.5å¼€å§‹JDKæä¾›äº†AtomicReferenceç±»æ¥ä¿è¯å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ï¼Œå¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œæ¥è¿›è¡ŒCASæ“ä½œã€‚ 2. è‡ªæ—‹é” VS é€‚åº”æ€§è‡ªæ—‹é”åœ¨ä»‹ç»è‡ªæ—‹é”å‰ï¼Œæˆ‘ä»¬éœ€è¦ä»‹ç»ä¸€äº›å‰æçŸ¥è¯†æ¥å¸®åŠ©å¤§å®¶æ˜ç™½è‡ªæ—‹é”çš„æ¦‚å¿µã€‚ é˜»å¡æˆ–å”¤é†’ä¸€ä¸ªJavaçº¿ç¨‹éœ€è¦æ“ä½œç³»ç»Ÿåˆ‡æ¢CPUçŠ¶æ€æ¥å®Œæˆï¼Œè¿™ç§çŠ¶æ€è½¬æ¢éœ€è¦è€—è´¹å¤„ç†å™¨æ—¶é—´ã€‚å¦‚æœåŒæ­¥ä»£ç å—ä¸­çš„å†…å®¹è¿‡äºç®€å•ï¼ŒçŠ¶æ€è½¬æ¢æ¶ˆè€—çš„æ—¶é—´æœ‰å¯èƒ½æ¯”ç”¨æˆ·ä»£ç æ‰§è¡Œçš„æ—¶é—´è¿˜è¦é•¿ã€‚ åœ¨è®¸å¤šåœºæ™¯ä¸­ï¼ŒåŒæ­¥èµ„æºçš„é”å®šæ—¶é—´å¾ˆçŸ­ï¼Œä¸ºäº†è¿™ä¸€å°æ®µæ—¶é—´å»åˆ‡æ¢çº¿ç¨‹ï¼Œçº¿ç¨‹æŒ‚èµ·å’Œæ¢å¤ç°åœºçš„èŠ±è´¹å¯èƒ½ä¼šè®©ç³»ç»Ÿå¾—ä¸å¿å¤±ã€‚å¦‚æœç‰©ç†æœºå™¨æœ‰å¤šä¸ªå¤„ç†å™¨ï¼Œèƒ½å¤Ÿè®©ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„çº¿ç¨‹åŒæ—¶å¹¶è¡Œæ‰§è¡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥è®©åé¢é‚£ä¸ªè¯·æ±‚é”çš„çº¿ç¨‹ä¸æ”¾å¼ƒCPUçš„æ‰§è¡Œæ—¶é—´ï¼Œçœ‹çœ‹æŒæœ‰é”çš„çº¿ç¨‹æ˜¯å¦å¾ˆå¿«å°±ä¼šé‡Šæ”¾é”ã€‚ è€Œä¸ºäº†è®©å½“å‰çº¿ç¨‹â€œç¨ç­‰ä¸€ä¸‹â€ï¼Œæˆ‘ä»¬éœ€è®©å½“å‰çº¿ç¨‹è¿›è¡Œè‡ªæ—‹ï¼Œå¦‚æœåœ¨è‡ªæ—‹å®Œæˆåå‰é¢é”å®šåŒæ­¥èµ„æºçš„çº¿ç¨‹å·²ç»é‡Šæ”¾äº†é”ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°±å¯ä»¥ä¸å¿…é˜»å¡è€Œæ˜¯ç›´æ¥è·å–åŒæ­¥èµ„æºï¼Œä»è€Œé¿å…åˆ‡æ¢çº¿ç¨‹çš„å¼€é”€ã€‚è¿™å°±æ˜¯è‡ªæ—‹é”ã€‚ è‡ªæ—‹é”æœ¬èº«æ˜¯æœ‰ç¼ºç‚¹çš„ï¼Œå®ƒä¸èƒ½ä»£æ›¿é˜»å¡ã€‚è‡ªæ—‹ç­‰å¾…è™½ç„¶é¿å…äº†çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ï¼Œä½†å®ƒè¦å ç”¨å¤„ç†å™¨æ—¶é—´ã€‚å¦‚æœé”è¢«å ç”¨çš„æ—¶é—´å¾ˆçŸ­ï¼Œè‡ªæ—‹ç­‰å¾…çš„æ•ˆæœå°±ä¼šéå¸¸å¥½ã€‚åä¹‹ï¼Œå¦‚æœé”è¢«å ç”¨çš„æ—¶é—´å¾ˆé•¿ï¼Œé‚£ä¹ˆè‡ªæ—‹çš„çº¿ç¨‹åªä¼šç™½æµªè´¹å¤„ç†å™¨èµ„æºã€‚æ‰€ä»¥ï¼Œè‡ªæ—‹ç­‰å¾…çš„æ—¶é—´å¿…é¡»è¦æœ‰ä¸€å®šçš„é™åº¦ï¼Œå¦‚æœè‡ªæ—‹è¶…è¿‡äº†é™å®šæ¬¡æ•°ï¼ˆé»˜è®¤æ˜¯10æ¬¡ï¼Œå¯ä»¥ä½¿ç”¨-XX:PreBlockSpinæ¥æ›´æ”¹ï¼‰æ²¡æœ‰æˆåŠŸè·å¾—é”ï¼Œå°±åº”å½“æŒ‚èµ·çº¿ç¨‹ã€‚ è‡ªæ—‹é”çš„å®ç°åŸç†åŒæ ·ä¹Ÿæ˜¯CASï¼ŒAtomicIntegerä¸­è°ƒç”¨unsafeè¿›è¡Œè‡ªå¢æ“ä½œçš„æºç ä¸­çš„do-whileå¾ªç¯å°±æ˜¯ä¸€ä¸ªè‡ªæ—‹æ“ä½œï¼Œå¦‚æœä¿®æ”¹æ•°å€¼å¤±è´¥åˆ™é€šè¿‡å¾ªç¯æ¥æ‰§è¡Œè‡ªæ—‹ï¼Œç›´è‡³ä¿®æ”¹æˆåŠŸã€‚ è‡ªæ—‹é”åœ¨JDK1.4.2ä¸­å¼•å…¥ï¼Œä½¿ç”¨-XX:+UseSpinningæ¥å¼€å¯ã€‚JDK 6ä¸­å˜ä¸ºé»˜è®¤å¼€å¯ï¼Œå¹¶ä¸”å¼•å…¥äº†è‡ªé€‚åº”çš„è‡ªæ—‹é”ï¼ˆé€‚åº”æ€§è‡ªæ—‹é”ï¼‰ã€‚ è‡ªé€‚åº”æ„å‘³ç€è‡ªæ—‹çš„æ—¶é—´ï¼ˆæ¬¡æ•°ï¼‰ä¸å†å›ºå®šï¼Œè€Œæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šã€‚å¦‚æœåœ¨åŒä¸€ä¸ªé”å¯¹è±¡ä¸Šï¼Œè‡ªæ—‹ç­‰å¾…åˆšåˆšæˆåŠŸè·å¾—è¿‡é”ï¼Œå¹¶ä¸”æŒæœ‰é”çš„çº¿ç¨‹æ­£åœ¨è¿è¡Œä¸­ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºå°±ä¼šè®¤ä¸ºè¿™æ¬¡è‡ªæ—‹ä¹Ÿæ˜¯å¾ˆæœ‰å¯èƒ½å†æ¬¡æˆåŠŸï¼Œè¿›è€Œå®ƒå°†å…è®¸è‡ªæ—‹ç­‰å¾…æŒç»­ç›¸å¯¹æ›´é•¿çš„æ—¶é—´ã€‚å¦‚æœå¯¹äºæŸä¸ªé”ï¼Œè‡ªæ—‹å¾ˆå°‘æˆåŠŸè·å¾—è¿‡ï¼Œé‚£åœ¨ä»¥åå°è¯•è·å–è¿™ä¸ªé”æ—¶å°†å¯èƒ½çœç•¥æ‰è‡ªæ—‹è¿‡ç¨‹ï¼Œç›´æ¥é˜»å¡çº¿ç¨‹ï¼Œé¿å…æµªè´¹å¤„ç†å™¨èµ„æºã€‚ åœ¨è‡ªæ—‹é”ä¸­ å¦æœ‰ä¸‰ç§å¸¸è§çš„é”å½¢å¼:TicketLockã€CLHlockå’ŒMCSlockï¼Œæœ¬æ–‡ä¸­ä»…åšåè¯ä»‹ç»ï¼Œä¸åšæ·±å…¥è®²è§£ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡ŒæŸ¥é˜…ç›¸å…³èµ„æ–™ã€‚ 3. æ— é” VS åå‘é” VS è½»é‡çº§é” VS é‡é‡çº§é”è¿™å››ç§é”æ˜¯æŒ‡é”çš„çŠ¶æ€ï¼Œä¸“é—¨é’ˆå¯¹synchronizedçš„ã€‚åœ¨ä»‹ç»è¿™å››ç§é”çŠ¶æ€ä¹‹å‰è¿˜éœ€è¦ä»‹ç»ä¸€äº›é¢å¤–çš„çŸ¥è¯†ã€‚ é¦–å…ˆä¸ºä»€ä¹ˆSynchronizedèƒ½å®ç°çº¿ç¨‹åŒæ­¥ï¼Ÿ åœ¨å›ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰æˆ‘ä»¬éœ€è¦äº†è§£ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼šâ€œJavaå¯¹è±¡å¤´â€ã€â€œMonitorâ€ã€‚ Javaå¯¹è±¡å¤´synchronizedæ˜¯æ‚²è§‚é”ï¼Œåœ¨æ“ä½œåŒæ­¥èµ„æºä¹‹å‰éœ€è¦ç»™åŒæ­¥èµ„æºå…ˆåŠ é”ï¼Œè¿™æŠŠé”å°±æ˜¯å­˜åœ¨Javaå¯¹è±¡å¤´é‡Œçš„ï¼Œè€ŒJavaå¯¹è±¡å¤´åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ æˆ‘ä»¬ä»¥Hotspotè™šæ‹Ÿæœºä¸ºä¾‹ï¼ŒHotspotçš„å¯¹è±¡å¤´ä¸»è¦åŒ…æ‹¬ä¸¤éƒ¨åˆ†æ•°æ®ï¼šMark Wordï¼ˆæ ‡è®°å­—æ®µï¼‰ã€Klass Pointerï¼ˆç±»å‹æŒ‡é’ˆï¼‰ã€‚ Mark Wordï¼šé»˜è®¤å­˜å‚¨å¯¹è±¡çš„HashCodeï¼Œåˆ†ä»£å¹´é¾„å’Œé”æ ‡å¿—ä½ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯éƒ½æ˜¯ä¸å¯¹è±¡è‡ªèº«å®šä¹‰æ— å…³çš„æ•°æ®ï¼Œæ‰€ä»¥Mark Wordè¢«è®¾è®¡æˆä¸€ä¸ªéå›ºå®šçš„æ•°æ®ç»“æ„ä»¥ä¾¿åœ¨æå°çš„ç©ºé—´å†…å­˜å­˜å‚¨å°½é‡å¤šçš„æ•°æ®ã€‚å®ƒä¼šæ ¹æ®å¯¹è±¡çš„çŠ¶æ€å¤ç”¨è‡ªå·±çš„å­˜å‚¨ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¿è¡ŒæœŸé—´Mark Wordé‡Œå­˜å‚¨çš„æ•°æ®ä¼šéšç€é”æ ‡å¿—ä½çš„å˜åŒ–è€Œå˜åŒ–ã€‚ Klass Pointï¼šå¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚ MonitorMonitorå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªåŒæ­¥å·¥å…·æˆ–ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œé€šå¸¸è¢«æè¿°ä¸ºä¸€ä¸ªå¯¹è±¡ã€‚æ¯ä¸€ä¸ªJavaå¯¹è±¡å°±æœ‰ä¸€æŠŠçœ‹ä¸è§çš„é”ï¼Œç§°ä¸ºå†…éƒ¨é”æˆ–è€…Monitoré”ã€‚ Monitoræ˜¯çº¿ç¨‹ç§æœ‰çš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå¯ç”¨monitor recordåˆ—è¡¨ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªå…¨å±€çš„å¯ç”¨åˆ—è¡¨ã€‚æ¯ä¸€ä¸ªè¢«é”ä½çš„å¯¹è±¡éƒ½ä¼šå’Œä¸€ä¸ªmonitorå…³è”ï¼ŒåŒæ—¶monitorä¸­æœ‰ä¸€ä¸ªOwnerå­—æ®µå­˜æ”¾æ‹¥æœ‰è¯¥é”çš„çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†ï¼Œè¡¨ç¤ºè¯¥é”è¢«è¿™ä¸ªçº¿ç¨‹å ç”¨ã€‚ ç°åœ¨è¯é¢˜å›åˆ°synchronizedï¼Œsynchronizedé€šè¿‡Monitoræ¥å®ç°çº¿ç¨‹åŒæ­¥ï¼ŒMonitoræ˜¯ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„Mutex Lockï¼ˆäº’æ–¥é”ï¼‰æ¥å®ç°çš„çº¿ç¨‹åŒæ­¥ã€‚ å¦‚åŒæˆ‘ä»¬åœ¨è‡ªæ—‹é”ä¸­æåˆ°çš„â€œé˜»å¡æˆ–å”¤é†’ä¸€ä¸ªJavaçº¿ç¨‹éœ€è¦æ“ä½œç³»ç»Ÿåˆ‡æ¢CPUçŠ¶æ€æ¥å®Œæˆï¼Œè¿™ç§çŠ¶æ€è½¬æ¢éœ€è¦è€—è´¹å¤„ç†å™¨æ—¶é—´ã€‚å¦‚æœåŒæ­¥ä»£ç å—ä¸­çš„å†…å®¹è¿‡äºç®€å•ï¼ŒçŠ¶æ€è½¬æ¢æ¶ˆè€—çš„æ—¶é—´æœ‰å¯èƒ½æ¯”ç”¨æˆ·ä»£ç æ‰§è¡Œçš„æ—¶é—´è¿˜è¦é•¿â€ã€‚è¿™ç§æ–¹å¼å°±æ˜¯synchronizedæœ€åˆå®ç°åŒæ­¥çš„æ–¹å¼ï¼Œè¿™å°±æ˜¯JDK 6ä¹‹å‰synchronizedæ•ˆç‡ä½çš„åŸå› ã€‚è¿™ç§ä¾èµ–äºæ“ä½œç³»ç»ŸMutex Lockæ‰€å®ç°çš„é”æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œé‡é‡çº§é”â€ï¼ŒJDK 6ä¸­ä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¼•å…¥äº†â€œåå‘é”â€å’Œâ€œè½»é‡çº§é”â€ã€‚ æ‰€ä»¥ç›®å‰é”ä¸€å…±æœ‰4ç§çŠ¶æ€ï¼Œçº§åˆ«ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯ï¼šæ— é”ã€åå‘é”ã€è½»é‡çº§é”å’Œé‡é‡çº§é”ã€‚é”çŠ¶æ€åªèƒ½å‡çº§ä¸èƒ½é™çº§ã€‚ é€šè¿‡ä¸Šé¢çš„ä»‹ç»ï¼Œæˆ‘ä»¬å¯¹synchronizedçš„åŠ é”æœºåˆ¶ä»¥åŠç›¸å…³çŸ¥è¯†æœ‰äº†ä¸€ä¸ªäº†è§£ï¼Œé‚£ä¹ˆä¸‹é¢æˆ‘ä»¬ç»™å‡ºå››ç§é”çŠ¶æ€å¯¹åº”çš„çš„Mark Wordå†…å®¹ï¼Œç„¶åå†åˆ†åˆ«è®²è§£å››ç§é”çŠ¶æ€çš„æ€è·¯ä»¥åŠç‰¹ç‚¹ï¼š é”çŠ¶æ€ å­˜å‚¨å†…å®¹ å­˜å‚¨å†…å®¹ æ— é” å¯¹è±¡çš„hashCodeã€å¯¹è±¡åˆ†ä»£å¹´é¾„ã€æ˜¯å¦æ˜¯åå‘é”ï¼ˆ0ï¼‰ 01 åå‘é” åå‘çº¿ç¨‹IDã€åå‘æ—¶é—´æˆ³ã€å¯¹è±¡åˆ†ä»£å¹´é¾„ã€æ˜¯å¦æ˜¯åå‘é”ï¼ˆ1ï¼‰ 01 è½»é‡çº§é” æŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆ 00 é‡é‡çº§é” æŒ‡å‘äº’æ–¥é‡ï¼ˆé‡é‡çº§é”ï¼‰çš„æŒ‡é’ˆ 10 æ— é” æ— é”æ²¡æœ‰å¯¹èµ„æºè¿›è¡Œé”å®šï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½èƒ½è®¿é—®å¹¶ä¿®æ”¹åŒä¸€ä¸ªèµ„æºï¼Œä½†åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹æˆåŠŸã€‚ æ— é”çš„ç‰¹ç‚¹å°±æ˜¯ä¿®æ”¹æ“ä½œåœ¨å¾ªç¯å†…è¿›è¡Œï¼Œçº¿ç¨‹ä¼šä¸æ–­çš„å°è¯•ä¿®æ”¹å…±äº«èµ„æºã€‚å¦‚æœæ²¡æœ‰å†²çªå°±ä¿®æ”¹æˆåŠŸå¹¶é€€å‡ºï¼Œå¦åˆ™å°±ä¼šç»§ç»­å¾ªç¯å°è¯•ã€‚å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹ä¿®æ”¹åŒä¸€ä¸ªå€¼ï¼Œå¿…å®šä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹æˆåŠŸï¼Œè€Œå…¶ä»–ä¿®æ”¹å¤±è´¥çš„çº¿ç¨‹ä¼šä¸æ–­é‡è¯•ç›´åˆ°ä¿®æ”¹æˆåŠŸã€‚ä¸Šé¢æˆ‘ä»¬ä»‹ç»çš„CASåŸç†åŠåº”ç”¨å³æ˜¯æ— é”çš„å®ç°ã€‚æ— é”æ— æ³•å…¨é¢ä»£æ›¿æœ‰é”ï¼Œä½†æ— é”åœ¨æŸäº›åœºåˆä¸‹çš„æ€§èƒ½æ˜¯éå¸¸é«˜çš„ã€‚ åå‘é” åå‘é”æ˜¯æŒ‡ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¼šè‡ªåŠ¨è·å–é”ï¼Œé™ä½è·å–é”çš„ä»£ä»·ã€‚ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œæ‰€ä»¥å‡ºç°äº†åå‘é”ã€‚å…¶ç›®æ ‡å°±æ˜¯åœ¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥ä»£ç å—æ—¶èƒ½å¤Ÿæé«˜æ€§èƒ½ã€‚ å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç å—å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨Mark Wordé‡Œå­˜å‚¨é”åå‘çš„çº¿ç¨‹IDã€‚åœ¨çº¿ç¨‹è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸å†é€šè¿‡CASæ“ä½œæ¥åŠ é”å’Œè§£é”ï¼Œè€Œæ˜¯æ£€æµ‹Mark Wordé‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚å¼•å…¥åå‘é”æ˜¯ä¸ºäº†åœ¨æ— å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹å°½é‡å‡å°‘ä¸å¿…è¦çš„è½»é‡çº§é”æ‰§è¡Œè·¯å¾„ï¼Œå› ä¸ºè½»é‡çº§é”çš„è·å–åŠé‡Šæ”¾ä¾èµ–å¤šæ¬¡CASåŸå­æŒ‡ä»¤ï¼Œè€Œåå‘é”åªéœ€è¦åœ¨ç½®æ¢ThreadIDçš„æ—¶å€™ä¾èµ–ä¸€æ¬¡CASåŸå­æŒ‡ä»¤å³å¯ã€‚ åå‘é”åªæœ‰é‡åˆ°å…¶ä»–çº¿ç¨‹å°è¯•ç«äº‰åå‘é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ï¼Œçº¿ç¨‹ä¸ä¼šä¸»åŠ¨é‡Šæ”¾åå‘é”ã€‚åå‘é”çš„æ’¤é”€ï¼Œéœ€è¦ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹ï¼ˆåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šæ²¡æœ‰å­—èŠ‚ç æ­£åœ¨æ‰§è¡Œï¼‰ï¼Œå®ƒä¼šé¦–å…ˆæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œåˆ¤æ–­é”å¯¹è±¡æ˜¯å¦å¤„äºè¢«é”å®šçŠ¶æ€ã€‚æ’¤é”€åå‘é”åæ¢å¤åˆ°æ— é”ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ01â€ï¼‰æˆ–è½»é‡çº§é”ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ00â€ï¼‰çš„çŠ¶æ€ã€‚ åå‘é”åœ¨JDK 6åŠä»¥åçš„JVMé‡Œæ˜¯é»˜è®¤å¯ç”¨çš„ã€‚å¯ä»¥é€šè¿‡JVMå‚æ•°å…³é—­åå‘é”ï¼š-XX:-UseBiasedLocking=falseï¼Œå…³é—­ä¹‹åç¨‹åºé»˜è®¤ä¼šè¿›å…¥è½»é‡çº§é”çŠ¶æ€ã€‚ è½»é‡çº§é” æ˜¯æŒ‡å½“é”æ˜¯åå‘é”çš„æ—¶å€™ï¼Œè¢«å¦å¤–çš„çº¿ç¨‹æ‰€è®¿é—®ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚ åœ¨ä»£ç è¿›å…¥åŒæ­¥å—çš„æ—¶å€™ï¼Œå¦‚æœåŒæ­¥å¯¹è±¡é”çŠ¶æ€ä¸ºæ— é”çŠ¶æ€ï¼ˆé”æ ‡å¿—ä½ä¸ºâ€œ01â€çŠ¶æ€ï¼Œæ˜¯å¦ä¸ºåå‘é”ä¸ºâ€œ0â€ï¼‰ï¼Œè™šæ‹Ÿæœºé¦–å…ˆå°†åœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ä¸ªåä¸ºé”è®°å½•ï¼ˆLock Recordï¼‰çš„ç©ºé—´ï¼Œç”¨äºå­˜å‚¨é”å¯¹è±¡ç›®å‰çš„Mark Wordçš„æ‹·è´ï¼Œç„¶åæ‹·è´å¯¹è±¡å¤´ä¸­çš„Mark Wordå¤åˆ¶åˆ°é”è®°å½•ä¸­ã€‚ æ‹·è´æˆåŠŸåï¼Œè™šæ‹Ÿæœºå°†ä½¿ç”¨CASæ“ä½œå°è¯•å°†å¯¹è±¡çš„Mark Wordæ›´æ–°ä¸ºæŒ‡å‘Lock Recordçš„æŒ‡é’ˆï¼Œå¹¶å°†Lock Recordé‡Œçš„owneræŒ‡é’ˆæŒ‡å‘å¯¹è±¡çš„Mark Wordã€‚ å¦‚æœè¿™ä¸ªæ›´æ–°åŠ¨ä½œæˆåŠŸäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±æ‹¥æœ‰äº†è¯¥å¯¹è±¡çš„é”ï¼Œå¹¶ä¸”å¯¹è±¡Mark Wordçš„é”æ ‡å¿—ä½è®¾ç½®ä¸ºâ€œ00â€ï¼Œè¡¨ç¤ºæ­¤å¯¹è±¡å¤„äºè½»é‡çº§é”å®šçŠ¶æ€ã€‚ å¦‚æœè½»é‡çº§é”çš„æ›´æ–°æ“ä½œå¤±è´¥äº†ï¼Œè™šæ‹Ÿæœºé¦–å…ˆä¼šæ£€æŸ¥å¯¹è±¡çš„Mark Wordæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„æ ˆå¸§ï¼Œå¦‚æœæ˜¯å°±è¯´æ˜å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œé‚£å°±å¯ä»¥ç›´æ¥è¿›å…¥åŒæ­¥å—ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™è¯´æ˜å¤šä¸ªçº¿ç¨‹ç«äº‰é”ã€‚ è‹¥å½“å‰åªæœ‰ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼Œåˆ™è¯¥çº¿ç¨‹é€šè¿‡è‡ªæ—‹è¿›è¡Œç­‰å¾…ã€‚ä½†æ˜¯å½“è‡ªæ—‹è¶…è¿‡ä¸€å®šçš„æ¬¡æ•°ï¼Œæˆ–è€…ä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰é”ï¼Œä¸€ä¸ªåœ¨è‡ªæ—‹ï¼Œåˆæœ‰ç¬¬ä¸‰ä¸ªæ¥è®¿æ—¶ï¼Œè½»é‡çº§é”å‡çº§ä¸ºé‡é‡çº§é”ã€‚ é‡é‡çº§é” å‡çº§ä¸ºé‡é‡çº§é”æ—¶ï¼Œé”æ ‡å¿—çš„çŠ¶æ€å€¼å˜ä¸ºâ€œ10â€ï¼Œæ­¤æ—¶Mark Wordä¸­å­˜å‚¨çš„æ˜¯æŒ‡å‘é‡é‡çº§é”çš„æŒ‡é’ˆï¼Œæ­¤æ—¶ç­‰å¾…é”çš„çº¿ç¨‹éƒ½ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ã€‚ æ•´ä½“çš„é”çŠ¶æ€å‡çº§æµç¨‹å¦‚ä¸‹ï¼š ç»¼ä¸Šï¼Œåå‘é”é€šè¿‡å¯¹æ¯”Mark Wordè§£å†³åŠ é”é—®é¢˜ï¼Œé¿å…æ‰§è¡ŒCASæ“ä½œã€‚è€Œè½»é‡çº§é”æ˜¯é€šè¿‡ç”¨CASæ“ä½œå’Œè‡ªæ—‹æ¥è§£å†³åŠ é”é—®é¢˜ï¼Œé¿å…çº¿ç¨‹é˜»å¡å’Œå”¤é†’è€Œå½±å“æ€§èƒ½ã€‚é‡é‡çº§é”æ˜¯å°†é™¤äº†æ‹¥æœ‰é”çš„çº¿ç¨‹ä»¥å¤–çš„çº¿ç¨‹éƒ½é˜»å¡ã€‚ 4. å…¬å¹³é” VS éå…¬å¹³é”å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œçº¿ç¨‹ç›´æ¥è¿›å…¥é˜Ÿåˆ—ä¸­æ’é˜Ÿï¼Œé˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰èƒ½è·å¾—é”ã€‚å…¬å¹³é”çš„ä¼˜ç‚¹æ˜¯ç­‰å¾…é”çš„çº¿ç¨‹ä¸ä¼šé¥¿æ­»ã€‚ç¼ºç‚¹æ˜¯æ•´ä½“ååæ•ˆç‡ç›¸å¯¹éå…¬å¹³é”è¦ä½ï¼Œç­‰å¾…é˜Ÿåˆ—ä¸­é™¤ç¬¬ä¸€ä¸ªçº¿ç¨‹ä»¥å¤–çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šé˜»å¡ï¼ŒCPUå”¤é†’é˜»å¡çº¿ç¨‹çš„å¼€é”€æ¯”éå…¬å¹³é”å¤§ã€‚ éå…¬å¹³é”æ˜¯å¤šä¸ªçº¿ç¨‹åŠ é”æ—¶ç›´æ¥å°è¯•è·å–é”ï¼Œè·å–ä¸åˆ°æ‰ä¼šåˆ°ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿå°¾ç­‰å¾…ã€‚ä½†å¦‚æœæ­¤æ—¶é”åˆšå¥½å¯ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å¯ä»¥æ— éœ€é˜»å¡ç›´æ¥è·å–åˆ°é”ï¼Œæ‰€ä»¥éå…¬å¹³é”æœ‰å¯èƒ½å‡ºç°åç”³è¯·é”çš„çº¿ç¨‹å…ˆè·å–é”çš„åœºæ™¯ã€‚éå…¬å¹³é”çš„ä¼˜ç‚¹æ˜¯å¯ä»¥å‡å°‘å”¤èµ·çº¿ç¨‹çš„å¼€é”€ï¼Œæ•´ä½“çš„ååæ•ˆç‡é«˜ï¼Œå› ä¸ºçº¿ç¨‹æœ‰å‡ ç‡ä¸é˜»å¡ç›´æ¥è·å¾—é”ï¼ŒCPUä¸å¿…å”¤é†’æ‰€æœ‰çº¿ç¨‹ã€‚ç¼ºç‚¹æ˜¯å¤„äºç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å¯èƒ½ä¼šé¥¿æ­»ï¼Œæˆ–è€…ç­‰å¾ˆä¹…æ‰ä¼šè·å¾—é”ã€‚ ç›´æ¥ç”¨è¯­è¨€æè¿°å¯èƒ½æœ‰ç‚¹æŠ½è±¡ï¼Œè¿™é‡Œä½œè€…ç”¨ä»åˆ«å¤„çœ‹åˆ°çš„ä¸€ä¸ªä¾‹å­æ¥è®²è¿°ä¸€ä¸‹å…¬å¹³é”å’Œéå…¬å¹³é”ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå‡è®¾æœ‰ä¸€å£æ°´äº•ï¼Œæœ‰ç®¡ç†å‘˜çœ‹å®ˆï¼Œç®¡ç†å‘˜æœ‰ä¸€æŠŠé”ï¼Œåªæœ‰æ‹¿åˆ°é”çš„äººæ‰èƒ½å¤Ÿæ‰“æ°´ï¼Œæ‰“å®Œæ°´è¦æŠŠé”è¿˜ç»™ç®¡ç†å‘˜ã€‚æ¯ä¸ªè¿‡æ¥æ‰“æ°´çš„äººéƒ½è¦ç®¡ç†å‘˜çš„å…è®¸å¹¶æ‹¿åˆ°é”ä¹‹åæ‰èƒ½å»æ‰“æ°´ï¼Œå¦‚æœå‰é¢æœ‰äººæ­£åœ¨æ‰“æ°´ï¼Œé‚£ä¹ˆè¿™ä¸ªæƒ³è¦æ‰“æ°´çš„äººå°±å¿…é¡»æ’é˜Ÿã€‚ç®¡ç†å‘˜ä¼šæŸ¥çœ‹ä¸‹ä¸€ä¸ªè¦å»æ‰“æ°´çš„äººæ˜¯ä¸æ˜¯é˜Ÿä¼é‡Œæ’æœ€å‰é¢çš„äººï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œæ‰ä¼šç»™ä½ é”è®©ä½ å»æ‰“æ°´ï¼›å¦‚æœä½ ä¸æ˜¯æ’ç¬¬ä¸€çš„äººï¼Œå°±å¿…é¡»å»é˜Ÿå°¾æ’é˜Ÿï¼Œè¿™å°±æ˜¯å…¬å¹³é”ã€‚ ä½†æ˜¯å¯¹äºéå…¬å¹³é”ï¼Œç®¡ç†å‘˜å¯¹æ‰“æ°´çš„äººæ²¡æœ‰è¦æ±‚ã€‚å³ä½¿ç­‰å¾…é˜Ÿä¼é‡Œæœ‰æ’é˜Ÿç­‰å¾…çš„äººï¼Œä½†å¦‚æœåœ¨ä¸Šä¸€ä¸ªäººåˆšæ‰“å®Œæ°´æŠŠé”è¿˜ç»™ç®¡ç†å‘˜è€Œä¸”ç®¡ç†å‘˜è¿˜æ²¡æœ‰å…è®¸ç­‰å¾…é˜Ÿä¼é‡Œä¸‹ä¸€ä¸ªäººå»æ‰“æ°´æ—¶ï¼Œåˆšå¥½æ¥äº†ä¸€ä¸ªæ’é˜Ÿçš„äººï¼Œè¿™ä¸ªæ’é˜Ÿçš„äººæ˜¯å¯ä»¥ç›´æ¥ä»ç®¡ç†å‘˜é‚£é‡Œæ‹¿åˆ°é”å»æ‰“æ°´ï¼Œä¸éœ€è¦æ’é˜Ÿï¼ŒåŸæœ¬æ’é˜Ÿç­‰å¾…çš„äººåªèƒ½ç»§ç»­ç­‰å¾…ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ReentrantLockçš„æºç æ¥è®²è§£å…¬å¹³é”å’Œéå…¬å¹³é”ã€‚ æ ¹æ®ä»£ç å¯çŸ¥ï¼ŒReentrantLocké‡Œé¢æœ‰ä¸€ä¸ªå†…éƒ¨ç±»Syncï¼ŒSyncç»§æ‰¿AQSï¼ˆAbstractQueuedSynchronizerï¼‰ï¼Œæ·»åŠ é”å’Œé‡Šæ”¾é”çš„å¤§éƒ¨åˆ†æ“ä½œå®é™…ä¸Šéƒ½æ˜¯åœ¨Syncä¸­å®ç°çš„ã€‚å®ƒæœ‰å…¬å¹³é”FairSyncå’Œéå…¬å¹³é”NonfairSyncä¸¤ä¸ªå­ç±»ã€‚ReentrantLocké»˜è®¤ä½¿ç”¨éå…¬å¹³é”ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ„é€ å™¨æ¥æ˜¾ç¤ºçš„æŒ‡å®šä½¿ç”¨å…¬å¹³é”ã€‚ ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…¬å¹³é”ä¸éå…¬å¹³é”çš„åŠ é”æ–¹æ³•çš„æºç : é€šè¿‡ä¸Šå›¾ä¸­çš„æºä»£ç å¯¹æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥æ˜æ˜¾çš„çœ‹å‡ºå…¬å¹³é”ä¸éå…¬å¹³é”çš„lock()æ–¹æ³•å”¯ä¸€çš„åŒºåˆ«å°±åœ¨äºå…¬å¹³é”åœ¨è·å–åŒæ­¥çŠ¶æ€æ—¶å¤šäº†ä¸€ä¸ªé™åˆ¶æ¡ä»¶ï¼šhasQueuedPredecessors()ã€‚ å†è¿›å…¥hasQueuedPredecessors()ï¼Œå¯ä»¥çœ‹åˆ°è¯¥æ–¹æ³•ä¸»è¦åšä¸€ä»¶äº‹æƒ…ï¼šä¸»è¦æ˜¯åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä½äºåŒæ­¥é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªã€‚å¦‚æœæ˜¯åˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚ ç»¼ä¸Šï¼Œå…¬å¹³é”å°±æ˜¯é€šè¿‡åŒæ­¥é˜Ÿåˆ—æ¥å®ç°å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œä»è€Œå®ç°å…¬å¹³çš„ç‰¹æ€§ã€‚éå…¬å¹³é”åŠ é”æ—¶ä¸è€ƒè™‘æ’é˜Ÿç­‰å¾…é—®é¢˜ï¼Œç›´æ¥å°è¯•è·å–é”ï¼Œæ‰€ä»¥å­˜åœ¨åç”³è¯·å´å…ˆè·å¾—é”çš„æƒ…å†µã€‚ 5. å¯é‡å…¥é” VS éå¯é‡å…¥é”å¯é‡å…¥é”åˆåé€’å½’é”ï¼Œæ˜¯æŒ‡åœ¨åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³•è·å–é”çš„æ—¶å€™ï¼Œå†è¿›å…¥è¯¥çº¿ç¨‹çš„å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”ï¼ˆå‰æé”å¯¹è±¡å¾—æ˜¯åŒä¸€ä¸ªå¯¹è±¡æˆ–è€…classï¼‰ï¼Œä¸ä¼šå› ä¸ºä¹‹å‰å·²ç»è·å–è¿‡è¿˜æ²¡é‡Šæ”¾è€Œé˜»å¡ã€‚Javaä¸­ReentrantLockå’Œsynchronizedéƒ½æ˜¯å¯é‡å…¥é”ï¼Œå¯é‡å…¥é”çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯å¯ä¸€å®šç¨‹åº¦é¿å…æ­»é”ã€‚ä¸‹é¢ç”¨ç¤ºä¾‹ä»£ç æ¥è¿›è¡Œåˆ†æï¼š 12345678910public class Widget &#123; public synchronized void doSomething() &#123; System.out.println(&quot;æ–¹æ³•1æ‰§è¡Œ...&quot;); doOthers(); &#125; public synchronized void doOthers() &#123; System.out.println(&quot;æ–¹æ³•2æ‰§è¡Œ...&quot;); &#125;&#125; åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œç±»ä¸­çš„ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯è¢«å†…ç½®é”synchronizedä¿®é¥°çš„ï¼ŒdoSomething()æ–¹æ³•ä¸­è°ƒç”¨doOthers()æ–¹æ³•ã€‚å› ä¸ºå†…ç½®é”æ˜¯å¯é‡å…¥çš„ï¼Œæ‰€ä»¥åŒä¸€ä¸ªçº¿ç¨‹åœ¨è°ƒç”¨doOthers()æ—¶å¯ä»¥ç›´æ¥è·å¾—å½“å‰å¯¹è±¡çš„é”ï¼Œè¿›å…¥doOthers()è¿›è¡Œæ“ä½œã€‚ å¦‚æœæ˜¯ä¸€ä¸ªä¸å¯é‡å…¥é”ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹åœ¨è°ƒç”¨doOthers()ä¹‹å‰éœ€è¦å°†æ‰§è¡ŒdoSomething()æ—¶è·å–å½“å‰å¯¹è±¡çš„é”é‡Šæ”¾æ‰ï¼Œå®é™…ä¸Šè¯¥å¯¹è±¡é”å·²è¢«å½“å‰çº¿ç¨‹æ‰€æŒæœ‰ï¼Œä¸”æ— æ³•é‡Šæ”¾ã€‚æ‰€ä»¥æ­¤æ—¶ä¼šå‡ºç°æ­»é”ã€‚ è€Œä¸ºä»€ä¹ˆå¯é‡å…¥é”å°±å¯ä»¥åœ¨åµŒå¥—è°ƒç”¨æ—¶å¯ä»¥è‡ªåŠ¨è·å¾—é”å‘¢ï¼Ÿæˆ‘ä»¬é€šè¿‡å›¾ç¤ºå’Œæºç æ¥åˆ†åˆ«è§£æä¸€ä¸‹ã€‚ è¿˜æ˜¯æ‰“æ°´çš„ä¾‹å­ï¼Œæœ‰å¤šä¸ªäººåœ¨æ’é˜Ÿæ‰“æ°´ï¼Œæ­¤æ—¶ç®¡ç†å‘˜å…è®¸é”å’ŒåŒä¸€ä¸ªäººçš„å¤šä¸ªæ°´æ¡¶ç»‘å®šã€‚è¿™ä¸ªäººç”¨å¤šä¸ªæ°´æ¡¶æ‰“æ°´æ—¶ï¼Œç¬¬ä¸€ä¸ªæ°´æ¡¶å’Œé”ç»‘å®šå¹¶æ‰“å®Œæ°´ä¹‹åï¼Œç¬¬äºŒä¸ªæ°´æ¡¶ä¹Ÿå¯ä»¥ç›´æ¥å’Œé”ç»‘å®šå¹¶å¼€å§‹æ‰“æ°´ï¼Œæ‰€æœ‰çš„æ°´æ¡¶éƒ½æ‰“å®Œæ°´ä¹‹åæ‰“æ°´äººæ‰ä¼šå°†é”è¿˜ç»™ç®¡ç†å‘˜ã€‚è¿™ä¸ªäººçš„æ‰€æœ‰æ‰“æ°´æµç¨‹éƒ½èƒ½å¤ŸæˆåŠŸæ‰§è¡Œï¼Œåç»­ç­‰å¾…çš„äººä¹Ÿèƒ½å¤Ÿæ‰“åˆ°æ°´ã€‚è¿™å°±æ˜¯å¯é‡å…¥é”ã€‚ ä½†å¦‚æœæ˜¯éå¯é‡å…¥é”çš„è¯ï¼Œæ­¤æ—¶ç®¡ç†å‘˜åªå…è®¸é”å’ŒåŒä¸€ä¸ªäººçš„ä¸€ä¸ªæ°´æ¡¶ç»‘å®šã€‚ç¬¬ä¸€ä¸ªæ°´æ¡¶å’Œé”ç»‘å®šæ‰“å®Œæ°´ä¹‹åå¹¶ä¸ä¼šé‡Šæ”¾é”ï¼Œå¯¼è‡´ç¬¬äºŒä¸ªæ°´æ¡¶ä¸èƒ½å’Œé”ç»‘å®šä¹Ÿæ— æ³•æ‰“æ°´ã€‚å½“å‰çº¿ç¨‹å‡ºç°æ­»é”ï¼Œæ•´ä¸ªç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½æ— æ³•è¢«å”¤é†’ã€‚ ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ReentrantLockå’Œsynchronizedéƒ½æ˜¯é‡å…¥é”ï¼Œé‚£ä¹ˆæˆ‘ä»¬é€šè¿‡é‡å…¥é”ReentrantLockä»¥åŠéå¯é‡å…¥é”NonReentrantLockçš„æºç æ¥å¯¹æ¯”åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆéå¯é‡å…¥é”åœ¨é‡å¤è°ƒç”¨åŒæ­¥èµ„æºæ—¶ä¼šå‡ºç°æ­»é”ã€‚ é¦–å…ˆReentrantLockå’ŒNonReentrantLockéƒ½ç»§æ‰¿çˆ¶ç±»AQSï¼Œå…¶çˆ¶ç±»AQSä¸­ç»´æŠ¤äº†ä¸€ä¸ªåŒæ­¥çŠ¶æ€statusæ¥è®¡æ•°é‡å…¥æ¬¡æ•°ï¼Œstatusåˆå§‹å€¼ä¸º0ã€‚ å½“çº¿ç¨‹å°è¯•è·å–é”æ—¶ï¼Œå¯é‡å…¥é”å…ˆå°è¯•è·å–å¹¶æ›´æ–°statuså€¼ï¼Œå¦‚æœstatus == 0è¡¨ç¤ºæ²¡æœ‰å…¶ä»–çº¿ç¨‹åœ¨æ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œåˆ™æŠŠstatusç½®ä¸º1ï¼Œå½“å‰çº¿ç¨‹å¼€å§‹æ‰§è¡Œã€‚å¦‚æœstatus != 0ï¼Œåˆ™åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦æ˜¯è·å–åˆ°è¿™ä¸ªé”çš„çº¿ç¨‹ï¼Œå¦‚æœæ˜¯çš„è¯æ‰§è¡Œstatus+1ï¼Œä¸”å½“å‰çº¿ç¨‹å¯ä»¥å†æ¬¡è·å–é”ã€‚è€Œéå¯é‡å…¥é”æ˜¯ç›´æ¥å»è·å–å¹¶å°è¯•æ›´æ–°å½“å‰statusçš„å€¼ï¼Œå¦‚æœstatus != 0çš„è¯ä¼šå¯¼è‡´å…¶è·å–é”å¤±è´¥ï¼Œå½“å‰çº¿ç¨‹é˜»å¡ã€‚ é‡Šæ”¾é”æ—¶ï¼Œå¯é‡å…¥é”åŒæ ·å…ˆè·å–å½“å‰statusçš„å€¼ï¼Œåœ¨å½“å‰çº¿ç¨‹æ˜¯æŒæœ‰é”çš„çº¿ç¨‹çš„å‰æä¸‹ã€‚å¦‚æœstatus-1 == 0ï¼Œåˆ™è¡¨ç¤ºå½“å‰çº¿ç¨‹æ‰€æœ‰é‡å¤è·å–é”çš„æ“ä½œéƒ½å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œç„¶åè¯¥çº¿ç¨‹æ‰ä¼šçœŸæ­£é‡Šæ”¾é”ã€‚è€Œéå¯é‡å…¥é”åˆ™æ˜¯åœ¨ç¡®å®šå½“å‰çº¿ç¨‹æ˜¯æŒæœ‰é”çš„çº¿ç¨‹ä¹‹åï¼Œç›´æ¥å°†statusç½®ä¸º0ï¼Œå°†é”é‡Šæ”¾ã€‚ 6. ç‹¬äº«é” VS å…±äº«é”ç‹¬äº«é”å’Œå…±äº«é”åŒæ ·æ˜¯ä¸€ç§æ¦‚å¿µã€‚æˆ‘ä»¬å…ˆä»‹ç»ä¸€ä¸‹å…·ä½“çš„æ¦‚å¿µï¼Œç„¶åé€šè¿‡ReentrantLockå’ŒReentrantReadWriteLockçš„æºç æ¥ä»‹ç»ç‹¬äº«é”å’Œå…±äº«é”ã€‚ ç‹¬äº«é”ä¹Ÿå«æ’ä»–é”ï¼Œæ˜¯æŒ‡è¯¥é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚å¦‚æœçº¿ç¨‹Tå¯¹æ•°æ®AåŠ ä¸Šæ’å®ƒé”åï¼Œåˆ™å…¶ä»–çº¿ç¨‹ä¸èƒ½å†å¯¹AåŠ ä»»ä½•ç±»å‹çš„é”ã€‚è·å¾—æ’å®ƒé”çš„çº¿ç¨‹å³èƒ½è¯»æ•°æ®åˆèƒ½ä¿®æ”¹æ•°æ®ã€‚JDKä¸­çš„synchronizedå’ŒJUCä¸­Lockçš„å®ç°ç±»å°±æ˜¯äº’æ–¥é”ã€‚ å…±äº«é”æ˜¯æŒ‡è¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚å¦‚æœçº¿ç¨‹Tå¯¹æ•°æ®AåŠ ä¸Šå…±äº«é”åï¼Œåˆ™å…¶ä»–çº¿ç¨‹åªèƒ½å¯¹Aå†åŠ å…±äº«é”ï¼Œä¸èƒ½åŠ æ’å®ƒé”ã€‚è·å¾—å…±äº«é”çš„çº¿ç¨‹åªèƒ½è¯»æ•°æ®ï¼Œä¸èƒ½ä¿®æ”¹æ•°æ®ã€‚ ç‹¬äº«é”ä¸å…±äº«é”ä¹Ÿæ˜¯é€šè¿‡AQSæ¥å®ç°çš„ï¼Œé€šè¿‡å®ç°ä¸åŒçš„æ–¹æ³•ï¼Œæ¥å®ç°ç‹¬äº«æˆ–è€…å…±äº«ã€‚ ä¸‹å›¾ä¸ºReentrantReadWriteLockçš„éƒ¨åˆ†æºç ï¼š æˆ‘ä»¬çœ‹åˆ°ReentrantReadWriteLockæœ‰ä¸¤æŠŠé”ï¼šReadLockå’ŒWriteLockï¼Œç”±è¯çŸ¥æ„ï¼Œä¸€ä¸ªè¯»é”ä¸€ä¸ªå†™é”ï¼Œåˆç§°â€œè¯»å†™é”â€ã€‚å†è¿›ä¸€æ­¥è§‚å¯Ÿå¯ä»¥å‘ç°ReadLockå’ŒWriteLockæ˜¯é å†…éƒ¨ç±»Syncå®ç°çš„é”ã€‚Syncæ˜¯AQSçš„ä¸€ä¸ªå­ç±»ï¼Œè¿™ç§ç»“æ„åœ¨CountDownLatchã€ReentrantLockã€Semaphoreé‡Œé¢ä¹Ÿéƒ½å­˜åœ¨ã€‚ åœ¨ReentrantReadWriteLocké‡Œé¢ï¼Œè¯»é”å’Œå†™é”çš„é”ä¸»ä½“éƒ½æ˜¯Syncï¼Œä½†è¯»é”å’Œå†™é”çš„åŠ é”æ–¹å¼ä¸ä¸€æ ·ã€‚è¯»é”æ˜¯å…±äº«é”ï¼Œå†™é”æ˜¯ç‹¬äº«é”ã€‚è¯»é”çš„å…±äº«é”å¯ä¿è¯å¹¶å‘è¯»éå¸¸é«˜æ•ˆï¼Œè€Œè¯»å†™ã€å†™è¯»ã€å†™å†™çš„è¿‡ç¨‹äº’æ–¥ï¼Œå› ä¸ºè¯»é”å’Œå†™é”æ˜¯åˆ†ç¦»çš„ã€‚æ‰€ä»¥ReentrantReadWriteLockçš„å¹¶å‘æ€§ç›¸æ¯”ä¸€èˆ¬çš„äº’æ–¥é”æœ‰äº†å¾ˆå¤§æå‡ã€‚ é‚£è¯»é”å’Œå†™é”çš„å…·ä½“åŠ é”æ–¹å¼æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿåœ¨äº†è§£æºç ä¹‹å‰æˆ‘ä»¬éœ€è¦å›é¡¾ä¸€ä¸‹å…¶ä»–çŸ¥è¯†ã€‚ åœ¨æœ€å¼€å§‹æåŠAQSçš„æ—¶å€™æˆ‘ä»¬ä¹Ÿæåˆ°äº†stateå­—æ®µï¼ˆintç±»å‹ï¼Œ32ä½ï¼‰ï¼Œè¯¥å­—æ®µç”¨æ¥æè¿°æœ‰å¤šå°‘çº¿ç¨‹è·æŒæœ‰é”ã€‚ åœ¨ç‹¬äº«é”ä¸­è¿™ä¸ªå€¼é€šå¸¸æ˜¯0æˆ–è€…1ï¼ˆå¦‚æœæ˜¯é‡å…¥é”çš„è¯stateå€¼å°±æ˜¯é‡å…¥çš„æ¬¡æ•°ï¼‰ï¼Œåœ¨å…±äº«é”ä¸­stateå°±æ˜¯æŒæœ‰é”çš„æ•°é‡ã€‚ä½†æ˜¯åœ¨ReentrantReadWriteLockä¸­æœ‰è¯»ã€å†™ä¸¤æŠŠé”ï¼Œæ‰€ä»¥éœ€è¦åœ¨ä¸€ä¸ªæ•´å‹å˜é‡stateä¸Šåˆ†åˆ«æè¿°è¯»é”å’Œå†™é”çš„æ•°é‡ï¼ˆæˆ–è€…ä¹Ÿå¯ä»¥å«çŠ¶æ€ï¼‰ã€‚äºæ˜¯å°†stateå˜é‡â€œæŒ‰ä½åˆ‡å‰²â€åˆ‡åˆ†æˆäº†ä¸¤ä¸ªéƒ¨åˆ†ï¼Œé«˜16ä½è¡¨ç¤ºè¯»é”çŠ¶æ€ï¼ˆè¯»é”ä¸ªæ•°ï¼‰ï¼Œä½16ä½è¡¨ç¤ºå†™é”çŠ¶æ€ï¼ˆå†™é”ä¸ªæ•°ï¼‰ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š äº†è§£äº†æ¦‚å¿µä¹‹åæˆ‘ä»¬å†æ¥çœ‹ä»£ç ï¼Œå…ˆçœ‹å†™é”çš„åŠ é”æºç ï¼š 12345678910111213141516171819protected final boolean tryAcquire(int acquires) &#123; Thread current = Thread.currentThread(); int c = getState(); // å–åˆ°å½“å‰é”çš„ä¸ªæ•° int w = exclusiveCount(c); // å–å†™é”çš„ä¸ªæ•°w if (c != 0) &#123; // å¦‚æœå·²ç»æœ‰çº¿ç¨‹æŒæœ‰äº†é”(c!=0) // (Note: if c != 0 and w == 0 then shared count != 0) if (w == 0 || current != getExclusiveOwnerThread()) // å¦‚æœå†™çº¿ç¨‹æ•°ï¼ˆwï¼‰ä¸º0ï¼ˆæ¢è¨€ä¹‹å­˜åœ¨è¯»é”ï¼‰ æˆ–è€…æŒæœ‰é”çš„çº¿ç¨‹ä¸æ˜¯å½“å‰çº¿ç¨‹å°±è¿”å›å¤±è´¥ return false; if (w + exclusiveCount(acquires) &gt; MAX_COUNT) // å¦‚æœå†™å…¥é”çš„æ•°é‡å¤§äºæœ€å¤§æ•°ï¼ˆ65535ï¼Œ2çš„16æ¬¡æ–¹-1ï¼‰å°±æŠ›å‡ºä¸€ä¸ªErrorã€‚ throw new Error(&quot;Maximum lock count exceeded&quot;); // Reentrant acquire setState(c + acquires); return true; &#125; if (writerShouldBlock() || !compareAndSetState(c, c + acquires)) // å¦‚æœå½“ä¸”å†™çº¿ç¨‹æ•°ä¸º0ï¼Œå¹¶ä¸”å½“å‰çº¿ç¨‹éœ€è¦é˜»å¡é‚£ä¹ˆå°±è¿”å›å¤±è´¥ï¼›æˆ–è€…å¦‚æœé€šè¿‡CASå¢åŠ å†™çº¿ç¨‹æ•°å¤±è´¥ä¹Ÿè¿”å›å¤±è´¥ã€‚ return false; setExclusiveOwnerThread(current); // å¦‚æœc=0ï¼Œw=0æˆ–è€…c&gt;0ï¼Œw&gt;0ï¼ˆé‡å…¥ï¼‰ï¼Œåˆ™è®¾ç½®å½“å‰çº¿ç¨‹æˆ–é”çš„æ‹¥æœ‰è€… return true;&#125; è¿™æ®µä»£ç é¦–å…ˆå–åˆ°å½“å‰é”çš„ä¸ªæ•°cï¼Œç„¶åå†é€šè¿‡cæ¥è·å–å†™é”çš„ä¸ªæ•°wã€‚å› ä¸ºå†™é”æ˜¯ä½16ä½ï¼Œæ‰€ä»¥å–ä½16ä½çš„æœ€å¤§å€¼ä¸å½“å‰çš„cåšä¸è¿ç®—ï¼ˆ int w = exclusiveCountÂ©; ï¼‰ï¼Œé«˜16ä½å’Œ0ä¸è¿ç®—åæ˜¯0ï¼Œå‰©ä¸‹çš„å°±æ˜¯ä½ä½è¿ç®—çš„å€¼ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æŒæœ‰å†™é”çš„çº¿ç¨‹æ•°ç›®ã€‚ åœ¨å–åˆ°å†™é”çº¿ç¨‹çš„æ•°ç›®åï¼Œé¦–å…ˆåˆ¤æ–­æ˜¯å¦å·²ç»æœ‰çº¿ç¨‹æŒæœ‰äº†é”ã€‚å¦‚æœå·²ç»æœ‰çº¿ç¨‹æŒæœ‰äº†é”(c!=0)ï¼Œåˆ™æŸ¥çœ‹å½“å‰å†™é”çº¿ç¨‹çš„æ•°ç›®ï¼Œå¦‚æœå†™çº¿ç¨‹æ•°ä¸º0ï¼ˆå³æ­¤æ—¶å­˜åœ¨è¯»é”ï¼‰æˆ–è€…æŒæœ‰é”çš„çº¿ç¨‹ä¸æ˜¯å½“å‰çº¿ç¨‹å°±è¿”å›å¤±è´¥ï¼ˆæ¶‰åŠåˆ°å…¬å¹³é”å’Œéå…¬å¹³é”çš„å®ç°ï¼‰ã€‚ å¦‚æœå†™å…¥é”çš„æ•°é‡å¤§äºæœ€å¤§æ•°ï¼ˆ65535ï¼Œ2çš„16æ¬¡æ–¹-1ï¼‰å°±æŠ›å‡ºä¸€ä¸ªErrorã€‚ å¦‚æœå½“ä¸”å†™çº¿ç¨‹æ•°ä¸º0ï¼ˆé‚£ä¹ˆè¯»çº¿ç¨‹ä¹Ÿåº”è¯¥ä¸º0ï¼Œå› ä¸ºä¸Šé¢å·²ç»å¤„ç†c!=0çš„æƒ…å†µï¼‰ï¼Œå¹¶ä¸”å½“å‰çº¿ç¨‹éœ€è¦é˜»å¡é‚£ä¹ˆå°±è¿”å›å¤±è´¥ï¼›å¦‚æœé€šè¿‡CASå¢åŠ å†™çº¿ç¨‹æ•°å¤±è´¥ä¹Ÿè¿”å›å¤±è´¥ã€‚ å¦‚æœc=0,w=0æˆ–è€…c&gt;0,w&gt;0ï¼ˆé‡å…¥ï¼‰ï¼Œåˆ™è®¾ç½®å½“å‰çº¿ç¨‹æˆ–é”çš„æ‹¥æœ‰è€…ï¼Œè¿”å›æˆåŠŸï¼ tryAcquire()é™¤äº†é‡å…¥æ¡ä»¶ï¼ˆå½“å‰çº¿ç¨‹ä¸ºè·å–äº†å†™é”çš„çº¿ç¨‹ï¼‰ä¹‹å¤–ï¼Œå¢åŠ äº†ä¸€ä¸ªè¯»é”æ˜¯å¦å­˜åœ¨çš„åˆ¤æ–­ã€‚å¦‚æœå­˜åœ¨è¯»é”ï¼Œåˆ™å†™é”ä¸èƒ½è¢«è·å–ï¼ŒåŸå› åœ¨äºï¼šå¿…é¡»ç¡®ä¿å†™é”çš„æ“ä½œå¯¹è¯»é”å¯è§ï¼Œå¦‚æœå…è®¸è¯»é”åœ¨å·²è¢«è·å–çš„æƒ…å†µä¸‹å¯¹å†™é”çš„è·å–ï¼Œé‚£ä¹ˆæ­£åœ¨è¿è¡Œçš„å…¶ä»–è¯»çº¿ç¨‹å°±æ— æ³•æ„ŸçŸ¥åˆ°å½“å‰å†™çº¿ç¨‹çš„æ“ä½œã€‚ å› æ­¤ï¼Œåªæœ‰ç­‰å¾…å…¶ä»–è¯»çº¿ç¨‹éƒ½é‡Šæ”¾äº†è¯»é”ï¼Œå†™é”æ‰èƒ½è¢«å½“å‰çº¿ç¨‹è·å–ï¼Œè€Œå†™é”ä¸€æ—¦è¢«è·å–ï¼Œåˆ™å…¶ä»–è¯»å†™çº¿ç¨‹çš„åç»­è®¿é—®å‡è¢«é˜»å¡ã€‚å†™é”çš„é‡Šæ”¾ä¸ReentrantLockçš„é‡Šæ”¾è¿‡ç¨‹åŸºæœ¬ç±»ä¼¼ï¼Œæ¯æ¬¡é‡Šæ”¾å‡å‡å°‘å†™çŠ¶æ€ï¼Œå½“å†™çŠ¶æ€ä¸º0æ—¶è¡¨ç¤ºå†™é”å·²è¢«é‡Šæ”¾ï¼Œç„¶åç­‰å¾…çš„è¯»å†™çº¿ç¨‹æ‰èƒ½å¤Ÿç»§ç»­è®¿é—®è¯»å†™é”ï¼ŒåŒæ—¶å‰æ¬¡å†™çº¿ç¨‹çš„ä¿®æ”¹å¯¹åç»­çš„è¯»å†™çº¿ç¨‹å¯è§ã€‚ æ¥ç€æ˜¯è¯»é”çš„ä»£ç ï¼š 123456789101112131415161718192021222324252627protected final int tryAcquireShared(int unused) &#123; Thread current = Thread.currentThread(); int c = getState(); if (exclusiveCount(c) != 0 &amp;&amp; getExclusiveOwnerThread() != current) return -1; // å¦‚æœå…¶ä»–çº¿ç¨‹å·²ç»è·å–äº†å†™é”ï¼Œåˆ™å½“å‰çº¿ç¨‹è·å–è¯»é”å¤±è´¥ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ int r = sharedCount(c); if (!readerShouldBlock() &amp;&amp; r &lt; MAX_COUNT &amp;&amp; compareAndSetState(c, c + SHARED_UNIT)) &#123; if (r == 0) &#123; firstReader = current; firstReaderHoldCount = 1; &#125; else if (firstReader == current) &#123; firstReaderHoldCount++; &#125; else &#123; HoldCounter rh = cachedHoldCounter; if (rh == null || rh.tid != getThreadId(current)) cachedHoldCounter = rh = readHolds.get(); else if (rh.count == 0) readHolds.set(rh); rh.count++; &#125; return 1; &#125; return fullTryAcquireShared(current);&#125; å¯ä»¥çœ‹åˆ°åœ¨tryAcquireShared(int unused)æ–¹æ³•ä¸­ï¼Œå¦‚æœå…¶ä»–çº¿ç¨‹å·²ç»è·å–äº†å†™é”ï¼Œåˆ™å½“å‰çº¿ç¨‹è·å–è¯»é”å¤±è´¥ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚å¦‚æœå½“å‰çº¿ç¨‹è·å–äº†å†™é”æˆ–è€…å†™é”æœªè¢«è·å–ï¼Œåˆ™å½“å‰çº¿ç¨‹ï¼ˆçº¿ç¨‹å®‰å…¨ï¼Œä¾é CASä¿è¯ï¼‰å¢åŠ è¯»çŠ¶æ€ï¼ŒæˆåŠŸè·å–è¯»é”ã€‚è¯»é”çš„æ¯æ¬¡é‡Šæ”¾ï¼ˆçº¿ç¨‹å®‰å…¨çš„ï¼Œå¯èƒ½æœ‰å¤šä¸ªè¯»çº¿ç¨‹åŒæ—¶é‡Šæ”¾è¯»é”ï¼‰å‡å‡å°‘è¯»çŠ¶æ€ï¼Œå‡å°‘çš„å€¼æ˜¯â€œ1&lt;&lt;16â€ã€‚æ‰€ä»¥è¯»å†™é”æ‰èƒ½å®ç°è¯»è¯»çš„è¿‡ç¨‹å…±äº«ï¼Œè€Œè¯»å†™ã€å†™è¯»ã€å†™å†™çš„è¿‡ç¨‹äº’æ–¥ã€‚ æ­¤æ—¶ï¼Œæˆ‘ä»¬å†å›å¤´çœ‹ä¸€ä¸‹äº’æ–¥é”ReentrantLockä¸­å…¬å¹³é”å’Œéå…¬å¹³é”çš„åŠ é”æºç ï¼š æˆ‘ä»¬å‘ç°åœ¨ReentrantLockè™½ç„¶æœ‰å…¬å¹³é”å’Œéå…¬å¹³é”ä¸¤ç§ï¼Œä½†æ˜¯å®ƒä»¬æ·»åŠ çš„éƒ½æ˜¯ç‹¬äº«é”ã€‚æ ¹æ®æºç æ‰€ç¤ºï¼Œå½“æŸä¸€ä¸ªçº¿ç¨‹è°ƒç”¨lockæ–¹æ³•è·å–é”æ—¶ï¼Œå¦‚æœåŒæ­¥èµ„æºæ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹é”ä½ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹åœ¨ä½¿ç”¨CASæ›´æ–°stateæˆåŠŸåå°±ä¼šæˆåŠŸæŠ¢å è¯¥èµ„æºã€‚è€Œå¦‚æœå…¬å…±èµ„æºè¢«å ç”¨ä¸”ä¸æ˜¯è¢«å½“å‰çº¿ç¨‹å ç”¨ï¼Œé‚£ä¹ˆå°±ä¼šåŠ é”å¤±è´¥ã€‚æ‰€ä»¥å¯ä»¥ç¡®å®šReentrantLockæ— è®ºè¯»æ“ä½œè¿˜æ˜¯å†™æ“ä½œï¼Œæ·»åŠ çš„é”éƒ½æ˜¯éƒ½æ˜¯ç‹¬äº«é”ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"é”","slug":"é”","permalink":"http://example.com/tags/%E9%94%81/"}]},{"title":"è°ˆä¸€è°ˆJavaä¸­çš„é›†åˆç±»ä¹‹æ€»è¿°","slug":"è°ˆä¸€è°ˆJavaä¸­çš„é›†åˆç±»","date":"2019-09-05T06:40:08.000Z","updated":"2019-09-05T06:40:08.000Z","comments":true,"path":"2019/09/05/è°ˆä¸€è°ˆJavaä¸­çš„é›†åˆç±»/","link":"","permalink":"http://example.com/2019/09/05/%E8%B0%88%E4%B8%80%E8%B0%88Java%E4%B8%AD%E7%9A%84%E9%9B%86%E5%90%88%E7%B1%BB/","excerpt":"","text":"æœ¬æ–‡æ¶‰åŠé›†åˆç±»çŸ¥è¯†ä»¥åŠé¢è¯•å¸¸é—®çŸ¥è¯†ç‚¹ OverViewé›†åˆç±»åˆ†ä¸ºList,Map,Set. å…ˆä¸Šå¼ å›¾ MapåŒ…æ‹¬HashMap, LinkedHashMap, HashTable, TreeMap å’Œ WeakHashMap, ConcurrentHashMap HashMap ä¸æ˜¯çº¿ç¨‹å®‰å…¨ï¼Œæœ€å¤šå…è®¸ä¸€æ¡é”®ä¸ºnullçš„è®°å½• LinkedHashMap ä¿å­˜äº†è®°å½•çš„æ’å…¥é¡ºåº ConcurrentHashMap çº¿ç¨‹å®‰å…¨ HashTable çº¿ç¨‹å®‰å…¨ï¼Œé”®å’Œå€¼éƒ½ä¸èƒ½ä¸ºç©º TreeMap æœ‰æ’åºåŠŸèƒ½ ListåŒ…æ‹¬ArrayList, LinkedList, Vector å’Œ stack SetåŒ…æ‹¬HashSet , TreeSet å¸¸è§é—®é¢˜ HashMap å’Œ ConcurrentHashMapæ¯”è¾ƒ HashTableå®ç°åŸç†ï¼Œä¸ºä»€ä¹ˆçº¿ç¨‹å®‰å…¨ TreeMapå®ç°åŸç†","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"é›†åˆç±»","slug":"é›†åˆç±»","permalink":"http://example.com/tags/%E9%9B%86%E5%90%88%E7%B1%BB/"}]},{"title":"è°ˆä¸€è°ˆJavaå¸¸é‡æ± ä¹‹classå¸¸é‡æ± ","slug":"è°ˆä¸€è°ˆJavaå¸¸é‡æ± ä¹‹classå¸¸é‡æ± ","date":"2019-09-04T06:08:30.000Z","updated":"2019-09-04T06:08:30.000Z","comments":true,"path":"2019/09/04/è°ˆä¸€è°ˆJavaå¸¸é‡æ± ä¹‹classå¸¸é‡æ± /","link":"","permalink":"http://example.com/2019/09/04/%E8%B0%88%E4%B8%80%E8%B0%88Java%E5%B8%B8%E9%87%8F%E6%B1%A0%E4%B9%8Bclass%E5%B8%B8%E9%87%8F%E6%B1%A0/","excerpt":"","text":"Javaå¸¸é‡æ± åˆ†ä¸ºå­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œclasså¸¸é‡æ± å’Œè¿è¡Œæ—¶å¸¸é‡æ± ã€‚æœ¬æ–‡ä¸»è¦è®²classå¸¸é‡æ± ã€‚ ä»€ä¹ˆæ˜¯classå¸¸é‡æ± é¡¾åæ€ä¹‰ï¼Œclasså¸¸é‡æ± å°±æ˜¯classæ–‡ä»¶ä¸­å¯¹åº”çš„å¸¸é‡æ± ï¼Œé‚£ä»€ä¹ˆæ˜¯classæ–‡ä»¶å‘¢ï¼Œå°±æ˜¯å°†javaæ–‡ä»¶ç¼–è¯‘å¾—åˆ°çš„å­—èŠ‚ç æ–‡ä»¶ï¼Œjvmæ‰€å¤„ç†çš„ä¹Ÿæ­£æ˜¯è¿™ç§å­—èŠ‚ç æ–‡ä»¶ã€‚è€Œclasså¸¸é‡æ± ï¼ŒæŒ‡çš„å°±æ˜¯è¿™ä¸ªå­—èŠ‚ç æ–‡ä»¶ä¸­å¯¹åº”çš„ä¸€éƒ¨åˆ†å†…å®¹ã€‚ classæ–‡ä»¶ç»“æ„ä¸ºäº†è¿›ä¸€æ­¥äº†è§£classæ–‡ä»¶ï¼Œæˆ‘ä»¬å‡†å¤‡äº†ä¸€å°æ®µä»£ç ï¼š 12345public class Test &#123; public static void main(String[] args) &#123; String s = &quot;hello world&quot; ; &#125;&#125; ä½¿ç”¨javacè¿›è¡Œç¼–è¯‘,åœ¨åå…­è¿›åˆ¶ä¸‹æŸ¥çœ‹ï¼Œå¾—åˆ°ï¼š è¿™å°±æ˜¯æˆ‘ä»¬ç¼–è¯‘å¾—åˆ°çš„classæ–‡ä»¶ã€‚ å‰å››ä¸ªå­—èŠ‚æ˜¯é­”æ•°ï¼ˆmagic numberï¼‰,ç´§æ¥ç€çš„å››ä¸ªå­—èŠ‚æ˜¯ç‰ˆæœ¬å·ï¼Œç„¶åå°±æ˜¯classå¸¸é‡æ± çš„å…¥å£äº†ã€‚ ä¸‹å›¾å±•ç¤ºäº†å®Œæ•´çš„classæ–‡ä»¶æ ¼å¼ï¼š ç±»å‹ åç§° æ•°é‡ è¯´æ˜ u4 magic 1 é­”æ•° u2 minor_version 1 æ¬¡ç‰ˆæœ¬å· u2 major_version 1 ä¸»ç‰ˆæœ¬å· u2 constant_pool_count 1 å¸¸é‡æ± ä¸­å¸¸é‡æ•°é‡ cp_info constant_pool constant_pool_count-1 å¸¸é‡æ± ä¸­çš„å¸¸é‡ u2 access_flag 1 è®¿é—®æ ‡å¿—ï¼Œç”¨äºæ ‡è¯†å½“å‰çš„ç±»æˆ–è€…æ¥å£çš„è®¿é—®ä¿¡æ¯ï¼Œå¦‚æ˜¯ç±»è¿˜æ˜¯æ¥å£ï¼Œè®¿é—®ç±»å‹ç­‰ u2 this_class 1 ç±»ç´¢å¼•ï¼Œç¡®å®šè¿™ä¸ªç±»çš„å…¨é™å®šåï¼Œå…·ä½“å­˜æ”¾åœ¨å¸¸é‡æ± ä¸­ï¼Œæ ¹æ®è¿™ä¸ªç´¢å¼•å»æŸ¥æ‰¾ u2 super_class 1 çˆ¶ç±»ç´¢å¼•ï¼Œä½œç”¨åŒä¸Š u2 interfaces_count 1 å½“å‰ç±»æ‰€å®ç°çš„æ¥å£æ•°é‡ u2 interfaces interfaces_count æ¥å£ç´¢å¼•é›†åˆï¼Œæè¿°å½“å‰ç±»æ‰€å®ç°çš„æ¥å£ï¼Œæ ¹æ®ç´¢å¼•åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾ u2 fields_count 1 field_info fields fields_count å­—æ®µè¡¨é›†åˆï¼Œç”¨äºæè¿°ç±»æˆ–è€…æ¥å£ä¸­ç”³æ˜çš„å˜é‡ u2 methods_count 1 method_info methods methods_count æ–¹æ³•è¡¨é›†åˆï¼Œç”¨äºæè¿°ç±»æˆ–è€…æ¥å£ä¸­ç”³æ˜çš„æ–¹æ³• u2 attributes_count 1 attribute_info attributes attributes_count å¯ä»¥çœ‹å‡ºclassæ–‡ä»¶ä¸­åªæœ‰ä¸¤ç§æ•°æ®ç±»å‹ï¼šæ— ç¬¦å·æ•°å’Œè¡¨ï¼Œå¯¹äºæ¯ä¸ªè¡¨ï¼Œå¼€å¤´æ€»ä¼šå…ˆè¯´å®ƒçš„æ•°é‡ï¼Œç„¶åè¡¨ä¸­çš„æ¯ä¸ªå­—æ®µéƒ½æœ‰è‡ªå·±çš„ç»“æ„ã€‚ ä¸‹é¢è¿™ä¸ªè¡¨æè¿°äº†å¸¸é‡æ± ä¸­éƒ½æœ‰å“ªäº›è¡¨ ç±»å‹ æ ‡å¿— æè¿° CONSTANT_utf8_info 1 UTF-8ç¼–ç çš„å­—ç¬¦ä¸² CONSTANT_Integer_info 3 æ•´å½¢å­—é¢é‡ CONSTANT_Float_info 4 æµ®ç‚¹å‹å­—é¢é‡ CONSTANT_Long_info ï¼• é•¿æ•´å‹å­—é¢é‡ CONSTANT_Double_info ï¼– åŒç²¾åº¦æµ®ç‚¹å‹å­—é¢é‡ CONSTANT_Class_info ï¼— ç±»æˆ–æ¥å£çš„ç¬¦å·å¼•ç”¨ CONSTANT_String_info ï¼˜ å­—ç¬¦ä¸²ç±»å‹å­—é¢é‡ CONSTANT_Fieldref_info ï¼™ å­—æ®µçš„ç¬¦å·å¼•ç”¨ CONSTANT_Methodref_info ï¼‘ï¼ ç±»ä¸­æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ CONSTANT_InterfaceMethodref_info ï¼‘ï¼‘ æ¥å£ä¸­æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ CONSTANT_NameAndType_info ï¼‘ï¼’ å­—æ®µæˆ–æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ CONSTANT_MothodType_info ï¼‘ï¼– æ ‡å¿—æ–¹æ³•ç±»å‹ CONSTANT_MethodHandle_info ï¼‘ï¼• è¡¨ç¤ºæ–¹æ³•å¥æŸ„ CONSTANT_InvokeDynamic_info ï¼‘ï¼˜ è¡¨ç¤ºä¸€ä¸ªåŠ¨æ€æ–¹æ³•è°ƒç”¨ç‚¹ è¦æ³¨æ„çš„æ˜¯æ¯ä¸ªè¡¨ç»“æ„éƒ½æ˜¯ä¸åŒçš„ï¼Œé‚£ä¹ˆè¿™æ ·å°±æœ‰ä¸€ä¸ªé—®é¢˜äº†ï¼Œæ—¢ç„¶è¡¨ç»“æ„éƒ½æœ‰ä¸åŒï¼Œé‚£ä¹ˆjvmè‡ªå·±åˆæ˜¯æ€ä¹ˆè®¤è¯†è¿™äº›è¡¨é¡¹çš„å‘¢ã€‚è¿™é‡Œå°±æœ‰ä¸€ç‚¹classæ–‡ä»¶è®¾è®¡çš„æŠ€å·§äº†ï¼šè™½ç„¶æ¯ä¸ªè¡¨éƒ½ä¸åŒï¼Œä½†æ˜¯æˆ‘å¯ä»¥ç»™æ¯ä¸ªè¡¨è®¾ç½®ä¸€ä¸ªå¼€å§‹æ ‡å¿—æˆ–è€…ç»“æŸæ ‡å¿—å‘€ã€‚classæ–‡ä»¶ä½¿ç”¨çš„æ˜¯å‰ä¸€ç§ï¼Œæ¯ä¸ªè¡¨é¡¹ï¼Œéƒ½æ˜¯ä»¥ä¸€ä¸ªä¸€å­—èŠ‚çš„tagä½ä½œä¸ºå¼€å§‹çš„ï¼Œå¦‚ä¸Šè¡¨æ‰€ç¤ºï¼Œæ¯ä¸ªtagä»£è¡¨äº†ä¸åŒçš„è¡¨ç»“æ„ï¼Œç„¶åæ ¹æ®tagå»æŸ¥æ‰¾å¯¹åº”çš„è¡¨ç»“æ„ï¼ŒæŒ‰ç…§å¯¹åº”çš„è¡¨ç»“æ„æ¥è§£ææ¥ä¸‹æ¥çš„å†…å®¹ã€‚ classå¸¸é‡æ± é‡Œæœ‰å•¥çœ‹å®Œclassæ–‡ä»¶ç»“æ„ï¼Œå†æ¥ç»†çœ‹ä¸€ä¸‹classå¸¸é‡æ± ï¼Œä»ä¸Šé¢çš„è¡¨æ ¼å¯ä»¥çœ‹å‡ºï¼Œå¸¸é‡æ± ä¹Ÿæ˜¯ä¸€ä¸ªè¡¨ï¼Œå¼€å¤´å…ˆè¯´å®ƒçš„æ•°é‡ï¼Œå³é‡Œé¢æœ‰å‡ ä¸ªå¸¸é‡ï¼Œç„¶åæ‰æ˜¯å¸¸é‡æ± çš„å†…å®¹ã€‚ å¸¸é‡æ± ä¸­æ¯ä¸€é¡¹åˆæ˜¯ä¸€ä¸ªè¡¨ï¼Œä¸”ä¸åŒçš„è¯¦ï¼Œè¡¨ç»“æ„ä¸åŒ æˆ‘ä»¬ä½¿ç”¨javapå‘½ä»¤æ¥ç®€å•æ˜äº†çš„çœ‹ä¸‹classå¸¸é‡æ± ï¼š ä¸Šå›¾å±•ç¤ºäº†classå¸¸é‡æ± ä¸­çš„å†…å®¹ï¼Œå¸¸é‡æ± ä¸­ä¸»è¦å­˜æ”¾ä¸¤ç§å¸¸é‡ï¼šå­—é¢é‡ï¼ˆLiteralï¼‰å’Œç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referencesï¼‰.å­—é¢é‡æŒ‡çš„å°±æ˜¯ä¸€äº›å­—ç¬¦ä¸²å•Šæ•°å­—å•Šä¹‹ç±»çš„ä¸œè¥¿ï¼Œè€Œç¬¦å·å¼•ç”¨åŒ…æ‹¬ä»¥ä¸‹ä¸‰ç±»å¸¸é‡ï¼š ç±»å’Œæ¥å£çš„å…¨é™å®šåï¼ˆè¿™ä¸ªå¸¸é‡åœ¨ç±»ç´¢å¼•æˆ–è€…çˆ¶ç±»ç´¢å¼•ä¸­å°±ä¼šç”¨åˆ°ï¼‰ å­—æ®µçš„åç§°å’Œæè¿°ç¬¦ ï¼ˆè¿™ä¸ªåœ¨å­—æ®µè¡¨é›†åˆä¸­ä¼šè¢«ç”¨åˆ°ï¼‰ æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦ï¼ˆè¿™ä¸ªåœ¨æ–¹æ³•è¡¨é›†åˆä¸­ä¼šè¢«ç”¨åˆ°ï¼‰ classå¸¸é‡æ± æœ‰å•¥ç”¨å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œclasså¸¸é‡æ± ç›¸å½“äºæ˜¯ä¸€ä¸ªèµ„æºåº“ï¼Œåœ¨JVMè¿è¡Œæ—¶ï¼Œå®ƒä¼šæŠŠéœ€è¦çš„èµ„æºä»classæ–‡ä»¶ä¸­åŠ è½½è¿›å†…å­˜ã€‚è€Œè¿™äº›å°±æ˜¯ç±»åŠ è½½çš„å†…å®¹äº†ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢çš„æ–‡ç« ä¸­è®²åˆ°ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"classæ–‡ä»¶","slug":"classæ–‡ä»¶","permalink":"http://example.com/tags/class%E6%96%87%E4%BB%B6/"}]},{"title":"Javaä¸­çš„NIO","slug":"Javaä¸­çš„NIO","date":"2019-07-17T08:30:42.000Z","updated":"2023-05-29T14:17:37.598Z","comments":true,"path":"2019/07/17/Javaä¸­çš„NIO/","link":"","permalink":"http://example.com/2019/07/17/Java%E4%B8%AD%E7%9A%84NIO/","excerpt":"","text":"NIO(Non-Blocking IOï¼Œéé˜»å¡åŒæ­¥IO)æ˜¯Jdk 1.4åæå‡ºçš„æ–°æŠ€æœ¯ï¼Œä¸ºä»€ä¹ˆè¦æå‡ºè¿™ä¸ªæŠ€æœ¯å‘¢ï¼Ÿæ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ è¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œå°±è¦ä»ä¼ ç»Ÿçš„é˜»å¡å¼IOè¯´èµ·ã€‚ ä½•ä¸ºåŒæ­¥å¼‚æ­¥ï¼Œä½•ä¸ºé˜»å¡éé˜»å¡å¯¹IOæ¥è¯´ï¼Œ åŒæ­¥ï¼šAPIè°ƒç”¨è¿”å›æ—¶å°±å·²ç»çŸ¥é“æ‰§è¡Œç»“æœäº† å¼‚æ­¥ï¼šAPIè°ƒç”¨è¿”å›æ—¶è¿˜ä¸çŸ¥é“æ‰§è¡Œç»“æœï¼Œéœ€è¦è¿‡ä¸€ä¼šå„¿æ‰èƒ½çŸ¥é“ é˜»å¡ï¼šå½“æ²¡æœ‰æ•°æ®è¯»æˆ–è€…å†™æ—¶ï¼Œå®ƒå°±ä¸€ç›´ç­‰å•Šç­‰ï¼Œç­‰åˆ°æœ‰æ•°æ®æ¥ éé˜»å¡ï¼šèƒ½è¯»å¤šå°‘æ˜¯å¤šå°‘ï¼Œç„¶åè¿”å›ï¼Œå³ä½¿æ²¡æœ‰æ•°æ®è¯»ï¼Œæˆ‘ä¹Ÿä¸ç­‰ï¼Œç›´æ¥è¿”å› æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼ŒåŒæ­¥å¼‚æ­¥ï¼Œå¼ºè°ƒçš„æ˜¯è¿”å›æ—¶æœ‰æ²¡æœ‰ç›´åˆ°æ‰§è¡Œç»“æœã€‚è€Œé˜»å¡å’Œéé˜»å¡ï¼Œå¼ºè°ƒçš„æ˜¯ä½•æ—¶è¿”å›ï¼Œå³æ­»ç­‰è¿˜æ˜¯ç«‹å³è¿”å›ã€‚ ä¼ ç»ŸIO å•çº¿ç¨‹ä¸‹çš„é€šä¿¡ æˆ‘ä»¬ä¸¾ä¸ªç®€å•ä¾‹å­ï¼Œä¸ºäº†è¯»å–ä¸€ä¸ªTCPè¿æ¥çš„æ•°æ®ï¼Œ å®¢æˆ·ç«¯ï¼š 123456789public class Client &#123; public static void main(String[] args) throws IOException &#123; String host = &quot;127.0.0.1&quot;; int port = 8888 ; Socket socket = new Socket(host,port) ; OutputStream outputStream = socket.getOutputStream(); outputStream.write(String.valueOf(&quot;hello server&quot;).getBytes()); &#125;&#125; æœåŠ¡ç«¯ 1234567891011121314public class Server &#123; public static void main(String[] args) throws IOException &#123; ServerSocket serverSocket = new ServerSocket(8888); while (true) &#123; Socket socket = serverSocket.accept(); //do something InputStream inputStream = socket.getInputStream(); byte[] bytes = new byte[1024]; int len = inputStream.read(bytes); System.out.println(new String(bytes, 0, len)); &#125; &#125;&#125; åœ¨è¿™é‡Œï¼ŒæœåŠ¡ç«¯çš„serverSocket.accept()å°±æ˜¯ä¸€ç§åŒæ­¥é˜»å¡çš„å†™æ³•ï¼ŒæœåŠ¡ç«¯çš„çº¿ç¨‹ä¸€ç›´é˜»å¡åœ¨è¿™é‡Œï¼Œå ç”¨ç€å†…å­˜èµ„æºï¼Œç›´åˆ°æœ‰è¯·æ±‚è¿‡æ¥ï¼Œæ‰å¼€å§‹æ‰§è¡Œåç»­ä»£ç ã€‚å½“æœ‰å¤šä¸ªè¯·æ±‚åˆ°æ¥æ—¶ï¼ŒæœåŠ¡ç«¯å°±ä¸€ä¸ªä¸€ä¸ªæŒ¨ä¸ªå¤„ç†ã€‚å¾ˆæ˜¾ç„¶ï¼Œè¿™æ˜¯å¾ˆä½æ•ˆçš„ï¼Œ å¤šçº¿ç¨‹ä¸‹çš„é€šä¿¡ ä¸ºäº†æé«˜æœåŠ¡ç«¯çš„æ•ˆç‡ï¼Œæˆ‘ä»¬å¤šå¼€å‡ ä¸ªçº¿ç¨‹æ¥å¤„ç†æœåŠ¡ç«¯çš„è¯·æ±‚ã€‚æ¯æ¬¡æœ‰æ–°çš„è¿æ¥æ¥äº†æˆ‘å°±é‡æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œè€Œä¸æ˜¯æ’é˜Ÿç­‰å€™é‚£å”¯ä¸€ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™æ ·æ•ˆç‡å¾—åˆ°äº†æé«˜ã€‚ æœåŠ¡ç«¯ï¼š 12345678910111213141516171819202122232425262728293031public class MultiThreadServer &#123; public static void main(String[] args) throws IOException &#123; ServerSocket serverSocket = new ServerSocket(8888); while (true) &#123; Socket socket = serverSocket.accept(); //do something new Thread(new Runnable() &#123; @Override public void run() &#123; try &#123; System.out.println(&quot;sub thread:&quot;+Thread.currentThread().getName()); InputStream inputStream = null; inputStream = socket.getInputStream(); byte[] bytes = new byte[1024]; int len = 0; len = inputStream.read(bytes); System.out.println(new String(bytes, 0, len)); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125;).start(); &#125; &#125;&#125; çº¿ç¨‹å¤ªå¤šå•¦ å†åæ¥ï¼Œä¸šåŠ¡åºå¤§äº†ï¼Œè¿æ¥æ•°å¤šäº†èµ·æ¥ï¼Œè¿™ä¹ˆé¢‘ç¹çš„åˆ›å»ºé”€æ¯çº¿ç¨‹ä¹Ÿæ˜¯å¾ˆæ¶ˆè€—ç³»ç»Ÿèµ„æºçš„ï¼Œäºæ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨çº¿ç¨‹æ± è¿›è¡ŒæœåŠ¡ç«¯çº¿ç¨‹çš„åˆ›å»ºä¸ç»´æŠ¤ï¼Œæ–¹ä¾¿ç»Ÿä¸€ç®¡ç†å’Œå¤ç”¨çº¿ç¨‹ï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡ã€‚åœ¨è¥ä¸šï¼ˆæ¥æ”¶å¹¶å¤„ç†è¯·æ±‚ï¼‰ä¹‹å‰æˆ‘å…ˆåˆ›å»ºå¥½ä¸€ç³»åˆ—çº¿ç¨‹ï¼Œåˆ°æ—¶å€™æœ‰è¿æ¥æ¥äº†æˆ‘å°±åˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼Œç”¨å®Œäº†æˆ‘å†æ‹¿å›æ¥ï¼Œæ€§èƒ½è–›å¾®å¾—åˆ°äº†ä¸€ä¸æ”¹å–„ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041public class ThreadPoolServer &#123; public static void main(String[] args) throws IOException &#123; ExecutorService service = new ThreadPoolExecutor(5, 10, 60L, TimeUnit.SECONDS, new ArrayBlockingQueue&lt;&gt;(10)); ServerSocket serverSocket = new ServerSocket(8888); while (true) &#123; Socket socket = serverSocket.accept(); service.submit(new RequestHandler(socket)); &#125; &#125;&#125;class RequestHandler implements Runnable &#123; private Socket socket; public RequestHandler(Socket socket) &#123; this.socket = socket; &#125; public RequestHandler() &#123; &#125; @Override public void run() &#123; try &#123; System.out.println(&quot;sub thread:&quot; + Thread.currentThread().getName()); InputStream inputStream = null; inputStream = socket.getInputStream(); byte[] bytes = new byte[1024]; int len = 0; len = inputStream.read(bytes); System.out.println(new String(bytes, 0, len)); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125; çº¿ç¨‹æ± ä¹Ÿæ‰›ä¸ä½äº† ä¸šåŠ¡æŒç»­å¢é•¿ï¼Œçº¿ç¨‹æ± ä¹Ÿæ»¡è¶³ä¸äº†éœ€æ±‚äº†ï¼Œå½“çº¿ç¨‹æ•°å¤§äºcpuæ ¸æ•°çš„æ—¶å€™ï¼Œå¿…ç„¶ä¼šå­˜åœ¨çº¿ç¨‹åˆ‡æ¢çš„é—®é¢˜ï¼Œè¿™å¾ˆè€—è´¹èµ„æºï¼Œè€Œä¸”ï¼Œå¯¹äºæ¯ä¸ªçº¿ç¨‹å†…éƒ¨ï¼Œé˜»å¡çš„æƒ…å†µè¿˜æ˜¯å­˜åœ¨çš„ï¼Œè¿™ä¹Ÿå°±å­˜åœ¨ä¸€ä¸ªçº¿ç¨‹çŠ¶æ€åˆ‡æ¢çš„é—®é¢˜ï¼Œè¿™ä¹Ÿè€—è´¹èµ„æºã€‚ åŸºäºè¿™ä¸ªèƒŒæ™¯ï¼Œæˆ‘ä»¬å°±åœ¨è€ƒè™‘ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•ï¼Œèƒ½å¤Ÿè§£å†³è¿™ä¸ªçº¿ç¨‹é¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„é—®é¢˜ï¼Ÿä¹Ÿå°±æœ‰äº†æˆ‘ä»¬çš„NIO NIOå…³äºNIOï¼Œç½‘ç»œä¸Šå·²ç»æœ‰å¾ˆå¤šç›¸å…³ä»‹ç»äº†ï¼Œä½†æ˜¯æˆ‘æƒ³ä»ä¸€ä¸ªä¸åŒçš„è§’åº¦å»åˆ¨æå®ƒã€‚ åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­æˆ‘ä»¬ä»‹ç»äº†äº”ç§IOæ¨¡å‹ï¼Œå…¶ä¸­æœ‰ä¸€ç§æ˜¯ IOå¤šè·¯å¤ç”¨(IO multiplexing)ï¼ŒNIOçš„è®¾è®¡å°±ç”¨åˆ°äº†è¿™ä¸€æ€æƒ³ã€‚ é¦–å…ˆæˆ‘ä»¬æ¥å¤§æ¦‚äº†è§£ä¸‹NIOæ˜¯æ€ä¹ˆå·¥ä½œçš„ã€‚ é¦–å…ˆï¼Œå®ƒæ˜¯éé˜»å¡çš„ï¼Œéé˜»å¡æ„å‘³ç€è¯»æˆ–è€…å†™çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®ï¼Œå°±ç›´æ¥è¿”å›äº†ã€‚ä¸ºäº†èƒ½å¤Ÿæ‹¿åˆ°æ•°æ®ï¼Œä½ å¯èƒ½å°±è¦ä¸åœçš„å»è°ƒç”¨readæˆ–è€…writeå»å°è¯•çœ‹èƒ½ä¸èƒ½æ‹¿åˆ°æ•°æ®ã€‚è¿™ä¹Ÿæ˜¯NIOéœ€è¦è§£å†³çš„é—®é¢˜ä¹‹ä¸€ã€‚ NIOæœ‰ä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—ï¼š Buffer Channel Selector ä¸‹é¢æˆ‘ä»¬ä¼šä¸€ä¸€ä»‹ç»ã€‚ Bufferä¼ ç»Ÿçš„BIOæ˜¯é¢å‘æµï¼ˆStreamï¼‰çš„ï¼Œå³æˆ‘ä»¬æ˜¯å‘Streamè¯»å–æˆ–è€…å†™å…¥æ•°æ®çš„ï¼Œå¹¶ä¸”è¿™ä¸ªStreamæ˜¯å•å‘çš„ï¼Œå³è¦ä¹ˆæ˜¯è¾“å…¥æµï¼Œè¦ä¹ˆæ˜¯è¾“å‡ºæµã€‚ NIOæ˜¯é¢å‘ç¼“å†²åŒºçš„ï¼Œæˆ‘ä»¬è¦è¾“å…¥çš„æ•°æ®ï¼Œé¦–å…ˆå¾—æ”¾åˆ°Bufferï¼Œç„¶åç”±Bufferé€åˆ°Channelä¸­ã€‚ ChannelChannelæ„æ€å³é€šé“ï¼Œå®ƒå’Œä¼ ç»Ÿçš„Streamç±»ä¼¼ï¼Œå¾ˆå¤§çš„ä¸€ç‚¹ä¸åŒåœ¨äºï¼šChannelæ˜¯åŒå‘çš„ï¼ŒåŒä¸€ä¸ªChannelæ—¢å¯ä»¥æ‹¿æ¥è¾“å…¥ï¼Œä¹Ÿå¯ä»¥æ‹¿æ¥è¾“å‡ºï¼Œè€Œä¸åƒStreamæ˜¯æœ‰InputStreamå’ŒOutputStreamä¹‹åˆ†çš„ã€‚ SelectorSelectorå«åšé€‰æ‹©å™¨ï¼Œä¹Ÿè¢«å«åšå¤šè·¯å¤ç”¨å™¨ï¼Œä»ä»–çš„åå­—å°±å¯ä»¥çŸ¥é“ï¼Œå®ƒå’Œæˆ‘ä»¬ä¹‹å‰ä»‹ç»çš„IO multiplexingæœ‰å¾ˆå¤§å…³ç³»ã€‚ NIOä¸­åˆ©ç”¨Selectorå®ç°äº†å¤šè·¯å¤ç”¨ï¼Œé€šè¿‡åœ¨Selectorä¸Šæ³¨å†Œå¤šä¸ªäº‹ä»¶ï¼ˆåœ¨æˆ‘ä»¬è¿™é‡Œå¯¹åº”çš„å°±æ˜¯é€šé“äº†ï¼‰ï¼ŒSelectorå»ç›‘å¬è¿™å¤šä¸ªäº‹ä»¶æ˜¯å¦æœ‰å‘ç”Ÿï¼Œå¦‚æœæœ‰äº‹ä»¶å‘ç”Ÿï¼Œåˆ™è¿›è¡Œç›¸åº”å¤„ç†ã€‚å®ƒè¿™æ ·è®¾è®¡ä¸€ä¸ªå¾ˆå¤§çš„å¥½å¤„æ˜¯å¯ä»¥ç”¨å•çº¿ç¨‹ç®¡ç†å¤šä¸ªé€šé“ï¼Œå¦‚æœä½ ä»”ç»†è¯»è¿™ç¯‡æ–‡ç« ï¼Œä½ ä¼šå‘ç°å®ƒä»¬ååˆ†ç±»ä¼¼ã€‚ ä½†æ˜¯ä¹Ÿæœ‰ä¸åŒï¼Œåœ¨IO multiplexingä¸­ï¼Œåº”ç”¨è¿›ç¨‹æ˜¯è¢«selectç³»ç»Ÿè°ƒç”¨é˜»å¡çš„ï¼Œä½†æ˜¯ç›®æµ‹åœ¨NIOä¸­ï¼Œæ³¨å†Œç›‘å¬åå½“å‰çº¿ç¨‹å¹¶æ²¡æœ‰è¢«é˜»å¡ï¼Œæ‰€ä»¥ä»è¿™ä¸ªè§’åº¦è®²ï¼ŒNIOæ›´åƒæ˜¯IOå¤šè·¯å¤ç”¨å’Œä¿¡å·é©±åŠ¨å¼IOçš„ç»“åˆã€‚ æ€»ç»“ä¸€ä¸‹ï¼Œå®ƒçš„è®¾è®¡æ€æƒ³æ˜¯è¿™æ ·çš„ï¼š å•çº¿ç¨‹å®ç° æå‡ºäº†Channelçš„æ¦‚å¿µï¼Œæ¯ä¸€ä¸ªå¯¹ç£ç›˜æˆ–è€…æ–‡ä»¶çš„IOæ“ä½œå¯¹åº”ä¸€ä¸ªChannelï¼Œç›¸å½“äºChannelæä¾›äº†æˆ‘ä»¬å’ŒçœŸæ­£çš„æ–‡ä»¶æˆ–è€…ç£ç›˜æ“ä½œçš„ä¸€ä¸ªæ¡¥æ¢ã€‚ æˆ‘ä»¬é€šè¿‡Bufferå’ŒChanneläº¤äº’ï¼Œå¯¹äºè¯»æ“ä½œï¼Œæˆ‘ä»¬å…ˆæŠŠæ•°æ®ä»Channelè¯»åˆ°Buffer,ç„¶åå†æ“ä½œBuffer, å¯¹äºå†™æ“ä½œï¼Œæˆ‘ä»¬å…ˆæŠŠæ•°æ®æ”¾åˆ°Buffer, ç„¶åå†å†™åˆ°Channel. ä¸ºäº†åœ¨å®ç°éé˜»å¡çš„åŒæ—¶é¿å…ä¸åœçš„è°ƒç”¨read()æˆ–è€…write(), å®ç°äº†ç›‘å¬æœºåˆ¶ã€‚å…·ä½“æ˜¯é€šè¿‡é€‰æ‹©å™¨Selectorå®ç°çš„ï¼Œæˆ‘ä»¬æŠŠæ¯ä¸ªChanneléƒ½ç»‘å®šåœ¨ä¸€ä¸ªSelectorä¸Šï¼Œå¹¶ä¸”å‘Šè¯‰Selectoræˆ‘å¯¹ä»€ä¹ˆæ ·çš„äº‹ä»¶æ„Ÿå…´è¶£ï¼Œé€šè¿‡Selectorè¿›è¡Œç›‘å¬ï¼Œç›‘å¬çš„è¿‡ç¨‹ä¸­ç¨‹åºæ˜¯é˜»å¡çš„ï¼Œå½“Channelæ„Ÿå…´è¶£çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒSelectoré€šçŸ¥Channel,ç„¶åChannelå¼€å§‹å®ƒçš„è¡¨æ¼”ã€‚ æ‰€ä»¥ï¼Œè¯´ç™½äº†ï¼Œå®ƒçš„éé˜»å¡åŒæ­¥ï¼Œä¸»è¦å°±æ˜¯ è®¾ç½®äº†ç›‘å¬ æŠŠå¤šçº¿ç¨‹çš„å®¢æˆ·ç«¯è¯·æ±‚æ˜ å°„æˆäº†å•çº¿ç¨‹çš„å¤šä¸ªchannel, ç„¶åselectorç›‘å¬ï¼Œæœ‰æ„Ÿå…´è¶£çš„äº‹æƒ…å‘ç”Ÿä¹‹åå°±å¼€å§‹è½®è¯¢æ¯ä¸ªchannel.","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"IO","slug":"IO","permalink":"http://example.com/tags/IO/"}]},{"title":"Javaåå°„æœºåˆ¶","slug":"Javaåå°„æœºåˆ¶","date":"2019-07-11T07:26:23.000Z","updated":"2019-07-11T07:26:23.000Z","comments":true,"path":"2019/07/11/Javaåå°„æœºåˆ¶/","link":"","permalink":"http://example.com/2019/07/11/Java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/","excerpt":"","text":"å†™è¿™ç¯‡æ–‡ç« ä¸»è¦æƒ³è®²ä¸¤ä¸ªé—®é¢˜ï¼š ä»€ä¹ˆæ˜¯åå°„ åå°„å­˜åœ¨çš„æ„ä¹‰ åå°„èƒ½åšå“ªäº›äº‹ ä»€ä¹ˆæ˜¯åå°„åå°„ï¼Œç®€å•çš„æ¥è®²ï¼Œæ˜¯ä¸€ç§åœ¨ç¨‹åºè¿è¡Œæ—¶ç”Ÿæˆå¯¹è±¡çš„æŠ€æœ¯ã€‚ä¸ºä»€ä¹ˆè¯´æ˜¯è¿è¡Œæ—¶å‘¢ï¼Œç›¸æ¯”æˆ‘ä»¬å¹³æ—¶å†™ä»£ç æ—¶åˆ›å»ºå¯¹è±¡ï¼Œæ¯”å¦‚ï¼š 123public static void main()&#123; Object obj = new Object();&#125; æˆ‘ä»¬åˆ›å»ºå¯¹è±¡çš„ä»£ç æ˜¯äº‹å…ˆå†™å¥½çš„ï¼Œé‚£ä¹ˆç¨‹åºåœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯.javaæ–‡ä»¶è¢«ç¼–è¯‘æˆ.classæ–‡ä»¶çš„æ—¶å€™ï¼Œè¿™ä¸ªå¯¹è±¡å°±å·²ç»åœ¨classæ–‡ä»¶ä¸­äº†ã€‚è€Œåå°„è®²çš„æ˜¯ï¼Œè¿™ä¸ªå¯¹è±¡åœ¨ç¼–è¯‘å™¨æ˜¯ä¸å­˜åœ¨ï¼Œåœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œå› ä¸ºæŸç§éœ€æ±‚ï¼Œå®ƒæ‰è¢«åˆ›å»ºå‡ºæ¥ã€‚ åå°„å­˜åœ¨çš„æ„ä¹‰å­¦ä¹ ä¸€ç§æŠ€æœ¯ï¼Œæ›´é‡è¦çš„æ˜¯è¦æ˜ç™½å®ƒå­˜åœ¨çš„æ„ä¹‰ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè¦æœ‰åå°„å‘¢ï¼Ÿ åå°„ä¸€ä¸ªæœ€å¤§çš„ç”¨é€”å°±æ˜¯ç”¨åœ¨å„å¤§æ¡†æ¶ä¸­ï¼Œå¦‚Spring,Struts2 ç°åœ¨çš„å„ç§æ¡†æ¶éƒ½æ˜¯é…ç½®å‹çš„ã€‚ä¸‹é¢çš„xmlæ˜¯Stucts2ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚å½“åå°æ”¶åˆ°è¿™ä¸ªloginè¯·æ±‚åï¼Œç»è¿‡å„ç§è¿‡æ»¤å™¨ï¼Œæœ€åå®ƒä¼šå’Œè¿™ä¸ªé…ç½®æ–‡ä»¶å¯¹åº”ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶é‡Œé¢æè¿°äº†å½“æ”¶åˆ°è¿™ç§è¯·æ±‚åæˆ‘è¦è°ƒç”¨å“ªä¸ªç±»ï¼ˆè¿™é‡Œå°±æ˜¯ org.ScZyhSoft.test.action.SimpleLoginActionç±»ï¼‰ï¼Œä»¥åŠç±»ä¸­çš„å“ªä¸ªæ–¹æ³•ï¼ˆè¿™é‡Œå°±æ˜¯executeæ–¹æ³•ï¼‰ã€‚ä½†è¿™ä¸ªç±»å…¶å®é…ç½®æ–‡ä»¶åªå†™äº†ä¸€ä¸ªç±»åï¼Œä¹Ÿå°±æ˜¯è¯´ç­‰åˆ°çœŸæ­£è¿™ä¸ªè¯·æ±‚åˆ°äº†ï¼Œéœ€è¦ç”¨åˆ°è¿™ä¸ªç±»çš„æ—¶å€™å®ƒæ‰è¢«åˆ›å»ºï¼Œè¿™é‡Œåˆ›å»ºçš„æŠ€æœ¯å°±æ˜¯åå°„ã€‚ 123456&lt;action name=&quot;login&quot; class=&quot;org.ScZyhSoft.test.action.SimpleLoginAction&quot; method=&quot;execute&quot;&gt; &lt;result&gt;/shop/shop-index.jsp&lt;/result&gt; &lt;result name=&quot;error&quot;&gt;login.jsp&lt;/result&gt; &lt;/action&gt; åå°„èƒ½åšå“ªäº›äº‹åˆ›å»ºå®ä¾‹ä½¿ç”¨åå°„åˆ›å»ºå®ä¾‹ï¼Œé¦–å…ˆè¦è·å¾—Classå¯¹è±¡ï¼Œä½ å¯ä»¥è®¤ä¸ºå®ƒå°±æ˜¯æˆ‘ä»¬æ‰€å†™çš„ç±»çš„å¯¹è±¡ç±»å‹ã€‚è¿™å¥è¯å¯èƒ½æœ‰ç‚¹ç»•ï¼Œä¿—è¯è¯´â€œä¸‡äº‹ä¸‡ç‰©çš†å¯¹è±¡â€ï¼ˆå½“ç„¶é™¤äº†åŸºæœ¬æ•°æ®ç±»å‹ï¼‰ï¼Œæ‰€ä»¥ç±»æœ¬èº«ä¹Ÿæ˜¯å¯¹è±¡ï¼Œå®ƒæ˜¯Classç±»çš„å¯¹è±¡ï¼Œè·å–Classå¯¹è±¡æœ‰ä¸‰ç§æ–¹æ³•ï¼š Class.forName() æ¯”å¦‚Class.forName(org.ScZyhSoft.test.action.SimpleLoginAction) ç›´æ¥è·å–æŸä¸ªå¯¹è±¡çš„classå±æ€§ å¦‚Class&lt;?&gt; klass = obj.class è°ƒç”¨æŸä¸ªå¯¹è±¡çš„getClass()æ–¹æ³• å¦‚Class&lt;?&gt; klass = obj.getClass() è·å–Classå¯¹è±¡ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨Classå¯¹è±¡æ¥åˆ›å»ºå®ä¾‹äº† å¯¹äºé»˜è®¤æ„é€ å‡½æ•°çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥ 12Class&lt;?&gt; c = String.class;Object str = c.newInstance(); å¯¹äºå¸¦å‚çš„æ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ 123456//è·å–Stringæ‰€å¯¹åº”çš„Classå¯¹è±¡Class&lt;?&gt; c = String.class;//è·å–Stringç±»å¸¦ä¸€ä¸ªStringå‚æ•°çš„æ„é€ å™¨Constructor constructor = c.getConstructor(String.class);//æ ¹æ®æ„é€ å™¨åˆ›å»ºå®ä¾‹Object obj = constructor.newInstance(&quot;23333&quot;); è·å–æ–¹æ³•å’Œæˆå‘˜å˜é‡è·å–æŸä¸ªClasså¯¹è±¡çš„æ–¹æ³•é›†åˆï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š getDeclaredMethods æ–¹æ³•è¿”å›ç±»æˆ–æ¥å£å£°æ˜çš„æ‰€æœ‰æ–¹æ³•ï¼ŒåŒ…æ‹¬å…¬å…±ã€ä¿æŠ¤ã€é»˜è®¤ï¼ˆåŒ…ï¼‰è®¿é—®å’Œç§æœ‰æ–¹æ³•ï¼Œä½†ä¸åŒ…æ‹¬ç»§æ‰¿çš„æ–¹æ³•ã€‚ 1public Method[] getDeclaredMethods() throws SecurityException getMethods æ–¹æ³•è¿”å›æŸä¸ªç±»çš„æ‰€æœ‰å…¬ç”¨ï¼ˆpublicï¼‰æ–¹æ³•ï¼ŒåŒ…æ‹¬å…¶ç»§æ‰¿ç±»çš„å…¬ç”¨æ–¹æ³•ã€‚ 1public Method[] getMethods() throws SecurityException getMethod æ–¹æ³•è¿”å›ä¸€ä¸ªç‰¹å®šçš„æ–¹æ³•ï¼Œpublicçš„ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ–¹æ³•åç§°ï¼Œåé¢çš„å‚æ•°ä¸ºæ–¹æ³•çš„å‚æ•°å¯¹åº”Classçš„å¯¹è±¡ã€‚ 1public Method getMethod(String name, Class&lt;?&gt;... parameterTypes) getDeclaredFieldï¼šæ‰€æœ‰å·²å£°æ˜çš„æˆå‘˜å˜é‡ï¼Œä¸é—®è®¿é—®æƒé™ï¼Œä½†ä¸èƒ½å¾—åˆ°å…¶çˆ¶ç±»çš„æˆå‘˜å˜é‡ getFiledsï¼šè®¿é—®å…¬æœ‰çš„æˆå‘˜å˜é‡ï¼ŒåŒ…æ‹¬ç»§æ‰¿çš„å…¬ç”¨æ–¹æ³• getField(String name) è·å–æŒ‡å®šçš„å˜é‡ï¼ˆpublicï¼‰ è°ƒç”¨æ–¹æ³•invoke()","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"åå°„","slug":"åå°„","permalink":"http://example.com/tags/%E5%8F%8D%E5%B0%84/"}]},{"title":"Javaé›†åˆç±»ä¹‹HashMap","slug":"è°ˆä¸€è°ˆJavaé›†åˆç±»ä¹‹HashMap","date":"2019-07-09T12:44:30.000Z","updated":"2019-07-09T12:44:30.000Z","comments":true,"path":"2019/07/09/è°ˆä¸€è°ˆJavaé›†åˆç±»ä¹‹HashMap/","link":"","permalink":"http://example.com/2019/07/09/%E8%B0%88%E4%B8%80%E8%B0%88Java%E9%9B%86%E5%90%88%E7%B1%BB%E4%B9%8BHashMap/","excerpt":"","text":"OverViewHashMapå·¥ä½œåŸç†1. jdk 1.7æ•°æ®ç»“æ„ï¼š çœ‹ä¸€ä¸‹Entryçš„ç»“æ„ï¼š 1234final K key;V value;Entry&lt;K,V&gt; next;int hash; putæ–¹æ³•ï¼š 12345678910111213141516171819202122public V put(K key, V value) &#123; if (table == EMPTY_TABLE) &#123; inflateTable(threshold); &#125; if (key == null) return putForNullKey(value); int hash = hash(key); int i = indexFor(hash, table.length); for (Entry&lt;K,V&gt; e = table[i]; e != null; e = e.next) &#123; Object k; if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123; V oldValue = e.value; e.value = value; e.recordAccess(this); return oldValue; &#125; &#125; modCount++; addEntry(hash, key, value, i); return null; &#125; 123456789void addEntry(int hash, K key, V value, int bucketIndex) &#123; if ((size &gt;= threshold) &amp;&amp; (null != table[bucketIndex])) &#123; resize(2 * table.length); hash = (null != key) ? hash(key) : 0; bucketIndex = indexFor(hash, table.length); &#125; createEntry(hash, key, value, bucketIndex); &#125; 12345void createEntry(int hash, K key, V value, int bucketIndex) &#123; Entry&lt;K,V&gt; e = table[bucketIndex]; table[bucketIndex] = new Entry&lt;&gt;(hash, key, value, e); size++; &#125; resizeæ–¹æ³•ï¼š 12345678910111213void resize(int newCapacity) &#123; Entry[] oldTable = table; int oldCapacity = oldTable.length; if (oldCapacity == MAXIMUM_CAPACITY) &#123; threshold = Integer.MAX_VALUE; return; &#125; Entry[] newTable = new Entry[newCapacity]; transfer(newTable, initHashSeedAsNeeded(newCapacity)); table = newTable; threshold = (int)Math.min(newCapacity * loadFactor, MAXIMUM_CAPACITY + 1); &#125; 123456789101112131415void transfer(Entry[] newTable, boolean rehash) &#123; int newCapacity = newTable.length; for (Entry&lt;K,V&gt; e : table) &#123; while(null != e) &#123; Entry&lt;K,V&gt; next = e.next; if (rehash) &#123; e.hash = null == e.key ? 0 : hash(e.key); &#125; int i = indexFor(e.hash, newCapacity); e.next = newTable[i]; newTable[i] = e; e = next; &#125; &#125; &#125; 2. jdk 1.8åœ¨1.7çš„å®ç°ä¸­ï¼Œæ¯ä¸ªæ¡¶ä¸­çš„é“¾è¡¨è¿‡é•¿åä¼šé€ æˆæŸ¥è¯¢æ—¶é—´å¢é•¿ï¼Œé’ˆå¯¹æ­¤ï¼Œåœ¨1.8ä¸­è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå½“é“¾è¡¨è¶…è¿‡ä¸€å®šé•¿åº¦æ—¶ï¼Œä½¿ç”¨çº¢é»‘æ ‘æ¥ä»£æ›¿ã€‚ æ•°æ®ç»“æ„ï¼š ç›¸æ¯”1.7ä¸­çš„æˆå‘˜å˜é‡ï¼Œä¸»è¦æœ‰ä»¥ä¸‹æ”¹åŠ¨: å¢åŠ äº†TREEIFY_THRESHOLDå’ŒUNTREEIFY_THRESHOLD:å°†é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘çš„é˜ˆå€¼,ä»¥åŠåœ¨resizeæ—¶å°†çº¢é»‘æ ‘è½¬ä¸ºé“¾è¡¨çš„é˜ˆå€¼ã€‚ å°†Entryæ”¹ä¸ºNode Nodeçš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š 1234final int hash;final K key;V value;Node&lt;K,V&gt; next; putæ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; //å¦‚æœè¡¨ç©º if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length; //å¦‚æœå½“å‰æ¡¶ç©º if ((p = tab[i = (n - 1) &amp; hash]) == null) tab[i] = newNode(hash, key, value, null); else &#123; Node&lt;K,V&gt; e; K k; //å¦‚æœæœ‰keyç›¸åŒçš„å…ƒç´  if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; //å¦‚æœæ˜¯treeèŠ‚ç‚¹ else if (p instanceof TreeNode) e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); //å¦‚æœæ˜¯é“¾è¡¨èŠ‚ç‚¹ else &#123; for (int binCount = 0; ; ++binCount) &#123; if ((e = p.next) == null) &#123; p.next = newNode(hash, key, value, null); if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st treeifyBin(tab, hash); break; &#125; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; p = e; &#125; &#125; if (e != null) &#123; // existing mapping for key V oldValue = e.value; if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e); return oldValue; &#125; &#125; //æ£€æŸ¥å®¹é‡æ˜¯å¦åˆ°è¾¾é˜ˆå€¼ ++modCount; if (++size &gt; threshold) resize(); afterNodeInsertion(evict); return null; &#125; getæ–¹æ³•ï¼š 12345678910111213141516171819final Node&lt;K,V&gt; getNode(int hash, Object key) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k; if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (first = tab[(n - 1) &amp; hash]) != null) &#123; if (first.hash == hash &amp;&amp; // always check first node ((k = first.key) == key || (key != null &amp;&amp; key.equals(k)))) return first; if ((e = first.next) != null) &#123; if (first instanceof TreeNode) return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key); do &#123; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; &#125; while ((e = e.next) != null); &#125; &#125; return null; &#125; éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒHashMapå’Œå…¶ä»–é›†åˆç±»ä¸€æ ·ï¼Œä¹Ÿæœ‰æ‰©å®¹çš„æ“ä½œï¼Œå½“entriesçš„æ•°é‡è¶…è¿‡å®¹é‡é˜ˆå€¼æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰©å®¹ã€‚æ‰€è°“æ‰©å®¹ï¼Œå°±æ˜¯æŠŠé‡Œé¢çš„å…ƒç´ ç§»æ¤åˆ°ä¸€ä¸ªæ›´å¤§çš„HashMapä¸­ï¼Œé‡Œé¢æ‰€æœ‰çš„å…ƒç´ éƒ½è¦è¿›è¡Œä»¥æ­¤é‡æ–°hash. å³ä½¿1.8ä¸­è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä½†æ˜¯hashmapè¿˜æ˜¯å­˜åœ¨ä¸€äº›ä¸å¯é¿å…çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼šçº¿ç¨‹ä¸å®‰å…¨ã€‚å½“åœ¨æ‰©å®¹çš„è¿‡ç¨‹ä¸­æœ‰å¤šä¸ªçº¿ç¨‹ä¸€èµ·æ“ä½œæ—¶ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šé€ æˆé“¾è¡¨é¦–ä½ç›¸è¿ï¼Œå½¢æˆæ­»å¾ªç¯ã€‚Javadocä¸­æœ‰è¿™ä¹ˆä¸€å¥è¯ 12345678&lt;p&gt;&lt;strong&gt;Note that this implementation is not synchronized.&lt;/strong&gt;If multiple threads access a hash map concurrently, and at least one ofthe threads modifies the map structurally, it &lt;i&gt;must&lt;/i&gt; besynchronized externally. (A structural modification is any operationthat adds or deletes one or more mappings; merely changing the valueassociated with a key that an instance already contains is not astructural modification.) This is typically accomplished bysynchronizing on some object that naturally encapsulates the map. å°±æ˜¯è¯´åœ¨å¯¹HashMapåšç»“æ„æ€§ä¿®æ”¹çš„æ—¶å€™ï¼Œæ¯”å¦‚putï¼Œremoveï¼Œresizeè¿™ç§æ“ä½œï¼Œä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å…¶å®ç›´è§‚æƒ³ä¸€æƒ³ä¹Ÿæ˜¯ï¼Œå¤šä¸ªçº¿ç¨‹ç›´æ¥è®¿é—®è¿™äº›å†…å®¹ï¼Œè‚¯å®šä¼šæœ‰é—®é¢˜çš„ã€‚ä¸‹é¢æˆ‘ä¸»è¦ä»ä¸‰ä¸ªæ–¹é¢æ¥è¯´æ˜å®ƒçš„çº¿ç¨‹ä¸å®‰å…¨æ€§ã€‚ æ‰§è¡Œputæ“ä½œçš„æ—¶å€™ ä»¥jdk 1.7ä¸ºä¾‹ï¼Œåœ¨putçš„ä»£ç ä¸­æœ‰ä»¥ä¸‹æ–¹æ³•ï¼š 1234567void createEntry(int hash, K key, V value, int bucketIndex) &#123; //å…ˆä¿å­˜è¿™ä¸ªä½ç½®æœ¬æ¥çš„å…ƒç´  Entry&lt;K,V&gt; e = table[bucketIndex]; //å°†æ–°æ¥çš„å…ƒç´ å¤´æ’ table[bucketIndex] = new Entry&lt;&gt;(hash, key, value, e); size++; &#125; è¿™æ˜¯ä¸€ä¸ªç®€å•çš„å¤´æ’æ³•ï¼Œè¯•æƒ³ä¸€ä¸‹ï¼Œå‡å¦‚æœ‰ä¸¤ä¸ªçº¿ç¨‹Aå’ŒBéƒ½å¾€åŒä¸€ä¸ªhashmapä¸­å†™å…ƒç´ ï¼Œæ°å¥½è¿™ä¸¤ä¸ªå…ƒç´ ç®—å‡ºæ¥çš„ç´¢å¼•æ˜¯ä¸€æ ·çš„ï¼ŒBçº¿ç¨‹æ‰§è¡Œåˆ°Entry&lt;K,V&gt; e = table[bucketIndex]åæ—¶é—´ç‰‡ç”¨å®Œï¼Œè·å–äº†æ¡¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ åå°±æŒ‚èµ·äº†ï¼Œç„¶åçº¿ç¨‹Aè¿›å…¥è¿™ä¸ªæ–¹æ³•å¹¶æ‰§è¡Œå®Œï¼Œè¿™æ—¶å€™çœ‹ä¼¼Açº¿ç¨‹æˆåŠŸå°†å®ƒæ‰€æ“ä½œçš„å…ƒç´ æ’å…¥äº†è¿›æ¥ï¼Œç­‰åˆ°Bçº¿ç¨‹çš„æ—¶é—´ç‰‡æ¥ä¸´æ—¶ï¼ŒBçº¿ç¨‹ç»§ç»­ä¸Šæ¬¡åœæ­¢çš„åœ°æ–¹æ‰§è¡Œï¼Œå› ä¸ºAçº¿ç¨‹å’ŒBçº¿ç¨‹è·å–çš„æ˜¯ç›¸åŒçš„å¤´å…ƒç´ ï¼Œæ‰€ä»¥Bçº¿ç¨‹çš„æ’å…¥ä¼šè¦†ç›–ä¹‹å‰Bçº¿ç¨‹çš„æ“ä½œã€‚ æ‰§è¡Œresizeçš„æ—¶å€™ æ‰§è¡Œresizeçš„æ—¶å€™ï¼Œå¾ˆå®¹æ˜“é€ æˆå¾ªç¯é“¾è¡¨ï¼Œä½¿å¾—cpuå ç”¨ç‡é£™å‡ã€‚ä¸Šé¢å±•ç¤ºäº†resizeçš„ä»£ç ï¼Œå®ƒæœ‰ä¸ªæ ¸å¿ƒæ–¹æ³•transfer: ä½œç”¨å°±æ˜¯æŠŠåŸæ¥tableä¸­çš„å…ƒç´ è½¬ç§»åˆ°æ–°çš„tableä¸­ã€‚ç•™æ„åœˆå‡ºæ¥çš„å†…å®¹ï¼Œä½ ä¼šå‘ç°å®ƒå…¶å®å°±æ˜¯ä¸ªå°†å½“å‰å…ƒç´ eå¤´æ’çš„é“¾è¡¨æ“ä½œ. åŒæ ·å‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œå‡è®¾äº†æˆ‘ä»¬çš„hashç®—æ³•å°±æ˜¯ç®€å•çš„ç”¨key mod ä¸€ä¸‹è¡¨çš„å¤§å°ã€‚ â€‹ (1) å‡è®¾çº¿ç¨‹ä¸€åˆšå¥½æ‰§è¡Œå®Œä»£ç 1å°±è¢«æŒ‚èµ·ï¼Œè€Œçº¿ç¨‹äºŒæ‰§è¡Œå®Œäº†ï¼Œé‚£ä¹ˆæƒ…å†µå¦‚ä¸‹ï¼š çº¿ç¨‹ä¸€çš„eæŒ‡å‘3ï¼ŒnextæŒ‡å‘7. â€‹ (2) çº¿ç¨‹ä¸€è¢«è°ƒåº¦å›æ¥æ‰§è¡Œï¼Œæ‰§è¡Œå®Œå½“å‰å¾ªç¯ï¼Œå°†3å¤´æ’ï¼Œå¹¶ä¸”æ‰§è¡Œä¸‹æ¬¡å¾ªç¯ä¸­çš„ä»£ç next=e.nextåï¼Œ â€‹ (3) å°†7å¤´æ’ï¼Œå¹¶æ‰§è¡Œä¸‹ä¸€æ¬¡å¾ªç¯ä¸­çš„next=e.nextå â€‹ (4) å®ƒæ¥äº†ï¼Œå®ƒå¸¦ç€ç¯å‹é“¾è¡¨æ¥äº† æ€»ç»“ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆä¼šå‡ºç°ç¯å‹é“¾è¡¨ï¼Œé’ˆå¯¹è¿™ä¸ªé“¾è¡¨è€Œè¨€ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬æŠŠé“¾è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ è¿›è¡Œäº†å¤´æ’å´æ²¡æœ‰è€ƒè™‘å°†æŒ‡å‘è¿™ä¸ªèŠ‚ç‚¹çš„nextæŒ‡é’ˆç½®ä¸ºnullå¯¼è‡´çš„ã€‚ æ‰§è¡Œremoveçš„æ—¶å€™ ConcurrentHashMap1. jdk 1.7å·¥ä½œåŸç†ä½¿ç”¨åˆ†æ®µé”æŠ€æœ¯ï¼Œå®šä¹‰äº†Segmentç±»ï¼Œè¯¥ç±»ç»§æ‰¿è‡ªReentryLock, ConcurrentHashMapç»“æ„å¤§æ¦‚ å¦‚ä¸‹ï¼š è¿™ç›¸å½“äºä¸€ç§åˆ†æ²»æ€æƒ³ï¼ŒSegmentæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ åŒ…å«äº†ä¸€ä¸ªtableæ•°ç»„,è¿™æ˜¯ä¸€ä¸ªåŸå§‹æ„ä¹‰ä¸Šçš„HashMapï¼Œæ¯ä¸ªtableæ•°ç»„çš„å…ƒç´ é‡Œè£…äº†HashEntry. tableæ•´ä½“æ˜¯ä¸€ä¸ªæ•°ç»„é“¾è¡¨çš„å½¢å¼ã€‚ å³ä½¿éœ€è¦åŠ é”ï¼Œä¹Ÿæ˜¯å¯¹æ¯ä¸ªæ®µè¿›è¡ŒåŠ é”ã€‚ HashEntryæ‰€åŒ…å«çš„å­—æ®µå¦‚ä¸‹ï¼š 1234final int hash;final K key;volatile V value;volatile HashEntry&lt;K,V&gt; next; å¯ä»¥å‘ç°ï¼Œhashå’Œkeyéƒ½æ˜¯è¢«finalä¿®é¥°çš„ï¼Œ valueå’Œnextæ˜¯è¢«volatileä¿®é¥°çš„ï¼Œä¿è¯äº†å¤šçº¿ç¨‹ä¸‹çš„å¯è§æ€§ã€‚ put1234567891011public V put(K key, V value) &#123; Segment&lt;K,V&gt; s; if (value == null) //valueä¸èƒ½ä¸ºç©º throw new NullPointerException(); int hash = hash(key); int j = (hash &gt;&gt;&gt; segmentShift) &amp; segmentMask; //å¯»æ‰¾å¯¹åº”çš„æ®µ if ((s = (Segment&lt;K,V&gt;)UNSAFE.getObject // nonvolatile; recheck (segments, (j &lt;&lt; SSHIFT) + SBASE)) == null) // in ensureSegment s = ensureSegment(j); return s.put(key, hash, value, false); //åœ¨å¯¹åº”çš„æ®µä¸­è¿›è¡Œput&#125; ä»ä¸Šè¿°ä»£ç å¯ä»¥å‘ç°ï¼ŒConcurrentHashMapä¸­valueä¸å…è®¸ä¸ºç©ºã€‚æ®µä¸­çš„putæ–¹æ³•å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445final V put(K key, int hash, V value, boolean onlyIfAbsent) &#123; HashEntry&lt;K,V&gt; node = tryLock() ? null : scanAndLockForPut(key, hash, value); V oldValue; try &#123; HashEntry&lt;K,V&gt;[] tab = table; int index = (tab.length - 1) &amp; hash; HashEntry&lt;K,V&gt; first = entryAt(tab, index); for (HashEntry&lt;K,V&gt; e = first;;) &#123; if (e != null) &#123; K k; if ((k = e.key) == key || (e.hash == hash &amp;&amp; key.equals(k))) &#123; //å¦‚æœå­˜åœ¨ç›¸åŒentryåˆ™æ›¿æ¢ oldValue = e.value; if (!onlyIfAbsent) &#123; e.value = value; ++modCount; &#125; break; &#125; e = e.next; &#125; else &#123; //å¦‚æœå½“å‰æ¡¶é‡Œæ²¡ä¸œè¥¿åˆ™åˆ›å»ºæ–°EntryåŠ è¿›å» if (node != null) node.setNext(first); else node = new HashEntry&lt;K,V&gt;(hash, key, value, first); int c = count + 1; if (c &gt; threshold &amp;&amp; tab.length &lt; MAXIMUM_CAPACITY) rehash(node); else setEntryAt(tab, index, node); ++modCount; count = c; oldValue = null; break; &#125; &#125; &#125; finally &#123; unlock(); &#125; return oldValue; &#125; å¯ä»¥çœ‹åˆ°putæ“ä½œè¿˜æ˜¯æœ‰åŠ é”å¤„ç†çš„ï¼Œå› ä¸ºvolatileå…³é”®å­—å¹¶ä¸èƒ½ä¿è¯åŸå­æ€§ã€‚å…ˆå°è¯•è·å–é”ï¼Œå¦‚æœå¤±è´¥ï¼Œåˆ™åˆ©ç”¨scanAndLockForPutè‡ªæ—‹è·å–é”ã€‚ rehash12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061private void rehash(HashEntry&lt;K,V&gt; node) &#123; /* * Reclassify nodes in each list to new table. Because we * are using power-of-two expansion, the elements from * each bin must either stay at same index, or move with a * power of two offset. We eliminate unnecessary node * creation by catching cases where old nodes can be * reused because their next fields won&#x27;t change. * Statistically, at the default threshold, only about * one-sixth of them need cloning when a table * doubles. The nodes they replace will be garbage * collectable as soon as they are no longer referenced by * any reader thread that may be in the midst of * concurrently traversing table. Entry accesses use plain * array indexing because they are followed by volatile * table write. */ HashEntry&lt;K,V&gt;[] oldTable = table; int oldCapacity = oldTable.length; int newCapacity = oldCapacity &lt;&lt; 1; threshold = (int)(newCapacity * loadFactor); HashEntry&lt;K,V&gt;[] newTable = (HashEntry&lt;K,V&gt;[]) new HashEntry[newCapacity]; int sizeMask = newCapacity - 1; for (int i = 0; i &lt; oldCapacity ; i++) &#123; HashEntry&lt;K,V&gt; e = oldTable[i]; if (e != null) &#123; HashEntry&lt;K,V&gt; next = e.next; int idx = e.hash &amp; sizeMask; if (next == null) // Single node on list newTable[idx] = e; else &#123; // Reuse consecutive sequence at same slot HashEntry&lt;K,V&gt; lastRun = e; int lastIdx = idx; for (HashEntry&lt;K,V&gt; last = next; last != null; last = last.next) &#123; int k = last.hash &amp; sizeMask; //1. è¿™é‡Œå°±æ˜¯éå†å½“å‰é“¾è¡¨ï¼Œæ‰¾åˆ°æœ€åä¸€ä¸ªä¸åœ¨åŸæ¡¶ä¸­çš„å…ƒç´ ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ åé¢çš„æ‰€æœ‰å…ƒç´ ä¹Ÿéƒ½ä¸åœ¨åŸæ¡¶ä¸­ã€‚ if (k != lastIdx) &#123; lastIdx = k; lastRun = last; &#125; &#125; newTable[lastIdx] = lastRun; // Clone remaining nodes for (HashEntry&lt;K,V&gt; p = e; p != lastRun; p = p.next) &#123; V v = p.value; int h = p.hash; int k = h &amp; sizeMask; HashEntry&lt;K,V&gt; n = newTable[k]; newTable[k] = new HashEntry&lt;K,V&gt;(h, p.key, v, n); &#125; &#125; &#125; &#125; int nodeIndex = node.hash &amp; sizeMask; // add the new node node.setNext(newTable[nodeIndex]); newTable[nodeIndex] = node; table = newTable; &#125; è¿™é‡Œä¸»è¦è¦æ³¨æ„é‡Œé¢çš„ä¸€ä¸ªä¼˜åŒ–ï¼Œè¿›è¡Œrehashæ—¶ï¼Œç”±äºæ‰©å®¹æ˜¯äºŒå€ï¼Œæ‰€ä»¥æœ¬æ¥æ¡¶ä¸­çš„é‚£äº›entryè¦ä¹ˆåœ¨åŸå¤„ï¼Œè¦ä¹ˆåœ¨åŸä½ç½®+åŸå®¹é‡çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´æ¡¶ä¸­çš„entryåªæœ‰ä¸¤ä¸ªå»å¤„ï¼šåŸåœ°ä¸åŠ¨æˆ–è€…å½“å‰ä½ç½®+å®¹é‡ã€‚æ‰€ä»¥æ³¨é‡Š1å¤„æ‰¾åˆ°æœ€åä¸€ä¸ªä¸åœ¨åŸæ¡¶ä¸­çš„å…ƒç´ åï¼Œè¿™ä¸ªå…ƒç´ åé¢çš„æ‰€æœ‰å…ƒç´ éƒ½ä¸åœ¨åŸæ¡¶ä¸­ä¸”éƒ½åœ¨ç›¸åŒçš„ç´¢å¼•å¤„ã€‚ get1234567891011121314151617public V get(Object key) &#123; Segment&lt;K,V&gt; s; // manually integrate access methods to reduce overhead HashEntry&lt;K,V&gt;[] tab; int h = hash(key); long u = (((h &gt;&gt;&gt; segmentShift) &amp; segmentMask) &lt;&lt; SSHIFT) + SBASE; if ((s = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(segments, u)) != null &amp;&amp; (tab = s.table) != null) &#123; for (HashEntry&lt;K,V&gt; e = (HashEntry&lt;K,V&gt;) UNSAFE.getObjectVolatile (tab, ((long)(((tab.length - 1) &amp; h)) &lt;&lt; TSHIFT) + TBASE); e != null; e = e.next) &#123; K k; if ((k = e.key) == key || (e.hash == h &amp;&amp; key.equals(k))) return e.value; &#125; &#125; return null; &#125; å› ä¸ºvalueéƒ½æ˜¯volatileä¿®é¥°çš„ï¼Œæ‰€ä»¥getè¿‡ç¨‹ä¸éœ€è¦åŠ é”ã€‚ sizesizeæ–¹æ³•æ˜¯è·¨æ®µæ“ä½œ 2. jdk 1.8å·¥ä½œåŸç†åº•å±‚ä½¿ç”¨çº¢é»‘æ ‘ï¼Œç±»ä¼¼hashmapçš„ä¼˜åŒ–ï¼š åœ¨å¹¶å‘æ§åˆ¶ä¸Šï¼ŒæŠ›å¼ƒäº†åŸæœ¬çš„åˆ†æ®µé”ï¼Œé‡‡ç”¨CAS+synchronized æ¥ä¿è¯å¹¶å‘å®‰å…¨æ€§ã€‚ put get sizeæ–¹æ³•1.8ä¸­sizeæ–¹æ³•å°±æ¯”è¾ƒç®€å• 123456public int size() &#123; long n = sumCount(); return ((n &lt; 0L) ? 0 : (n &gt; (long)Integer.MAX_VALUE) ? Integer.MAX_VALUE : (int)n); &#125; sumCountæ–¹æ³•ï¼š 1234567891011final long sumCount() &#123; CounterCell[] as = counterCells; CounterCell a; long sum = baseCount; if (as != null) &#123; for (int i = 0; i &lt; as.length; ++i) &#123; if ((a = as[i]) != null) sum += a.value; &#125; &#125; return sum; &#125; å¦‚æœcounterCellsä¸ç©ºï¼Œåˆ™éå†å…ƒç´ å’ŒbaseCountç´¯åŠ ã€‚å…³äºbaseCountå’ŒCounterCellsè§£é‡Šå¦‚ä¸‹ï¼š baseCountå®šä¹‰å¦‚ä¸‹ï¼š 123456/** * Base counter value, used mainly when there is no contention, * but also as a fallback during table initialization * races. Updated via CAS. */private transient volatile long baseCount; é€šè¿‡CASæ›´æ–°ï¼Œæ²¡æœ‰äº‰ç”¨æ—¶ä½¿ç”¨å®ƒè®¡æ•°ã€‚å®ƒåœ¨addCountæ–¹æ³•ä¸­è¢«ä½¿ç”¨ã€‚ å¦‚æœæœ‰äº‰ç”¨ï¼ŒbaseCountçš„CASæ›´æ–°å¤±è´¥ï¼Œé‚£ä¹ˆå°±å°è¯•æŠŠè¦æ›´æ–°çš„å¢é‡æ›´æ–°åˆ°CounterCellä¸­ CounterCellç»“æ„å¦‚ä¸‹ï¼š 12345678/** * A padded cell for distributing counts. Adapted from LongAdder * and Striped64. See their internal docs for explanation. */ @sun.misc.Contended static final class CounterCell &#123; volatile long value; CounterCell(long x) &#123; value = x; &#125; &#125; 1.7å’Œ1.8çš„åŒºåˆ« 1.7 1.8 æ•°æ®ç»“æ„ é“¾è¡¨ çº¢é»‘æ ‘ å¹¶å‘æ§åˆ¶ åˆ†æ®µé” CAS+synhcronized size å¤šæ¬¡è®¡ç®—ï¼Œå†å†³å®šæ˜¯å¦åŠ é” baseCount+CounterCell å‚è€ƒMap ç»¼è¿°ï¼ˆä¸‰ï¼‰ï¼šå½»å¤´å½»å°¾ç†è§£ ConcurrentHashMapï¼ˆjdk 1.6ï¼‰ HashMap? ConcurrentHashMap? ç›¸ä¿¡çœ‹å®Œè¿™ç¯‡æ²¡äººèƒ½éš¾ä½ä½ ï¼ (jdk1.7 jdk 1.8) Javaè¿›é˜¶ï¼ˆå…­ï¼‰ä»ConcurrentHashMapçš„æ¼”è¿›çœ‹Javaå¤šçº¿ç¨‹æ ¸å¿ƒæŠ€æœ¯ ç–«è‹—ï¼šJAVA HASHMAPçš„æ­»å¾ªç¯ å¹¶å‘ç¼–ç¨‹ â€”â€” ConcurrentHashMap size æ–¹æ³•åŸç†åˆ†æ","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"HashMap","slug":"HashMap","permalink":"http://example.com/tags/HashMap/"}]},{"title":"å…³äºsynchronizedå…³é”®å­—","slug":"å…³äºsynchronizeå…³é”®å­—","date":"2019-07-04T06:45:10.000Z","updated":"2019-07-04T06:45:10.000Z","comments":true,"path":"2019/07/04/å…³äºsynchronizeå…³é”®å­—/","link":"","permalink":"http://example.com/2019/07/04/%E5%85%B3%E4%BA%8Esynchronize%E5%85%B3%E9%94%AE%E5%AD%97/","excerpt":"","text":"synchronizedå…³é”®å­—å¯ä»¥ç”¨æ¥ä¿®é¥°æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥ä¿®é¥°ä»£ç å—ï¼Œä½†æ˜¯åº•å±‚çš„å®ç°æœ‰æ‰€ä¸åŒã€‚å¯¹äºåŒæ­¥æ–¹æ³•ï¼ŒJVMé‡‡ç”¨ACC_SYNCHRONIZEDæ ‡è®°ç¬¦æ¥å®ç°åŒæ­¥ã€‚ å¯¹äºåŒæ­¥ä»£ç å—ã€‚JVMé‡‡ç”¨monitorenterã€monitorexitä¸¤ä¸ªæŒ‡ä»¤æ¥å®ç°åŒæ­¥ã€‚ Q1: synchronizedå…³é”®å­—å¦‚ä½•å®ç°åŸå­æ€§ï¼Ÿ â€‹ é€šè¿‡moniterenterå’Œmoniterexitä¸¤ä¸ªæŒ‡ä»¤ä¿è¯ä»£ç å—åœ¨åŒä¸€æ—¶é—´å†…åªèƒ½è¢«åŒä¸€çº¿ç¨‹è®¿é—®ã€‚ Q2: synchronizedå…³é”®å­—å¦‚ä½•å®ç°å¯è§æ€§ï¼Ÿ â€‹ å¯¹äºsybchronizedå…³é”®å­—ï¼Œæœ‰ä¸€æ¡è§„å®šæ˜¯è¿™æ ·çš„ï¼Œåœ¨å¯¹ä»£ç å—è§£é”å‰ï¼Œéœ€è¦å…ˆæŠŠé‡Œé¢çš„å˜é‡åŒæ­¥åˆ°ä¸»å­˜ä¸­ï¼Œä»¥æ­¤æ¥ä¿è¯å¯è§æ€§ã€‚","categories":[{"name":"java","slug":"java","permalink":"http://example.com/categories/java/"}],"tags":[]},{"title":"ç§‘å­¦ä¸Šç½‘","slug":"ç§‘å­¦ä¸Šç½‘","date":"2019-07-04T02:58:39.000Z","updated":"2019-07-04T02:58:39.000Z","comments":true,"path":"2019/07/04/ç§‘å­¦ä¸Šç½‘/","link":"","permalink":"http://example.com/2019/07/04/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/","excerpt":"","text":"æœ€è¿‘ä¹°äº†ä¸ªvultr,ç‰¹æ­¤è®°å½•ä»¥ä¸‹å®‰è£…å°é£æœºçš„è¿‡ç¨‹ï¼š 123wget --no-check-certificate -O shadowsocks.sh https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks.shchmod +x shadowsocks.sh./shadowsocks.sh | tee shadowsocks.log ç„¶åæ ¹æ®æç¤ºè¾“å…¥å¯†ç ç«¯å£ä¹‹ç±»çš„ï¼Œç­‰å®‰è£…å¥½å°±å¯ä»¥ç”¨äº† 1/etc/init.d/shadowsocks status å¯ä»¥æŸ¥çœ‹shadowsocksæ˜¯å¦åœ¨è¿è¡Œ æœ‰æ—¶å€™shadowsocksä¸å¥½ç”¨ï¼Œå¯ä»¥ç”¨ssr 123wget --no-check-certificate https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocksR.shchmod +x shadowsocksR.sh./shadowsocksR.sh 2&gt;&amp;1 | tee shadowsocksR.log","categories":[{"name":"æ•™ç¨‹","slug":"æ•™ç¨‹","permalink":"http://example.com/categories/%E6%95%99%E7%A8%8B/"}],"tags":[{"name":"æ•™ç¨‹","slug":"æ•™ç¨‹","permalink":"http://example.com/tags/%E6%95%99%E7%A8%8B/"}]},{"title":"ç±»åŠ è½½æœºåˆ¶","slug":"ç±»åŠ è½½æœºåˆ¶","date":"2019-06-05T07:41:06.000Z","updated":"2019-06-05T07:41:06.000Z","comments":true,"path":"2019/06/05/ç±»åŠ è½½æœºåˆ¶/","link":"","permalink":"http://example.com/2019/06/05/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/","excerpt":"","text":"æ·±å…¥ç†è§£Javaç±»åŠ è½½å™¨(ClassLoader)2017å¹´06æœˆ26æ—¥ 09:34:08 zejian_ é˜…è¯»æ•°ï¼š115126 ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè¯·å°Šé‡åŸåˆ›ï¼Œæœªç»åšä¸»å…è®¸ç¦æ­¢è½¬è½½ï¼Œä¿ç•™è¿½ç©¶æƒ https://blog.csdn.net/javazejian/article/details/73413292 ã€ç‰ˆæƒç”³æ˜ã€‘æœªç»åšä¸»åŒæ„ï¼Œè°¢ç»è½¬è½½ï¼ï¼ˆè¯·å°Šé‡åŸåˆ›ï¼Œåšä¸»ä¿ç•™è¿½ç©¶æƒï¼‰http://blog.csdn.net/javazejian/article/details/73413292å‡ºè‡ªã€zejiançš„åšå®¢ã€‘ å…³è”æ–‡ç« ï¼š æ·±å…¥ç†è§£Javaç±»å‹ä¿¡æ¯(Classå¯¹è±¡)ä¸åå°„æœºåˆ¶ æ·±å…¥ç†è§£Javaæšä¸¾ç±»å‹(enum) æ·±å…¥ç†è§£Javaæ³¨è§£ç±»å‹(@Annotation) æ·±å…¥ç†è§£Javaç±»åŠ è½½å™¨(ClassLoader) æ·±å…¥ç†è§£Javaå¹¶å‘ä¹‹synchronizedå®ç°åŸç† Javaå¹¶å‘ç¼–ç¨‹-æ— é”CASä¸Unsafeç±»åŠå…¶å¹¶å‘åŒ…Atomic æ·±å…¥ç†è§£Javaå†…å­˜æ¨¡å‹(JMM)åŠvolatileå…³é”®å­— å‰–æåŸºäºå¹¶å‘AQSçš„é‡å…¥é”(ReetrantLock)åŠå…¶Conditionå®ç°åŸç† å‰–æåŸºäºå¹¶å‘AQSçš„å…±äº«é”çš„å®ç°(åŸºäºä¿¡å·é‡Semaphore) å¹¶å‘ä¹‹é˜»å¡é˜Ÿåˆ—LinkedBlockingQueueä¸ArrayBlockingQueue æœ¬ç¯‡åšæ–‡ä¸»è¦æ˜¯æ¢è®¨ç±»åŠ è½½å™¨ï¼ŒåŒæ—¶åœ¨æœ¬ç¯‡ä¸­åˆ—ä¸¾çš„æºç éƒ½åŸºäºJava8ç‰ˆæœ¬ï¼Œä¸åŒçš„ç‰ˆæœ¬å¯èƒ½æœ‰äº›è®¸å·®å¼‚ã€‚ä¸»è¦å†…å®¹å¦‚ä¸‹ ç±»åŠ è½½çš„æœºåˆ¶çš„å±‚æ¬¡ç»“æ„ å¯åŠ¨Bootstrapç±»åŠ è½½å™¨ æ‰©å±•Extensionç±»åŠ è½½å™¨ ç³»ç»ŸSystemç±»åŠ è½½å™¨ ç†è§£åŒäº²å§”æ´¾æ¨¡å¼ åŒäº²å§”æ´¾æ¨¡å¼å·¥ä½œåŸç† åŒäº²å§”æ´¾æ¨¡å¼ä¼˜åŠ¿ ç±»åŠ è½½å™¨é—´çš„å…³ç³» ç±»ä¸ç±»åŠ è½½å™¨ ç±»ä¸ç±»åŠ è½½å™¨ äº†è§£classæ–‡ä»¶çš„æ˜¾ç¤ºåŠ è½½ä¸éšå¼åŠ è½½çš„æ¦‚å¿µ ç¼–å†™è‡ªå·±çš„ç±»åŠ è½½å™¨ è‡ªå®šä¹‰Fileç±»åŠ è½½å™¨ è‡ªå®šä¹‰ç½‘ç»œç±»åŠ è½½å™¨ çƒ­éƒ¨ç½²ç±»åŠ è½½å™¨ åŒäº²å§”æ´¾æ¨¡å‹çš„ç ´åè€…-çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ ç±»åŠ è½½çš„æœºåˆ¶çš„å±‚æ¬¡ç»“æ„æ¯ä¸ªç¼–å†™çš„â€.javaâ€æ‹“å±•åç±»æ–‡ä»¶éƒ½å­˜å‚¨ç€éœ€è¦æ‰§è¡Œçš„ç¨‹åºé€»è¾‘ï¼Œè¿™äº›â€.javaâ€æ–‡ä»¶ç»è¿‡Javaç¼–è¯‘å™¨ç¼–è¯‘æˆæ‹“å±•åä¸ºâ€.classâ€çš„æ–‡ä»¶ï¼Œâ€.classâ€æ–‡ä»¶ä¸­ä¿å­˜ç€Javaä»£ç ç»è½¬æ¢åçš„è™šæ‹ŸæœºæŒ‡ä»¤ï¼Œå½“éœ€è¦ä½¿ç”¨æŸä¸ªç±»æ—¶ï¼Œè™šæ‹Ÿæœºå°†ä¼šåŠ è½½å®ƒçš„â€.classâ€æ–‡ä»¶ï¼Œå¹¶åˆ›å»ºå¯¹åº”çš„classå¯¹è±¡ï¼Œå°†classæ–‡ä»¶åŠ è½½åˆ°è™šæ‹Ÿæœºçš„å†…å­˜ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºç±»åŠ è½½ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹ç±»åŠ è½½çš„è¿‡ç¨‹ï¼Œå¦‚ä¸‹ï¼š åŠ è½½ï¼šç±»åŠ è½½è¿‡ç¨‹çš„ä¸€ä¸ªé˜¶æ®µï¼šé€šè¿‡ä¸€ä¸ªç±»çš„å®Œå…¨é™å®šæŸ¥æ‰¾æ­¤ç±»å­—èŠ‚ç æ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨å­—èŠ‚ç æ–‡ä»¶åˆ›å»ºä¸€ä¸ªClasså¯¹è±¡ éªŒè¯ï¼šç›®çš„åœ¨äºç¡®ä¿Classæ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºè¦æ±‚ï¼Œä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«å®‰å…¨ã€‚ä¸»è¦åŒ…æ‹¬å››ç§éªŒè¯ï¼Œæ–‡ä»¶æ ¼å¼éªŒè¯ï¼Œå…ƒæ•°æ®éªŒè¯ï¼Œå­—èŠ‚ç éªŒè¯ï¼Œç¬¦å·å¼•ç”¨éªŒè¯ã€‚ å‡†å¤‡ï¼šä¸ºç±»å˜é‡(å³staticä¿®é¥°çš„å­—æ®µå˜é‡)åˆ†é…å†…å­˜å¹¶ä¸”è®¾ç½®è¯¥ç±»å˜é‡çš„åˆå§‹å€¼å³0(å¦‚static int i=5;è¿™é‡Œåªå°†iåˆå§‹åŒ–ä¸º0ï¼Œè‡³äº5çš„å€¼å°†åœ¨åˆå§‹åŒ–æ—¶èµ‹å€¼)ï¼Œè¿™é‡Œä¸åŒ…å«ç”¨finalä¿®é¥°çš„staticï¼Œå› ä¸ºfinalåœ¨ç¼–è¯‘çš„æ—¶å€™å°±ä¼šåˆ†é…äº†ï¼Œæ³¨æ„è¿™é‡Œä¸ä¼šä¸ºå®ä¾‹å˜é‡åˆ†é…åˆå§‹åŒ–ï¼Œç±»å˜é‡ä¼šåˆ†é…åœ¨æ–¹æ³•åŒºä¸­ï¼Œè€Œå®ä¾‹å˜é‡æ˜¯ä¼šéšç€å¯¹è±¡ä¸€èµ·åˆ†é…åˆ°Javaå †ä¸­ã€‚ è§£æï¼šä¸»è¦å°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚ç¬¦å·å¼•ç”¨å°±æ˜¯ä¸€ç»„ç¬¦å·æ¥æè¿°ç›®æ ‡ï¼Œå¯ä»¥æ˜¯ä»»ä½•å­—é¢é‡ï¼Œè€Œç›´æ¥å¼•ç”¨å°±æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–ä¸€ä¸ªé—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚æœ‰ç±»æˆ–æ¥å£çš„è§£æï¼Œå­—æ®µè§£æï¼Œç±»æ–¹æ³•è§£æï¼Œæ¥å£æ–¹æ³•è§£æ(è¿™é‡Œæ¶‰åŠåˆ°å­—èŠ‚ç å˜é‡çš„å¼•ç”¨ï¼Œå¦‚éœ€æ›´è¯¦ç»†äº†è§£ï¼Œå¯å‚è€ƒã€Šæ·±å…¥Javaè™šæ‹Ÿæœºã€‹)ã€‚ åˆå§‹åŒ–ï¼šç±»åŠ è½½æœ€åé˜¶æ®µï¼Œè‹¥è¯¥ç±»å…·æœ‰è¶…ç±»ï¼Œåˆ™å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ï¼Œæ‰§è¡Œé™æ€åˆå§‹åŒ–å™¨å’Œé™æ€åˆå§‹åŒ–æˆå‘˜å˜é‡(å¦‚å‰é¢åªåˆå§‹åŒ–äº†é»˜è®¤å€¼çš„staticå˜é‡å°†ä¼šåœ¨è¿™ä¸ªé˜¶æ®µèµ‹å€¼ï¼Œæˆå‘˜å˜é‡ä¹Ÿå°†è¢«åˆå§‹åŒ–)ã€‚ è¿™ä¾¿æ˜¯ç±»åŠ è½½çš„5ä¸ªè¿‡ç¨‹ï¼Œè€Œç±»åŠ è½½å™¨çš„ä»»åŠ¡æ˜¯æ ¹æ®ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è¯»å–æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµåˆ°JVMä¸­ï¼Œç„¶åè½¬æ¢ä¸ºä¸€ä¸ªä¸ç›®æ ‡ç±»å¯¹åº”çš„java.lang.Classå¯¹è±¡å®ä¾‹ï¼Œåœ¨è™šæ‹Ÿæœºæä¾›äº†3ç§ç±»åŠ è½½å™¨ï¼Œå¼•å¯¼ï¼ˆBootstrapï¼‰ç±»åŠ è½½å™¨ã€æ‰©å±•ï¼ˆExtensionï¼‰ç±»åŠ è½½å™¨ã€ç³»ç»Ÿï¼ˆSystemï¼‰ç±»åŠ è½½å™¨ï¼ˆä¹Ÿç§°åº”ç”¨ç±»åŠ è½½å™¨ï¼‰ï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç» å¯åŠ¨ï¼ˆBootstrapï¼‰ç±»åŠ è½½å™¨å¯åŠ¨ç±»åŠ è½½å™¨ä¸»è¦åŠ è½½çš„æ˜¯JVMè‡ªèº«éœ€è¦çš„ç±»ï¼Œè¿™ä¸ªç±»åŠ è½½ä½¿ç”¨C++è¯­è¨€å®ç°çš„ï¼Œæ˜¯è™šæ‹Ÿæœºè‡ªèº«çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒè´Ÿè´£å°† &lt;JAVA_HOME&gt;/libè·¯å¾„ä¸‹çš„æ ¸å¿ƒç±»åº“æˆ–-Xbootclasspathå‚æ•°æŒ‡å®šçš„è·¯å¾„ä¸‹çš„jaråŒ…åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ³¨æ„å¿…ç”±äºè™šæ‹Ÿæœºæ˜¯æŒ‰ç…§æ–‡ä»¶åè¯†åˆ«åŠ è½½jaråŒ…çš„ï¼Œå¦‚rt.jarï¼Œå¦‚æœæ–‡ä»¶åä¸è¢«è™šæ‹Ÿæœºè¯†åˆ«ï¼Œå³ä½¿æŠŠjaråŒ…ä¸¢åˆ°libç›®å½•ä¸‹ä¹Ÿæ˜¯æ²¡æœ‰ä½œç”¨çš„(å‡ºäºå®‰å…¨è€ƒè™‘ï¼ŒBootstrapå¯åŠ¨ç±»åŠ è½½å™¨åªåŠ è½½åŒ…åä¸ºjavaã€javaxã€sunç­‰å¼€å¤´çš„ç±»)ã€‚ æ‰©å±•ï¼ˆExtensionï¼‰ç±»åŠ è½½å™¨æ‰©å±•ç±»åŠ è½½å™¨æ˜¯æŒ‡Sunå…¬å¸(å·²è¢«Oracleæ”¶è´­)å®ç°çš„sun.misc.Launcher$ExtClassLoaderç±»ï¼Œç”±Javaè¯­è¨€å®ç°çš„ï¼Œæ˜¯Launcherçš„é™æ€å†…éƒ¨ç±»ï¼Œå®ƒè´Ÿè´£åŠ è½½&lt;JAVA_HOME&gt;/lib/extç›®å½•ä¸‹æˆ–è€…ç”±ç³»ç»Ÿå˜é‡-Djava.ext.diræŒ‡å®šä½è·¯å¾„ä¸­çš„ç±»åº“ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨æ ‡å‡†æ‰©å±•ç±»åŠ è½½å™¨ã€‚ 12345678910111213141516171819//ExtClassLoaderç±»ä¸­è·å–è·¯å¾„çš„ä»£ç private static File[] getExtDirs() &#123; //åŠ è½½&lt;JAVA_HOME&gt;/lib/extç›®å½•ä¸­çš„ç±»åº“ String s = System.getProperty(&quot;java.ext.dirs&quot;); File[] dirs; if (s != null) &#123; StringTokenizer st = new StringTokenizer(s, File.pathSeparator); int count = st.countTokens(); dirs = new File[count]; for (int i = 0; i &lt; count; i++) &#123; dirs[i] = new File(st.nextToken()); &#125; &#125; else &#123; dirs = new File[0]; &#125; return dirs; &#125;12345678910111213141516171819 ç³»ç»Ÿï¼ˆSystemï¼‰ç±»åŠ è½½å™¨ä¹Ÿç§°åº”ç”¨ç¨‹åºåŠ è½½å™¨æ˜¯æŒ‡ Sunå…¬å¸å®ç°çš„sun.misc.Launcher$AppClassLoaderã€‚å®ƒè´Ÿè´£åŠ è½½ç³»ç»Ÿç±»è·¯å¾„java -classpathæˆ–-D java.class.path æŒ‡å®šè·¯å¾„ä¸‹çš„ç±»åº“ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„classpathè·¯å¾„ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨ç³»ç»Ÿç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¯¥ç±»åŠ è½½æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼Œé€šè¿‡ClassLoader#getSystemClassLoader()æ–¹æ³•å¯ä»¥è·å–åˆ°è¯¥ç±»åŠ è½½å™¨ã€‚ åœ¨Javaçš„æ—¥å¸¸åº”ç”¨ç¨‹åºå¼€å‘ä¸­ï¼Œç±»çš„åŠ è½½å‡ ä¹æ˜¯ç”±ä¸Šè¿°3ç§ç±»åŠ è½½å™¨ç›¸äº’é…åˆæ‰§è¡Œçš„ï¼Œåœ¨å¿…è¦æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒJavaè™šæ‹Ÿæœºå¯¹classæ–‡ä»¶é‡‡ç”¨çš„æ˜¯æŒ‰éœ€åŠ è½½çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´å½“éœ€è¦ä½¿ç”¨è¯¥ç±»æ—¶æ‰ä¼šå°†å®ƒçš„classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ç”Ÿæˆclasså¯¹è±¡ï¼Œè€Œä¸”åŠ è½½æŸä¸ªç±»çš„classæ–‡ä»¶æ—¶ï¼ŒJavaè™šæ‹Ÿæœºé‡‡ç”¨çš„æ˜¯åŒäº²å§”æ´¾æ¨¡å¼å³æŠŠè¯·æ±‚äº¤ç”±çˆ¶ç±»å¤„ç†ï¼Œå®ƒä¸€ç§ä»»åŠ¡å§”æ´¾æ¨¡å¼ï¼Œä¸‹é¢æˆ‘ä»¬è¿›ä¸€æ­¥äº†è§£å®ƒã€‚ ç†è§£åŒäº²å§”æ´¾æ¨¡å¼åŒäº²å§”æ´¾æ¨¡å¼å·¥ä½œåŸç†åŒäº²å§”æ´¾æ¨¡å¼è¦æ±‚é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½åº”å½“æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ï¼Œè¯·æ³¨æ„åŒäº²å§”æ´¾æ¨¡å¼ä¸­çš„çˆ¶å­å…³ç³»å¹¶éé€šå¸¸æ‰€è¯´çš„ç±»ç»§æ‰¿å…³ç³»ï¼Œè€Œæ˜¯é‡‡ç”¨ç»„åˆå…³ç³»æ¥å¤ç”¨çˆ¶ç±»åŠ è½½å™¨çš„ç›¸å…³ä»£ç ï¼Œç±»åŠ è½½å™¨é—´çš„å…³ç³»å¦‚ä¸‹ï¼š åŒäº²å§”æ´¾æ¨¡å¼æ˜¯åœ¨Java 1.2åå¼•å…¥çš„ï¼Œå…¶å·¥ä½œåŸç†çš„æ˜¯ï¼Œå¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½è¯·æ±‚ï¼Œå®ƒå¹¶ä¸ä¼šè‡ªå·±å…ˆå»åŠ è½½ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™çˆ¶ç±»çš„åŠ è½½å™¨å»æ‰§è¡Œï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨è¿˜å­˜åœ¨å…¶çˆ¶ç±»åŠ è½½å™¨ï¼Œåˆ™è¿›ä¸€æ­¥å‘ä¸Šå§”æ‰˜ï¼Œä¾æ¬¡é€’å½’ï¼Œè¯·æ±‚æœ€ç»ˆå°†åˆ°è¾¾é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨å¯ä»¥å®Œæˆç±»åŠ è½½ä»»åŠ¡ï¼Œå°±æˆåŠŸè¿”å›ï¼Œå€˜è‹¥çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆæ­¤åŠ è½½ä»»åŠ¡ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ï¼Œè¿™å°±æ˜¯åŒäº²å§”æ´¾æ¨¡å¼ï¼Œå³æ¯ä¸ªå„¿å­éƒ½å¾ˆæ‡’ï¼Œæ¯æ¬¡æœ‰æ´»å°±ä¸¢ç»™çˆ¶äº²å»å¹²ï¼Œç›´åˆ°çˆ¶äº²è¯´è¿™ä»¶äº‹æˆ‘ä¹Ÿå¹²ä¸äº†æ—¶ï¼Œå„¿å­è‡ªå·±æƒ³åŠæ³•å»å®Œæˆï¼Œè¿™ä¸å°±æ˜¯ä¼ è¯´ä¸­çš„å®åŠ›å‘çˆ¹å•Šï¼Ÿé‚£ä¹ˆé‡‡ç”¨è¿™ç§æ¨¡å¼æœ‰å•¥ç”¨å‘¢? åŒäº²å§”æ´¾æ¨¡å¼ä¼˜åŠ¿é‡‡ç”¨åŒäº²å§”æ´¾æ¨¡å¼çš„æ˜¯å¥½å¤„æ˜¯Javaç±»éšç€å®ƒçš„ç±»åŠ è½½å™¨ä¸€èµ·å…·å¤‡äº†ä¸€ç§å¸¦æœ‰ä¼˜å…ˆçº§çš„å±‚æ¬¡å…³ç³»ï¼Œé€šè¿‡è¿™ç§å±‚çº§å…³å¯ä»¥é¿å…ç±»çš„é‡å¤åŠ è½½ï¼Œå½“çˆ¶äº²å·²ç»åŠ è½½äº†è¯¥ç±»æ—¶ï¼Œå°±æ²¡æœ‰å¿…è¦å­ClassLoaderå†åŠ è½½ä¸€æ¬¡ã€‚å…¶æ¬¡æ˜¯è€ƒè™‘åˆ°å®‰å…¨å› ç´ ï¼Œjavaæ ¸å¿ƒapiä¸­å®šä¹‰ç±»å‹ä¸ä¼šè¢«éšæ„æ›¿æ¢ï¼Œå‡è®¾é€šè¿‡ç½‘ç»œä¼ é€’ä¸€ä¸ªåä¸ºjava.lang.Integerçš„ç±»ï¼Œé€šè¿‡åŒäº²å§”æ‰˜æ¨¡å¼ä¼ é€’åˆ°å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œè€Œå¯åŠ¨ç±»åŠ è½½å™¨åœ¨æ ¸å¿ƒJava APIå‘ç°è¿™ä¸ªåå­—çš„ç±»ï¼Œå‘ç°è¯¥ç±»å·²è¢«åŠ è½½ï¼Œå¹¶ä¸ä¼šé‡æ–°åŠ è½½ç½‘ç»œä¼ é€’çš„è¿‡æ¥çš„java.lang.Integerï¼Œè€Œç›´æ¥è¿”å›å·²åŠ è½½è¿‡çš„Integer.classï¼Œè¿™æ ·ä¾¿å¯ä»¥é˜²æ­¢æ ¸å¿ƒAPIåº“è¢«éšæ„ç¯¡æ”¹ã€‚å¯èƒ½ä½ ä¼šæƒ³ï¼Œå¦‚æœæˆ‘ä»¬åœ¨classpathè·¯å¾„ä¸‹è‡ªå®šä¹‰ä¸€ä¸ªåä¸ºjava.lang.SingleIntergeç±»(è¯¥ç±»æ˜¯èƒ¡ç¼–çš„)å‘¢ï¼Ÿè¯¥ç±»å¹¶ä¸å­˜åœ¨java.langä¸­ï¼Œç»è¿‡åŒäº²å§”æ‰˜æ¨¡å¼ï¼Œä¼ é€’åˆ°å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ï¼Œç”±äºçˆ¶ç±»åŠ è½½å™¨è·¯å¾„ä¸‹å¹¶æ²¡æœ‰è¯¥ç±»ï¼Œæ‰€ä»¥ä¸ä¼šåŠ è½½ï¼Œå°†åå‘å§”æ‰˜ç»™å­ç±»åŠ è½½å™¨åŠ è½½ï¼Œæœ€ç»ˆä¼šé€šè¿‡ç³»ç»Ÿç±»åŠ è½½å™¨åŠ è½½è¯¥ç±»ã€‚ä½†æ˜¯è¿™æ ·åšæ˜¯ä¸å…è®¸ï¼Œå› ä¸ºjava.langæ˜¯æ ¸å¿ƒAPIåŒ…ï¼Œéœ€è¦è®¿é—®æƒé™ï¼Œå¼ºåˆ¶åŠ è½½å°†ä¼šæŠ¥å‡ºå¦‚ä¸‹å¼‚å¸¸ 1java.lang.SecurityException: Prohibited package name: java.lang1 æ‰€ä»¥æ— è®ºå¦‚ä½•éƒ½æ— æ³•åŠ è½½æˆåŠŸçš„ã€‚ä¸‹é¢æˆ‘ä»¬ä»ä»£ç å±‚é¢äº†è§£å‡ ä¸ªJavaä¸­å®šä¹‰çš„ç±»åŠ è½½å™¨åŠå…¶åŒäº²å§”æ´¾æ¨¡å¼çš„å®ç°ï¼Œå®ƒä»¬ç±»å›¾å…³ç³»å¦‚ä¸‹ ä»å›¾å¯ä»¥çœ‹å‡ºé¡¶å±‚çš„ç±»åŠ è½½å™¨æ˜¯ClassLoaderç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå…¶åæ‰€æœ‰çš„ç±»åŠ è½½å™¨éƒ½ç»§æ‰¿è‡ªClassLoaderï¼ˆä¸åŒ…æ‹¬å¯åŠ¨ç±»åŠ è½½å™¨ï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦ä»‹ç»ClassLoaderä¸­å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„æ–¹æ³•ã€‚ loadClass(String) è¯¥æ–¹æ³•åŠ è½½æŒ‡å®šåç§°ï¼ˆåŒ…æ‹¬åŒ…åï¼‰çš„äºŒè¿›åˆ¶ç±»å‹ï¼Œè¯¥æ–¹æ³•åœ¨JDK1.2ä¹‹åä¸å†å»ºè®®ç”¨æˆ·é‡å†™ä½†ç”¨æˆ·å¯ä»¥ç›´æ¥è°ƒç”¨è¯¥æ–¹æ³•ï¼ŒloadClass()æ–¹æ³•æ˜¯ClassLoaderç±»è‡ªå·±å®ç°çš„ï¼Œè¯¥æ–¹æ³•ä¸­çš„é€»è¾‘å°±æ˜¯åŒäº²å§”æ´¾æ¨¡å¼çš„å®ç°ï¼Œå…¶æºç å¦‚ä¸‹ï¼ŒloadClass(String name, boolean resolve)æ˜¯ä¸€ä¸ªé‡è½½æ–¹æ³•ï¼Œresolveå‚æ•°ä»£è¡¨æ˜¯å¦ç”Ÿæˆclasså¯¹è±¡çš„åŒæ—¶è¿›è¡Œè§£æç›¸å…³æ“ä½œã€‚ï¼š 1234567891011121314151617181920212223242526272829303132333435363738protected Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException &#123; synchronized (getClassLoadingLock(name)) &#123; // å…ˆä»ç¼“å­˜æŸ¥æ‰¾è¯¥classå¯¹è±¡ï¼Œæ‰¾åˆ°å°±ä¸ç”¨é‡æ–°åŠ è½½ Class&lt;?&gt; c = findLoadedClass(name); if (c == null) &#123; long t0 = System.nanoTime(); try &#123; if (parent != null) &#123; //å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™å§”æ‰˜ç»™çˆ¶ç±»åŠ è½½å™¨å»åŠ è½½ c = parent.loadClass(name, false); &#125; else &#123; //å¦‚æœæ²¡æœ‰çˆ¶ç±»ï¼Œåˆ™å§”æ‰˜ç»™å¯åŠ¨åŠ è½½å™¨å»åŠ è½½ c = findBootstrapClassOrNull(name); &#125; &#125; catch (ClassNotFoundException e) &#123; // ClassNotFoundException thrown if class not found // from the non-null parent class loader &#125; if (c == null) &#123; // If still not found, then invoke findClass in order // å¦‚æœéƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™é€šè¿‡è‡ªå®šä¹‰å®ç°çš„findClasså»æŸ¥æ‰¾å¹¶åŠ è½½ c = findClass(name); // this is the defining class loader; record the stats sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0); sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1); sun.misc.PerfCounter.getFindClasses().increment(); &#125; &#125; if (resolve) &#123;//æ˜¯å¦éœ€è¦åœ¨åŠ è½½æ—¶è¿›è¡Œè§£æ resolveClass(c); &#125; return c; &#125; &#125;1234567891011121314151617181920212223242526272829303132333435363738 æ­£å¦‚loadClassæ–¹æ³•æ‰€å±•ç¤ºçš„ï¼Œå½“ç±»åŠ è½½è¯·æ±‚åˆ°æ¥æ—¶ï¼Œå…ˆä»ç¼“å­˜ä¸­æŸ¥æ‰¾è¯¥ç±»å¯¹è±¡ï¼Œå¦‚æœå­˜åœ¨ç›´æ¥è¿”å›ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™äº¤ç»™è¯¥ç±»åŠ è½½å»çš„çˆ¶åŠ è½½å™¨å»åŠ è½½ï¼Œå€˜è‹¥æ²¡æœ‰çˆ¶åŠ è½½åˆ™äº¤ç»™é¡¶çº§å¯åŠ¨ç±»åŠ è½½å™¨å»åŠ è½½ï¼Œæœ€åå€˜è‹¥ä»æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ä½¿ç”¨findClass()æ–¹æ³•å»åŠ è½½ï¼ˆå…³äºfindClass()ç¨åä¼šè¿›ä¸€æ­¥ä»‹ç»ï¼‰ã€‚ä»loadClasså®ç°ä¹Ÿå¯ä»¥çŸ¥é“å¦‚æœä¸æƒ³é‡æ–°å®šä¹‰åŠ è½½ç±»çš„è§„åˆ™ï¼Œä¹Ÿæ²¡æœ‰å¤æ‚çš„é€»è¾‘ï¼Œåªæƒ³åœ¨è¿è¡Œæ—¶åŠ è½½è‡ªå·±æŒ‡å®šçš„ç±»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨this.getClass().getClassLoder.loadClass(&quot;className&quot;)ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥è°ƒç”¨ClassLoaderçš„loadClassæ–¹æ³•è·å–åˆ°classå¯¹è±¡ã€‚ findClass(String)åœ¨JDK1.2ä¹‹å‰ï¼Œåœ¨è‡ªå®šä¹‰ç±»åŠ è½½æ—¶ï¼Œæ€»ä¼šå»ç»§æ‰¿ClassLoaderç±»å¹¶é‡å†™loadClassæ–¹æ³•ï¼Œä»è€Œå®ç°è‡ªå®šä¹‰çš„ç±»åŠ è½½ç±»ï¼Œä½†æ˜¯åœ¨JDK1.2ä¹‹åå·²ä¸å†å»ºè®®ç”¨æˆ·å»è¦†ç›–loadClass()æ–¹æ³•ï¼Œè€Œæ˜¯å»ºè®®æŠŠè‡ªå®šä¹‰çš„ç±»åŠ è½½é€»è¾‘å†™åœ¨findClass()æ–¹æ³•ä¸­ï¼Œä»å‰é¢çš„åˆ†æå¯çŸ¥ï¼ŒfindClass()æ–¹æ³•æ˜¯åœ¨loadClass()æ–¹æ³•ä¸­è¢«è°ƒç”¨çš„ï¼Œå½“loadClass()æ–¹æ³•ä¸­çˆ¶åŠ è½½å™¨åŠ è½½å¤±è´¥åï¼Œåˆ™ä¼šè°ƒç”¨è‡ªå·±çš„findClass()æ–¹æ³•æ¥å®Œæˆç±»åŠ è½½ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ä¹Ÿç¬¦åˆåŒäº²å§”æ‰˜æ¨¡å¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ClassLoaderç±»ä¸­å¹¶æ²¡æœ‰å®ç°findClass()æ–¹æ³•çš„å…·ä½“ä»£ç é€»è¾‘ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯æŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸ï¼ŒåŒæ—¶åº”è¯¥çŸ¥é“çš„æ˜¯findClassæ–¹æ³•é€šå¸¸æ˜¯å’ŒdefineClassæ–¹æ³•ä¸€èµ·ä½¿ç”¨çš„(ç¨åä¼šåˆ†æ)ï¼ŒClassLoaderç±»ä¸­findClass()æ–¹æ³•æºç å¦‚ä¸‹ï¼š 1234//ç›´æ¥æŠ›å‡ºå¼‚å¸¸protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123; throw new ClassNotFoundException(name);&#125;1234 defineClass(byte[] b, int off, int len)defineClass()æ–¹æ³•æ˜¯ç”¨æ¥å°†byteå­—èŠ‚æµè§£ææˆJVMèƒ½å¤Ÿè¯†åˆ«çš„Classå¯¹è±¡(ClassLoaderä¸­å·²å®ç°è¯¥æ–¹æ³•é€»è¾‘)ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•ä¸ä»…èƒ½å¤Ÿé€šè¿‡classæ–‡ä»¶å®ä¾‹åŒ–classå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼å®ä¾‹åŒ–classå¯¹è±¡ï¼Œå¦‚é€šè¿‡ç½‘ç»œæ¥æ”¶ä¸€ä¸ªç±»çš„å­—èŠ‚ç ï¼Œç„¶åè½¬æ¢ä¸ºbyteå­—èŠ‚æµåˆ›å»ºå¯¹åº”çš„Classå¯¹è±¡ï¼ŒdefineClass()æ–¹æ³•é€šå¸¸ä¸findClass()æ–¹æ³•ä¸€èµ·ä½¿ç”¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œä¼šç›´æ¥è¦†ç›–ClassLoaderçš„findClass()æ–¹æ³•å¹¶ç¼–å†™åŠ è½½è§„åˆ™ï¼Œå–å¾—è¦åŠ è½½ç±»çš„å­—èŠ‚ç åè½¬æ¢æˆæµï¼Œç„¶åè°ƒç”¨defineClass()æ–¹æ³•ç”Ÿæˆç±»çš„Classå¯¹è±¡ï¼Œç®€å•ä¾‹å­å¦‚ä¸‹ï¼š 12345678910protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123; // è·å–ç±»çš„å­—èŠ‚æ•°ç»„ byte[] classData = getClassData(name); if (classData == null) &#123; throw new ClassNotFoundException(); &#125; else &#123; //ä½¿ç”¨defineClassç”Ÿæˆclasså¯¹è±¡ return defineClass(name, classData, 0, classData.length); &#125; &#125;12345678910 éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœç›´æ¥è°ƒç”¨defineClass()æ–¹æ³•ç”Ÿæˆç±»çš„Classå¯¹è±¡ï¼Œè¿™ä¸ªç±»çš„Classå¯¹è±¡å¹¶æ²¡æœ‰è§£æ(ä¹Ÿå¯ä»¥ç†è§£ä¸ºé“¾æ¥é˜¶æ®µï¼Œæ¯•ç«Ÿè§£ææ˜¯é“¾æ¥çš„æœ€åä¸€æ­¥)ï¼Œå…¶è§£ææ“ä½œéœ€è¦ç­‰å¾…åˆå§‹åŒ–é˜¶æ®µè¿›è¡Œã€‚ resolveClass(Classâ‰º?â‰» c)ä½¿ç”¨è¯¥æ–¹æ³•å¯ä»¥ä½¿ç”¨ç±»çš„Classå¯¹è±¡åˆ›å»ºå®Œæˆä¹ŸåŒæ—¶è¢«è§£æã€‚å‰é¢æˆ‘ä»¬è¯´é“¾æ¥é˜¶æ®µä¸»è¦æ˜¯å¯¹å­—èŠ‚ç è¿›è¡ŒéªŒè¯ï¼Œä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®åˆå§‹å€¼åŒæ—¶å°†å­—èŠ‚ç æ–‡ä»¶ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨ã€‚ ä¸Šè¿°4ä¸ªæ–¹æ³•æ˜¯ClassLoaderç±»ä¸­çš„æ¯”è¾ƒé‡è¦çš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å¯èƒ½ä¼šç»å¸¸ç”¨åˆ°çš„æ–¹æ³•ã€‚æ¥çœ‹SercureClassLoaderæ‰©å±•äº† ClassLoaderï¼Œæ–°å¢äº†å‡ ä¸ªä¸ä½¿ç”¨ç›¸å…³çš„ä»£ç æº(å¯¹ä»£ç æºçš„ä½ç½®åŠå…¶è¯ä¹¦çš„éªŒè¯)å’Œæƒé™å®šä¹‰ç±»éªŒè¯(ä¸»è¦æŒ‡å¯¹classæºç çš„è®¿é—®æƒé™)çš„æ–¹æ³•ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¸ä¼šç›´æ¥è·Ÿè¿™ä¸ªç±»æ‰“äº¤é“ï¼Œæ›´å¤šæ˜¯ä¸å®ƒçš„å­ç±»URLClassLoaderæœ‰æ‰€å…³è”ï¼Œå‰é¢è¯´è¿‡ï¼ŒClassLoaderæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå¾ˆå¤šæ–¹æ³•æ˜¯ç©ºçš„æ²¡æœ‰å®ç°ï¼Œæ¯”å¦‚ findClass()ã€findResource()ç­‰ã€‚è€ŒURLClassLoaderè¿™ä¸ªå®ç°ç±»ä¸ºè¿™äº›æ–¹æ³•æä¾›äº†å…·ä½“çš„å®ç°ï¼Œå¹¶æ–°å¢äº†URLClassPathç±»ååŠ©å–å¾—Classå­—èŠ‚ç æµç­‰åŠŸèƒ½ï¼Œåœ¨ç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¦‚æœæ²¡æœ‰å¤ªè¿‡äºå¤æ‚çš„éœ€æ±‚ï¼Œå¯ä»¥ç›´æ¥ç»§æ‰¿URLClassLoaderç±»ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…è‡ªå·±å»ç¼–å†™findClass()æ–¹æ³•åŠå…¶è·å–å­—èŠ‚ç æµçš„æ–¹å¼ï¼Œä½¿è‡ªå®šä¹‰ç±»åŠ è½½å™¨ç¼–å†™æ›´åŠ ç®€æ´ï¼Œä¸‹é¢æ˜¯URLClassLoaderçš„ç±»å›¾(åˆ©ç”¨IDEAç”Ÿæˆçš„ç±»å›¾) ä»ç±»å›¾ç»“æ„çœ‹å‡ºURLClassLoaderä¸­å­˜åœ¨ä¸€ä¸ªURLClassPathç±»ï¼Œé€šè¿‡è¿™ä¸ªç±»å°±å¯ä»¥æ‰¾åˆ°è¦åŠ è½½çš„å­—èŠ‚ç æµï¼Œä¹Ÿå°±æ˜¯è¯´URLClassPathç±»è´Ÿè´£æ‰¾åˆ°è¦åŠ è½½çš„å­—èŠ‚ç ï¼Œå†è¯»å–æˆå­—èŠ‚æµï¼Œæœ€åé€šè¿‡defineClass()æ–¹æ³•åˆ›å»ºç±»çš„Classå¯¹è±¡ã€‚ä»URLClassLoaderç±»çš„ç»“æ„å›¾å¯ä»¥çœ‹å‡ºå…¶æ„é€ æ–¹æ³•éƒ½æœ‰ä¸€ä¸ªå¿…é¡»ä¼ é€’çš„å‚æ•°URL[]ï¼Œè¯¥å‚æ•°çš„å…ƒç´ æ˜¯ä»£è¡¨å­—èŠ‚ç æ–‡ä»¶çš„è·¯å¾„,æ¢å¥è¯è¯´åœ¨åˆ›å»ºURLClassLoaderå¯¹è±¡æ—¶å¿…é¡»è¦æŒ‡å®šè¿™ä¸ªç±»åŠ è½½å™¨çš„åˆ°é‚£ä¸ªç›®å½•ä¸‹æ‰¾classæ–‡ä»¶ã€‚åŒæ—¶ä¹Ÿåº”è¯¥æ³¨æ„URL[]ä¹Ÿæ˜¯URLClassPathç±»çš„å¿…ä¼ å‚æ•°ï¼Œåœ¨åˆ›å»ºURLClassPathå¯¹è±¡æ—¶ï¼Œä¼šæ ¹æ®ä¼ é€’è¿‡æ¥çš„URLæ•°ç»„ä¸­çš„è·¯å¾„åˆ¤æ–­æ˜¯æ–‡ä»¶è¿˜æ˜¯jaråŒ…ï¼Œç„¶åæ ¹æ®ä¸åŒçš„è·¯å¾„åˆ›å»ºFileLoaderæˆ–è€…JarLoaderæˆ–é»˜è®¤Loaderç±»å»åŠ è½½ç›¸åº”è·¯å¾„ä¸‹çš„classæ–‡ä»¶ï¼Œè€Œå½“JVMè°ƒç”¨findClass()æ–¹æ³•æ—¶ï¼Œå°±ç”±è¿™3ä¸ªåŠ è½½å™¨ä¸­çš„ä¸€ä¸ªå°†classæ–‡ä»¶çš„å­—èŠ‚ç æµåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæœ€ååˆ©ç”¨å­—èŠ‚ç æµåˆ›å»ºç±»çš„classå¯¹è±¡ã€‚è¯·è®°ä½ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å®šä¹‰ç±»åŠ è½½å™¨æ—¶é€‰æ‹©ç»§æ‰¿ClassLoaderç±»è€ŒéURLClassLoaderï¼Œå¿…é¡»æ‰‹åŠ¨ç¼–å†™findclass()æ–¹æ³•çš„åŠ è½½é€»è¾‘ä»¥åŠè·å–å­—èŠ‚ç æµçš„é€»è¾‘ã€‚äº†è§£å®ŒURLClassLoaderåæ¥ç€çœ‹çœ‹å‰©ä½™çš„ä¸¤ä¸ªç±»åŠ è½½å™¨ï¼Œå³æ‹“å±•ç±»åŠ è½½å™¨ExtClassLoaderå’Œç³»ç»Ÿç±»åŠ è½½å™¨AppClassLoaderï¼Œè¿™ä¸¤ä¸ªç±»éƒ½ç»§æ‰¿è‡ªURLClassLoaderï¼Œæ˜¯sun.misc.Launcherçš„é™æ€å†…éƒ¨ç±»ã€‚sun.misc.Launcherä¸»è¦è¢«ç³»ç»Ÿç”¨äºå¯åŠ¨ä¸»åº”ç”¨ç¨‹åºï¼ŒExtClassLoaderå’ŒAppClassLoaderéƒ½æ˜¯ç”±sun.misc.Launcheråˆ›å»ºçš„ï¼Œå…¶ç±»ä¸»è¦ç±»ç»“æ„å¦‚ä¸‹ï¼š å®ƒä»¬é—´çš„å…³ç³»æ­£å¦‚å‰é¢æ‰€é˜è¿°çš„é‚£æ ·ï¼ŒåŒæ—¶æˆ‘ä»¬å‘ç°ExtClassLoaderå¹¶æ²¡æœ‰é‡å†™loadClass()æ–¹æ³•ï¼Œè¿™è¶³çŸ£è¯´æ˜å…¶éµå¾ªåŒäº²å§”æ´¾æ¨¡å¼ï¼Œè€ŒAppClassLoaderé‡è½½äº†loadCass()æ–¹æ³•ï¼Œä½†æœ€ç»ˆè°ƒç”¨çš„è¿˜æ˜¯çˆ¶ç±»loadClass()æ–¹æ³•ï¼Œå› æ­¤ä¾ç„¶éµå®ˆåŒäº²å§”æ´¾æ¨¡å¼ï¼Œé‡è½½æ–¹æ³•æºç å¦‚ä¸‹ï¼š 12345678910111213141516/** * Override loadClass æ–¹æ³•ï¼Œæ–°å¢åŒ…æƒé™æ£€æµ‹åŠŸèƒ½ */public Class loadClass(String name, boolean resolve) throws ClassNotFoundException&#123; int i = name.lastIndexOf(&#x27;.&#x27;); if (i != -1) &#123; SecurityManager sm = System.getSecurityManager(); if (sm != null) &#123; sm.checkPackageAccess(name.substring(0, i)); &#125; &#125; //ä¾ç„¶è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³• return (super.loadClass(name, resolve));&#125;12345678910111213141516 å…¶å®æ— è®ºæ˜¯ExtClassLoaderè¿˜æ˜¯AppClassLoaderéƒ½ç»§æ‰¿URLClassLoaderç±»ï¼Œå› æ­¤å®ƒä»¬éƒ½éµå®ˆåŒäº²å§”æ‰˜æ¨¡å‹ï¼Œè¿™ç‚¹æ˜¯æ¯‹åº¸ç½®ç–‘çš„ã€‚okï¼Œåˆ°æ­¤æˆ‘ä»¬å¯¹ClassLoaderã€URLClassLoaderã€ExtClassLoaderã€AppClassLoaderä»¥åŠLauncherç±»é—´çš„å…³ç³»æœ‰äº†æ¯”è¾ƒæ¸…æ™°çš„äº†è§£ï¼ŒåŒæ—¶å¯¹ä¸€äº›ä¸»è¦çš„æ–¹æ³•ä¹Ÿæœ‰ä¸€å®šçš„è®¤è¯†ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰å¯¹è¿™äº›ç±»çš„æºç è¿›è¡Œè¯¦ç»†çš„åˆ†æï¼Œæ¯•ç«Ÿæ²¡æœ‰é‚£ä¸ªå¿…è¦ï¼Œå› ä¸ºæˆ‘ä»¬ä¸»è¦å¼„å¾—ç±»ä¸ç±»é—´çš„å…³ç³»å’Œå¸¸ç”¨çš„æ–¹æ³•åŒæ—¶ææ¸…æ¥šåŒäº²å§”æ‰˜æ¨¡å¼çš„å®ç°è¿‡ç¨‹ï¼Œä¸ºç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨åšé“ºå«å°±è¶³å¤Ÿäº†ã€‚okï¼Œå‰é¢å‡ºç°äº†å¾ˆå¤šçˆ¶ç±»åŠ è½½å™¨çš„è¯´æ³•ï¼Œä½†æ¯ä¸ªç±»åŠ è½½å™¨çš„çˆ¶ç±»åˆ°åº•æ˜¯è°ï¼Œä¸€ç›´æ²¡æœ‰é˜æ˜ï¼Œä¸‹é¢æˆ‘ä»¬å°±é€šè¿‡ä»£ç éªŒè¯çš„æ–¹å¼æ¥é˜æ˜è¿™ç­”æ¡ˆã€‚ ç±»åŠ è½½å™¨é—´çš„å…³ç³»æˆ‘ä»¬è¿›ä¸€æ­¥äº†è§£ç±»åŠ è½½å™¨é—´çš„å…³ç³»(å¹¶éæŒ‡ç»§æ‰¿å…³ç³»)ï¼Œä¸»è¦å¯ä»¥åˆ†ä¸ºä»¥ä¸‹4ç‚¹ å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œç”±C++å®ç°ï¼Œæ²¡æœ‰çˆ¶ç±»ã€‚ æ‹“å±•ç±»åŠ è½½å™¨(ExtClassLoader)ï¼Œç”±Javaè¯­è¨€å®ç°ï¼Œçˆ¶ç±»åŠ è½½å™¨ä¸ºnull ç³»ç»Ÿç±»åŠ è½½å™¨(AppClassLoader)ï¼Œç”±Javaè¯­è¨€å®ç°ï¼Œçˆ¶ç±»åŠ è½½å™¨ä¸ºExtClassLoader è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œçˆ¶ç±»åŠ è½½å™¨è‚¯å®šä¸ºAppClassLoaderã€‚ ä¸‹é¢æˆ‘ä»¬é€šè¿‡ç¨‹åºæ¥éªŒè¯ä¸Šè¿°é˜è¿°çš„è§‚ç‚¹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344/** * Created by zejian on 2017/6/18. * Blog : http://blog.csdn.net/javazejian [åŸæ–‡åœ°å€,è¯·å°Šé‡åŸåˆ›] *///è‡ªå®šä¹‰ClassLoaderï¼Œå®Œæ•´ä»£ç ç¨ååˆ†æclass FileClassLoader extends ClassLoader&#123; private String rootDir; public FileClassLoader(String rootDir) &#123; this.rootDir = rootDir; &#125; // ç¼–å†™è·å–ç±»çš„å­—èŠ‚ç å¹¶åˆ›å»ºclasså¯¹è±¡çš„é€»è¾‘ @Override protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123; //...çœç•¥é€»è¾‘ä»£ç  &#125; //ç¼–å†™è¯»å–å­—èŠ‚æµçš„æ–¹æ³• private byte[] getClassData(String className) &#123; // è¯»å–ç±»æ–‡ä»¶çš„å­—èŠ‚ //çœç•¥ä»£ç .... &#125;&#125;public class ClassLoaderTest &#123; public static void main(String[] args) throws ClassNotFoundException &#123; FileClassLoader loader1 = new FileClassLoader(rootDir); System.out.println(&quot;è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„çˆ¶åŠ è½½å™¨: &quot;+loader1.getParent()); System.out.println(&quot;ç³»ç»Ÿé»˜è®¤çš„AppClassLoader: &quot;+ClassLoader.getSystemClassLoader()); System.out.println(&quot;AppClassLoaderçš„çˆ¶ç±»åŠ è½½å™¨: &quot;+ClassLoader.getSystemClassLoader().getParent()); System.out.println(&quot;ExtClassLoaderçš„çˆ¶ç±»åŠ è½½å™¨: &quot;+ClassLoader.getSystemClassLoader().getParent().getParent()); /** è¾“å‡ºç»“æœ: è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„çˆ¶åŠ è½½å™¨: sun.misc.Launcher$AppClassLoader@29453f44 ç³»ç»Ÿé»˜è®¤çš„AppClassLoader: sun.misc.Launcher$AppClassLoader@29453f44 AppClassLoaderçš„çˆ¶ç±»åŠ è½½å™¨: sun.misc.Launcher$ExtClassLoader@6f94fa3e ExtClassLoaderçš„çˆ¶ç±»åŠ è½½å™¨: null */ &#125;&#125;1234567891011121314151617181920212223242526272829303132333435363738394041424344 ä»£ç ä¸­ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰äº†ä¸€ä¸ªFileClassLoaderï¼Œè¿™é‡Œæˆ‘ä»¬ç»§æ‰¿äº†ClassLoaderè€ŒéURLClassLoader,å› æ­¤éœ€è¦è‡ªå·±ç¼–å†™findClass()æ–¹æ³•é€»è¾‘ä»¥åŠåŠ è½½å­—èŠ‚ç çš„é€»è¾‘ï¼Œå…³äºè‡ªå®šä¹‰ç±»åŠ è½½å™¨æˆ‘ä»¬ç¨åä¼šåˆ†æï¼Œè¿™é‡Œä»…éœ€è¦çŸ¥é“FileClassLoaderæ˜¯è‡ªå®šä¹‰åŠ è½½å™¨å³å¯ï¼Œæ¥ç€åœ¨mainæ–¹æ³•ä¸­ï¼Œé€šè¿‡ClassLoader.getSystemClassLoader()è·å–åˆ°ç³»ç»Ÿé»˜è®¤ç±»åŠ è½½å™¨ï¼Œé€šè¿‡è·å–å…¶çˆ¶ç±»åŠ è½½å™¨åŠå…¶çˆ¶çˆ¶ç±»åŠ è½½å™¨ï¼ŒåŒæ—¶è¿˜è·å–äº†è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨,æœ€ç»ˆè¾“å‡ºç»“æœæ­£å¦‚æˆ‘ä»¬æ‰€é¢„æ–™çš„ï¼ŒAppClassLoaderçš„çˆ¶ç±»åŠ è½½å™¨ä¸ºExtClassLoaderï¼Œè€ŒExtClassLoaderæ²¡æœ‰çˆ¶ç±»åŠ è½½å™¨ã€‚å¦‚æœæˆ‘ä»¬å®ç°è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œå®ƒçš„çˆ¶åŠ è½½å™¨éƒ½åªä¼šæ˜¯AppClassLoaderã€‚è¿™é‡Œæˆ‘ä»¬ä¸å¦¨çœ‹çœ‹Lancherçš„æ„é€ å™¨æºç  123456789101112131415161718192021222324public Launcher() &#123; // é¦–å…ˆåˆ›å»ºæ‹“å±•ç±»åŠ è½½å™¨ ClassLoader extcl; try &#123; extcl = ExtClassLoader.getExtClassLoader(); &#125; catch (IOException e) &#123; throw new InternalError( &quot;Could not create extension class loader&quot;); &#125; // Now create the class loader to use to launch the application try &#123; //å†åˆ›å»ºAppClassLoaderå¹¶æŠŠextclä½œä¸ºçˆ¶åŠ è½½å™¨ä¼ é€’ç»™AppClassLoader loader = AppClassLoader.getAppClassLoader(extcl); &#125; catch (IOException e) &#123; throw new InternalError( &quot;Could not create application class loader&quot;); &#125; //è®¾ç½®çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œç¨ååˆ†æ Thread.currentThread().setContextClassLoader(loader);//çœç•¥å…¶ä»–æ²¡å¿…è¦çš„ä»£ç ...... &#125; &#125;123456789101112131415161718192021222324 æ˜¾ç„¶Lancheråˆå§‹åŒ–æ—¶é¦–å…ˆä¼šåˆ›å»ºExtClassLoaderç±»åŠ è½½å™¨ï¼Œç„¶åå†åˆ›å»ºAppClassLoaderå¹¶æŠŠExtClassLoaderä¼ é€’ç»™å®ƒä½œä¸ºçˆ¶ç±»åŠ è½½å™¨ï¼Œè¿™é‡Œè¿˜æŠŠAppClassLoaderé»˜è®¤è®¾ç½®ä¸ºçº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œå…³äºçº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ç¨åä¼šåˆ†æã€‚é‚£ExtClassLoaderç±»åŠ è½½å™¨ä¸ºä»€ä¹ˆæ˜¯nullå‘¢ï¼Ÿçœ‹ä¸‹é¢çš„æºç åˆ›å»ºè¿‡ç¨‹å°±æ˜ç™½ï¼Œåœ¨åˆ›å»ºExtClassLoaderå¼ºåˆ¶è®¾ç½®äº†å…¶çˆ¶åŠ è½½å™¨ä¸ºnullã€‚ 1234567891011121314151617181920//Lancherä¸­åˆ›å»ºExtClassLoaderextcl = ExtClassLoader.getExtClassLoader();//getExtClassLoader()æ–¹æ³•public static ExtClassLoader getExtClassLoader() throws IOException&#123; //........çœç•¥å…¶ä»–ä»£ç  return new ExtClassLoader(dirs); // .........&#125;//æ„é€ æ–¹æ³•public ExtClassLoader(File[] dirs) throws IOException &#123; //è°ƒç”¨çˆ¶ç±»æ„é€ URLClassLoaderä¼ é€’nullä½œä¸ºparent super(getExtURLs(dirs), null, factory);&#125;//URLClassLoaderæ„é€ public URLClassLoader(URL[] urls, ClassLoader parent, URLStreamHandlerFactory factory) &#123;1234567891011121314151617181920 æ˜¾ç„¶ExtClassLoaderçš„çˆ¶ç±»ä¸ºnullï¼Œè€ŒAppClassLoaderçš„çˆ¶åŠ è½½å™¨ä¸ºExtClassLoaderï¼Œæ‰€æœ‰è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨å…¶çˆ¶åŠ è½½å™¨åªä¼šæ˜¯AppClassLoaderï¼Œæ³¨æ„è¿™é‡Œæ‰€æŒ‡çš„çˆ¶ç±»å¹¶ä¸æ˜¯Javaç»§æ‰¿å…³ç³»ä¸­çš„é‚£ç§çˆ¶å­å…³ç³»ã€‚ ç±»ä¸ç±»åŠ è½½å™¨ç±»ä¸ç±»åŠ è½½å™¨åœ¨JVMä¸­è¡¨ç¤ºä¸¤ä¸ªclasså¯¹è±¡æ˜¯å¦ä¸ºåŒä¸€ä¸ªç±»å¯¹è±¡å­˜åœ¨ä¸¤ä¸ªå¿…è¦æ¡ä»¶ ç±»çš„å®Œæ•´ç±»åå¿…é¡»ä¸€è‡´ï¼ŒåŒ…æ‹¬åŒ…åã€‚ åŠ è½½è¿™ä¸ªç±»çš„ClassLoader(æŒ‡ClassLoaderå®ä¾‹å¯¹è±¡)å¿…é¡»ç›¸åŒã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨JVMä¸­ï¼Œå³ä½¿è¿™ä¸ªä¸¤ä¸ªç±»å¯¹è±¡(classå¯¹è±¡)æ¥æºåŒä¸€ä¸ªClassæ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªè™šæ‹Ÿæœºæ‰€åŠ è½½ï¼Œä½†åªè¦åŠ è½½å®ƒä»¬çš„ClassLoaderå®ä¾‹å¯¹è±¡ä¸åŒï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªç±»å¯¹è±¡ä¹Ÿæ˜¯ä¸ç›¸ç­‰çš„ï¼Œè¿™æ˜¯å› ä¸ºä¸åŒçš„ClassLoaderå®ä¾‹å¯¹è±¡éƒ½æ‹¥æœ‰ä¸åŒçš„ç‹¬ç«‹çš„ç±»åç§°ç©ºé—´ï¼Œæ‰€ä»¥åŠ è½½çš„classå¯¹è±¡ä¹Ÿä¼šå­˜åœ¨ä¸åŒçš„ç±»åç©ºé—´ä¸­ï¼Œä½†å‰ææ˜¯è¦†å†™loadclassæ–¹æ³•ï¼Œä»å‰é¢åŒäº²å§”æ´¾æ¨¡å¼å¯¹loadClass()æ–¹æ³•çš„æºç åˆ†æä¸­å¯ä»¥çŸ¥ï¼Œåœ¨æ–¹æ³•ç¬¬ä¸€æ­¥ä¼šé€šè¿‡Class&lt;?&gt; c = findLoadedClass(name);ä»ç¼“å­˜æŸ¥æ‰¾ï¼Œç±»åå®Œæ•´åç§°ç›¸åŒåˆ™ä¸ä¼šå†æ¬¡è¢«åŠ è½½ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»ç»•è¿‡ç¼“å­˜æŸ¥è¯¢æ‰èƒ½é‡æ–°åŠ è½½classå¯¹è±¡ã€‚å½“ç„¶ä¹Ÿå¯ç›´æ¥è°ƒç”¨findClass()æ–¹æ³•ï¼Œè¿™æ ·ä¹Ÿé¿å…ä»ç¼“å­˜æŸ¥æ‰¾ï¼Œå¦‚ä¸‹ 1234567891011121314151617String rootDir=&quot;/Users/zejian/Downloads/Java8_Action/src/main/java/&quot;;//åˆ›å»ºä¸¤ä¸ªä¸åŒçš„è‡ªå®šä¹‰ç±»åŠ è½½å™¨å®ä¾‹FileClassLoader loader1 = new FileClassLoader(rootDir);FileClassLoader loader2 = new FileClassLoader(rootDir);//é€šè¿‡findClassåˆ›å»ºç±»çš„Classå¯¹è±¡Class&lt;?&gt; object1=loader1.findClass(&quot;com.zejian.classloader.DemoObj&quot;);Class&lt;?&gt; object2=loader2.findClass(&quot;com.zejian.classloader.DemoObj&quot;);System.out.println(&quot;findClass-&gt;obj1:&quot;+object1.hashCode());System.out.println(&quot;findClass-&gt;obj2:&quot;+object2.hashCode());/** * ç›´æ¥è°ƒç”¨findClassæ–¹æ³•è¾“å‡ºç»“æœ: * findClass-&gt;obj1:723074861 findClass-&gt;obj2:895328852 ç”Ÿæˆä¸åŒçš„å®ä¾‹ */1234567891011121314151617 å¦‚æœè°ƒç”¨çˆ¶ç±»çš„loadClassæ–¹æ³•ï¼Œç»“æœå¦‚ä¸‹ï¼Œé™¤éé‡å†™loadClass()æ–¹æ³•å»æ‰ç¼“å­˜æŸ¥æ‰¾æ­¥éª¤ï¼Œä¸è¿‡ç°åœ¨ä¸€èˆ¬éƒ½ä¸å»ºè®®é‡å†™loadClass()æ–¹æ³•ã€‚ 1234567891011121314151617//ç›´æ¥è°ƒç”¨çˆ¶ç±»çš„loadClass()æ–¹æ³•Class&lt;?&gt; obj1 =loader1.loadClass(&quot;com.zejian.classloader.DemoObj&quot;);Class&lt;?&gt; obj2 =loader2.loadClass(&quot;com.zejian.classloader.DemoObj&quot;);//ä¸åŒå®ä¾‹å¯¹è±¡çš„è‡ªå®šä¹‰ç±»åŠ è½½å™¨System.out.println(&quot;loadClass-&gt;obj1:&quot;+obj1.hashCode());System.out.println(&quot;loadClass-&gt;obj2:&quot;+obj2.hashCode());//ç³»ç»Ÿç±»åŠ è½½å™¨System.out.println(&quot;Class-&gt;obj3:&quot;+DemoObj.class.hashCode());/*** ç›´æ¥è°ƒç”¨loadClassæ–¹æ³•çš„è¾“å‡ºç»“æœ,æ³¨æ„å¹¶æ²¡æœ‰é‡å†™loadClassæ–¹æ³•* loadClass-&gt;obj1:1872034366 loadClass-&gt;obj2:1872034366 Class-&gt; obj3:1872034366 éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹*/1234567891011121314151617 æ‰€ä»¥å¦‚æœä¸ä»ç¼“å­˜æŸ¥è¯¢ç›¸åŒå®Œå…¨ç±»åçš„classå¯¹è±¡ï¼Œé‚£ä¹ˆåªæœ‰ClassLoaderçš„å®ä¾‹å¯¹è±¡ä¸åŒï¼ŒåŒä¸€å­—èŠ‚ç æ–‡ä»¶åˆ›å»ºçš„classå¯¹è±¡è‡ªç„¶ä¹Ÿä¸ä¼šç›¸åŒã€‚ äº†è§£classæ–‡ä»¶çš„æ˜¾ç¤ºåŠ è½½ä¸éšå¼åŠ è½½çš„æ¦‚å¿µæ‰€è°“classæ–‡ä»¶çš„æ˜¾ç¤ºåŠ è½½ä¸éšå¼åŠ è½½çš„æ–¹å¼æ˜¯æŒ‡JVMåŠ è½½classæ–‡ä»¶åˆ°å†…å­˜çš„æ–¹å¼ï¼Œæ˜¾ç¤ºåŠ è½½æŒ‡çš„æ˜¯åœ¨ä»£ç ä¸­é€šè¿‡è°ƒç”¨ClassLoaderåŠ è½½classå¯¹è±¡ï¼Œå¦‚ç›´æ¥ä½¿ç”¨Class.forName(name)æˆ–this.getClass().getClassLoader().loadClass()åŠ è½½classå¯¹è±¡ã€‚è€Œéšå¼åŠ è½½åˆ™æ˜¯ä¸ç›´æ¥åœ¨ä»£ç ä¸­è°ƒç”¨ClassLoaderçš„æ–¹æ³•åŠ è½½classå¯¹è±¡ï¼Œè€Œæ˜¯é€šè¿‡è™šæ‹Ÿæœºè‡ªåŠ¨åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¦‚åœ¨åŠ è½½æŸä¸ªç±»çš„classæ–‡ä»¶æ—¶ï¼Œè¯¥ç±»çš„classæ–‡ä»¶ä¸­å¼•ç”¨äº†å¦å¤–ä¸€ä¸ªç±»çš„å¯¹è±¡ï¼Œæ­¤æ—¶é¢å¤–å¼•ç”¨çš„ç±»å°†é€šè¿‡JVMè‡ªåŠ¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚åœ¨æ—¥å¸¸å¼€å‘ä»¥ä¸Šä¸¤ç§æ–¹å¼ä¸€èˆ¬ä¼šæ··åˆä½¿ç”¨ï¼Œè¿™é‡Œæˆ‘ä»¬çŸ¥é“æœ‰è¿™ä¹ˆå›äº‹å³å¯ã€‚ ç¼–å†™è‡ªå·±çš„ç±»åŠ è½½å™¨é€šè¿‡å‰é¢çš„åˆ†æå¯çŸ¥ï¼Œå®ç°è‡ªå®šä¹‰ç±»åŠ è½½å™¨éœ€è¦ç»§æ‰¿ClassLoaderæˆ–è€…URLClassLoaderï¼Œç»§æ‰¿ClassLoaderåˆ™éœ€è¦è‡ªå·±é‡å†™findClass()æ–¹æ³•å¹¶ç¼–å†™åŠ è½½é€»è¾‘ï¼Œç»§æ‰¿URLClassLoaderåˆ™å¯ä»¥çœå»ç¼–å†™findClass()æ–¹æ³•ä»¥åŠclassæ–‡ä»¶åŠ è½½è½¬æ¢æˆå­—èŠ‚ç æµçš„ä»£ç ã€‚é‚£ä¹ˆç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„æ„ä¹‰ä½•åœ¨å‘¢ï¼Ÿ å½“classæ–‡ä»¶ä¸åœ¨ClassPathè·¯å¾„ä¸‹ï¼Œé»˜è®¤ç³»ç»Ÿç±»åŠ è½½å™¨æ— æ³•æ‰¾åˆ°è¯¥classæ–‡ä»¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„ClassLoaderæ¥åŠ è½½ç‰¹å®šè·¯å¾„ä¸‹çš„classæ–‡ä»¶ç”Ÿæˆclasså¯¹è±¡ã€‚ å½“ä¸€ä¸ªclassæ–‡ä»¶æ˜¯é€šè¿‡ç½‘ç»œä¼ è¾“å¹¶ä¸”å¯èƒ½ä¼šè¿›è¡Œç›¸åº”çš„åŠ å¯†æ“ä½œæ—¶ï¼Œéœ€è¦å…ˆå¯¹classæ–‡ä»¶è¿›è¡Œç›¸åº”çš„è§£å¯†åå†åŠ è½½åˆ°JVMå†…å­˜ä¸­ï¼Œè¿™ç§æƒ…å†µä¸‹ä¹Ÿéœ€è¦ç¼–å†™è‡ªå®šä¹‰çš„ClassLoaderå¹¶å®ç°ç›¸åº”çš„é€»è¾‘ã€‚ å½“éœ€è¦å®ç°çƒ­éƒ¨ç½²åŠŸèƒ½æ—¶(ä¸€ä¸ªclassæ–‡ä»¶é€šè¿‡ä¸åŒçš„ç±»åŠ è½½å™¨äº§ç”Ÿä¸åŒclasså¯¹è±¡ä»è€Œå®ç°çƒ­éƒ¨ç½²åŠŸèƒ½)ï¼Œéœ€è¦å®ç°è‡ªå®šä¹‰ClassLoaderçš„é€»è¾‘ã€‚ è‡ªå®šä¹‰Fileç±»åŠ è½½å™¨è¿™é‡Œæˆ‘ä»¬ç»§æ‰¿ClassLoaderå®ç°è‡ªå®šä¹‰çš„ç‰¹å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶ç±»åŠ è½½å™¨å¹¶åŠ è½½ç¼–è¯‘åDemoObj.classï¼Œæºç ä»£ç å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091public class DemoObj &#123; @Override public String toString() &#123; return &quot;I am DemoObj&quot;; &#125;&#125;123456package com.zejian.classloader;import java.io.*;/** * Created by zejian on 2017/6/21. * Blog : http://blog.csdn.net/javazejian [åŸæ–‡åœ°å€,è¯·å°Šé‡åŸåˆ›] */public class FileClassLoader extends ClassLoader &#123; private String rootDir; public FileClassLoader(String rootDir) &#123; this.rootDir = rootDir; &#125; /** * ç¼–å†™findClassæ–¹æ³•çš„é€»è¾‘ * @param name * @return * @throws ClassNotFoundException */ @Override protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123; // è·å–ç±»çš„classæ–‡ä»¶å­—èŠ‚æ•°ç»„ byte[] classData = getClassData(name); if (classData == null) &#123; throw new ClassNotFoundException(); &#125; else &#123; //ç›´æ¥ç”Ÿæˆclasså¯¹è±¡ return defineClass(name, classData, 0, classData.length); &#125; &#125; /** * ç¼–å†™è·å–classæ–‡ä»¶å¹¶è½¬æ¢ä¸ºå­—èŠ‚ç æµçš„é€»è¾‘ * @param className * @return */ private byte[] getClassData(String className) &#123; // è¯»å–ç±»æ–‡ä»¶çš„å­—èŠ‚ String path = classNameToPath(className); try &#123; InputStream ins = new FileInputStream(path); ByteArrayOutputStream baos = new ByteArrayOutputStream(); int bufferSize = 4096; byte[] buffer = new byte[bufferSize]; int bytesNumRead = 0; // è¯»å–ç±»æ–‡ä»¶çš„å­—èŠ‚ç  while ((bytesNumRead = ins.read(buffer)) != -1) &#123; baos.write(buffer, 0, bytesNumRead); &#125; return baos.toByteArray(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; return null; &#125; /** * ç±»æ–‡ä»¶çš„å®Œå…¨è·¯å¾„ * @param className * @return */ private String classNameToPath(String className) &#123; return rootDir + File.separatorChar + className.replace(&#x27;.&#x27;, File.separatorChar) + &quot;.class&quot;; &#125; public static void main(String[] args) throws ClassNotFoundException &#123; String rootDir=&quot;/Users/zejian/Downloads/Java8_Action/src/main/java/&quot;; //åˆ›å»ºè‡ªå®šä¹‰æ–‡ä»¶ç±»åŠ è½½å™¨ FileClassLoader loader = new FileClassLoader(rootDir); try &#123; //åŠ è½½æŒ‡å®šçš„classæ–‡ä»¶ Class&lt;?&gt; object1=loader.loadClass(&quot;com.zejian.classloader.DemoObj&quot;); System.out.println(object1.newInstance().toString()); //è¾“å‡ºç»“æœ:I am DemoObj &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125;12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485 æ˜¾ç„¶æˆ‘ä»¬é€šè¿‡getClassData()æ–¹æ³•æ‰¾åˆ°classæ–‡ä»¶å¹¶è½¬æ¢ä¸ºå­—èŠ‚æµï¼Œå¹¶é‡å†™findClass()æ–¹æ³•ï¼Œåˆ©ç”¨defineClass()æ–¹æ³•åˆ›å»ºäº†ç±»çš„classå¯¹è±¡ã€‚åœ¨mainæ–¹æ³•ä¸­è°ƒç”¨äº†loadClass()æ–¹æ³•åŠ è½½æŒ‡å®šè·¯å¾„ä¸‹çš„classæ–‡ä»¶ï¼Œç”±äºå¯åŠ¨ç±»åŠ è½½å™¨ã€æ‹“å±•ç±»åŠ è½½å™¨ä»¥åŠç³»ç»Ÿç±»åŠ è½½å™¨éƒ½æ— æ³•åœ¨å…¶è·¯å¾„ä¸‹æ‰¾åˆ°è¯¥ç±»ï¼Œå› æ­¤æœ€ç»ˆå°†æœ‰è‡ªå®šä¹‰ç±»åŠ è½½å™¨åŠ è½½ï¼Œå³è°ƒç”¨findClass()æ–¹æ³•è¿›è¡ŒåŠ è½½ã€‚å¦‚æœç»§æ‰¿URLClassLoaderå®ç°ï¼Œé‚£ä»£ç å°±æ›´ç®€æ´äº†ï¼Œå¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940/** * Created by zejian on 2017/6/21. * Blog : http://blog.csdn.net/javazejian [åŸæ–‡åœ°å€,è¯·å°Šé‡åŸåˆ›] */public class FileUrlClassLoader extends URLClassLoader &#123; public FileUrlClassLoader(URL[] urls, ClassLoader parent) &#123; super(urls, parent); &#125; public FileUrlClassLoader(URL[] urls) &#123; super(urls); &#125; public FileUrlClassLoader(URL[] urls, ClassLoader parent, URLStreamHandlerFactory factory) &#123; super(urls, parent, factory); &#125; public static void main(String[] args) throws ClassNotFoundException, MalformedURLException &#123; String rootDir=&quot;/Users/zejian/Downloads/Java8_Action/src/main/java/&quot;; //åˆ›å»ºè‡ªå®šä¹‰æ–‡ä»¶ç±»åŠ è½½å™¨ File file = new File(rootDir); //File to URI URI uri=file.toURI(); URL[] urls=&#123;uri.toURL()&#125;; FileUrlClassLoader loader = new FileUrlClassLoader(urls); try &#123; //åŠ è½½æŒ‡å®šçš„classæ–‡ä»¶ Class&lt;?&gt; object1=loader.loadClass(&quot;com.zejian.classloader.DemoObj&quot;); System.out.println(object1.newInstance().toString()); //è¾“å‡ºç»“æœ:I am DemoObj &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125;12345678910111213141516171819202122232425262728293031323334353637383940 éå¸¸ç®€æ´é™¤äº†éœ€è¦é‡å†™æ„é€ å™¨å¤–æ— éœ€ç¼–å†™findClass()æ–¹æ³•åŠå…¶classæ–‡ä»¶çš„å­—èŠ‚æµè½¬æ¢é€»è¾‘ã€‚ è‡ªå®šä¹‰ç½‘ç»œç±»åŠ è½½å™¨è‡ªå®šä¹‰ç½‘ç»œç±»åŠ è½½å™¨ï¼Œä¸»è¦ç”¨äºè¯»å–é€šè¿‡ç½‘ç»œä¼ é€’çš„classæ–‡ä»¶ï¼ˆåœ¨è¿™é‡Œæˆ‘ä»¬çœç•¥classæ–‡ä»¶çš„è§£å¯†è¿‡ç¨‹ï¼‰ï¼Œå¹¶å°†å…¶è½¬æ¢æˆå­—èŠ‚æµç”Ÿæˆå¯¹åº”çš„classå¯¹è±¡ï¼Œå¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354/** * Created by zejian on 2017/6/21. * Blog : http://blog.csdn.net/javazejian [åŸæ–‡åœ°å€,è¯·å°Šé‡åŸåˆ›] */public class NetClassLoader extends ClassLoader &#123; private String url;//classæ–‡ä»¶çš„URL public NetClassLoader(String url) &#123; this.url = url; &#125; @Override protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123; byte[] classData = getClassDataFromNet(name); if (classData == null) &#123; throw new ClassNotFoundException(); &#125; else &#123; return defineClass(name, classData, 0, classData.length); &#125; &#125; /** * ä»ç½‘ç»œè·å–classæ–‡ä»¶ * @param className * @return */ private byte[] getClassDataFromNet(String className) &#123; String path = classNameToPath(className); try &#123; URL url = new URL(path); InputStream ins = url.openStream(); ByteArrayOutputStream baos = new ByteArrayOutputStream(); int bufferSize = 4096; byte[] buffer = new byte[bufferSize]; int bytesNumRead = 0; // è¯»å–ç±»æ–‡ä»¶çš„å­—èŠ‚ while ((bytesNumRead = ins.read(buffer)) != -1) &#123; baos.write(buffer, 0, bytesNumRead); &#125; //è¿™é‡Œçœç•¥è§£å¯†çš„è¿‡ç¨‹....... return baos.toByteArray(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; return null; &#125; private String classNameToPath(String className) &#123; // å¾—åˆ°ç±»æ–‡ä»¶çš„URL return url + &quot;/&quot; + className.replace(&#x27;.&#x27;, &#x27;/&#x27;) + &quot;.class&quot;; &#125;&#125;123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354 æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯åœ¨è·å–å­—èŠ‚ç æµæ—¶çš„åŒºåˆ«ï¼Œä»ç½‘ç»œç›´æ¥è·å–åˆ°å­—èŠ‚æµå†è½¬è½¦å­—èŠ‚æ•°ç»„ç„¶ååˆ©ç”¨defineClassæ–¹æ³•åˆ›å»ºclasså¯¹è±¡ï¼Œå¦‚æœç»§æ‰¿URLClassLoaderç±»åˆ™å’Œå‰é¢æ–‡ä»¶è·¯å¾„çš„å®ç°æ˜¯ç±»ä¼¼çš„ï¼Œæ— éœ€æ‹…å¿ƒè·¯å¾„æ˜¯filePathè¿˜æ˜¯Urlï¼Œå› ä¸ºURLClassLoaderå†…çš„URLClassPathå¯¹è±¡ä¼šæ ¹æ®ä¼ é€’è¿‡æ¥çš„URLæ•°ç»„ä¸­çš„è·¯å¾„åˆ¤æ–­æ˜¯æ–‡ä»¶è¿˜æ˜¯jaråŒ…ï¼Œç„¶åæ ¹æ®ä¸åŒçš„è·¯å¾„åˆ›å»ºFileLoaderæˆ–è€…JarLoaderæˆ–é»˜è®¤ç±»Loaderå»è¯»å–å¯¹äºçš„è·¯å¾„æˆ–è€…urlä¸‹çš„classæ–‡ä»¶ã€‚ çƒ­éƒ¨ç½²ç±»åŠ è½½å™¨æ‰€è°“çš„çƒ­éƒ¨ç½²å°±æ˜¯åˆ©ç”¨åŒä¸€ä¸ªclassæ–‡ä»¶ä¸åŒçš„ç±»åŠ è½½å™¨åœ¨å†…å­˜åˆ›å»ºå‡ºä¸¤ä¸ªä¸åŒçš„classå¯¹è±¡(å…³äºè¿™ç‚¹çš„åŸå› å‰é¢å·²åˆ†æè¿‡ï¼Œå³åˆ©ç”¨ä¸åŒçš„ç±»åŠ è½½å®ä¾‹)ï¼Œç”±äºJVMåœ¨åŠ è½½ç±»ä¹‹å‰ä¼šæ£€æµ‹è¯·æ±‚çš„ç±»æ˜¯å¦å·²åŠ è½½è¿‡(å³åœ¨loadClass()æ–¹æ³•ä¸­è°ƒç”¨findLoadedClass()æ–¹æ³•)ï¼Œå¦‚æœè¢«åŠ è½½è¿‡ï¼Œåˆ™ç›´æ¥ä»ç¼“å­˜è·å–ï¼Œä¸ä¼šé‡æ–°åŠ è½½ã€‚æ³¨æ„åŒä¸€ä¸ªç±»åŠ è½½å™¨çš„å®ä¾‹å’ŒåŒä¸€ä¸ªclassæ–‡ä»¶åªèƒ½è¢«åŠ è½½å™¨ä¸€æ¬¡ï¼Œå¤šæ¬¡åŠ è½½å°†æŠ¥é”™ï¼Œå› æ­¤æˆ‘ä»¬å®ç°çš„çƒ­éƒ¨ç½²å¿…é¡»è®©åŒä¸€ä¸ªclassæ–‡ä»¶å¯ä»¥æ ¹æ®ä¸åŒçš„ç±»åŠ è½½å™¨é‡å¤åŠ è½½ï¼Œä»¥å®ç°æ‰€è°“çš„çƒ­éƒ¨ç½²ã€‚å®é™…ä¸Šå‰é¢çš„å®ç°çš„FileClassLoaderå’ŒFileUrlClassLoaderå·²å…·å¤‡è¿™ä¸ªåŠŸèƒ½ï¼Œä½†å‰ææ˜¯ç›´æ¥è°ƒç”¨findClass()æ–¹æ³•ï¼Œè€Œä¸æ˜¯è°ƒç”¨loadClass()æ–¹æ³•ï¼Œå› ä¸ºClassLoaderä¸­loadClass()æ–¹æ³•ä½“ä¸­è°ƒç”¨findLoadedClass()æ–¹æ³•è¿›è¡Œäº†æ£€æµ‹æ˜¯å¦å·²è¢«åŠ è½½ï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥è°ƒç”¨findClass()æ–¹æ³•å°±å¯ä»¥ç»•è¿‡è¿™ä¸ªé—®é¢˜ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é‡æ–°loadClassæ–¹æ³•ï¼Œä½†å¼ºçƒˆä¸å»ºè®®è¿™ä¹ˆå¹²ã€‚åˆ©ç”¨FileClassLoaderç±»æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233public static void main(String[] args) throws ClassNotFoundException &#123; String rootDir=&quot;/Users/zejian/Downloads/Java8_Action/src/main/java/&quot;; //åˆ›å»ºè‡ªå®šä¹‰æ–‡ä»¶ç±»åŠ è½½å™¨ FileClassLoader loader = new FileClassLoader(rootDir); FileClassLoader loader2 = new FileClassLoader(rootDir); try &#123; //åŠ è½½æŒ‡å®šçš„classæ–‡ä»¶,è°ƒç”¨loadClass() Class&lt;?&gt; object1=loader.loadClass(&quot;com.zejian.classloader.DemoObj&quot;); Class&lt;?&gt; object2=loader2.loadClass(&quot;com.zejian.classloader.DemoObj&quot;); System.out.println(&quot;loadClass-&gt;obj1:&quot;+object1.hashCode()); System.out.println(&quot;loadClass-&gt;obj2:&quot;+object2.hashCode()); //åŠ è½½æŒ‡å®šçš„classæ–‡ä»¶,ç›´æ¥è°ƒç”¨findClass(),ç»•è¿‡æ£€æµ‹æœºåˆ¶ï¼Œåˆ›å»ºä¸åŒclasså¯¹è±¡ã€‚ Class&lt;?&gt; object3=loader.findClass(&quot;com.zejian.classloader.DemoObj&quot;); Class&lt;?&gt; object4=loader2.findClass(&quot;com.zejian.classloader.DemoObj&quot;); System.out.println(&quot;loadClass-&gt;obj3:&quot;+object3.hashCode()); System.out.println(&quot;loadClass-&gt;obj4:&quot;+object4.hashCode()); /** * è¾“å‡ºç»“æœ: * loadClass-&gt;obj1:644117698 loadClass-&gt;obj2:644117698 findClass-&gt;obj3:723074861 findClass-&gt;obj4:895328852 */ &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;123456789101112131415161718192021222324252627282930313233 åŒäº²å§”æ´¾æ¨¡å‹çš„ç ´åè€…-çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨â€‹ åœ¨Javaåº”ç”¨ä¸­å­˜åœ¨ç€å¾ˆå¤šæœåŠ¡æä¾›è€…æ¥å£ï¼ˆService Provider Interfaceï¼ŒSPIï¼‰ï¼Œè¿™äº›æ¥å£å…è®¸ç¬¬ä¸‰æ–¹ä¸ºå®ƒä»¬æä¾›å®ç°ï¼Œå¦‚å¸¸è§çš„ SPI æœ‰ JDBCã€JNDIç­‰ï¼Œè¿™äº› SPI çš„æ¥å£å±äº Java æ ¸å¿ƒåº“ï¼Œä¸€èˆ¬å­˜åœ¨rt.jaråŒ…ä¸­ï¼Œç”±Bootstrapç±»åŠ è½½å™¨åŠ è½½ï¼Œè€Œ SPI çš„ç¬¬ä¸‰æ–¹å®ç°ä»£ç åˆ™æ˜¯ä½œä¸ºJavaåº”ç”¨æ‰€ä¾èµ–çš„ jar åŒ…è¢«å­˜æ”¾åœ¨classpathè·¯å¾„ä¸‹ï¼Œç”±äºSPIæ¥å£ä¸­çš„ä»£ç ç»å¸¸éœ€è¦åŠ è½½å…·ä½“çš„ç¬¬ä¸‰æ–¹å®ç°ç±»å¹¶è°ƒç”¨å…¶ç›¸å…³æ–¹æ³•ï¼Œä½†SPIçš„æ ¸å¿ƒæ¥å£ç±»æ˜¯ç”±å¼•å¯¼ç±»åŠ è½½å™¨æ¥åŠ è½½çš„ï¼Œè€ŒBootstrapç±»åŠ è½½å™¨æ— æ³•ç›´æ¥åŠ è½½SPIçš„å®ç°ç±»ï¼ŒåŒæ—¶ç”±äºåŒäº²å§”æ´¾æ¨¡å¼çš„å­˜åœ¨ï¼ŒBootstrapç±»åŠ è½½å™¨ä¹Ÿæ— æ³•åå‘å§”æ‰˜AppClassLoaderåŠ è½½å™¨SPIçš„å®ç°ç±»ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸€ç§ç‰¹æ®Šçš„ç±»åŠ è½½å™¨æ¥åŠ è½½ç¬¬ä¸‰æ–¹çš„ç±»åº“ï¼Œè€Œçº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨å°±æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚â€‹ çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼ˆcontextClassLoaderï¼‰æ˜¯ä» JDK 1.2 å¼€å§‹å¼•å…¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡java.lang.Threadç±»ä¸­çš„getContextClassLoader()å’Œ setContextClassLoader(ClassLoader cl)æ–¹æ³•æ¥è·å–å’Œè®¾ç½®çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚å¦‚æœæ²¡æœ‰æ‰‹åŠ¨è®¾ç½®ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œçº¿ç¨‹å°†ç»§æ‰¿å…¶çˆ¶çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œåˆå§‹çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ˜¯ç³»ç»Ÿç±»åŠ è½½å™¨ï¼ˆAppClassLoaderï¼‰,åœ¨çº¿ç¨‹ä¸­è¿è¡Œçš„ä»£ç å¯ä»¥é€šè¿‡æ­¤ç±»åŠ è½½å™¨æ¥åŠ è½½ç±»å’Œèµ„æºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä»¥jdbc.jaråŠ è½½ä¸ºä¾‹ ä»å›¾å¯çŸ¥rt.jaræ ¸å¿ƒåŒ…æ˜¯æœ‰Bootstrapç±»åŠ è½½å™¨åŠ è½½çš„ï¼Œå…¶å†…åŒ…å«SPIæ ¸å¿ƒæ¥å£ç±»ï¼Œç”±äºSPIä¸­çš„ç±»ç»å¸¸éœ€è¦è°ƒç”¨å¤–éƒ¨å®ç°ç±»çš„æ–¹æ³•ï¼Œè€Œjdbc.jaråŒ…å«å¤–éƒ¨å®ç°ç±»(jdbc.jarå­˜åœ¨äºclasspathè·¯å¾„)æ— æ³•é€šè¿‡Bootstrapç±»åŠ è½½å™¨åŠ è½½ï¼Œå› æ­¤åªèƒ½å§”æ´¾çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æŠŠjdbc.jarä¸­çš„å®ç°ç±»åŠ è½½åˆ°å†…å­˜ä»¥ä¾¿SPIç›¸å…³ç±»ä½¿ç”¨ã€‚æ˜¾ç„¶è¿™ç§çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨çš„åŠ è½½æ–¹å¼ç ´åäº†â€œåŒäº²å§”æ´¾æ¨¡å‹â€ï¼Œå®ƒåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å¼ƒåŒäº²å§”æ´¾åŠ è½½é“¾æ¨¡å¼ï¼Œä½¿ç¨‹åºå¯ä»¥é€†å‘ä½¿ç”¨ç±»åŠ è½½å™¨ï¼Œå½“ç„¶è¿™ä¹Ÿä½¿å¾—Javaç±»åŠ è½½å™¨å˜å¾—æ›´åŠ çµæ´»ã€‚ä¸ºäº†è¿›ä¸€æ­¥è¯å®è¿™ç§åœºæ™¯ï¼Œä¸å¦¨çœ‹çœ‹DriverManagerç±»çš„æºç ï¼ŒDriverManageræ˜¯Javaæ ¸å¿ƒrt.jaråŒ…ä¸­çš„ç±»ï¼Œè¯¥ç±»ç”¨æ¥ç®¡ç†ä¸åŒæ•°æ®åº“çš„å®ç°é©±åŠ¨å³Driverï¼Œå®ƒä»¬éƒ½å®ç°äº†Javaæ ¸å¿ƒåŒ…ä¸­çš„java.sql.Driveræ¥å£ï¼Œå¦‚mysqlé©±åŠ¨åŒ…ä¸­çš„com.mysql.jdbc.Driverï¼Œè¿™é‡Œä¸»è¦çœ‹çœ‹å¦‚ä½•åŠ è½½å¤–éƒ¨å®ç°ç±»ï¼Œåœ¨DriverManageråˆå§‹åŒ–æ—¶ä¼šæ‰§è¡Œå¦‚ä¸‹ä»£ç  12345678910111213141516171819//DriverManageræ˜¯Javaæ ¸å¿ƒåŒ…rt.jarçš„ç±»public class DriverManager &#123; //çœç•¥ä¸å¿…è¦çš„ä»£ç  static &#123; loadInitialDrivers();//æ‰§è¡Œè¯¥æ–¹æ³• println(&quot;JDBC DriverManager initialized&quot;); &#125;//loadInitialDriversæ–¹æ³• private static void loadInitialDrivers() &#123; sun.misc.Providers() AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() &#123; public Void run() &#123; //åŠ è½½å¤–éƒ¨çš„Driverçš„å®ç°ç±» ServiceLoader&lt;Driver&gt; loadedDrivers = ServiceLoader.load(Driver.class); //çœç•¥ä¸å¿…è¦çš„ä»£ç ...... &#125; &#125;); &#125;12345678910111213141516171819 åœ¨DriverManagerç±»åˆå§‹åŒ–æ—¶æ‰§è¡Œäº†loadInitialDrivers()æ–¹æ³•,åœ¨è¯¥æ–¹æ³•ä¸­é€šè¿‡ServiceLoader.load(Driver.class);å»åŠ è½½å¤–éƒ¨å®ç°çš„é©±åŠ¨ç±»ï¼ŒServiceLoaderç±»ä¼šå»è¯»å–mysqlçš„jdbc.jarä¸‹META-INFæ–‡ä»¶çš„å†…å®¹ï¼Œå¦‚ä¸‹æ‰€ç¤º è€Œcom.mysql.jdbc.Driverç»§æ‰¿ç±»å¦‚ä¸‹ï¼š 12345678910public class Driver extends com.mysql.cj.jdbc.Driver &#123; public Driver() throws SQLException &#123; super(); &#125; static &#123; System.err.println(&quot;Loading class `com.mysql.jdbc.Driver&#x27;. This is deprecated. The new driver class is `com.mysql.cj.jdbc.Driver&#x27;. &quot; + &quot;The driver is automatically registered via the SPI and manual loading of the driver class is generally unnecessary.&quot;); &#125;&#125;12345678910 ä»æ³¨é‡Šå¯ä»¥çœ‹å‡ºå¹³å¸¸æˆ‘ä»¬ä½¿ç”¨com.mysql.jdbc.Driverå·²è¢«ä¸¢å¼ƒäº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯com.mysql.cj.jdbc.Driverï¼Œä¹Ÿå°±æ˜¯è¯´å®˜æ–¹ä¸å†å»ºè®®æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹ä»£ç æ³¨å†Œmysqlé©±åŠ¨ 123456//ä¸å»ºè®®ä½¿ç”¨è¯¥æ–¹å¼æ³¨å†Œé©±åŠ¨ç±»Class.forName(&quot;com.mysql.jdbc.Driver&quot;);String url = &quot;jdbc:mysql://localhost:3306/cm-storylocker?characterEncoding=UTF-8&quot;;// é€šè¿‡javaåº“è·å–æ•°æ®åº“è¿æ¥Connection conn = java.sql.DriverManager.getConnection(url, &quot;root&quot;, &quot;root@555&quot;);123456 è€Œæ˜¯ç›´æ¥å»æ‰æ³¨å†Œæ­¥éª¤ï¼Œå¦‚ä¸‹å³å¯ 1234String url = &quot;jdbc:mysql://localhost:3306/cm-storylocker?characterEncoding=UTF-8&quot;;// é€šè¿‡javaåº“è·å–æ•°æ®åº“è¿æ¥Connection conn = java.sql.DriverManager.getConnection(url, &quot;root&quot;, &quot;root@555&quot;);1234 è¿™æ ·ServiceLoaderä¼šå¸®åŠ©æˆ‘ä»¬å¤„ç†ä¸€åˆ‡ï¼Œå¹¶æœ€ç»ˆé€šè¿‡load()æ–¹æ³•åŠ è½½ï¼Œçœ‹çœ‹load()æ–¹æ³•å®ç° 12345public static &lt;S&gt; ServiceLoader&lt;S&gt; load(Class&lt;S&gt; service) &#123; //é€šè¿‡çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨åŠ è½½ ClassLoader cl = Thread.currentThread().getContextClassLoader(); return ServiceLoader.load(service, cl); &#125;12345 å¾ˆæ˜æ˜¾äº†ç¡®å®é€šè¿‡çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨åŠ è½½çš„ï¼Œå®é™…ä¸Šæ ¸å¿ƒåŒ…çš„SPIç±»å¯¹å¤–éƒ¨å®ç°ç±»çš„åŠ è½½éƒ½æ˜¯åŸºäºçº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ‰§è¡Œçš„ï¼Œé€šè¿‡è¿™ç§æ–¹å¼å®ç°äº†Javaæ ¸å¿ƒä»£ç å†…éƒ¨å»è°ƒç”¨å¤–éƒ¨å®ç°ç±»ã€‚æˆ‘ä»¬çŸ¥é“çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨é»˜è®¤æƒ…å†µä¸‹å°±æ˜¯AppClassLoaderï¼Œé‚£ä¸ºä»€ä¹ˆä¸ç›´æ¥é€šè¿‡getSystemClassLoader()è·å–ç±»åŠ è½½å™¨æ¥åŠ è½½classpathè·¯å¾„ä¸‹çš„ç±»çš„å‘¢ï¼Ÿå…¶å®æ˜¯å¯è¡Œçš„ï¼Œä½†è¿™ç§ç›´æ¥ä½¿ç”¨getSystemClassLoader()æ–¹æ³•è·å–AppClassLoaderåŠ è½½ç±»æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œé‚£å°±æ˜¯ä»£ç éƒ¨ç½²åˆ°ä¸åŒæœåŠ¡æ—¶ä¼šå‡ºç°é—®é¢˜ï¼Œå¦‚æŠŠä»£ç éƒ¨ç½²åˆ°Java Webåº”ç”¨æœåŠ¡æˆ–è€…EJBä¹‹ç±»çš„æœåŠ¡å°†ä¼šå‡ºé—®é¢˜ï¼Œå› ä¸ºè¿™äº›æœåŠ¡ä½¿ç”¨çš„çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨å¹¶éAppClassLoaderï¼Œè€Œæ˜¯Java Webåº”ç”¨æœè‡ªå®¶çš„ç±»åŠ è½½å™¨ï¼Œç±»åŠ è½½å™¨ä¸åŒã€‚ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”ç”¨è¯¥å°‘ç”¨getSystemClassLoader()ã€‚æ€»ä¹‹ä¸åŒçš„æœåŠ¡ä½¿ç”¨çš„å¯èƒ½é»˜è®¤ClassLoaderæ˜¯ä¸åŒçš„ï¼Œä½†ä½¿ç”¨çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ€»èƒ½è·å–åˆ°ä¸å½“å‰ç¨‹åºæ‰§è¡Œç›¸åŒçš„ClassLoaderï¼Œä»è€Œé¿å…ä¸å¿…è¦çš„é—®é¢˜ã€‚ok~.å…³äºçº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æš‚ä¸”èŠåˆ°è¿™ï¼Œå‰é¢é˜è¿°çš„DriverManagerç±»ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œçœ‹çœ‹æºç ï¼Œç›¸ä¿¡ä¼šæœ‰æ›´å¤šçš„ä½“ä¼šï¼Œå¦å¤–å…³äºServiceLoaderæœ¬ç¯‡å¹¶æ²¡æœ‰è¿‡å¤šçš„é˜è¿°ï¼Œæ¯•ç«Ÿæˆ‘ä»¬ä¸»é¢˜æ˜¯ç±»åŠ è½½å™¨ï¼Œä½†ServiceLoaderæ˜¯ä¸ªå¾ˆä¸é”™çš„è§£è€¦æœºåˆ¶ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡ŒæŸ¥é˜…å…¶ç›¸å…³ç”¨æ³•ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"ç±»åŠ è½½","slug":"ç±»åŠ è½½","permalink":"http://example.com/tags/%E7%B1%BB%E5%8A%A0%E8%BD%BD/"}]},{"title":"æ•°æ®åº“","slug":"æ•°æ®åº“","date":"2019-04-08T01:23:24.000Z","updated":"2019-04-08T01:23:24.000Z","comments":true,"path":"2019/04/08/æ•°æ®åº“/","link":"","permalink":"http://example.com/2019/04/08/%E6%95%B0%E6%8D%AE%E5%BA%93/","excerpt":"","text":"ä¹è§‚é”å’Œæ‚²è§‚é” æ‚²è§‚é” æ‚²è§‚é”å¯¹æ•°æ®ä¿®æ”¹æŒæœ‰æ‚²è§‚æ€åº¦ï¼Œè®¤ä¸ºæ•°æ®å¾ˆå®¹æ˜“è¢«ä¿®æ”¹ï¼Œæ‰€ä»¥åœ¨ä¿®æ”¹æ•°æ®å‰ä¼šå…ˆç»™åŠ é”ï¼Œæ•ˆç‡è¾ƒä½ã€‚ ä¹è§‚é” ä¹è§‚é”å‡è®¾ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä¼šé€ æˆæ•°æ®å†²çªï¼Œæ‰€å®ƒåªåœ¨äº‹åŠ¡æäº¤æ›´æ–°çš„æ—¶å€™ï¼Œæ‰å»æ£€æµ‹æ˜¯å¦æœ‰å†²çªã€‚å¦‚æœå†²çªäº†åˆ™ç»™ç”¨æˆ·è¿”å›ä¸€å®šçš„ä¿¡æ¯è®©ç”¨æˆ·è‡ªå·±å»å¤„ç†ã€‚ ä¹è§‚é”å¹¶ä¸æ˜¯çœŸæ­£çš„åŠ é”ï¼Œé€šå¸¸ï¼Œå®ƒå¯ä»¥é€šè¿‡ç‰ˆæœ¬å·ï¼Œæˆ–è€…æ—¶é—´æˆ³ç­‰æ¥åˆ¤æ–­æ˜¯å¦å‘ç”Ÿäº†å†²çªã€‚æ¯”å¦‚æ·»åŠ ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡ä¿®æ”¹æ•°æ®æ—¶éƒ½ä¼šå¸¦ä¸Šç‰ˆæœ¬å·ï¼Œå¦‚æœæ‰§è¡Œæ›´æ–°æ—¶çš„ç‰ˆæœ¬å·å’Œæˆ‘ä»¬åˆšåˆšæŸ¥è¯¢å‡ºæ¥çš„ç‰ˆæœ¬å·ä¸€è‡´ï¼Œå°±å¯ä»¥æ‰§è¡Œæ›´æ–°ï¼Œå¦åˆ™ï¼Œå°±è®¤ä¸ºæ˜¯è¿‡æœŸçš„æ•°æ® ã€‚","categories":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"}]},{"title":"javaè™šæ‹Ÿæœº","slug":"javaè™šæ‹Ÿæœº","date":"2019-03-04T13:43:50.000Z","updated":"2023-05-29T14:17:39.387Z","comments":true,"path":"2019/03/04/javaè™šæ‹Ÿæœº/","link":"","permalink":"http://example.com/2019/03/04/java%E8%99%9A%E6%8B%9F%E6%9C%BA/","excerpt":"","text":"Javaå†…å­˜æ¨¡å‹javaè¿è¡Œæ—¶æ•°æ®åŒºåŸŸç¨‹åºè®¡æ•°å™¨çº¿ç¨‹ç§æœ‰çš„ Javaè™šæ‹Ÿæœºæ ˆçº¿ç¨‹ç§æœ‰ï¼Œå­˜æ”¾å±€éƒ¨å˜é‡ï¼Œè¿”å›å€¼åœ°å€ç­‰ æœ¬åœ°æ–¹æ³•æ ˆçº¿ç¨‹ç§æœ‰ï¼Œå­˜æ”¾å±€éƒ¨å˜é‡ï¼Œè¿”å›å€¼åœ°å€ç­‰ Javaå †çº¿ç¨‹å…±äº«åŒºåŸŸï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚ æ–¹æ³•åŒºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ï¼Œå¸¸é‡ï¼Œé™æ€å˜é‡ï¼Œå³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚ è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢å˜é‡å’Œç¬¦å·å¼•ç”¨ ç›´æ¥å†…å­˜NIOä½¿ç”¨Nativeå‡½æ•° åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨Javaå †ä¸­çš„DirectByBufferå¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚ç”±äºè¿™æ ·åšé¿å…äº†åœ¨Javaå †å’ŒNativeå †ä¸­æ¥å›å¤åˆ¶æ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥æ˜¾è‘—æé«˜æ€§èƒ½ã€‚ å†…å­˜æ¨¡å‹å·¥ä½œå†…å­˜å’Œä¸»å†…å­˜ volatileå½“ä¸€ä¸ªå˜é‡è¢«volitileå…³é”®å­—ä¿®é¥°æ—¶ï¼Œå®ƒæœ‰ä¸¤å±‚è¯­ä¹‰ï¼š å¯è§æ€§ï¼šä¸€ä¸ªçº¿ç¨‹å¯¹è¿™ä¸ªå˜é‡çš„æ›´æ”¹ä¼šç«‹å³åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼šä¿è¯äº†æœ‰åºæ€§ã€‚ ä½†æ˜¯å®ƒä¸ä¿è¯åŸå­æ€§ï¼Œå®ƒèƒ½ä¿è¯ä¿®æ”¹è¢«ç«‹å³å†™åˆ°ä¸»å­˜ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯è¯»åˆ°çš„å€¼è¢«ç«‹å³ä¿®æ”¹ï¼Œä¹Ÿå°±æ˜¯åŸå­æ€§ã€‚å¯¹äºéåŸå­æ€§çš„æ“ä½œï¼Œæ¯”å¦‚è‡ªå¢æ“ä½œï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹è¯»å…¥äº†å˜é‡çš„å€¼ï¼Œç„¶åè¢«é˜»å¡ï¼Œè¿™æ—¶å€™è¿™ä¸ªçº¿ç¨‹å…¶å®æ˜¯æ²¡æœ‰ä¿®æ”¹å˜é‡å€¼çš„ï¼Œé‚£ä¹ˆä¹Ÿå°±ä¸ä¼šä½¿å¾—å…¶ä»–çº¿ç¨‹ç¼“å­˜æ— æ•ˆï¼Œè¿™æ—¶å€™å…¶ä»–çº¿ç¨‹ä¹Ÿè¯»å…¥è¿™ä¸ªå€¼å¾—æ—¶å€™ï¼Œè¯»å…¥å¾—å…¶å®æ˜¯æ—§å€¼ã€‚é—®é¢˜å¾—æ ¹æºå°±åœ¨äºï¼Œvolatileåªèƒ½ä¿è¯ä¿®æ”¹æ—¶ç«‹å³å¯è§ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯è¿™ä¸ªæ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œæ¯”å¦‚è‡ªå¢æ“ä½œã€‚å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨synchronizedå…³é”®å­—ã€‚ ä½¿ç”¨volatileå…³é”®å­—ï¼Œå¯ä»¥ä½¿å¾—å…¶ä»–çº¿ç¨‹ä¸­å¯¹è¢«ä¿®é¥°å˜é‡çš„æ‹·è´æ— æ•ˆï¼Œè¿«ä½¿å®ƒå†æ¬¡ä»ä¸»å­˜ä¸­é‡æ–°è¯»å–ã€‚ volatileå…³é”®å­—ç¦æ­¢æŒ‡ä»¤é‡æ’åºæœ‰ä¸¤å±‚æ„æ€ï¼š 1ï¼‰å½“ç¨‹åºæ‰§è¡Œåˆ°volatileå˜é‡çš„è¯»æ“ä½œæˆ–è€…å†™æ“ä½œæ—¶ï¼Œåœ¨å…¶å‰é¢çš„æ“ä½œçš„æ›´æ”¹è‚¯å®šå…¨éƒ¨å·²ç»è¿›è¡Œï¼Œä¸”ç»“æœå·²ç»å¯¹åé¢çš„æ“ä½œå¯è§ï¼›åœ¨å…¶åé¢çš„æ“ä½œè‚¯å®šè¿˜æ²¡æœ‰è¿›è¡Œï¼› 2ï¼‰åœ¨è¿›è¡ŒæŒ‡ä»¤ä¼˜åŒ–æ—¶ï¼Œvolatileè¯­å¥ç›¸å½“äºä¸€ä¸ªå±éšœï¼Œå®ƒæ‰€å¤„çš„ä½ç½®æ˜¯ç¦æ­¢æŒ‡ä»¤é‡æ’åºçš„ï¼Œä½†æ˜¯å®ƒå‰é¢å’Œåé¢çš„ä»£ç å—æ˜¯å¯ä»¥åˆ†åˆ«æŒ‡ä»¤é‡æ’åºçš„ã€‚ ç„¶åæ¨èä¸€ç¯‡å¾ˆä¸é”™çš„åšå®¢ï¼š å†…å­˜æ¨¡å‹çš„ç‰¹å¾ åŸå­æ€§ å¯è§æ€§ æœ‰åºæ€§ sychronizedå…³é”®å­—å¯ä»¥å®ç°ä¸Šè¿°ä¸‰ç§ç‰¹æ€§ã€‚ é™¤äº†volatileä¹‹å¤–ï¼Œsychronizedå’Œfinalä¹Ÿå¯ä»¥å®ç°å¯è§æ€§ã€‚ happens-beforeåŸåˆ™å…ˆè¡Œå‘ç”Ÿï¼ˆhappens-beforeï¼‰åŸåˆ™æŒ‡çš„æ˜¯javaå†…å­˜æ¨¡å‹ä¸­å®šä¹‰çš„ä¸¤ä¸ªæ“ä½œä¹‹é—´çš„å…ˆåºå…³ç³»ã€‚å¦‚æœAå…ˆè¡Œå‘ç”ŸäºBï¼Œé‚£ä¹ˆAæ“ä½œæ‰€äº§ç”Ÿçš„å½±å“å°±èƒ½è¢«Bè§‚å¯Ÿåˆ°ï¼Œè¿™é‡Œçš„å½±å“åŒ…æ‹¬å†…å­˜ä¸­å…±äº«å˜é‡å€¼çš„ä¿®æ”¹ï¼Œå‘é€æ¶ˆæ¯ï¼Œè°ƒç”¨æ–¹æ³•ç­‰ã€‚ happens-beforeåŸåˆ™æ˜¯å¯¹æŒ‡ä»¤æ‰§è¡Œé¡ºåºæ€§çš„ä¿éšœï¼Œå¦‚æœä¸¤ä¸ªæ“ä½œå¯ä»¥æœ‰ä¸‹é¢çš„åŸåˆ™æ¨å¯¼å‡ºæ¥ï¼Œè¯´æ˜è¿™ä¸¤ä¸ªæ“ä½œæ˜¯å­˜åœ¨é¡ºåºæ€§çš„ï¼Œå¯ä»¥åœ¨ç¼–ç ä¸­ç›´æ¥ä½¿ç”¨ã€‚å¦åˆ™ï¼Œè™šæ‹Ÿæœºå¯ä»¥å¯¹ä»–ä»¬é‡æ’åºã€‚ ç¨‹åºæ¬¡åºè§„åˆ™ï¼šä¸€ä¸ªçº¿ç¨‹å†…ï¼ŒæŒ‰ç…§ä»£ç é¡ºåºï¼Œä¹¦å†™åœ¨å‰é¢çš„æ“ä½œå…ˆè¡Œå‘ç”Ÿäºä¹¦å†™åœ¨åé¢çš„æ“ä½œã€‚ ç®¡ç¨‹é”è§„å®šï¼šä¸€ä¸ªunlockæ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹åŒä¸€ä¸ªé”çš„lockæ“ä½œã€‚ï¼ˆåé¢æŒ‡æ—¶é—´ä¸Šçš„å…ˆåæ€§ï¼‰ volatileå˜é‡è§„åˆ™: å¯¹ä¸€ä¸ªvolitleå˜é‡çš„å†™æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œã€‚ï¼ˆåé¢æŒ‡æ—¶é—´ä¸Šçš„å…ˆåæ€§ï¼‰ çº¿ç¨‹å¯åŠ¨è§„åˆ™ï¼šThreadå¯¹è±¡çš„start()æ–¹æ³•å…ˆè¡Œå‘ç”Ÿäºæ­¤çº¿ç¨‹çš„æ¯ä¸€ä¸ªåŠ¨ä½œã€‚ çº¿ç¨‹ç»ˆæ­¢è§„åˆ™ï¼šçº¿ç¨‹ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½å…ˆè¡Œå‘ç”Ÿäºå¯¹æ­¤çº¿ç¨‹çš„ç»ˆæ­¢æ£€æµ‹ã€‚ çº¿ç¨‹ä¸­æ–­è§„åˆ™: å¯¹çº¿ç¨‹interruptæ–¹æ³•çš„è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºè¢«ä¸­æ–­çº¿ç¨‹çš„ä»£ç æ£€æµ‹åˆ°ä¸­æ–­äº‹ä»¶çš„å‘ç”Ÿã€‚ å¯¹è±¡ç»ˆç»“æ“ä½œï¼šä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆå…ˆè¡Œå‘ç”Ÿäºå®ƒçš„finalizeæ–¹æ³•çš„å¼€å§‹ã€‚ ä¼ é€’æ€§ï¼šå¦‚æœAå…ˆè¡Œå‘ç”ŸäºBï¼ŒBå…ˆè¡Œå‘ç”ŸäºCï¼Œé‚£å°±å¯ä»¥å¾—å‡ºAå…ˆè¡Œå‘ç”ŸäºC å…ˆè¡Œå‘ç”ŸåŸåˆ™å’Œæ—¶é—´ä¸Šçš„å…ˆåå‘ç”Ÿå…¶å®æ˜¯æ²¡æœ‰å…³ç³»çš„ã€‚ä¸€ä¸ªæ“ä½œæ—¶é—´ä¸Šçš„å…ˆå‘ç”Ÿä¸ä»£è¡¨è¿™ä¸ªæ“ä½œæ˜¯â€œå…ˆè¡Œå‘ç”Ÿâ€ã€‚åè¿‡æ¥ï¼Œä¸€ä¸ªæ“ä½œæ˜¯â€œå…ˆè¡Œå‘ç”Ÿâ€ä¹Ÿä¸ä»£è¡¨å®ƒæ˜¯æ—¶é—´ä¸Šå…ˆå‘ç”Ÿçš„ï¼Œå› ä¸ºä¼šæœ‰æŒ‡ä»¤é‡æ’åºã€‚ GCæ‰€å›æ”¶çš„åŒºåŸŸæŒ‡çš„æ˜¯å †å’Œæ–¹æ³•åŒºã€‚ å…³äºGCçš„çµé­‚æ‹·é—®ï¼š ä»€ä¹ˆæ˜¯åƒåœ¾ å¼•ç”¨è®¡æ•°ç®—æ³•ï¼ˆReference Coutingï¼‰ æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è¢«å¼•ç”¨æ—¶ï¼Œè®¡æ•°å™¨åŠ ä¸€ï¼›å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å‡ä¸€ã€‚å¼•ç”¨ä¸ºé›¶ï¼Œåˆ™æ˜¯åƒåœ¾ã€‚ ç¼ºç‚¹ï¼šæ— æ³•è§£å†³å¯¹è±¡å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚ å¯è¾¾æ€§åˆ†æç®—æ³•(Reachablity Analysis) ä»ä¸€ä¸ªå«åšGC Rootçš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œä¸€ç›´å‘ä¸‹æœç´¢ï¼Œæœç´¢èµ°è¿‡çš„è·¯å¾„è¢«ç§°ä¸ºReference Chain, é‚£äº›ä¸åœ¨è¿™ä¸ªå¼•ç”¨é“¾ä¸­çš„å¯¹è±¡æ˜¯ä¸å¯è¾¾çš„ï¼Œæ˜¯åƒåœ¾ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå“ªäº›å¯¹è±¡è¢«ç§°ä¸ºGC Root? è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIå¼•ç”¨çš„å¯¹è±¡ å¦‚ä½•å›æ”¶åƒåœ¾ æ ‡è®°-æ¸…æ¥šç®—æ³• ä¼šäº§ç”Ÿå¤§é‡çš„å†…å­˜ç¢ç‰‡ å¤åˆ¶ç®—æ³• æˆ‘æ¯æ¬¡åªç”¨å†…å­˜çš„ä¸€åŠï¼Œè¿™ä¸€åŠç”¨å®Œåï¼ŒæŠŠå­˜æ´»çš„å¯¹è±¡æŒªåˆ°å¦ä¸€åŠï¼Œç„¶åæ¸…ç†è¿™ä¸€åŠã€‚ ç¼ºç‚¹ï¼šåªèƒ½ç”¨ä¸€åŠçš„ç©ºé—´ï¼Œè€Œä¸”å¤åˆ¶æ„å‘³ç€ä¿®æ”¹å¯¹è±¡çš„åœ°å€ã€‚ æ ‡è®°-æ•´ç†ç®—æ³• å¯ä»¥è®¤ä¸ºæ˜¯ç»“åˆäº†ä¸Šè¿°ä¸¤ç§æ–¹æ³•çš„ä¼˜ç‚¹ï¼Œå…ˆæ ‡è®°ï¼Œç„¶åæŠŠå­˜æ´»å¯¹è±¡å¾€ä¸€æ®µç§»åŠ¨ï¼Œæ¸…ç†å¦ä¸€ç«¯ã€‚ ç¼ºç‚¹ï¼šå†…å­˜å˜åŠ¨é¢‘ç¹ï¼Œéœ€è¦æ•´ç†æ‰€æœ‰å­˜æ´»å¯¹è±¡çš„å¼•ç”¨åœ°å€ï¼Œæ•ˆç‡æ¯”å¤åˆ¶ç®—æ³•ä½ã€‚ åˆ†ä»£æ”¶é›†ç®—æ³• é›†ç™¾å®¶ä¹‹é•¿ï¼Œå¯¹ä¸åŒå¯¿å‘½çš„å¯¹è±¡ä½¿ç”¨ä¸åŒçš„ç®—æ³•æ”¶é›†ã€‚ å°†å †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œæ–°ç”Ÿä»£å¯¹è±¡æœç”Ÿå¤•æ­»ï¼Œåªæœ‰å°‘é‡å¯¹è±¡å­˜æ´»ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨å¤åˆ¶ç®—æ³•ã€‚ å›æ”¶ç­–ç•¥Eden, from Survivor, to Survivor, Old å‰ä¸‰ä¸ªéƒ½æ˜¯æ–°ç”Ÿä»£ å¯¹è±¡é¦–å…ˆéƒ½ä¼šè¢«åˆ†é…åˆ°Edenä¸­ï¼Œå½“Edenå‰©ä½™ç©ºé—´ä¸å¤Ÿç”¨æ—¶ï¼Œä¼šè§¦å‘ä¸€æ¬¡Minor GC, å‰©ä¸‹çš„å­˜æ´»å¯¹è±¡æ”¾åˆ°from Survivor, å¦‚æœfromåŒºä¸å¤Ÿï¼Œåˆ™æ”¾åˆ°Old. ç»§ç»­æ–°å»ºå¯¹è±¡ï¼Œä¸‹ä¸€æ¬¡Edenåˆä¸å¤Ÿç”¨äº†ï¼Œç»§ç»­Minor GCï¼Œè¿™æ¬¡æŠŠEdenå’Œfromé‡Œé¢å‰©ä¸‹çš„å­˜æ´»å¯¹è±¡åˆæ”¾åˆ°toé‡Œé¢ï¼Œå¦‚æœä¸å¤Ÿæ”¾ï¼Œç»§ç»­æ”¾åˆ°Old. ç‰¹ä¾‹é™¤äº†ä¸Šè¿°æ‰€è¯´ï¼Œè¿˜æœ‰ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼š å¤§å¯¹è±¡ç›´æ¥è¿›å…¥Old. å› ä¸ºå®ƒæ¯”è¾ƒå¤§ï¼Œä½ æ”¾åˆ°æ–°ç”Ÿä»£çš„è¯ï¼Œé¢‘ç¹çš„Minor GCè¦ç§»åŠ¨ä¸€ä¸ªå¤§å—å¤´æ˜¯ä¸ªå¾ˆéº»çƒ¦çš„äº‹ é•¿æœŸå­˜æ´»å¯¹è±¡è¿›å…¥Old. æœ‰äº›å¯¹è±¡ä¸€ç›´åœ¨fromåŒºå’ŒtoåŒºæ¥å›è¹¦è·¶ï¼Œæˆ‘ä»¬ç»™å®ƒä¸€ä¸ªå¹´é¾„è®¡æ•°å™¨ï¼Œæ¯è¹¦è·¶ä¸€æ¬¡å¹´é¾„åŠ ä¸€ï¼Œç­‰åˆ°æˆå¹´äº†å°±æŠŠå®ƒé€åˆ°Old.è¿™ä¸ªå¹´é¾„é»˜è®¤æ˜¯15å² åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š JVMå¹¶ä¸æ˜¯ä¸¥æ ¼è¦æ±‚è¯´åªæœ‰æˆå¹´æ‰èƒ½è¢«é€åˆ°Old. å¦‚æœSurviorä¸­ç›¸åŒå¹´é¾„çš„å¯¹è±¡å ç”¨äº†ä¸€åŠæˆ–è€…ä»¥ä¸Šçš„ç©ºé—´ï¼Œé‚£ä¹ˆè¿™äº›å¯¹è±¡ä»¥åŠæ¯”ä»–ä»¬å¹´é•¿çš„éƒ½ä¼šè¢«é€åˆ°Old. å› ä¸ºå®ƒä»¬å¤ªå åœ°æ–¹äº†ã€‚ æ€è€ƒ ä¸ºä»€ä¹ˆè¦æœ‰SurvivoråŒºè€Œä¸æ˜¯ç›´æ¥Edenå’ŒOld. ä¸ºäº†åœ¨è¿›å…¥Oldä¹‹é—´ç¼“å†²ä¸€å“ˆï¼Œä¸ç„¶Oldä¼šè¢«å¾ˆå¿«å¡«æ»¡ï¼Œè€Œä¸”è¿›å…¥Oldçš„å¯¹è±¡æŒ‡ä¸å®šæ²¡è¿‡å¤šä¹…å°±å˜æˆåƒåœ¾äº†ã€‚ ä¸ºä»€ä¹ˆè¦æœ‰ä¸¤ä¸ªSurvivoråŒº è¿™ä¸ªå…¶å®æ˜¯å€Ÿé‰´äº†å¤åˆ¶ç®—æ³•çš„æ€æƒ³ã€‚ä¸¤ä¸ªSurvivoræ¥å›å€’è…¾ï¼Œæ¯æ¬¡æ€»æœ‰ä¸€ä¸ªæ˜¯ç©ºçš„ï¼Œå®ƒå¯ä»¥å¾ˆå¥½çš„è§£å†³ç¢ç‰‡åŒ–çš„é—®é¢˜ã€‚ å…³äºå¼•ç”¨ å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰ å¸¸è§çš„Objec obj = new Object()å°±æ˜¯å¼ºå¼•ç”¨ã€‚ å¼ºå¼•ç”¨æ‰€æŒ‡çš„å¯¹è±¡åœ¨ä»»ä½•æ—¶å€™éƒ½ä¸ä¼šè¢«ç³»ç»Ÿå›æ”¶ã€‚JVMå®æ„¿æŠ›å‡ºOOMå¼‚å¸¸ï¼Œä¹Ÿä¸ä¼šå›æ”¶å¼ºå¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡ã€‚ å¼ºå¼•ç”¨å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰ è½¯å¼•ç”¨æ˜¯é™¤äº†å¼ºå¼•ç”¨ä¹‹å¤–ï¼Œæœ€å¼ºçš„å¼•ç”¨ç±»å‹ã€‚ åœ¨å†…å­˜ç´§å¼ çš„æƒ…å†µä¸‹ï¼Œè½¯å¼•ç”¨ä¼šè¢«å›æ”¶ã€‚ å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰ ç³»ç»ŸGCæ—¶ï¼Œåªè¦å‘ç°å¼±å¼•ç”¨ï¼Œå°±ä¼šè¢«å›æ”¶ã€‚ å¼±å¼•ç”¨å’Œè½¯å¼•ç”¨éƒ½é€‚åˆç”¨æ¥ä¿å­˜ä¸€äº›å¯æœ‰å¯æ— çš„ç¼“å­˜æ•°æ®ã€‚ è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰ è™šå¼•ç”¨æ˜¯å››ä¸ªé‡Œé¢æœ€å¼±çš„ï¼Œå¦‚æœè¯´è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨æ˜¯å¼Ÿå¼Ÿï¼Œé‚£ä¹ˆè™šå¼•ç”¨å°±æ˜¯å¼Ÿä¸­å¼Ÿã€‚ ä¸€ä¸ªå¯¹è±¡æŒæœ‰è™šå¼•ç”¨ï¼Œå’Œæ²¡æœ‰æŒæœ‰å‡ ä¹æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºè™šå¼•ç”¨éšæ—¶å¯èƒ½ä¼šè¢«GCå›æ”¶ï¼Œé‚£ä¹ˆè™šå¼•ç”¨çš„ä½œç”¨åœ¨å“ªé‡Œå‘¢ï¼Ÿå®ƒä¸»è¦ç”¨åœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­ã€‚è™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—å…³è”ä½¿ç”¨ï¼Œå½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹ å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚ç¨‹åºå¯ä»¥é€šè¿‡åˆ¤æ–­å¼•ç”¨é˜Ÿåˆ—ä¸­æ˜¯å¦å·²ç»åŠ å…¥äº†è™šå¼•ç”¨ï¼Œæ¥äº†è§£è¢«å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å°†è¦è¢«åƒåœ¾å›æ”¶ã€‚å¦‚æœç¨‹åºå‘ç°æŸä¸ªè™šå¼•ç”¨å·²ç»è¢«åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å†…å­˜è¢«å›æ”¶ä¹‹å‰é‡‡å–å¿…è¦çš„è¡ŒåŠ¨ã€‚ ç±»åŠ è½½æœºåˆ¶ç±»åŠ è½½çš„ç”Ÿå‘½å‘¨æœŸåŠ è½½ éªŒè¯ å‡†å¤‡ è§£æ åˆå§‹åŒ– å„ç§ç±»åŠ è½½å™¨å¯åŠ¨ç±»åŠ è½½å™¨ æ‹“å±•ç±»åŠ è½½å™¨ï¼ˆExtClassLoaderï¼‰ ç³»ç»Ÿç±»åŠ è½½å™¨ï¼ˆAppClassLoaderï¼‰ è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ç±»åˆå§‹åŒ–çš„æ—¶æœºä»¥ä¸‹äº”ç§æƒ…å†µä¸‹ä¼šè¿›è¡Œç±»çš„åˆå§‹åŒ– ï¼ˆ1ï¼‰ ï¼ˆ2ï¼‰ ï¼ˆ3ï¼‰ ï¼ˆ4ï¼‰ ï¼ˆ5ï¼‰ è¿™äº”ç§æƒ…å†µç§°ä¹‹ä¸ºå¯¹ç±»çš„ä¸»åŠ¨å¼•ç”¨ï¼Œé™¤è¿™äº”ç§ä¹‹å¤–ï¼Œæ‰€æœ‰å¼•ç”¨ç±»çš„æ–¹å¼éƒ½ä¸ä¼šè§¦å‘åˆå§‹åŒ–ï¼Œæˆä¸ºè¢«åŠ¨å¼•ç”¨ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"Javaè™šæ‹Ÿæœº","slug":"Javaè™šæ‹Ÿæœº","permalink":"http://example.com/tags/Java%E8%99%9A%E6%8B%9F%E6%9C%BA/"}]},{"title":"çŸ©é˜µ","slug":"çŸ©é˜µ","date":"2019-03-03T06:01:35.000Z","updated":"2019-03-03T06:01:35.000Z","comments":true,"path":"2019/03/03/çŸ©é˜µ/","link":"","permalink":"http://example.com/2019/03/03/%E7%9F%A9%E9%98%B5/","excerpt":"","text":"å¦‚ä½•ç†è§£çŸ©é˜µèŒƒæ•°åœ¨ä¸€ç»´æˆ–è€…äºŒç»´çš„ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬æœ‰æ˜ å°„ï¼ˆæˆ–è€…å‡½æ•°ï¼‰ï¼Œä¸€ä¸ªå€¼é€šè¿‡ä¸€ä¸ªæ˜ å°„å…³ç³»ï¼ˆæˆ–å‡½æ•°ï¼‰å˜æˆäº†å¦ä¸€ä¸ªå€¼ï¼Œè¿™æ—¶å€™ä¸€ä¸ªå‡½æ•°å°±ä»£è¡¨äº†è¿™ç§æ˜ å°„å…³ç³»ã€‚åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„è‡ªå˜é‡ï¼Œæ˜¯ä¸€ç»´çš„ï¼Œæ˜¯ä¸€ä¸ªæ•°ã€‚ å½“æƒ…å†µä¸Šå‡ä¹‹åï¼Œå½“è‡ªå˜é‡æ˜¯äºŒç»´å‘¢ï¼Œæ¯”å¦‚è¯´ï¼Œè‡ªå˜é‡æ˜¯ä¸€ä¸ªå‘é‡ã€‚è¿™æ—¶å€™ï¼Œè¿™ç§æ˜ å°„å…³ç³»ï¼ˆæˆ–è€…å‡½æ•°å…³ç³»ï¼‰å¯ä»¥ç”¨çŸ©é˜µæ¥è¡¨ç¤ºã€‚ä¸€ä¸ªå‘é‡ï¼Œä½œç”¨åœ¨è¿™ä¸ªçŸ©é˜µä¸Šï¼Œå˜æˆäº†å¦ä¸€ä¸ªå‘é‡ã€‚ è€ŒèŒƒæ•°ï¼ˆnormï¼‰ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„æ¨¡ï¼Œå…¶å®å®ƒæ˜¯å¸¦æœ‰â€œé•¿åº¦â€çš„æ¦‚å¿µçš„ï¼Œå®ƒæ˜¯è¡¨ç¤ºè¿™ä¸ªå˜åŒ–è¿‡ç¨‹å¤§å°çš„ä¸€ä¸ªåº¦é‡ï¼Œå®ƒç”¨æ¥è¡¨ç¤ºè¿™ä¸ªçŸ©é˜µçš„æŸç§å¤§å°ã€‚å®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæŠŠä¸èƒ½æ¯”è¾ƒå¤§å°çš„å‘é‡ï¼ˆçŸ©é˜µï¼‰è½¬åŒ–æˆå®æ•°ï¼Œè¿™æ ·å°±å¯ä»¥ç”¨æ¥æ¯”è¾ƒå¤§å°äº†ã€‚ ä¹Ÿå¯ä»¥è®¤ä¸ºï¼ŒçŸ©é˜µæ˜¯ä¸€ç§åŠ›ï¼Œå®ƒä½œç”¨åœ¨ä¸€ä¸ªå‘é‡ï¼ˆæˆ–è€…çŸ©é˜µï¼‰ä¸Šé¢ï¼Œä¼šæ”¹å˜ä»–ä»¬çš„ä¸€äº›å±æ€§ï¼Œæ¯”å¦‚å¤§å°ï¼Œæ–¹å‘ã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"http://example.com/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"æ•°å­¦","slug":"æ•°å­¦","permalink":"http://example.com/tags/%E6%95%B0%E5%AD%A6/"}]},{"title":"javaå¤šçº¿ç¨‹","slug":"javaå¤šçº¿ç¨‹","date":"2019-01-20T04:56:25.000Z","updated":"2023-05-29T14:17:39.390Z","comments":true,"path":"2019/01/20/javaå¤šçº¿ç¨‹/","link":"","permalink":"http://example.com/2019/01/20/java%E5%A4%9A%E7%BA%BF%E7%A8%8B/","excerpt":"","text":"ThreadlocalThreadLocalæ˜¯ä¸€ä¸ªæ”¯æŒæ³›å‹çš„ç±»ï¼Œå®ƒä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›å±€éƒ¨å˜é‡ï¼Œè¿™ç§å˜é‡æ˜¯å…¶ä»–çº¿ç¨‹è®¿é—®ä¸åˆ°çš„ï¼Œå®ç°äº†çº¿ç¨‹çš„æ•°æ®éš”ç¦»ã€‚ çº¿ç¨‹é—´éš”ç¦»ï¼Œæ–¹æ³•é—´å…±äº« å†…éƒ¨æ–¹æ³•set12345678public void set(T value) &#123; Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) map.set(this, value); else createMap(t, value); &#125; è·å–å½“å‰çº¿ç¨‹ï¼Œè·å–å½“å‰çº¿ç¨‹çš„ThreadLocalMap,ç„¶åå­˜å‚¨é”®å€¼å¯¹ã€‚è¿™é‡Œéœ€è¦æ³¨æ„Threadä¸­æ˜¯ç”±ä¸€ä¸ªç±»å‹ä¸ºThreadLocalMapçš„å˜é‡threadLocals,å…¶ä¸­ThreadLocalMapå°±æ˜¯ä¸€ä¸ªå®šåˆ¶çš„hashmap. get1234567891011121314151617181920212223242526272829public T get() &#123; Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) &#123; ThreadLocalMap.Entry e = map.getEntry(this); if (e != null) &#123; @SuppressWarnings(&quot;unchecked&quot;) T result = (T)e.value; return result; &#125; &#125; return setInitialValue(); &#125; private T setInitialValue() &#123; T value = initialValue(); Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) map.set(this, value); else createMap(t, value); return value; &#125; protected T initialValue() &#123; return null; &#125; remove12345public void remove() &#123; ThreadLocalMap m = getMap(Thread.currentThread()); if (m != null) m.remove(this); &#125; æ­£å¸¸æ¥è®²ï¼ŒThreadLocalå¯¹è±¡ä¼šåœ¨æ¯ä¸ªçº¿ç¨‹é‡Œé¢ åˆ›å»ºä¸€ä¸ªå˜é‡å‰¯æœ¬ï¼Œçº¿ç¨‹é—´æ˜¯ä¸å¯äº’ç›¸è®¿é—®è¿™äº›å˜é‡çš„ï¼Œä½†æ˜¯åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å­çº¿ç¨‹ä¸­ä¹Ÿèƒ½è®¿é—®çˆ¶çº¿ç¨‹ä¸­çš„å˜é‡ï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨InheritableThreadLocalsç±»ï¼Œå½“çˆ¶çº¿ç¨‹åˆ›å»ºå­çº¿ç¨‹æ—¶ï¼Œçˆ¶çº¿ç¨‹ä¸­inheritalbeThreadLocalså˜é‡é‡Œçš„æœ¬åœ°å˜é‡å¤åˆ¶ä¸€ä»½ä¿å­˜åˆ°å­çº¿ç¨‹çš„inheritableThreadLocalså˜é‡é‡Œé¢ï¼Œ ä½†æ˜¯å¤åˆ¶è¿‡æ¥ä»¥åï¼Œä»–ä»¬ä¹Ÿæ˜¯äº’ç›¸ç‹¬ç«‹çš„å‰¯æœ¬äº†ï¼Œä¿®æ”¹èµ·æ¥äº’ä¸ç›¸å¹²ã€‚ æ€»ç»“ThreadLocalç±»é€šè¿‡æ“ä½œThreadç±»é‡Œé¢çš„ThreadLocalMapç±»å‹çš„å˜é‡ï¼Œæ¥å®ç°çº¿ç¨‹ç§æœ‰å˜é‡çš„è®¿é—®ã€‚çœŸæ­£ç§æœ‰å˜é‡æ˜¯æ”¾åœ¨è¿™ä¸ªå®šåˆ¶çš„hashmapé‡Œè¢«ç»´æŠ¤çš„ã€‚ Javaçº¿ç¨‹ä¸­æ–­ä¼šæœ‰è¿™ç§æƒ…å†µï¼Œç”±äºæŸç§éœ€æ±‚ä½ éœ€è¦ä¸€ä¸ªå­çº¿ç¨‹å»æ‰§è¡ŒæŸäº›ä»»åŠ¡ï¼Œä½†æ˜¯è¿™ä¸ªä»»åŠ¡å¯èƒ½åœ¨ä¸­é€”ç”±äºå…¶ä»–å› ç´ éœ€è¦è¢«ä¸­æ–­æˆ–è€…ä¸­æ­¢ï¼Œå¯¹äºè¿™ç§æƒ…å†µï¼Œå°±éœ€è¦ç”¨åˆ°javaçš„çº¿ç¨‹ä¸­æ–­çš„æ–¹æ³•äº†ã€‚ interrupt()æ–¹æ³•å‡†ç¡®çš„è®²ï¼Œinterrupt()æ–¹æ³•å¹¶ä¸æ˜¯çœŸæ­£çš„ä¸­æ–­çº¿ç¨‹ï¼Œå®ƒçš„çœŸæ­£ä½œç”¨æ˜¯ä¿®æ”¹çº¿ç¨‹ä¸­çš„æ ‡å¿—ä½ï¼Œç„¶åæˆ‘ä»¬æ ¹æ®æ ‡å¿—ä½ï¼Œæ‰‹åŠ¨çš„å»ä¸­æ–­è¿™ä¸ªçº¿ç¨‹ï¼ˆåé¢ä¼šè®²åˆ°å¯èƒ½æ˜¯æ ¹æ®æ ‡å¿—ä½ä¹Ÿå¯èƒ½æ˜¯æ ¹æ®çº¿ç¨‹æŠ›å‡ºçš„å¼‚å¸¸å»æ‰‹ä¸­æ–­çº¿ç¨‹ï¼‰ã€‚ 1234567891011121314public void interrupt() &#123; if (this != Thread.currentThread()) checkAccess(); synchronized (blockerLock) &#123; Interruptible b = blocker; if (b != null) &#123; interrupt0(); // Just to set the interrupt flag b.interrupt(this); return; &#125; &#125; interrupt0(); &#125; è¿™é‡Œæˆ‘è´´äº†ä¸€æ®µæºç ï¼Œå¦‚æœæ²¡çŒœé”™çš„è¯ï¼Œè¿™ä¸ªinterrupt0()æ–¹æ³•å°±æ˜¯ç”¨æ¥ä¿®æ”¹æ ‡å¿—ä½çš„ã€‚ interrupt()æ–¹æ³•å¯ä»¥ç”¨æ¥ä¸­æ–­çº¿ç¨‹ï¼Œæ ¹æ®æ‰€è¦ä¸­æ–­çš„çº¿ç¨‹æ˜¯é˜»å¡çš„æˆ–è€…æ˜¯éé˜»å¡çš„ï¼Œåšæ³•ä¸åŒã€‚ å¦‚æœè¦ä¸­æ–­çš„çº¿ç¨‹æ˜¯è¢«wait(),sleep(),join()æ–¹æ³•é˜»å¡ï¼Œé‚£ä¹ˆä¸­æ–­çŠ¶æ€ä¼šè¢«æ¸…é™¤å¹¶ä¸”æŠ›å‡ºä¸€ä¸ªInterruptedExceptionå¼‚å¸¸ã€‚ ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿä¸Šæ–‡ä¸­æˆ‘ä»¬è®²åˆ°interrupt()æ–¹æ³•å…¶å®ä¿®æ”¹çš„æ˜¯çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—ä½ï¼Œè€ŒéçœŸæ­£ä¸­æ–­çº¿ç¨‹ã€‚åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœè¦ä¸­æ–­çš„çº¿ç¨‹æ˜¯è¢«è¿™äº›æ–¹æ³•é˜»å¡çš„ï¼Œå½“æˆ‘ä»¬è°ƒç”¨interrupt()æ–¹æ³•æ—¶ï¼Œè™½ç„¶æ ‡å¿—ä½ä¼šè¢«ä¿®æ”¹ï¼Œä½†æ˜¯æˆ‘ä»¬æ˜¯å¯Ÿè§‰ä¸åˆ°çš„ï¼Œå› ä¸ºå®ƒåˆä¼šè¢«clearæ‰ï¼Œä¹Ÿå°±æ˜¯è¢«é‡æ–°ç½®ä¸ºfalse,æ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¦å»ä¸­æ–­çº¿ç¨‹çš„è¯ï¼Œå°±å¾—catchè¿™ä¸ªå¼‚å¸¸ï¼Œç„¶ååœ¨catchä¸­æ“ä½œäº†ã€‚ å¦‚æœè¦ä¸­æ–­çš„çº¿ç¨‹æ˜¯é€šè¿‡InterruptibleChannelè¢«I/Oæ“ä½œé˜»å¡çš„è¯ï¼Œæ ‡å¿—ä½ä¼šè¢«ä¿®æ”¹ä¸ºtrue,åŒæ—¶ä¼šæŠ›å‡ºClosedByInterruptionå¼‚å¸¸ã€‚ å¯¹äºè¿™ç§æƒ…å†µæˆ‘æ²¡æœ‰è¿›è¡Œå°è¯•ï¼Œä½†æ˜¯ä»å­—é¢æ„æ€æ¥çœ‹ï¼Œæˆ‘ä»¬åº”è¯¥æ—¢å¯ä»¥ä»æ ‡å¿—ä½å…¥æ‰‹å»ä¸­æ–­çº¿ç¨‹ä¹Ÿå¯ä»¥ä»å¼‚å¸¸å…¥æ‰‹å»åšã€‚ å¦‚æœçº¿ç¨‹è¢«Selectoré˜»å¡ï¼Œé‚£ä¹ˆé€šè¿‡interrupt()ä¸­æ–­å®ƒæ—¶ï¼›çº¿ç¨‹çš„ä¸­æ–­æ ‡è®°ä¼šè¢«è®¾ç½®ä¸ºtrueï¼Œå¹¶ä¸”å®ƒä¼šç«‹å³ä»é€‰æ‹©æ“ä½œä¸­è¿”å› å¦‚æœä¸å±äºå‰é¢æ‰€è¯´çš„æƒ…å†µï¼Œé‚£ä¹ˆé€šè¿‡interrupt()ä¸­æ–­çº¿ç¨‹æ—¶ï¼Œå®ƒçš„ä¸­æ–­æ ‡è®°ä¼šè¢«è®¾ç½®ä¸ºâ€œtrueâ€ ä¸Šé¢çš„æ“ä½œéƒ½æåˆ°äº†æ ‡å¿—ä½ï¼Œé‚£ä¹ˆæ ‡å¿—ä½æ€ä¹ˆè·å¾—å‘¢ï¼Ÿ interrupted():é™æ€æ–¹æ³•ï¼Œè°ƒç”¨å®ƒæ—¶ï¼Œæ ‡å¿—ä½ä¼šè¢«æ¸…é™¤ã€‚è¿™æ„å‘³ç€å¦‚æœä½ è¿ç€è°ƒç”¨ä¸¤æ¬¡è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡ç»“æœè‚¯å®šæ˜¯false. isInterrupted()ï¼šéé™æ€æ–¹æ³•ï¼Œè°ƒç”¨å®ƒæ—¶ï¼Œæ ‡å¿—ä½ä¸ä¼šè¢«æ¸…é™¤ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œç›¸å…³è¯´æ˜å·²ç»å†™åœ¨äº†æ³¨é‡Šé‡Œ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970import static java.lang.Thread.sleep;public class ThreadTest &#123; public static void main(String[] args) throws InterruptedException &#123; Thread t1 = new MyThread1(); Thread t2 = new MyThread2(); t1.start(); t2.start(); System.out.println(&quot;after two minutes thread one interrupt&quot;); try &#123; sleep(2000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; t1.interrupt(); t2.interrupt(); Thread.sleep(3000); System.out.println(&quot;in main &quot; + t1.getName() + &quot; &quot; + t1.getState() + &quot; &quot; + t1.isInterrupted()); System.out.println(&quot;in main &quot; + t1.getName() + &quot; &quot; + t2.getState() + &quot; &quot; + t2.isInterrupted() ); &#125;&#125;/** * éé˜»å¡å‹çº¿ç¨‹ï¼Œé€šè¿‡åˆ¤æ–­æ ‡å¿—ä½æ¥å®ç°çº¿ç¨‹ä¸­æ­¢ */class MyThread1 extends Thread &#123; @Override public void run() &#123; for (; ; ) &#123; System.out.println(&quot;in &quot;+getName()); if (isInterrupted()) &#123; /** * ä¸‹é¢è°ƒç”¨äº†ä¸€æ¬¡interrupted()æ–¹æ³•ï¼Œæ ‡å¿—ä½è¢«æ¸…é™¤ï¼Œæ‰€ä»¥å†æ¬¡è°ƒç”¨isInterrupted()æ–¹æ³•æ—¶ä¸ºfalse */ System.out.println(getName() + &quot; &quot; + getState() + &quot; &quot; + interrupted()+&quot; &quot;+isInterrupted() ); break; &#125; &#125; &#125;&#125;/** * é˜»å¡å‹çº¿ç¨‹ï¼Œé€šè¿‡å¼‚å¸¸æ¥ç»ˆæ­¢ */class MyThread2 extends Thread &#123; @Override public void run() &#123; try &#123; for (; ; ) &#123; System.out.println(&quot;in &quot;+getName()); sleep(500); &#125; &#125; catch (InterruptedException e) &#123; System.out.println(getName() + &quot; &quot; + getState() + &quot; &quot; + isInterrupted()); e.printStackTrace(); &#125; &#125;&#125; Javaçº¿ç¨‹æ± æˆ‘ä»¬é€šå¸¸ä½¿ç”¨çš„ä¸€ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹å¼ï¼š 1ExecuttorService executorService = new ThreadPoolExecutor(1,1,60,TimeUnit.SECONDS,new ArrayBlockingQueue&lt;&gt;(10)); å®ƒçš„æ„é€ å‡½æ•°æ˜¯è¿™æ ·çš„ï¼š 123456public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, RejectedExecutionHandler handler) å…¶ä¸­ï¼š corePoolSize: æ ¸å¿ƒçº¿ç¨‹æ•°é‡ maximumPoolSize:æœ€å¤§çº¿ç¨‹æ•°æ•°é‡ keepAliveTime:é‚£äº›è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°æ•°é‡çš„çš„çº¿ç¨‹å¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…æ²¡æœ‰è¢«æ‰§è¡Œï¼Œå°±ä¼šè¢«å›æ”¶ã€‚ unit:ä¸Šä¸€ä¸ªå‚æ•°çš„æ—¶é—´å•ä½ã€‚ workQueue:ç”¨æ¥å­˜å‚¨ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ã€‚ hander:æ‹’ç»ä»»åŠ¡å¤„ç†æ—¶çš„ç­–ç•¥ã€‚ çœ‹ThreadPoolExecutorçš„å®šä¹‰ï¼Œå¯ä»¥å‘ç°å®ƒç»§æ‰¿äº†AbstractExecutorService 1public class ThreadPoolExecutor extends AbstractExecutorService å†æ¥çœ‹ä¸‹AbstractExecutorServiceçš„å®šä¹‰: 1public abstract class AbstractExecutorService implements ExecutorService å®ƒå®ç°äº†ExecutorServiceæ¥å£ å†æ¥çœ‹ä¸‹ExecutorServiceæ¥å£ 1public interface ExecutorService extends Executor å®ƒå®ç°äº†Executoræ¥å£ï¼š 123public interface Executor&#123; void execute(Runnable command)&#125; æˆ‘ä»¬æ¥ç”»ä¸‹å®ƒä»¬çš„ç±»å›¾ å¯ä»¥çœ‹å‡ºï¼ŒExecutoræ˜¯æœ€é¡¶å±‚çš„æ¥å£ã€‚ è§£ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸‹ThreadPoolExecutoré‡Œé¢çš„ä¸€äº›å˜é‡å’Œæ–¹æ³•. é¦–å…ˆæ˜¯ctlç›¸å…³çš„ï¼š 123456789101112131415private final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0)); private static final int COUNT_BITS = Integer.SIZE - 3; private static final int COUNT_MASK = (1 &lt;&lt; COUNT_BITS) - 1; // runState is stored in the high-order bits private static final int RUNNING = -1 &lt;&lt; COUNT_BITS; private static final int SHUTDOWN = 0 &lt;&lt; COUNT_BITS; private static final int STOP = 1 &lt;&lt; COUNT_BITS; private static final int TIDYING = 2 &lt;&lt; COUNT_BITS; private static final int TERMINATED = 3 &lt;&lt; COUNT_BITS; // Packing and unpacking ctl private static int runStateOf(int c) &#123; return c &amp; ~COUNT_MASK; &#125; private static int workerCountOf(int c) &#123; return c &amp; COUNT_MASK; &#125; private static int ctlOf(int rs, int wc) &#123; return rs | wc; &#125; ctlè¿™ä¸ªå˜é‡å…¶å®æ˜¯ä¸ªç»„åˆå˜é‡ï¼Œç”¨å®ƒæ¥è¡¨ç¤ºçº¿ç¨‹æ•°é‡workerCountå’Œçº¿ç¨‹å·¥ä½œçŠ¶æ€runStateã€‚ ä»ä¸‹é¢å‡ è¡Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œçº¿ç¨‹çŠ¶æ€æœ‰äº”ç§ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸‰ä¸ªæ¯”ç‰¹ä½æ¥è¡¨ç¤ºï¼Œå‰©ä¸‹çš„Integer.SIZE-3ä¹Ÿå°±æ˜¯29ä½ç”¨æ¥è¡¨ç¤ºçº¿ç¨‹æ•°é‡ï¼Œä¸€å…±èƒ½è¡¨ç¤º$2^{29}-1$ä¸ªçº¿ç¨‹ã€‚ç¬¬ä¸‰è¡Œåˆ™æ˜¯é€šè¿‡ä½è¿ç®—æ¥è®¡ç®—æ©ç ï¼Œæ©ç æ˜¯é•¿åº¦ä¸º29 bitçš„1ã€‚ æ‰€ä»¥ç°åœ¨çš„æƒ…å†µæ˜¯è¿™æ ·çš„ï¼Œctlä¸€å…±æœ‰32ä½ï¼Œé«˜ä¸‰ä½ç”¨æ¥è¡¨ç¤ºçº¿ç¨‹æ± è¿è¡ŒçŠ¶æ€ï¼Œä½29ä½ç”¨æ¥è¡¨ç¤ºçº¿ç¨‹æ•°é‡ã€‚ ä¸‹é¢çœ‹ä¸‹è¿™å‡ ä¸ªæ‹†è§£ctlçš„æ–¹æ³•ï¼š 1private static int runStateOf(int c) &#123; return c &amp; ~COUNT_MASK; &#125; è¿™ä¸ªæ–¹æ³•æ˜¯ä¸ºäº†è·å–è¿è¡ŒçŠ¶æ€ã€‚æ©ç æ˜¯29ä¸ª1ï¼Œå–éï¼Œ29ä¸ª0ï¼Œä¸ctlä¸è¿ç®—ï¼Œå¾—åˆ°ctlçš„é«˜ä¸‰ä½+29ä¸ª0ï¼Œæ­£å¥½å’Œä¸Šé¢å‡ è¡Œçš„runStateçš„å·¦ç§»å¯¹åº”èµ·æ¥ã€‚ 1private static int workerCountOf(int c) &#123; return c &amp; COUNT_MASK; &#125; è¿™ä¸ªæ–¹æ³•ç”¨æ¥è·å–çº¿ç¨‹æ•°é‡ï¼Œä¸çš„ç»“æœå°±æ˜¯ctlçš„ä½29ä½ã€‚ 1private static int ctlOf(int rs, int wc) &#123; return rs | wc; &#125; è¿™ä¸ªæ–¹æ³•runStateå’ŒworkerCountæ¥ç»„åˆå‡ºä¸€ä¸ªctl å†æ¥çœ‹ä¸‹executeæ–¹æ³•ï¼š å®ƒçš„ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819public void execute(Runnable command) &#123; if (command == null) throw new NullPointerException(); int c = ctl.get(); if (workerCountOf(c) &lt; corePoolSize) &#123; if (addWorker(command, true)) return; c = ctl.get(); &#125; if (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123; int recheck = ctl.get(); if (! isRunning(recheck) &amp;&amp; remove(command)) reject(command); else if (workerCountOf(recheck) == 0) addWorker(null, false); &#125; else if (!addWorker(command, false)) reject(command); &#125; æˆ‘ä»¬åˆ†æ‰¹æ¥çœ‹è¿™å—ä»£ç ï¼š 123456int c = ctl.get(); if (workerCountOf(c) &lt; corePoolSize) &#123; if (addWorker(command, true)) return; c = ctl.get(); &#125; é¦–å…ˆï¼Œè·å¾—å½“å‰çº¿ç¨‹æ•°ï¼Œå¦‚æœå°äºcorePoolSizeï¼Œé‚£ä¹ˆå°±æ·»åŠ æ–°çš„çº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ã€‚å¦‚æœæ·»åŠ çº¿ç¨‹æˆåŠŸäº†ï¼Œç›´æ¥return,å¦åˆ™ï¼Œé‡æ–°è·å¾—ctlçš„å€¼ï¼Œç»§ç»­ä¸‹é¢çš„åˆ¤æ–­ã€‚ 1234567if (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123; int recheck = ctl.get(); if (! isRunning(recheck) &amp;&amp; remove(command)) reject(command); else if (workerCountOf(recheck) == 0) addWorker(null, false); &#125; åœ¨æ‰§è¡Œè¿™ä¸ªä»£ç å—æ—¶æˆ‘ä»¬éœ€è¦æ³¨æ„ï¼Œæ¥åˆ°ç¬¬äºŒä¸ªä»£ç å—æ—¶ï¼Œç¬¬ä¸€ä¸ªä»£ç å—çš„åˆ¤æ–­æ¡ä»¶å¯èƒ½æ˜¯workerCountå¤§äºç­‰äºcorePoolSize,ä¹Ÿå¯èƒ½æ˜¯addWorkerå¤±è´¥ã€‚å¦‚æœçº¿ç¨‹æ± isRunning,åˆ™å°è¯•å‘workQueueä¸­æ·»åŠ ä»»åŠ¡ï¼Œå¦‚æœæ·»åŠ æˆåŠŸï¼Œé‡æ–°è·å¾—ctlå€¼ï¼Œdouble check çº¿ç¨‹æ± æ˜¯å¦running,å¦‚æœæ­¤æ—¶çº¿ç¨‹æ± æ²¡æœ‰runningï¼Œåˆ™removeæ‰å½“å‰ä»»åŠ¡ï¼Œå¹¶ä¸”æ‰§è¡Œreject. å¦‚æœçº¿ç¨‹æ± åœ¨è¿è¡Œï¼Œæˆ–è€…removeå¤±è´¥ï¼Œæ£€æŸ¥workerCountæ˜¯å¦ä¸º0ï¼Œå¦‚æœä¸º0åˆ™æ·»åŠ ä¸€ä¸ªç©ºçš„thread. 12else if (!addWorker(command, false)) reject(command); å¦‚æœæ·»åŠ æ ¸å¿ƒçº¿ç¨‹å¤±è´¥ï¼Œåˆ™ç›´æ¥æ‹’ç»ã€‚ è¿™ä¸ªå¯èƒ½çœ‹ç€æœ‰ç‚¹è¿·ï¼Œå…ˆçœ‹ä¸‹é‡Œé¢çš„addWorkeræ–¹æ³• //æœ‰ç©ºå†å†™å§ è¿™é‡Œæ¨èä¸€ç¯‡è®²çš„å¾ˆä»”ç»†çš„åšå®¢ï¼šhttps://mp.weixin.qq.com/s/-89-CcDnSLBYy3THmcLEdQ Javaä¸­çš„é”å›¾ç‰‡æ¥è‡ªç¾å›¢æŠ€æœ¯å›¢é˜Ÿåšå®¢ è¿™äº›åˆ†ç±»æ›´å¤šçš„æ˜¯æŒ‰ç…§é”çš„ç‰¹æ€§å’Œè®¾è®¡æ¥åˆ†ç±»çš„ï¼Œå¹¶ä¸æ˜¯è¯´çœŸçœŸæ­£æ­£çš„æœ‰è¿™ä¹ˆå¤šçš„é”ã€‚ ä¸‹é¢æˆ‘ä¼šä»‹ç»Javaä¸­çš„synchronized ã€ reentrylockç­‰é”ï¼Œä»¥åŠå®ƒä»¬åˆ†åˆ«å±äºå“ªäº›ç±»åˆ«ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}]},{"title":"ç›´é¢Java","slug":"ç›´é¢Java","date":"2019-01-12T12:49:24.000Z","updated":"2019-01-12T12:49:24.000Z","comments":true,"path":"2019/01/12/ç›´é¢Java/","link":"","permalink":"http://example.com/2019/01/12/%E7%9B%B4%E9%9D%A2Java/","excerpt":"","text":"é­”æ•°å¸¸é‡å€¼ æ¯”å¦‚è¯´ç”¨æ¥æ ‡è¯†æ–‡ä»¶ç±»å‹ JITâ€‹ JIT(Just in time compiler). â€‹ å‰æï¼š â€‹ 1. javaæ–‡ä»¶æ˜¯å…ˆè¢«ç¼–è¯‘æˆå­—èŠ‚ç ï¼ˆä¹Ÿå°±æ˜¯classæ–‡ä»¶ï¼‰ç„¶åæ‰è½½å…¥JVMçš„â€‹ 2. JVMä¸­æ—¢æœ‰è§£é‡Šå™¨åˆæœ‰ç¼–è¯‘å™¨ â€‹ åŠæ—¶ç¼–è¯‘æŠ€æœ¯å°±æ˜¯è¯´ï¼Œåœ¨JVMè§£é‡Šï¼ˆç”¨çš„æ˜¯è§£é‡Šå™¨ï¼‰æ‰§è¡Œå­—èŠ‚ç çš„æ—¶å€™ï¼Œé‡åˆ°ä¸€äº›çƒ­ç‚¹ä»£ç ï¼ˆä¹Ÿå°±æ˜¯ç»å¸¸è¢«é‡å¤æ‰§è¡Œçš„ä»£ç ï¼Œå…·ä½“æ€ä¹ˆç®—é‡å¤æ‰§è¡Œåé¢æœ‰è®²åˆ°ï¼‰æ—¶ï¼Œä¼šæŠŠå®ƒç¼–è¯‘æˆå’Œæœ¬åœ°å¹³å°ç›¸å…³çš„æœºå™¨ç å»æ‰§è¡Œã€‚ â€‹ è¿™é‡Œä½ å¯èƒ½ä¼šæœ‰ç–‘é—®ï¼š ä¸ºä»€ä¹ˆé‡åˆ°çƒ­ç‚¹ä»£ç æ—¶è¦æŠŠä»–ä»¬ç¿»è¯‘æˆæœ¬åœ°æœºå™¨ç ï¼Ÿ ç­”ï¼šå› ä¸ºJVMæ‰§è¡Œæœºå™¨ç çš„é€Ÿåº¦è¦æ¯”è§£é‡Šæ‰§è¡Œå¿«å¾—å¤šï¼Œé‡è§è¿™ç§é‡å¤æ‰§è¡Œå¾ˆå¤šæ¬¡çš„ä»£ç ï¼ŒæŠŠå®ƒç¿»è¯‘æˆæœºå™¨ç æ˜¯æ˜æ™ºçš„ã€‚ ä¸ºä»€ä¹ˆä¸å…¨éƒ¨ç¼–è¯‘ï¼Ÿ ç­”ï¼šå› ä¸ºç¼–è¯‘ä¹Ÿè´¹æ—¶é—´å•Šï¼Œå°¤å…¶å½“å·¥ç¨‹å¾ˆå¤§çš„æ—¶å€™ã€‚è€Œä¸”ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æ‰§è¡Œå‰æŠŠJavaæ–‡ä»¶å…¨éƒ¨ç¼–è¯‘æˆæœºå™¨ç çš„è¯ï¼Œé‚£å®ƒè¿˜å’ŒC++æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå®ƒçš„è·¨å¹³å°æ€§åˆä½“ç°åœ¨å“ªé‡Œï¼Ÿ â€‹ javaæ–‡ä»¶é¦–å…ˆè¢«ç¼–è¯‘æˆå­—èŠ‚ç ï¼Œä¹Ÿå°±æ˜¯classæ–‡ä»¶ï¼Œclassæ–‡ä»¶è¢«è™šæ‹Ÿæœºè£…è½½ä»¥åï¼Œä¼šä»¥è§£é‡Šæ¨¡å¼è¿è¡Œä¸€æ®µæ—¶é—´ï¼Œå½“å‘è§‰æŸäº›ä»£ç è¿è¡Œæ¯”è¾ƒé¢‘ç¹ï¼ˆè¿™é‡Œæœ‰ä¸¤ç§åº¦é‡æ–¹å¼ï¼‰æ—¶ï¼Œå°±ä¼šå¯¹è¿™äº›ä»£ç è¿›è¡Œä¼˜åŒ–ã€‚ ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒJVMä¸­æœ‰è§£é‡Šå™¨å’Œç¼–è¯‘å™¨ï¼Œè§£é‡Šå™¨å°†å­—èŠ‚ç è§£é‡Šæ‰§è¡Œï¼Œæ¯”è¾ƒæ…¢ã€‚å°¤å…¶å½“æœ‰ä¸€éƒ¨åˆ†ä»£ç è¿è¡Œçš„ç‰¹åˆ«é¢‘ç¹ï¼Œå¦‚å¾ªç¯ï¼Œè¿™æ—¶å€™ä½¿ç”¨è§£é‡Šå™¨æ¥è§£é‡Šæ‰§è¡Œå°±æ›´æ…¢äº†ã€‚è€ŒJITçš„ä½œç”¨ä¹Ÿå°±ä½“ç°åœ¨è¿™é‡Œã€‚ä»£ç è§£é‡Šæ‰§è¡Œçš„æ—¶å€™ï¼Œå®ƒå…ˆæš—ä¸­è§‚å¯Ÿä¸€æ®µæ—¶é—´ï¼Œä»è€Œå‘ç°çƒ­ç‚¹ä»£ç â€œHot Spot Codeâ€ï¼ŒæŠŠå®ƒç¼–è¯‘æˆå’Œæœ¬åœ°å¹³å°ç›¸å…³çš„æœºå™¨ç ï¼ˆç¼–è¯‘ç”±åå°çº¿ç¨‹å»æ‰§è¡Œï¼‰ï¼Œå¹¶è¿›è¡Œå„ä¸ªå±‚æ¬¡çš„ä¼˜åŒ–ã€‚è¿™é‡Œçš„çƒ­ç‚¹ä»£ç æœ‰ä¸¤ç±»ï¼š å¤šæ¬¡è°ƒç”¨çš„æ–¹æ³• å¤šæ¬¡è°ƒç”¨çš„å¾ªç¯ä½“ é‚£ä¹ˆå¦‚ä½•å‘ç°çƒ­ç‚¹ä»£ç å‘¢ï¼Œè¿™å°±éœ€è¦ç”¨åˆ°çƒ­ç‚¹æ¢æµ‹â€œHotpot Detectionâ€,ç›®æµ‹çš„æ¢æµ‹æ–¹æ³•æœ‰ä¸¤ç§ï¼š åŸºäºé‡‡æ ·çš„çƒ­ç‚¹æ¢æµ‹ï¼šå‘¨æœŸæ€§çš„æ£€æŸ¥æ¯ä¸ªçº¿ç¨‹çš„æ ˆé¡¶ï¼Œé‚£äº›ç»å¸¸å‡ºç°åœ¨æ ˆé¡¶çš„æ–¹æ³•å°±æ˜¯çƒ­ç‚¹ä»£ç ã€‚ ä¼˜ç‚¹ï¼šå®¹æ˜“è·å¾—æ–¹æ³•è°ƒç”¨å…³ç³» ç¼ºç‚¹ï¼šä¸ç²¾ç¡® åŸºäºè®¡æ•°å™¨çš„çƒ­ç‚¹æ¢æµ‹ï¼šæ›´ä¸ºä¸¥è°¨ï¼Œå®ƒä¸ºæ¯ä¸ªæ–¹æ³•æˆ–è€…ä»£ç å—å»ºç«‹è®¡æ•°å™¨ï¼Œå¦‚æœè®¡æ•°è¶…è¿‡æŸä¸ªé˜ˆå€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•ï¼ˆä»£ç å—ï¼‰å°±æ˜¯çƒ­ç‚¹ä»£ç ã€‚ ä¼˜ç‚¹ï¼šç²¾ç¡® ç¼ºç‚¹ï¼šæ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦ä¸ºæ¯ä¸ªæ–¹æ³•æˆ–ä»£ç å—å»ºç«‹è®¡æ•°å™¨ HotSpotä¸­ä½¿ç”¨ç¬¬äºŒç§ï¼Œå®ƒä¸ºæ–¹æ³•å’Œå¾ªç¯ä½“åˆ†åˆ«è®¾å®šäº†æ–¹æ³•è®¡æ•°å™¨å’Œå›è¾¹è®¡æ•°å™¨ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œç¼–è¯‘åçš„æœ¬åœ°æœºå™¨ç æ”¾åœ¨äº†å“ªé‡Œï¼Ÿ JITç¼–è¯‘å™¨åˆ†clientæ¨¡å¼å’Œserveræ¨¡å¼ã€‚serveræ¨¡å¼å¯åŠ¨æ…¢ï¼Œä½†æ˜¯å¯åŠ¨åæ€§èƒ½é«˜ï¼Œé€‚åˆäºå¤§å‹çš„æœåŠ¡å™¨åå°ç¨‹åºï¼›clientå¯åŠ¨å¿«ï¼Œä½†æ€§èƒ½ä¸å¦‚serveræ¨¡å¼ï¼Œé€‚åˆäºæ¡Œé¢ç¨‹åºç­‰ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"}]},{"title":"Pythonå­¦ä¹ ç¬”è®°","slug":"pythonå­¦ä¹ ç¬”è®°","date":"2018-10-13T07:33:11.000Z","updated":"2020-05-31T04:35:04.000Z","comments":true,"path":"2018/10/13/pythonå­¦ä¹ ç¬”è®°/","link":"","permalink":"http://example.com/2018/10/13/python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","excerpt":"è¯­å¥ whileå¾ªç¯ï¼Œforå¾ªç¯ï¼Œifè¯­å¥ ä¸éœ€è¦æ‹¬å·ï¼Œåé¢éœ€è¦åŠ å†’å· å®šä¹‰å‡½æ•°è¯­å¥ ï¼š def fun(a,b): â€‹ æ³¨ï¼šå‚æ•°å¯ä»¥è®¾ç½®ä¸ºé»˜è®¤å€¼ å®šä¹‰å…¨å±€å˜é‡ï¼š å®šä¹‰åœ¨å‡½æ•°å¤–éƒ¨æˆ–è€…ç”¨å†…éƒ¨globalä¿®é¥°","text":"è¯­å¥ whileå¾ªç¯ï¼Œforå¾ªç¯ï¼Œifè¯­å¥ ä¸éœ€è¦æ‹¬å·ï¼Œåé¢éœ€è¦åŠ å†’å· å®šä¹‰å‡½æ•°è¯­å¥ ï¼š def fun(a,b): â€‹ æ³¨ï¼šå‚æ•°å¯ä»¥è®¾ç½®ä¸ºé»˜è®¤å€¼ å®šä¹‰å…¨å±€å˜é‡ï¼š å®šä¹‰åœ¨å‡½æ•°å¤–éƒ¨æˆ–è€…ç”¨å†…éƒ¨globalä¿®é¥° æ¨¡å—å®‰è£… sd å‡½æ•° é»˜è®¤å‚æ•° å‡½æ•°å¯ä»¥æœ‰é»˜è®¤å‚æ•°ï¼Œä½†æ˜¯é»˜è®¤å‚æ•°å¿…é¡»æŒ‡å‘ä¸å˜å¯¹è±¡ å¯å˜å‚æ•° æ„å‘³ç€å¯ä»¥ä¼ å…¥ä»»æ„å¤šä¸ªå‚æ•°ï¼Œåœ¨è°ƒç”¨æ—¶è‡ªåŠ¨ç»„è£…æˆä¸€ä¸ªtuple,åœ¨å‚æ•°å‰é¢åŠ ä¸ª*å·ï¼Œåœ¨ä¸€ä¸ªlistæˆ–è€…tupleå‰é¢åŠ ä¸ª *å·ï¼Œæ„å‘³ç€å°†listæˆ–tupleå…ƒç´ æ‹†è§£æˆå¤šä¸ªå¯å˜å‚æ•°ä¼ å…¥ å…³é”®å­—å‚æ•° å…³é”®å­—å‚æ•°å…è®¸ä¼ å…¥ä»»æ„ä¸ªå«å‚æ•°åçš„å‚æ•°ï¼Œè¿™äº›å…³é”®å­—å‚æ•°åœ¨å‡½æ•°å†…éƒ¨è‡ªåŠ¨ç»„è£…æˆä¸€ä¸ªdict 1234def person(name,age,**kw): print(&#x27;name&#x27;,name,&#x27;age&#x27;,age,&#x27;other&#x27;,kw)person(&#x27;Jack&#x27;,24,**&#123;&#x27;city&#x27;:&#x27;Beijing&#x27;,&#x27;job&#x27;:&#x27;Engineer&#x27;&#125;)&gt;&gt;&gt; name Jack age 24 other &#123;&#x27;job&#x27;: &#x27;Engineer&#x27;, &#x27;city&#x27;: &#x27;Beijing&#x27;&#125; å‘½åå…³é”®å­—å‚æ•° é¡¾åæ€ä¹‰ï¼Œé™åˆ¶å…³é”®å­—å‚æ•°çš„åå­—ï¼Œæ¯”å¦‚è¯´æˆ‘åªå…è®¸ä¼ å…¥cityå’Œjobå…³é”®å­—ï¼Œé‚£ä¹ˆ 1person(name,age,*,city,job) æœå‡½æ•°å®šä¹‰ä¸­å·²ç»æœ‰äº†ä¸€ä¸ªå¯å˜å‚æ•°ï¼Œåé¢è·Ÿç€çš„å‘½åå…³é”®å­—å‚æ•°å°±ä¸å†éœ€è¦ä¸€ä¸ªç‰¹æ®Šåˆ†éš”ç¬¦*äº† 1person(name,age,*args,city,job) é«˜çº§ç‰¹æ€§ åˆ‡ç‰‡ 12345l=list(range(0,100,1))L[0:3]è¡¨ç¤ºå–å‡ºç´¢å¼•0åˆ°ç´¢å¼•2çš„æ‰€æœ‰å…ƒç´ l[:10] //å–å‡ºå‰åä¸ªå…ƒç´ l[-10:] //å–å‡ºååä¸ªå…ƒç´ l[:10:2] //å‰åä¸ªæ•°æ¯ä¸¤ä¸ªå–ä¸€ä¸ª åˆ—è¡¨ç”Ÿæˆå¼ 123[x*x for x in range(1,11)]d = &#123;&#x27;x&#x27;:&#x27;A&#x27;,&#x27;y&#x27;:&#x27;B&#x27;,&#x27;z&#x27;:&#x27;C&#x27;&#125;[k+&#x27;=&#x27;+v for k,v in d.items()] ç”Ÿæˆå™¨ ä¸€è¾¹å¾ªç¯ä¸€éè®¡ç®—çš„æœºåˆ¶ å®šä¹‰æ–¹æ³•ä¸€ 123456&gt;&gt;&gt; l = [x*x for x in range(1,11)]&gt;&gt;&gt; l[1, 4, 9, 16, 25, 36, 49, 64, 81, 100]&gt;&gt;&gt; g = (x*x for x in range(1,11))&gt;&gt;&gt; g&lt;generator object &lt;genexpr&gt; at 0x000001EF9005A5C8&gt; ç›¸æ¯”äºåˆ—è¡¨ç”Ÿæˆå™¨ï¼Œå”¯ä¸€çš„ä¸åŒå°±æ˜¯() å®šä¹‰æ–¹æ³•äºŒ yieldå…³é”®å­—ï¼Œä»¥æ–æ³¢é‚£å¥‘æ•°åˆ—ä¸ºä¾‹ 1234567891011121314151617&gt;&gt;&gt; def fib(max): n,a,b = 0,0,1 while n&lt;max: yield b a,b = b,a+b n=n+1 return &#x27;done&#x27;&gt;&gt;&gt; for i in fib(6): print(i) 112358 å¦‚æœæŠŠè¿™é‡Œçš„yieldæ¢æˆprintï¼Œé‚£fib()å°±æ˜¯ä¸ªå‡½æ•°ï¼Œè¿™é‡Œyieldå…³é”®å­—çš„ä½œç”¨æ˜¯ï¼Œç”Ÿæˆå™¨æ¯æ¬¡æ‰§è¡Œåˆ°è¿™é‡Œè¿”å›ï¼Œä¸‹æ¬¡æ‰§è¡Œæ—¶æ¥ç€è¿™é‡Œæ‰§è¡Œ Interable Interator å¯ä»¥ä½œç”¨äºforå¾ªç¯çš„æˆä¸ºInterable å¯ä»¥è¢«next()å‡½æ•°è°ƒç”¨å¹¶ä¸æ–­è¿”å›ä¸‹ä¸€ä¸ªå€¼çš„å«åšInterator å¯ä»¥ç”¨isInstance()åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯Interatorå¯¹è±¡ Interatorçš„è®¡ç®—æ˜¯æƒ°æ€§çš„ï¼Œåªæœ‰éœ€è¦ä¸‹ä¸€ä¸ªå€¼æ—¶å®ƒæ‰ä¼šè®¡ç®— å‡½æ•°å¼ç¼–ç¨‹å…è®¸å°†å‡½æ•°ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ ç»™å‡½æ•° é«˜é˜¶å‡½æ•° map/reduce map map(function,Interator),mapå°†functionä½œç”¨äºInteratorçš„æ¯ä¸ªå…ƒç´ ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„Interator 1234567&gt;&gt;&gt; map(abs,[-1,-2,-3,-4])&lt;map object at 0x000001EF9006C518&gt;&gt;&gt;&gt; r = map(abs,[-1,-2,-3,-4])&gt;&gt;&gt; r&lt;map object at 0x000001EF9006C278&gt;&gt;&gt;&gt; list(r)[1, 2, 3, 4] ä¹Ÿå°±æ˜¯ä¸€ç§æ˜ å°„ reduce reduce(function,Interator)ï¼Œreduceå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç§å½’çº³æˆ–è€…è¿­ä»£ 123&gt;&gt;&gt; from functools import reduce&gt;&gt;&gt; reduce(add,[1,2,3,4])10 filter åŒæ ·æ¥æ”¶ä¸¤ä¸ªå‚æ•° sorted sorted([...],key=function)å…ˆæŒ‰ç…§keyæ‰€æŒ‡çš„å‡½æ•°å¯¹listå¤„ç†ï¼Œå¯¹å¤„ç†åçš„ç»“æœæ’åºï¼Œç„¶åæŠŠæ’åºå¥½çš„ç»“æœæ˜ å°„åˆ°åŸæ¥çš„listå¹¶è¿”å› æ–‡ä»¶è¯»å†™ å†™æ–‡ä»¶ï¼š 123file = open(&quot;filename&quot;,&quot;openMethod&quot;)file.write()file.close() è¯»æ–‡ä»¶ï¼š 1234file = open()context = file.read()//å…¶ä»–å½¢å¼file.readline()æˆ–file.readlines()file.close() class ç±» å®šä¹‰ï¼š 123456class Calculator : name = &#x27;Good Calculator&#x27; price = 18 def __init__(self,name,price) def add(self,x,y): return x+y å£°æ˜ï¼š calcu = Calculator(); æ³¨ï¼š ä¸javaä¸åŒçš„æ˜¯pythonå®šä¹‰æ–¹æ³•æ—¶å¿…ç„¶æœ‰ä¸€ä¸ªselfå‚æ•°ï¼Œç›¸å½“äºjavaä¸­çš„this,ä¸”åœ¨æ–¹æ³•ä¸­ä½¿ç”¨å±æ€§æ—¶éœ€è¦ç”¨ self.name å‡½æ•°init()ç›¸å½“äºæ„é€ å‡½æ•°ï¼Œç”¨äºåˆå§‹åŒ–å±æ€§ï¼Œä¹Ÿæ˜¯æœ€å…ˆæ‰§è¡Œçš„æ–¹æ³•ï¼Œæ¯”è¾ƒå¥‡æ€ªçš„æ˜¯å®ƒè¿™é‡Œå¹¶æ²¡æœ‰åƒjavaä¸­é‚£æ ·å’Œç±»ååŒå å±æ€§å¿…é¡»åˆå§‹å€¼ï¼Œä¸ç„¶ä¼šæŠ¥é”™ å…ƒç»„ï¼Œåˆ—è¡¨ï¼Œå­—å…¸ï¼Œé›†åˆ å…ƒç»„ tuple = (â€¦) åœ†æ‹¬å·,ç›¸æ¯”äºåˆ—è¡¨ï¼Œå…ƒç»„ä¸€æ—¦åˆå§‹åŒ–å°±ä¸å¯æ”¹å˜ åˆ—è¡¨ list= [â€¦] æ–¹æ‹¬å·123456789list.append(element) #è¿½åŠ list.insert(index,element) #æ’å…¥list.remove(element) #åˆ é™¤ç¬¬ä¸€æ¬¡å‡ºç°çš„è¯¥å…ƒç´ list[-1] #è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´ list[0:3] #ä»ç¬¬0ä¸ªå…ƒç´ åˆ°ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼ˆä¸åŒ…æ‹¬ç¬¬ä¸‰ä¸ªï¼‰list.index(element) #è¿”å›ç¬¬ä¸€æ¬¡å‡ºç°è¯¥å…ƒç´ çš„ç´¢å¼•list.count(element) #è¿”å›listä¸­è¯¥å…ƒç´ çš„ä¸ªæ•°list.sort() #å¯¹listè¿›è¡Œå‡åºæ’åºå¹¶è¦†ç›–åŸæ¥çš„listlist.sort(reverse=True) #å¯¹listé™åºæ’åº å¤šç»´åˆ—è¡¨123multi_dim_list = [[1,2,3],[4,5,6],[7,8,9]]print(multi_dim_list[0])print(multi_dim_list[0][2]) å­—å…¸ æ— åºçš„å®¹å™¨ï¼Œå¯å­˜å‚¨ä»»æ„ç±»å‹å¯¹è±¡ï¼Œæ¯ä¸ªå…ƒç´ åˆ†åˆ«åˆç”±é”®ï¼šå€¼æ„æˆï¼Œé”®å¿…é¡»å”¯ä¸€ï¼Œå€¼å¯ä¸å”¯ä¸€ï¼Œä¸”ç±»å‹å¯å¤šæ ·ï¼Œé”®ç±»å‹ä¹Ÿå¯å¤šæ ·ã€‚æ— è®ºæ˜¯æ·»åŠ è¿˜æ˜¯åˆ é™¤å…ƒç´ ï¼Œéƒ½æ˜¯é€šè¿‡é”®æ¥ç´¢å¼•å€¼ 123456789101112d = &#123;1:&#x27;a&#x27;,2:&#x27;b&#x27;&#125;print(d)print(d[1])del d[1]print(d)d[3]=&#x27;c&#x27;print(d)d[4] = &#123;1:3,2:4&#125;d[5] = [&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;]print(d)d[&#x27;a&#x27;]= 1print(d) é›†åˆ setå¯ä»¥çœ‹æˆæ•°å­¦æ„ä¹‰ä¸Šçš„æ— åºå’Œæ— é‡å¤å…ƒç´ çš„é›†åˆï¼Œseté‡Œå­˜æ”¾çš„æ˜¯ä¸å¯é‡å¤çš„é”® æ¨¡å—1. importæ¨¡å— + import time + import time as t è‡ªå·±é‡æ–°å®šä¹‰æ¨¡å—å + from time import time,localtime åªimportè‡ªå·±æƒ³è¦çš„åŠŸèƒ½ + from time import * importè¯¥æ¨¡å—æ‰€æœ‰åŠŸèƒ½ tryè¯­å¥123456try: .....except Exception as e: ....else: .... map zip lambda zip å°†ä¸¤ä¸ªlistç”¨äºçºµå‘çš„åˆå¹¶,å¦‚ï¼š 12a=[1,2,3] , b=[4,5,6]print(list(zip(a,b))) è¾“å‡ºï¼š[(1, 4), (2, 5), (3, 6)] lambda lambdaç”¨äºå®šä¹‰ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œç®€åŒ–ä»£ç ,å¦‚ï¼š 12res = lambda x,y : x+yprint(res(2,5)) è¾“å‡ºï¼š7 map ç”¨äºç»‘å®šå‡½æ•°ä¸å‚æ•°ï¼Œå¦‚ï¼šlist(map(fun,1,2))æ³¨ï¼šå‚æ•°é¡»ä¸ºåˆ—è¡¨å½¢å¼ copy &amp; deepcopy a = list[1,2,3] , å¦‚æœ b = a , åˆ™aå’ŒbæŒ‡å‘çš„æ˜¯åŒä¸€å†…å­˜ç©ºé—´ï¼Œè¿™æ—¶å€™å¦‚æœç”¨ b = copy.copy(a) (å› ä¸ºcopyæ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæ‰€ä»¥éœ€è¦å…ˆå¼•å…¥è¿™ä¸ªæ¨¡å—import copy), åˆ™ä¼šå¼€è¾Ÿæ–°çš„å†…å­˜ç©ºé—´ï¼Œå¦‚æœè¾“å‡º id(a) == id(b) ,åˆ™æ˜¯false.ä½†æ˜¯éœ€è¦æ³¨æ„è¿™é‡Œçš„copyæ˜¯æµ…å¤åˆ¶(shallow copy),ä¹Ÿå°±æ˜¯è¯´åªä¼šå¤åˆ¶listä¸­çš„ä¸€å±‚åˆ°æ–°çš„å†…å­˜ç©ºé—´ï¼Œå¦‚æœlistæ˜¯è¿™ç§å½¢å¼ï¼ša = list[1,2,[3,4]],é‚£ä¹ˆæ‰§è¡Œcopyåå‰ä¸¤ä¸ªå…ƒç´  ä¼šè¢«å¤åˆ¶åˆ°æ–°çš„å†…å­˜ç©ºé—´ï¼Œè€Œç¬¬ä¸‰ä¸ªå…ƒç´ åˆ™è¢«å…±äº«ï¼Œè¿™æ—¶å€™å°±éœ€è¦deepcopyå‘æŒ¥ä½œç”¨äº†ï¼Œä½¿ç”¨å®ƒåˆ™æ˜¯å®Œå®Œå…¨å…¨çš„å¤åˆ¶ å†’å·çš„ç”¨æ³•æŠŠå†’å·æ”¾åœ¨æ•°ç»„ä¸­ï¼Œä¸»è¦èµ·åˆ°åˆ†ç‰‡çš„ä½œç”¨ï¼Œ 1234567891011121314&gt;&gt;&gt; a = &#x27;hello&#x27;&gt;&gt;&gt; a[1:3]&#x27;el&#x27;&gt;&gt;&gt; a[::]&#x27;hello&#x27;&gt;&gt;&gt; a[:]&#x27;hello&#x27;&gt;&gt;&gt; a[:1]&#x27;h&#x27;&gt;&gt;&gt; a[1:]&#x27;ello&#x27;&gt;&gt;&gt; a[-1]&#x27;o&#x27;&gt;&gt;&gt;","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"http://example.com/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[]},{"title":"è®ºæ–‡æ€»ç»“","slug":"è®ºæ–‡æ€»ç»“","date":"2018-07-16T02:40:04.000Z","updated":"2023-05-29T14:17:39.392Z","comments":true,"path":"2018/07/16/è®ºæ–‡æ€»ç»“/","link":"","permalink":"http://example.com/2018/07/16/%E8%AE%BA%E6%96%87%E6%80%BB%E7%BB%93/","excerpt":"","text":"CROWDSOURCE-BASED SIGNAL STRENGTH FIELD ESTIMATION BYGAUSSIAN PROCESSES the authors apply a Gaussian Process (GP) to model the RSS(received signal strength), and for estimation they use measurements from known locationsï¼Œwhich based on a log-normal path loss model and perfectly knowledge of the user locations. In this paper, the author proposed an extended GP implementation and took into account the inaccuracy of user locations and unknown of path loss exponent. The parameters of the path loss Gaussian are estimated according to the empirical Bayesian approach. Steering Crowdsourced Signal Map Construction via Bayesian Compressive Sensing incentive mechanism is essential challenges: missing value inference crowdsourcing quality estimation incentive mechanism (incentive distribution map) cost and reward ? how to construct projection matrix (using correlations) mentioned: auction-based incentive designs RMapCS: Radio Map Construction From Crowdsourced Samples for Indoor LocalizationUse site survey to construct a radio map offline radio map construction, Online fingerprinting localization Challenges: Inaccurate sample annotation Measurement device diversity Nonuniform spatial distribution Quality-Aware Sparse Data Collection in MEC Enhanced Mobile Crowdsensing Systemså°†è¾¹ç¼˜è®¡ç®—å’Œç¾¤æ™ºæ„ŸçŸ¥ç»“åˆèµ·æ¥ï¼š è¾¹ç¼˜èŠ‚ç‚¹è¿›è¡Œä¸€éƒ¨åˆ†çš„è®¡ç®—ï¼Œæ¨æ–­å‡ºæœªé‡‡æ ·æ ¼å­çš„çŠ¶æ€ï¼Œé™ä½å†—ä½™å’Œå‘æœåŠ¡å™¨ä¼ è¾“çš„æ•°æ®é‡ã€‚ è¾¹ç¼˜èŠ‚ç‚¹èƒ½å¤Ÿå®æ—¶æ„ŸçŸ¥ç”¨æˆ·ç§»åŠ¨æ¨¡å¼ï¼Œä»è€Œåˆ¤æ–­å½“å‰åŒºåŸŸçš„å‚ä¸è€…å¯†åº¦å¹¶è¿›è¡Œè°ƒèŠ‚ã€‚ åœ¨äº‘ç«¯ï¼š é€šè¿‡å‹ç¼©æ„ŸçŸ¥æ¢å¤æ•°æ®","categories":[{"name":"å­¦æœ¯","slug":"å­¦æœ¯","permalink":"http://example.com/categories/%E5%AD%A6%E6%9C%AF/"}],"tags":[]},{"title":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","date":"2018-07-15T08:07:59.000Z","updated":"2023-05-29T14:17:37.594Z","comments":true,"path":"2018/07/15/è®¾è®¡æ¨¡å¼/","link":"","permalink":"http://example.com/2018/07/15/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/","excerpt":"","text":"å•ä¾‹æ¨¡å¼ ä½¿ç”¨åœºæ™¯ï¼šæœ‰äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªå®ä¾‹ï¼Œæ¯”å¦‚è¯´ï¼šç‚¹å‡»æŒ‰é’®ä¹‹åçš„å¼¹æ¡†ï¼Œåº”è¯¥æ˜¯ç‚¹å‡»å¤šæ¬¡ä¹Ÿåªå¼¹ä¸€æ¬¡ï¼Œè€Œä¸æ˜¯ç‚¹å‡»ä¸€æ¬¡å¼¹ä¸€æ¬¡ã€‚è¿™ç§æƒ…å†µå°±éœ€è¦ç”¨åˆ°å•ä¾‹æ¨¡å¼ï¼Œä»åŠŸèƒ½ä¸Šè®²ï¼Œå•ä¾‹æ¨¡å¼ç”¨äºé‚£äº›åªéœ€è¦ä¸€ä¸ªå®ä¾‹çš„åœºæ™¯ï¼›ä»èµ„æºä¸Šè®²ï¼Œå•ä¾‹æ¨¡å¼å¯ä»¥é¿å…å¯¹è±¡é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯ã€‚ å¦‚ä½•å®ç°ï¼šæ„é€ æ–¹æ³•ç§æœ‰ï¼Œé€šè¿‡getInstance()æ–¹æ³•æ¥è·å¾—å®ä¾‹ã€‚ å®ç°ä»£ç  æ‡’æ±‰å¼ï¼Œçº¿ç¨‹ä¸å®‰å…¨ æ‰€è°“æ‡’æ±‰å¼ï¼Œå°±æ˜¯è¯´å¹¶æ²¡æœ‰åœ¨å®šä¹‰intanceçš„æ—¶å€™å°±ç»™å®ƒåˆå§‹åŒ–ï¼Œå› ä¸ºæ‡’ï¼Œåªæœ‰åˆ°ç¬¬ä¸€æ¬¡ç”¨åˆ°è¿™ä¸ªå®ä¾‹çš„æ—¶å€™æ‰å»åˆå§‹åŒ–ã€‚æ‡’æ±‰æ¨¡å¼æ˜¯ä¸€ç§lazy-loadingï¼Œåªæœ‰åˆ°ç”¨çš„æ—¶å€™æ‰ä¼šåˆ›å»ºï¼Œä»è€Œä¹Ÿå°±ä¼šæœ‰ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™åˆ›å»ºå¯èƒ½ä¼šæ¯”è¾ƒè€—æ—¶ã€‚å¦‚æœæˆ‘ä»¬çŸ¥é“è¿™ä¸ªå¯¹è±¡è‚¯å®šæ˜¯è¦è¢«ç”¨åˆ°çš„ï¼Œå¯ä»¥ç”¨é¥¿æ±‰æ¨¡å¼ï¼Œä¸‹é¢ä¼šè¯´åˆ°ã€‚ ä½†æ˜¯å¾ˆæ˜¾ç„¶åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ˜¯ä¼šå‡ºé—®é¢˜çš„ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œåˆ°äº†if(instance==null)ï¼Œç„¶åå‘ç°éƒ½æˆç«‹ï¼Œå°±ä¼šnewå‡ºä¸¤ä¸ªå®ä¾‹æ¥ã€‚ 12345678910public class SingleObject&#123; private static SingleObject instance ; private SingleObject()&#123;&#125;; private static SingleObject getInstance()&#123; if(instance == null)&#123; instance = new SingleObject() ; &#125; return instance ; &#125;&#125; æ‡’æ±‰å¼ï¼Œçº¿ç¨‹å®‰å…¨ è¿™ç§æ–¹æ³•åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æ‰åˆå§‹åŒ–ï¼Œé¿å…æµªè´¹å†…å­˜ã€‚ä½†æ˜¯éœ€è¦åŠ é”æ‰èƒ½ä¿è¯å•ä¾‹ï¼Œä¼šå½±å“æ•ˆç‡ã€‚å› ä¸ºåªæœ‰newçš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€æ¬¡åˆå§‹åŒ–çš„æ—¶å€™æ‰éœ€è¦å¹¶å‘æ§åˆ¶ï¼Œå…¶ä»–æƒ…å†µä¸‹æ˜¯ä¸éœ€è¦å¹¶å‘æ§åˆ¶çš„ï¼Œä½†æ˜¯ç»™è¿™ä¸ªgetInstance()æ–¹æ³•åŠ ä¸Šsynchronizedå…³é”®å­—ï¼Œä¼šå¯¼è‡´æ¯æ¬¡éœ€è¦è·å¾—å•ä¾‹çš„æ—¶å€™éƒ½ä¼šè¢«åŠ é”ã€‚ 12345678910public class SingleObject&#123; private static SingleObject instance ; private SingleObject()&#123;&#125;; private static synchronized SingleObject getInstance()&#123; if(instance == null)&#123; instance = new SingleObject() ; &#125; return instance ; &#125;&#125; å¯ä»¥çœ‹å‡ºè¿™ç§æ–¹å¼ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œé”çš„ç²’åº¦å¤ªå¤§äº†ï¼Œå…¶å®åªéœ€è¦åœ¨newå¯¹è±¡çš„æ—¶å€™åŠ é”å°±å¯ä»¥äº†ï¼Œè¿™å°±å¼•å‡ºäº†ä¸‹é¢åŒé‡æ ¡éªŒé”ã€‚ é¥¿æ±‰å¼ï¼Œçº¿ç¨‹å®‰å…¨ æ‰€è°“é¥¿æ±‰ï¼Œå°±æ˜¯è¯´åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±åˆå§‹åŒ–ã€‚å®ƒè¿™é‡Œå…¶å®æ˜¯åˆ©ç”¨äº†ç±»åŠ è½½æœºåˆ¶ï¼Œç±»åŠ è½½çš„æ—¶å€™æ˜¯ä¼šç”¨synchronizedå…³é”®å­—ç»™åŠ é”çš„ã€‚æœªå®ç°lazy-loading. 1234567public classs SingleObject&#123; private static SingleObject instance = new SingleObject() ; private SingleObject()&#123;&#125;; private static SingleObject getInstance()&#123; return instance ; &#125;&#125; é¥¿æ±‰å˜ç§ 123456789public class Singleton&#123; private static class SingletonHolder&#123; private static final Singleton instance = new Singleton() ; &#125; private Singleton()&#123;&#125; public static final Singleton getInstance()&#123; return SingletonHolder.instance ; &#125;&#125; åŒæ ·æ˜¯åˆ©ç”¨ç±»åŠ è½½æœºåˆ¶ï¼ŒåŒæ ·æ˜¯é¥¿æ±‰ï¼Œä½†æ˜¯å®ƒå®ç°äº†lazy-loadingã€‚ç±»åŠ è½½çš„æ—¶å€™Singletonè¢«è£…è½½ï¼Œä½†æ˜¯instanceä¸ä¸€å®šè¢«åˆå§‹åŒ–ï¼Œåªæœ‰è°ƒç”¨getIntance()æ–¹æ³•çš„æ—¶å€™ï¼Œæ‰ä¼šæ˜¾å¼è£…è½½SingletonHolderç±»ï¼Œä»è€Œå®ä¾‹åŒ–instance åŒé‡æ ¡éªŒé” 123456789101112131415public static SingleObject&#123; private volatile static SingleObject instance ; private SingleObject()&#123;&#125;; private static SingleObject getInstance()&#123; if(instance == null)&#123; synchronized(Singleton.class)&#123; if(instance==null)&#123; instance = new SingleObject() ; &#125; &#125; &#125; return instance ; &#125;&#125; double checkåœ¨ä»£ç ä¸­å·²ç»ä½“ç°çš„å¾ˆæ˜æ˜¾äº†ï¼Œè¿™é‡Œä¸»è¦è§£é‡Šä¸€ä¸‹volatileå…³é”®å­—ã€‚åœ¨jvmçš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»æåˆ°volatileå…³é”®å­—å¯ä»¥ä¿è¯å¯è§æ€§ã€ç¦æ­¢æŒ‡ä»¤é‡æ’åºã€‚å®ƒç”¨åœ¨è¿™é‡Œçš„çš„ä¸»è¦ä½œç”¨ä¹Ÿæ˜¯ä¸ºäº†ä¿è¯ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Œåœ¨åˆå§‹åŒ–ä¸€ä¸ªå®ä¾‹çš„æ—¶å€™ï¼Œè¦ç»è¿‡ä¸€ä¸‹å‡ ä¸ªæ­¥éª¤ ï¼ˆ1ï¼‰ç”³è¯·å†…å­˜ç©ºé—´ ï¼ˆ2ï¼‰åˆå§‹åŒ–é»˜è®¤å€¼ï¼ˆæ³¨æ„ä¸æ˜¯æ„é€ æ–¹æ³•çš„åˆå§‹åŒ–ï¼‰ ï¼ˆ3ï¼‰æ‰§è¡Œæ„é€ æ–¹æ³• ï¼ˆ4ï¼‰è¿æ¥å¼•ç”¨å’Œå®ä¾‹ å…¶ä¸­æ­¥éª¤ï¼ˆ3ï¼‰å¯¹åº”new SingleObject()ï¼Œæ­¥éª¤å››å¯¹åº”instance=new SingleObject()ï¼Œè¿™å››ä¸ªæ­¥éª¤å¯èƒ½ä¼šè¿›è¡ŒæŒ‡ä»¤é‡æ’åºï¼Œå˜æˆï¼ˆ1ï¼‰ï¼ˆ2ï¼‰ï¼ˆ4ï¼‰ï¼ˆ3ï¼‰ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œä¸Šè¿°ä»£ç æ‰§è¡Œå®Œåå¯èƒ½ä¼šreturnä¸€ä¸ªè¿˜æ²¡æœ‰åˆå§‹åŒ–å®Œçš„å®ä¾‹ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è·å–æ—¶ï¼Œå°±ä¼šè·å–åˆ°ä¸€ä¸ªæœªåˆå§‹åŒ–å®Œçš„å¯¹è±¡ã€‚è€Œä½¿ç”¨äº†volatileå…³é”®å­—åï¼Œå¯ä»¥ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Œé‚£ä¹ˆæ‰§è¡Œçš„é¡ºåºå°±æ˜¯(1)(2)(3)(4)ï¼Œå°±ä¸ä¼šå­˜åœ¨ä¸Šè¿°é—®é¢˜ã€‚ é™æ€å†…éƒ¨ç±» 123456789public class Singleton &#123; private static class SingletonHolder &#123; private static final Singleton INSTANCE = new Singleton(); &#125; private Singleton ()&#123;&#125; public static final Singleton getInstance() &#123; return SingletonHolder.INSTANCE; &#125; &#125; æšä¸¾ CAS IteratorIteratoræœ¬èº«æ˜¯ä¸ªInterface,è¢«å¾ˆå¤šé›†åˆç±»æ‰€å®ç°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å®ç°ã€‚ ä½¿ç”¨Iteratorçš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯æˆ‘ä»¬å¯ä»¥ä¸ç”¨å»å…³æ³¨åºåˆ—æœ¬èº«å…·ä½“çš„ç»“æ„ï¼Œåªç”¨æ“ä½œIteratorå°±å¯ä»¥å®ç°åºåˆ—çš„éå†ã€‚ å¦‚ä½•å®ç°åœ¨é›†åˆç±»å†…éƒ¨å®ç°ä¸€ä¸ªIteratoræ¥å£ï¼Œåœ¨è¿™ä¸ªå®ç°çš„æ¥å£é‡Œé¢å¯¹é›†åˆç±»è¿›è¡Œè®¿é—®ã€‚è€Œå¤–éƒ¨ç±»æƒ³è¦è®¿é—®é›†åˆä¸­çš„å…ƒç´ æ—¶ï¼Œåªéœ€è¦ç»™å®ƒè¿”å›ä¸€ä¸ªIteratorå¯¹è±¡ï¼Œç„¶åé€šè¿‡Iteratorçš„next()å’ŒhasNext()æ–¹æ³•æ¥è®¿é—®é›†åˆå…ƒç´ ã€‚ è¿™æ ·åšçš„ä¸€ä¸ªå¥½å¤„ï¼šå¯ä»¥ä¸å¯¹å¤–éƒ¨ç±»æš´éœ²é›†åˆå†…éƒ¨æƒ…å†µã€‚ è¿™é‡Œæ˜¯ä»£ç éƒ¨åˆ† å…¶å®æ„Ÿè§‰è®¾è®¡æ¨¡å¼çš„æ ¸å¿ƒå°±æ˜¯å®ç°åŠŸèƒ½çš„è§£è€¦ï¼Œè®©æ¯ä¸ªéƒ¨åˆ†å„å¸å…¶èŒï¼Œè€Œä¸æ˜¯ä¸€é”…å¤§æ‚çƒ©ã€‚ Visitorå½“å¯¹è±¡ç»“æ„å¯¹åº”çš„ç±»å¾ˆå°‘æ”¹å˜ï¼Œä½†ç»å¸¸éœ€è¦åœ¨æ­¤ç»“æ„ä¸Šå®šä¹‰å¾ˆå¤šä¸åŒä¸”ä¸ç›¸å…³çš„æ“ä½œï¼Œä¸ºäº†ä¸è®©è¿™äº›æ“ä½œæ±¡æŸ“è¿™äº›å¯¹è±¡çš„ç±»ï¼Œæˆ‘ä»¬å°†è¿™äº›æ“ä½œå°è£…åœ¨å¦ä¸€ä¸ªç±»ä¸­ï¼Œè€Œåœ¨è¢«è®¿é—®çš„ç±»ä¸­åªæä¾›ä¸€ä¸ªæ¥å¾…è®¿é—®è€…çš„æ¥å£accept(Visitor),åœ¨Visitor()ä¸­ä¼ å…¥è¢«è®¿é—®ç±»çš„å¼•ç”¨ä¾›è®¿é—®ã€‚ ç±»ä¼¼äºæœ‰äººæ¥ä½ å®¶åšå®¢ï¼Œä½ åªè´Ÿè´£ç»™ä»–å¼€ä¸ªé—¨ï¼ˆè¢«è®¿é—®çš„ç±»æä¾›ä¸€ä¸ªaccept()æ¥å£è®©visitorè¿›æ¥ï¼‰ï¼Œä»–æ¥åˆ°äº†ä½ å®¶ï¼Œå¯¹ä½ å®¶çš„ç»“æ„å¾ˆæ¸…æ¥šäº†ï¼ˆvisitæ–¹æ³•æœ‰ä¸€ä¸ªè¢«è®¿é—®å¯¹è±¡ä½œä¸ºå‚æ•°ï¼‰ï¼Œè‡³äºå®¢äººå…·ä½“è¦åšä»€ä¹ˆï¼Œå®Œå…¨è‡ªä¾¿ï¼ˆå…·ä½“çš„visit()æ–¹æ³•çš„å†…å®¹ç”±Visitorå®šï¼‰ã€‚ è¿™ç§è®¾è®¡çš„å¥½å¤„ï¼š å¾ˆå¥½çš„è§£è€¦äº†è®¿é—®è€…å’Œè¢«è®¿é—®è€… ç»™è¢«è®¿é—®è€…æä¾›äº†å¾ˆå¤§çš„è‡ªä¸»æ“ä½œçš„ç©ºé—´ã€‚ ComputerPart æ¥å£ 12345package Visitor;public interface ComputerPart &#123; void accept(ComputerPartVisitor visitor) ;&#125; ComputerPartå®ç°ç±» 12345678910111213141516171819202122232425262728package Visitor;public class Keyboard implements ComputerPart &#123; @Override public void accept(ComputerPartVisitor visitor) &#123; visitor.visit(this); &#125;&#125;package Visitor;public class Mouse implements ComputerPart &#123; @Override public void accept(ComputerPartVisitor visitor) &#123; visitor.visit(this); &#125;&#125;package Visitor;public class Monitor implements ComputerPart &#123; @Override public void accept(ComputerPartVisitor visitor) &#123; visitor.visit(this); &#125;&#125; Visitoræ¥å£ 123456package Visitor;public interface ComputerPartVisitor &#123; void visit(ComputerPart computerPart) ;&#125; Visitoræ¥å£å®ç°ç±» 1234567891011package Visitor;public class ComputerPartVisitorImp implements ComputerPartVisitor &#123; @Override public void visit(ComputerPart computerPart) &#123; System.out.println(&quot;visit &quot;+computerPart.getClass()); &#125;&#125; å½“æˆ‘ä»¬éœ€è¦è®¿é—®æ›´å¤šå¯¹è±¡æ—¶ï¼Œå¯ä»¥åœ¨Visitorä¸­å¤šé‡è½½å‡ ä¸ªvisitorå‡½æ•°å³å¯ã€‚ Compositeä¹Ÿå«åšéƒ¨åˆ†-æ•´ä½“æ¨¡å¼ï¼ŒæŠŠå¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ï¼Œå°†ä¸ªä½“å¯¹è±¡ï¼ˆå¶å­ï¼‰å’Œç»„åˆå¯¹è±¡ï¼ˆæ ‘æï¼‰ç»Ÿä¸€å¯¹å¾…ã€‚ å®ƒæ˜¯ä¸€ç§åµŒå¥—çš„å…³ç³»ï¼Œå°±åƒç›®å½•æ ‘ä¸€æ ·ï¼Œä¸€ä¸ªæ–‡ä»¶å¤¹å¥—ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç›´åˆ°æœ€åçš„å¶å­èŠ‚ç‚¹â€”â€”æ–‡ä»¶ï¼›æˆ–è€…åƒä¸€å¥è¯ä¸€æ ·ï¼Œä»å¥å­åˆ°å•è¯å†åˆ°æœ€åçš„å­—æ¯ï¼›è¿˜æœ‰HTMLæ ‡ç­¾ï¼Œç­‰ç­‰ã€‚ å½“æˆ‘ä»¬æƒ³å¿½ç•¥ç»„åˆå¯¹è±¡ä¸ä¸ªä½“å¯¹è±¡çš„ä¸åŒï¼Œç»Ÿä¸€ä½¿ç”¨ç»„åˆç»“æ„ä¸­çš„æ‰€æœ‰å¯¹è±¡æ—¶ï¼Œå¯ä»¥è€ƒè™‘è¿™ç§è®¾è®¡æ¨¡å¼ã€‚ Implementing the composite pattern lets clients treat individual objects and compositions uniformly. å¦‚ä½•è§£å†³ï¼šæ ‘æå’Œå¶å­å®ç°ç»Ÿä¸€æ¥å£ï¼Œæ ‘æå†…éƒ¨ç»„åˆè¯¥æ¥å£ã€‚ å…³é”®ä»£ç ï¼šæ ‘æå†…éƒ¨ç»„åˆè¯¥æ¥å£ï¼Œå¹¶ä¸”å«æœ‰å†…éƒ¨å±æ€§ Listï¼Œé‡Œé¢æ”¾ Component ä¸€èˆ¬æ¥è®²ï¼Œç»„åˆæ¨¡å¼çš„Compositeé‡Œé¢ä¼šæœ‰ä¸€ä¸ªArraylistï¼Œaddæ–¹æ³•æ—¢å¯ä»¥å‘å…¶ä¸­æ·»åŠ Leafï¼Œä¹Ÿå¯ä»¥æ·»åŠ composite,è¿™é‡Œå°±ä½“ç°äº†ä¸ªä½“å’Œç»„åˆå¯¹è±¡çš„ç»Ÿä¸€å¯¹å¾…ã€‚ è¿™é‡Œæ˜¯ç›¸å…³ä»£ç å®ç°ï¼Œä»£ç ä¸­é™¤äº†addæ–¹æ³•èƒ½ä½“ç°è¯¥æ€æƒ³å¤–ï¼ŒprintListæ–¹æ³•ä¹Ÿèƒ½ä½“ç°ï¼Œå¯¹äºFileçš„print,åªæ˜¯ç®€å•çš„æ‰“å°ï¼Œå¯¹äºDirectoryçš„printåˆ™æ˜¯é€šè¿‡è¿­ä»£å™¨ï¼Œå»æ‰“å°å…¶æ¯ä¸€ä¸ªitemï¼Œè¿™é‡Œå…¶å®æ˜¯ä¸ªé€’å½’è°ƒç”¨ï¼Œå¦‚æœitemæ˜¯file,é‚£ä¹ˆå°±è°ƒç”¨äº†Fileçš„Â·printListæ–¹æ³•ï¼Œå¦‚æœitemæ˜¯directory,åˆ™é€’å½’è°ƒç”¨ã€‚ Adapteré€‚é…å™¨æ¨¡å¼ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±åƒç”µæºé€‚é…å™¨ä¸€æ ·ï¼Œä½ éœ€è¦å¯¹å·²æœ‰çš„ä¸œè¥¿è¿›è¡Œä¸€å®šçš„æ”¹è£…ï¼Œä½¿ä»–é€‚é…äºæ–°çš„éœ€æ±‚ã€‚ æ¯”å¦‚è¯´æˆ‘åŸæœ¬å°±æœ‰ä¸€ä¸ªç°æˆçš„ç±»ï¼Œç°åœ¨æœ‰ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œä¹Ÿèƒ½ç”¨åˆ°è¿™ä¸ªç±»ï¼Œä½†æ˜¯éœ€è¦ç¨ä½œä¿®æ”¹ï¼ˆæ—§ç±»çš„æ¥å£ä¸ç¬¦åˆæ–°ç³»ç»Ÿçš„éœ€è¦ï¼‰ã€‚ å†å…·ä½“ä¸€ç‚¹ï¼Œæ–°ç±»Aæƒ³ç”¨æ—§ç±»Bä¸­çš„ä¸€äº›æ–¹æ³•ï¼Œä½†æ˜¯å¾—éœ€è¦ä¿®æ”¹ä¸€ä¸‹ï¼Œå› ä¸ºè¿™äº›æ–¹æ³•ä¸èƒ½å®Œå…¨æ»¡è¶³ç°åœ¨çš„éœ€æ±‚ã€‚æœ‰è¿™ä¹ˆå‡ ç§æƒ³æ³•ï¼š ç›´æ¥ä¿®æ”¹æ—§ç±»B ï¼ˆè¿™ä¸ªæ–¹æ³•å¾ˆæš´åŠ›ï¼‰ æ–°ç±»Aç»§æ‰¿æ—§ç±»B ï¼ˆJavaä¸­ç±»åªèƒ½å•ç»§æ‰¿ï¼Œè€Œä¸”è¿™ä¸¤ä¸ªç±»é€»è¾‘ä¸Šä¹Ÿä¸æ˜¯ç»§æ‰¿å…³ç³»ï¼Œå¦‚æœç»§æ‰¿å¹¶è¦†ç›–çš„è¯è¿˜ä¸å¦‚é‡æ–°å®ç°ï¼‰ é€‚é…å™¨æ¨¡å¼ ï¼ˆé€šè¿‡ä¸€ä¸ªä¸­é—´ä»¶æŠŠç±»Açš„ä¸œè¥¿è½¬åŒ–æˆç±»Bçš„ï¼‰ é€‚é…å™¨æ¨¡å¼å°±åƒç”Ÿæ´»ä¸­çš„ç”µæºé€‚é…å™¨ä¸€æ ·ï¼Œèƒ½å¤Ÿè¿æ¥ä¸¤å¤´å¹¶ä¸”è¿›è¡Œè½¬æ¢ã€‚ä¸¾ä¸ªæ —å­ï¼Œæ¯”å¦‚è¯´æœ‰ä¸ªChineseç±»ï¼Œä»–èƒ½speakå’Œwriteï¼Œä½†æ˜¯éƒ½æ˜¯ä¸­æ–‡ï¼Œåæ¥ï¼Œéœ€æ±‚æ”¹å˜ï¼Œåˆéœ€è¦å†å†™ä¸€ä¸ªAmerican,ä»–ä¹Ÿèƒ½speakå’Œwrite,ä½†æ˜¯æ˜¯è‹±æ–‡ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœé‡æ–°å†™ä¸€ä¸ªç±»çš„è¯ï¼Œå…¶å®å¾ˆå¤šä»£ç éƒ½æ˜¯å’ŒChineseç›¸åŒçš„ï¼Œè¿™æ—¶å€™å°±éœ€è¦é€‚é…å™¨æ¨¡å¼äº†ã€‚é€‚é…å™¨æ¨¡å¼æœ‰ä¸¤ç§å®ç°æ–¹æ³• ç»§æ‰¿å·²æœ‰ç±»ï¼Œå®ç°ç›®æ ‡æ¥å£ ä¾èµ–å·²æœ‰ç±»ï¼ˆå°†å·²æœ‰ç±»ä½œä¸ºè‡ªå·±çš„å…ƒç´ ï¼‰ï¼Œå®ç°ç›®æ ‡æ¥å£ è¿™é‡Œå®ä¾‹ä¸€ä¸ªä¾èµ–çš„å®ç° Chineseç±» 12345678910Public class Chinese&#123; public String write()&#123; System.out.println(&quot;æˆ‘æ­£åœ¨å†™æ±‰å­—&quot;); return &quot;æˆ‘æ­£åœ¨å†™æ±‰å­—&quot; ; &#125; public String speak()&#123; System.out.println(&quot;æˆ‘æ­£åœ¨è¯´æ±‰è¯­&quot;); return &quot;æˆ‘æ­£åœ¨è¯´æ±‰è¯­&quot; ; &#125;&#125; Americanæ¥å£ 1234Public interface American&#123; public void writeEnglish(); public void speakEnglish();&#125; é€‚é…å™¨ 1234567891011121314151617181920212223Public class TranslatorAdapter implement American&#123; Chinese chi ; public TranslatorAdapter(Chinese chi)&#123; this.chi = chi ; &#125; @Override public void writeEnglish()&#123; System.out.println(translate(chi.write())); &#125; public void speakEnglish()&#123; System.out.println(translate(chi.speak())) ; &#125; public String tranlate(String sentence)&#123; if(sentence.equal(&quot;æˆ‘æ­£åœ¨å†™æ±‰å­—&quot;)) return &quot;I am speak English&quot; ; return &quot;I am writing English&quot; ; &#125; &#125; æµ‹è¯•ç±» 12345Pulic class Test&#123; public static void main(String[] args)&#123; TranslatorAdapter adapter = new TranslatorAdapter(new Chinese()) &#125;&#125; Template Method PatternTemplate Methodæ¨¡å¼ç”¨åˆ°äº†æŠ½è±¡ç±»ï¼Œç”¨ä¸€å¥è¯æ€»ç»“å®ƒçš„ç‰¹ç‚¹å°±æ˜¯ï¼šçˆ¶ç±»ä¸­å®šä¹‰å¤„ç†æµç¨‹çš„æ¡†æ¶ï¼Œå­ç±»ä¸­å®ç°å…·ä½“çš„å¤„ç†ã€‚æ¨¡æ¿é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æä¾›äº†ä¸€ä¸ªæ¨¡æ¿ï¼Œæœ€åçš„æ¨¡å…·å’Œå®ƒçš„å½¢çŠ¶ç›¸åŒï¼ˆå­ç±»ç»§æ‰¿çˆ¶ç±»ï¼‰ï¼Œä½†æ˜¯ä½†æ˜¯ä¸åŒçš„æ¨¡å…·ç”¨çš„ææ–™å¯èƒ½ä¸åŒï¼ˆç»§æ‰¿è‡ªæŠ½è±¡çˆ¶ç±»çš„å­ç±»çš„å®ç°æ–¹æ³•ä¸å°½ç›¸åŒï¼‰ è¿™é‡Œæ˜¯ä¸€ä¸ªç®€å•çš„demo,éœ€è¦æ³¨æ„ä¸¤ä¸ªé—®é¢˜ æ¨¡æ¿ä½¿ç”¨finalå…³é”®å­—ä¿®é¥°ï¼Œä¸å¯æ”¹å˜ å…·ä½“æ–¹æ³•å»¶è¿Ÿåˆ°å­ç±»ä¸­å»å®ç° Simple Factory Patternæ¨¡å¼åŠ¨æœºå‡è®¾è¿™æ ·ä¸€ç§åœºæ™¯ï¼šæœ‰ä¸€ä¸ªçˆ¶ç±»æŒ‰é’®Button, è¿™ä¸ªçˆ¶ç±»æŒ‰é’®åº•ä¸‹ç»§æ‰¿äº†å¾ˆå¤šä¸åŒå½¢çŠ¶çš„å­ç±»æŒ‰é’®ï¼Œåœ†å½¢çš„ï¼Œæ­£æ–¹å½¢çš„ï¼Œä¸‰è§’å½¢çš„ã€‚ã€‚ã€‚ç°åœ¨å®¢æˆ·ç«¯ç¨‹åºæƒ³è¦ç”¨è¿™äº›æŒ‰é’®ï¼Œä¸€ç§æ–¹æ³•æ˜¯ä½ è¯´æ˜è¦å“ªç§æŒ‰é’®ï¼Œç„¶ååœ¨å®¢æˆ·ç«¯ä¸­newå‡ºæ¥ï¼Œä½†æ˜¯æ˜¾ç„¶è¿™æ ·è€¦åˆåº¦æ¯”è¾ƒé«˜ï¼Œå› ä¸ºåœ¨å®¢æˆ·ç«¯ä¸­æˆ‘ä»¬æƒ³ç”¨å°±å®Œäº‹äº†ï¼Œè€Œä¸æƒ³å¤šä½™çš„å…ˆåˆ¤æ–­ï¼Œå†new. å¦ä¸€ç§å¯è¡Œçš„åŠæ³•æ˜¯ï¼Œæˆ‘ä»¬å†é‡æ–°å»ºä¸€ä¸ªç±»ï¼Œå«åšå·¥å‚ç±»ï¼Œå½“å®¢æˆ·ç«¯ä¸­æƒ³è¦ä»€ä¹ˆç±»å‹çš„æŒ‰é’®æ—¶ï¼Œå°±è·Ÿå·¥å‚ç±»è®²ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯éœ€è¦ä¸€ä¸ªåœ†å½¢æŒ‰é’®ï¼Œå®ƒä¸éœ€è¦çŸ¥é“è¿™ä¸ªæŒ‰é’®çš„ç±»åå«ä»€ä¹ˆï¼Œå®ƒåªéœ€è¦å‘Šè¯‰å·¥å‚ç±»ï¼Œæˆ‘éœ€è¦ä¸€ä¸ªåœ†å½¢æŒ‰é’®ï¼Œå·¥å‚ç±»é€ å¥½ç»™å®ƒå°±å¯ä»¥äº†ã€‚ è¿™å°±æ˜¯ç®€å•å·¥å‚æ¨¡å¼ï¼Œå°±æ˜¯è¯´æœ‰ä¸€ä¸ªä¸“é—¨çš„å·¥å‚ç±»ç”¨æ¥ç”Ÿäº§ä¸€å †å¤§å·®ä¸å·®çš„å­ç±»ï¼Œå¤–éƒ¨åªéœ€è¦å‘Šè¯‰å®ƒè¦ä»€ä¹ˆç±»ï¼Œå®ƒç”Ÿäº§å¥½äº†å†äº¤ç»™å¤–éƒ¨ã€‚ UMLå†å·ä¸€å¼ èœé¸Ÿæ•™ç¨‹çš„å›¾å˜¿å˜¿å˜¿ è¿™ä¸ªå¾ˆå®¹æ˜“ç†è§£ï¼Œå°±ä¸å†™ä»£ç äº† è¦è¯´ç®€å•å·¥å‚æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼çš„åŒºåˆ«ï¼Œå·¥å‚æ¨¡å¼ç”Ÿäº§çš„æ˜¯ç±»ï¼Œè€Œç­–ç•¥æ¨¡å¼æ³¨é‡çš„æ˜¯ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯æ–¹æ³•ï¼Œ å·¥å‚ç±»æ ¹æ®ä¸åŒçš„éœ€æ±‚è¿”å›ä¸åŒçš„ç±»ï¼Œç­–ç•¥æ¨¡å¼æ ¹æ®å¤–éƒ¨ä¼ å…¥çš„ä¸åŒçš„ç±»ï¼Œç»™å‡ºï¼ˆæ‰§è¡Œï¼‰ä¸åŒçš„æ–¹æ³•ï¼ˆç­–ç•¥ï¼‰ å·¥å‚æ–¹æ³•æ¨¡å¼ä¸Šè¿°ç®€å•å·¥å‚æ¨¡å¼ä¸­ï¼Œæœ‰ä¸€ä¸ªå·¥å‚ç±»ï¼Œå®¢æˆ·ç«¯å‘Šè¯‰å·¥å‚éœ€æ±‚ï¼Œå®ƒæ ¹æ®éœ€æ±‚åˆ›å»ºå¥½å¯¹åº”çš„ç±»å¹¶è¿”å›ã€‚è¿™å°±å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œä½ éœ€è¦åœ¨å·¥å‚ç±»ä¸­åˆ¤æ–­å½“å‰æ˜¯å“ªç§éœ€æ±‚ï¼Œè¿™å°±æ„å‘³ç€ä»¥åè¦æ‰©å±•æ—¶ï¼Œä½ è‚¯å®šè¦åœ¨å·¥å‚ç±»ä¸­åšä¿®æ”¹ï¼Œå¢åŠ æ–°çš„éœ€æ±‚åˆ¤æ–­æ¡ä»¶ï¼Œè¿™å°±è¿èƒŒäº†å¼€é—­åŸåˆ™ï¼Œå› ä¸ºï¼Œæˆ‘ä»¬æå‡ºäº†å·¥å‚æ–¹æ³•æ¨¡å¼ã€‚ ç®€å•å·¥å‚æ¨¡å¼åªæœ‰ä¸€ä¸ªå·¥å‚ç±»ï¼Œæ ¹æ®ä¸åŒéœ€æ±‚äº§ç”Ÿä¸åŒçš„product, å·¥å‚æ–¹æ³•æ¨¡å¼æœ‰å¤šä¸ªå·¥å‚ç±»ï¼Œä¸åŒçš„éœ€æ±‚å¯¹åº”ä¸åŒçš„å·¥å‚ç±»ï¼Œè¿™äº›å·¥å‚ç±»å®ç°äº†å…±åŒçš„æ¥å£ã€‚å½“æ—¥åè¦æ‰©å±•æ—¶ï¼Œåªéœ€è¦æ·»åŠ productç±»ï¼Œæ·»åŠ å¯¹åº”å·¥å‚ç±»å°±å¯ä»¥äº†ã€‚è¿™ç§ä¿®æ”¹åŒæ—¶æ„å‘³ç€æˆ‘ä»¬å°†éœ€æ±‚çš„åˆ¤æ–­äº¤ç»™äº†å®¢æˆ·ç«¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯éœ€è¦å‘Šè¯‰å·¥å‚ç±»å®ƒæƒ³è¦ä»€ä¹ˆå…·ä½“äº§å“ï¼Œè€Œä¸æ˜¯åƒç®€å•å·¥å‚æ¨¡å¼é‚£æ ·è¿™ä¸ªåˆ¤æ–­æ˜¯åœ¨å·¥å‚ç±»ä¸­è¿›è¡Œçš„ã€‚ æŠ½è±¡å·¥å‚æ¨¡å¼å·¥å‚æ–¹æ³•æ¨¡å¼ä¸­ï¼Œä¸€ä¸ªå·¥å‚ç”Ÿäº§ä¸€ç§ç‰¹å®šçš„äº§å“ï¼Œå·¥å‚æ–¹æ³•ä¹Ÿå…·æœ‰å”¯ä¸€æ€§ã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¸€ç§æƒ…å†µï¼Œä¸€ä¸ªå·¥å‚è¦ç”Ÿäº§å¤šç§äº§å“ï¼Œå¦‚ä¸€ä¸ªæµ·å°”å…¬å¸è¦ç”Ÿäº§æµ·å°”ç”µè§†ï¼Œæµ·å°”å†°ç®±ï¼Œæµ·å°”æ´—è¡£æœºï¼›åˆå¦‚ä¸€ä¸ªSqlServerå·¥å‚è¦ç”Ÿäº§userè¡¨ï¼Œéƒ¨é—¨è¡¨ç­‰ï¼Œä¸€ä¸ªAccesså·¥å‚ä¹Ÿè¦ç”Ÿäº§userè¡¨ï¼Œéƒ¨é—¨è¡¨ç­‰ã€‚å¯¹äºè¿™ç§ä¸€ä¸ªå·¥å‚è¦ç”Ÿäº§å¤šç§ä¸åŒäº§å“çš„æƒ…å†µï¼Œæˆ‘ä»¬é‡‡ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼ã€‚ Decoratorâ€‹ è£…é¥°å™¨æ¨¡å¼ï¼Œåœ¨ä¸è¿èƒŒå¼€é—­åŸåˆ™çš„åŸºç¡€ä¸Šï¼Œç»™ä¸€ä¸ªç±»åŠ¨æ€çš„æ·»åŠ åŠŸèƒ½ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨ä¸ä¿®æ”¹è¿™ä¸ªç±»ä¸”ä¸å½±å“å…¶ä»–ç±»çš„åŸºç¡€ä¸Šï¼Œç»™è¿™ä¸ªç±»æ·»åŠ åŠŸèƒ½ã€‚ â€‹ å¯¹äºä¸€ä¸ªè®¾è®¡æ¨¡å¼ï¼Œç†è§£å®ƒçš„åŸç†æ˜¯å¾ˆç®€å•çš„ï¼Œä½†æ˜¯è¦ç†è§£å®ƒä¸ºä»€ä¹ˆæ˜¯è¿™æ ·çš„ï¼Œåº”è¯¥åœ¨å“ªäº›åœºæ™¯ä¸­ä½¿ç”¨å®ƒï¼Œå´æ˜¯ä¸å®¹æ˜“çš„ã€‚ä¸‹é¢æˆ‘å°†è¯•ç€ä»ä¸€ä¸ªå¼€å‘è€…çš„è§’åº¦å»æ€è€ƒè¿™ä¸ªé—®é¢˜ã€‚ â€‹ å‡å¦‚æœ‰ä¸€ä¸ªç±» Aï¼Œç°åœ¨éœ€æ±‚å‡çº§ï¼Œè¦ç»™Aæ·»åŠ æ–°çš„åŠŸèƒ½ï¼Œè¯¥æ€ä¹ˆåšï¼Ÿ ç›´æ¥ä¿®æ”¹Aï¼Œç®€å•ç²—æš´ï¼Œä½†åŒæ—¶ä¹Ÿæœ‰å¾ˆå¤šéšæ‚£ã€‚ å†™ä¸€ä¸ªå­ç±»ç»§æ‰¿Aï¼Œåœ¨å­ç±»ä¸­æ·»åŠ æ–°çš„åŠŸèƒ½ã€‚å¯ä»¥æ˜¯å¯ä»¥ï¼Œä¸å¤Ÿä¼˜é›…ï¼Œæœ‰æ–°åŠŸèƒ½çš„Aå’ŒåŸæ¥çš„AåŸåˆ™ä¸Šè®²å¹¶æ²¡æœ‰ç»§æ‰¿å…³ç³»ï¼Œåªæ˜¯æˆ‘ä»¬ä¸ºäº†å®ç°éœ€æ±‚ç»™å¼ºè¡Œç»§æ‰¿äº†ã€‚ ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼ã€‚ è£…é¥°å™¨æ¨¡å¼ï¼Œå¬åå­—å°±çŸ¥é“ï¼Œå®ƒè£…é¥°äº†åŸæ¥çš„ç±»ã€‚å°±åƒæ˜æœˆè£…é¥°äº†ä½ çš„çª—æˆ·ï¼Œä½ è£…é¥°äº†åˆ«äººçš„æ¢¦ã€‚æŠ›å»è¿™äº›èŠ±é‡Œèƒ¡å“¨çš„åè¯ï¼Œæˆ‘ä»¬æ¥çœ‹ä»–çš„æœ¬è´¨ã€‚ æ—¢ç„¶æ˜¯è£…é¥°ï¼Œå…¶å®å¯ä»¥ç†è§£ä¸ºä¸€ç§â€œåŒ…è£¹â€ï¼Œæˆ‘åœ¨åŸæ¥çš„ç±»çš„åŸºç¡€ä¸Šå†åŒ…è£¹ä¸€äº›ä¸œè¥¿ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ€ä¹ˆåŒ…è£¹å‘¢ï¼Ÿé¦–å…ˆï¼Œä¸ºäº†è®©å¤–äººçœ‹ä¸å‡ºæˆ‘çš„è£…é¥°å™¨ç±»å’ŒåŸæ¥çš„Aç±»çš„å·®åˆ«ï¼Œæˆ‘è®©è£…é¥°å™¨ç±»å’ŒAç±»ç»§æ‰¿è‡ªåŒä¸€çˆ¶ç±»ï¼› ç„¶åï¼Œä¸ºäº†å®ç°åŒ…è£¹ï¼Œæˆ‘æŠŠåŸæ¥çš„Aç±»ä½œä¸ºè£…é¥°å™¨ç±»çš„ä¸€ä¸ªæ„é€ å‡½æ•°å‚æ•°ä¼ ç»™è£…é¥°å™¨ç±»ï¼Œè¿™æ ·è£…é¥°å™¨ç±»æ—¢èƒ½å¤Ÿä½¿ç”¨Aç±»ï¼Œåˆèƒ½å¤Ÿåœ¨Aç±»çš„åŸºç¡€ä¸Šè¿›è¡Œä¸€äº›æ“ä½œäº†ã€‚ï¼ˆè¿™ä¸ªåŒ…è£¹è¯´çš„ä¸“ä¸šç‚¹å°±å«åšèšåˆï¼‰ ä»¥ä¸Šã€‚ â€‹ ä»UMLå›¾å¯ä»¥çœ‹å‡ºï¼Œå…¶å®Decoratorå’ŒConcretComponentç»§æ‰¿è‡ªåŒä¸€çˆ¶ç±»ï¼ŒDecorotorå®ƒèšä¼šäº†Componentç±»ï¼Œç„¶ååœ¨å¤å†™çš„operationæ–¹æ³•ä¸­å¯¹èšåˆè€Œæ¥çš„componentç±»è¿›è¡Œæ“ä½œï¼Œè¿™å°±æ˜¯æ‰€è°“çš„è£…é¥°ã€‚â€‹â€‹ å…¶å®è£…é¥°å™¨æ¨¡å¼çš„æœ¬è´¨å°±æ˜¯ï¼Œåœ¨ä¸€ä¸ªè£…é¥°å™¨ç±»ä¸­å¼•å…¥äº†åŸæœ¬è¦ä¿®æ”¹çš„ç±»ï¼Œç„¶åå¯¹è¿™ä¸ªç±»è¿›è¡Œè£…é¥°ã€‚è¦è¢«ä¿®æ”¹çš„ç±»çš„ä»£ç æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œåªæ˜¯å®ƒè‡ªå·±è¢«æ”¾åœ¨å¦ä¸€ä¸ªç±»ä¸­è¢«æ“ä½œäº†ä¸€æ³¢ã€‚â€‹â€‹ å®ƒçš„æ ¸å¿ƒæ€æƒ³ï¼š1. ç»§æ‰¿è‡ªç›¸åŒçš„çˆ¶ç±»ï¼ˆè¿™æ ·å°±å¯ä»¥å¤å†™è¦ä¿®æ”¹çš„ç±»ä¸­çš„æ–¹æ³•ï¼‰ 2. èšåˆäº†è¦ä¿®æ”¹çš„ç±»ï¼ˆè¿™æ ·å°±å¯ä»¥åœ¨åŸæ¥ç±»çš„åŸºç¡€ä¸Šè¿›è¡Œä¸€å®šçš„è£…é¥°ï¼Œè€Œè¿™ä¸ªè£…é¥°ä»£ç æ˜¯åœ¨åŸæ¥çš„ç±»ä¹‹å¤–çš„ã€‚ï¼‰ Proxy Patternä»£ç†æ¨¡å¼ï¼Œæ•…åæ€æ„ã€‚åŠ å…¥æˆ‘ä»¬æƒ³è®¿é—®å¯¹è±¡Aï¼Œä»£ç†æ¨¡å¼å°±æ˜¯åœ¨æˆ‘ä»¬å’Œå¯¹è±¡Aä¹‹é—´å»ºç«‹ä¸€ä¸ªä¸­é—´å±‚ï¼Œä¹Ÿå°±æ˜¯ä»£ç†ï¼Œä»è€Œè®©ä»£ç†æ›¿æˆ‘ä»¬å»è®¿é—®è¿™ä¸ªå¯¹è±¡ã€‚ å®ƒçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯è®©ä»£ç†å’Œè¢«è®¿é—®å¯¹è±¡å®ç°åŒä¸€æ¥å£ï¼Œç„¶ååœ¨ä»£ç†ä¸­è°ƒç”¨è¢«è®¿é—®å¯¹è±¡ä¸­çš„æ–¹æ³•æ¥å®ç°è®¿é—®ã€‚ åŸå‹æ¨¡å¼Javaä¸­åŸå‹æ¨¡å¼é€šè¿‡å®ç°`Cloneable`æ¥å£æ¥å®ç°ã€‚æ‰€è°“åŸå‹æ¨¡å¼å°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ¥å£æœ‰ä¸ªcloneæ–¹æ³•ï¼Œå½“æˆ‘ä»¬éœ€è¦è¿™ä¸ªå¯¹è±¡æ—¶ï¼Œé€šè¿‡cloneæ–¹æ³•æ¥è·å¾—å¯¹è±¡ï¼Œè€Œä¸æ˜¯é€šè¿‡ç±»çš„æ„é€ å‡½æ•°æ¥æ„é€ ç±»ï¼Œè¿™ä¸¤è€…çš„ä»£ä»·æ˜¯å¾ˆä¸åŒçš„ã€‚ æ‰€ä½¿ç”¨çš„åœºæ™¯ï¼šå½“ç›´æ¥åˆ›å»ºå¯¹è±¡çš„ä»£ä»·æ¯”è¾ƒå¤§æ—¶ï¼Œåˆ™é‡‡ç”¨è¿™ç§æ¨¡å¼ã€‚ â€‹ æ‰€ä»¥è¿™é‡Œå°±ä¼šå­˜åœ¨ä¸€ä¸ªæµ…å¤åˆ¶å’Œæ·±å¤åˆ¶çš„é—®é¢˜ã€‚ å¤–è§‚æ¨¡å¼å‡å¦‚ä½ æ¥æ‰‹ç¥–ä¼ ä»£ç åï¼Œä½¿ç”¨èµ·æ¥è‚¯å®šä¸å®¹æ˜“ï¼Œè¿™æ—¶å€™ä½ å¯ä»¥åœ¨ç¥–ä¼ ä»£ç ä¹‹ä¸Šå†åŠ ä¸€ä¸ªä¸­é—´å±‚ï¼Œå¤–éƒ¨ä»£ç é€šè¿‡è®¿é—®ä¸­é—´å±‚æ¥å®ç°å¯¹ç¥–ä¼ ä»£ç çš„è®¿é—®ï¼Œè¿™æ ·å°±é¿å…äº†å¤–éƒ¨ä»£ç ç›´æ¥å»è®¿é—®ç¥–ä¼ ä»£ç ã€‚ å¤–è§‚æ¨¡å¼éšè—ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚å®ƒå‘ç°æœ‰çš„ç³»ç»Ÿæä¾›ä¸€ä¸ªæ¥å£ï¼Œæ¥éšè—ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚å®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“ç³»ç»Ÿå†…éƒ¨çš„å¤æ‚è”ç³»ï¼Œæ•´ä¸ªç³»ç»Ÿåªéœ€è¦æä¾›ä¸€ä¸ªæ¥å¾…å‘˜å³å¯ã€‚ å…³é”®ä»£ç ï¼šåœ¨å®¢æˆ·ç«¯å’Œå¤æ‚ç³»ç»Ÿä¹‹é—´å†åŠ ä¸€å±‚ï¼Œè¿™ä¸€å±‚å°†è°ƒç”¨é¡ºåºã€ä¾èµ–å…³ç³»ç­‰å¤„ç†å¥½ã€‚ å»ºé€ è€…æ¨¡å¼å°†ä¸€ä¸ªå¤æ‚çš„æ„å»ºä¸å…¶è¡¨ç¤ºç›¸åˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚ï¼ˆæ„Ÿè§‰æœ‰ç‚¹åƒæ¨¡æ¿æ¨¡å¼ï¼‰ å»ºé€ è€…æ¨¡å¼æ›´åŠ å…³æ³¨é›¶ä»¶è£…é…çš„é¡ºåºã€‚å°±æ˜¯è¯´ç»„ä»¶ä¸å˜ï¼Œè€Œè¿™äº›ç»„ä»¶ä¹‹é—´çš„ç»„åˆä¼šå‘ç”Ÿå˜åŒ–ã€‚ å¦‚ä½•å®ç°ï¼šé¦–å…ˆæœ‰ä¸ªbuilderç±»ï¼Œç”¨æ¥æœ‰æ„å»ºå„ä¸ªç»„ä»¶çš„æ–¹æ³•ï¼Œå…¶æ¬¡æœ‰ä¸ªDirectorç±»ï¼Œç”¨æ¥æè¿°å„ä¸ªç»„ä»¶ä¹‹é—´çš„ç»„åˆå…³ç³»ã€‚ è§‚å¯Ÿè€…æ¨¡å¼ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œç»™æ‰€æœ‰ä¾èµ–å®ƒçš„å¯¹è±¡å‘é€é€šçŸ¥ï¼Œè¿›è¡Œæ›´æ–°ã€‚ ç­–ç•¥æ¨¡å¼è®¾è®¡æ¨¡å¼çš„ç»ˆæç›®çš„åœ¨äºè§£è€¦ã€‚ åŠ å…¥å®Œæˆä¸€ä¸ªä»»åŠ¡ï¼Œæœ‰å¤šç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¸Œæœ›æ ¹æ®ä¸åŒçš„ç¯å¢ƒæˆ–è€…ä¸åŒçš„æ¡ä»¶è¿™å¤šç§æ–¹æ³•å¯ä»¥éšæ—¶æ›¿æ¢ã€‚ æ¯”å¦‚è¯´ç°åœ¨æœ‰ä¸ªè®¡ç®—å™¨ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬è¦å®ƒåšåŠ æ³•ï¼Œæœ‰æ—¶å€™åˆè¦å®ƒåšå‡æ³•ï¼Œé‚£ä¹ˆæ€ä¹ˆå®ç°å‘¢ï¼Ÿ æœ€ç›´è§‚çš„æ–¹æ³•å°±æ˜¯ç¡¬ç¼–ç äº†ï¼Œç›´æ¥æŠŠè¿™äº›åŠ å‡ä¹˜é™¤å†™æˆä¸€ä¸ªè®¡ç®—å™¨Calculatorçš„æ–¹æ³•ï¼Œå¦‚æœè¿™æ ·çš„è¯åæœŸä¿®æ”¹ä¹Ÿå°±æ¯”è¾ƒéº»çƒ¦ã€‚ ç­–ç•¥æ¨¡å¼çš„æ€æƒ³å°±åœ¨äºæŠŠè¿™äº›ä¸åŒçš„ç®—æ³•å°è£…æˆä¸åŒçš„ç­–ç•¥ç±»ï¼Œç„¶åèšåˆåˆ°Calculatorç±»ä¸­ï¼Œç„¶åå†ç»™Calculatorç±»ä¸€ä¸ªsetæ–¹æ³•ï¼Œä»¥æ­¤å®ç°å¯æ’æ‹”ã€‚ å†ç›—ä¸€å¼ èœé¸Ÿæ•™ç¨‹çš„å›¾ã€‚","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"Androidå­¦ä¹ ç¬”è®°","slug":"Androidå­¦ä¹ ç¬”è®°","date":"2018-07-04T07:46:41.000Z","updated":"2023-05-29T14:17:37.582Z","comments":true,"path":"2018/07/04/Androidå­¦ä¹ ç¬”è®°/","link":"","permalink":"http://example.com/2018/07/04/Android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","excerpt":"","text":"æ­¤æ–‡ç« è°¨ç”¨æ¥è®°å½•æˆ‘åœ¨åšå®‰å“è¿‡ç¨‹ä¸­é‡åˆ°çš„ç›¸å…³é—®é¢˜å’ŒçŸ¥è¯†ç‚¹ Handlerhandleråœ¨åˆ›å»ºä¹‹åˆï¼Œä¼šå’ŒæŸä¸ªçº¿ç¨‹ç»‘å®šï¼Œå¯ä»¥è®¤ä¸ºå®ƒæ˜¯è¿™ä¸ªçº¿ç¨‹çš„ä»£è¨€äººï¼Œå…¶ä¸€ä¸ªç”¨é€”å°±æ˜¯å¤šçº¿ç¨‹é€šä¿¡ï¼Œå°¤å…¶æ˜¯éçº¿ç¨‹å®‰å…¨æƒ…å†µä¸‹çš„çº¿ç¨‹é€šä¿¡ Fragmentä¸ºä»€ä¹ˆä¼šå‡ºç°fragmentè¿™ä¸ªä¸œè¥¿å‘¢ï¼Œä¸¾ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œå°±æ˜¯æƒ³æŠŠä¸€ä¸ªå®‰å“é¡µé¢åˆ’åˆ†æˆå¤šä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†æ˜¾ç¤ºä¸åŒçš„å†…å®¹ï¼Œè€Œè¿™å‡ ä¸ªéƒ¨åˆ†åˆå±äºåŒä¸€ä¸ªactivity,æ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨qqæˆ–è€…å¾®ä¿¡çš„æ—¶å€™ï¼Œåœ°ä¸‹æœ‰ä¸ªå¯¼èˆªæ ï¼Œæ— è®ºæˆ‘ä»¬æ˜¯é€‰æ‹©å“ªä¸€ä¸ªï¼Œåªæœ‰ä¸Šé¢çš„éƒ¨åˆ†åœ¨å˜ï¼Œè€Œå¯¼èˆªæ å´ä¸€ç›´éƒ½åœ¨ï¼Œè¿™å°±æ˜¯fragmentçš„åº”ç”¨ã€‚ fragmentè‹±æ–‡å«åšç‰‡æ®µï¼Œé¡¾åæ€ä¹‰å…¶å®å®ƒå°±æ˜¯activityçš„ä¸€ä¸ªç‰‡æ®µï¼Œä¸€ä¸ªå­é›†ï¼Œè®©ä¸€ä¸ªactivityå æ®æ•´ä¸ªé¡µé¢å¾ˆåºå¤§ï¼Œé‚£æˆ‘ä»¬å°±æŠŠactivityåˆ†æˆå¥½å‡ ä¸ªéƒ¨åˆ†ï¼Œè®©å®ƒä»¬å…±äº«è¿™ä¸ªé¡µé¢ã€‚ è¿™é‡Œæˆ‘æ‹¿ä¸€å¼ googleå®˜æ–¹çš„ç¤ºä¾‹å›¾ï¼Œå°±å¾ˆèƒ½è¯´æ˜é—®é¢˜äº†ã€‚ ç”Ÿå‘½å‘¨æœŸå†ç”©ä¸€å¼ å®˜æ–¹å›¾ ä¸Šå›¾è¡¨ç¤ºåœ¨fragmentæ‰€åœ¨çš„activityè¿è¡Œæ—¶fragmentçš„ç”Ÿå‘½å‘¨æœŸ æ·»åŠ Fragment æœ‰åŠ¨æ€æ·»åŠ å’Œé™æ€æ·»åŠ ä¸¤ç§æ–¹å¼ï¼Œåé¢ä¼šè®²åˆ° onAttach() è¯¥fragmentè¢«æ·»åŠ åˆ°activityä¸­æ—¶è¢«è°ƒç”¨ï¼ˆä¸¤è€…å»ºç«‹å…³è”æ—¶ï¼‰ï¼Œä¸”åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ onCreate() fragmentè¢«åˆ›å»ºæ—¶è°ƒç”¨ onCreateView() ç»˜åˆ¶è¯¥fragmentçš„viewæ—¶è¢«è°ƒç”¨ï¼Œä¸”è®²ç»˜åˆ¶çš„viewè¿”å› onActivityCreate() fragmentæ‰€åœ¨çš„activityå¯åŠ¨å®Œæˆåå›è°ƒ onStart() å¯åŠ¨fragmentæ—¶è¢«å›è°ƒ onResume() æ¢å¤fragmentæ—¶è¢«è°ƒç”¨ï¼ŒonStart()æ–¹æ³•åä¸€å®šå›è°ƒonResume() ç»è¿‡ä¸Šè¿°æ­¥éª¤ï¼Œfragmentå°±è¢«æ¿€æ´»äº† onPause() fragmentè¢«æš‚åœæ—¶è°ƒç”¨ onStop() fragmentåœæ­¢æ—¶è°ƒç”¨ï¼Œåœæ­¢å¹¶ä¸æ„å‘³ç€è¿™ä¸ªfragmentè¢«é”€æ¯ï¼Œæ¯”å¦‚æˆ‘ä»¬æŒ‰ä¸‹homeé”® onDestroyView() é”€æ¯Fragmentæ‰€åŒ…å«çš„view onDestroy() é”€æ¯fragment onDetach() fragmentè¢«ä»activityä¸­removeæ—¶è°ƒç”¨ å…¶å®å®ƒçš„ç”Ÿå‘½å‘¨æœŸå’Œactivityå¾ˆç›¸ä¼¼ï¼Œç†è§£å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿™æ ·å°±èƒ½æ›´å¥½çš„çŸ¥é“åº”è¯¥åœ¨å®ƒä»¬çš„å“ªä¸ªé˜¶æ®µè¿›è¡Œå“ªäº›æ“ä½œã€‚ é™/åŠ¨æ€æ·»åŠ ä¸Šé¢æåˆ°ï¼Œfragmentæ˜¯activityçš„ç‰‡æ®µï¼Œæ‰€ä»¥å°±æœ‰ä¸ªè¿™ä¸ªç‰‡æ®µä½•æ—¶è¢«æ·»åŠ çš„é—®é¢˜ã€‚ æ— è®ºåŠ¨æ€æ·»åŠ è¿˜æ˜¯é™æ€æ·»åŠ ï¼Œåœ¨æ­¤ä¹‹å‰æˆ‘ä»¬éƒ½è¦å…ˆå®šä¹‰å¥½è¿™ä¸ªfragmentçš„å†…éƒ¨å¸ƒå±€xmlæ–‡ä»¶å¹¶ä¸”å®šä¹‰ä¸€ä¸ªç»§æ‰¿äº†Fragmentçš„ç±»å’Œè¿™ä¸ªxmlæ–‡ä»¶å…³è”èµ·æ¥ï¼Œæœ‰ç‚¹ç±»ä¼¼äºæˆ‘ä»¬è¦å®šä¹‰å¥½listviewçš„æ¯ä¸ªitemç„¶åé€šè¿‡adapterå°†å®ƒä»¬é€‚é…ã€‚ ä¸‹é¢æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªchart_fragmentæ–‡ä»¶ 1234567891011121314&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;match_parent&quot;&gt; &lt;TextView android:id=&quot;@+id/textView&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;match_parent&quot; android:layout_weight=&quot;1&quot; android:text=&quot;this is chart fragment&quot; android:textSize=&quot;20dp&quot;/&gt;&lt;/LinearLayout&gt; ç„¶åç”¨ä¸€ä¸ªç»§æ‰¿è‡ªFragmentçš„ç±»å°†è¿™ä¸ªxmlæ·»åŠ è¿›æ¥ 123public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) &#123; return inflater.inflate(R.layout.chart_fragment,container,false); &#125; è¿™æ ·ChartFragmentç±»å°±å’Œæˆ‘ä»¬çš„å¸ƒå±€æ–‡ä»¶å…³è”èµ·æ¥äº†ï¼Œä»¥åç”¨ChartFragmentå°±æŒ‡çš„æ˜¯è¿™ä¸ªfragmentäº† é™æ€æ·»åŠ  ç›´è§‚è®²å°±æ˜¯åœ¨activityçš„å¸ƒå±€æ–‡ä»¶ä¸­åŠ å…¥fragmentæ ‡ç­¾ 123456789101112&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; android:orientation=&quot;horizontal&quot; android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;match_parent&quot;&gt; &lt;fragment android:name=&quot;com.example.news.ArticleListFragment&quot; android:id=&quot;@+id/list&quot; android:layout_weight=&quot;1&quot; android:layout_width=&quot;0dp&quot; android:layout_height=&quot;match_parent&quot; /&gt; &lt;/LinearLayout&gt; åƒè¿™æ ·ï¼Œå¯ä»¥å‘ç°ä¸Šè¿°fragmentçš„nameæ˜¯ä¸€ä¸ªç±»åï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢å…³è”çš„ç±»åï¼Œè¿™ä¹Ÿæ˜¯é™æ€æ·»åŠ fragmentçš„ä¸€ä¸ªç‰¹ç‚¹ åŠ¨æ€æ·»åŠ  æ‰€è°“åŠ¨æ€æ·»åŠ å°±æ˜¯æˆ‘ä»¬ä¸ç›´æ¥æŠŠfragmentæ ‡ç­¾å†™æ­»åœ¨activityçš„å¸ƒå±€æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯åœ¨activityå¸ƒå±€æ–‡ä»¶ä¸­ç»™fragmentç•™ä¸€ä¸ªcontainer,æ¯”å¦‚å„ç§layout,ç„¶ååœ¨ä»£ç ä¸­é€šè¿‡FragmentSupportManageræ¥è¿›è¡Œæ·»åŠ ã€‚æˆ‘ä»¬è·å¾—Transactionå¯¹è±¡ï¼Œç”¨å®ƒæ¥æ“ä½œfragment,æ¯”å¦‚add,remove,hide,show,replaceç­‰ã€‚ 1getSupportFragmentManager().beginTransaction().replace(R.id.frame2,new MapFragment()).commit(); Fragment Activityäº¤äº’è¿™é‡Œç”¨èœé¸Ÿæ•™ç¨‹çš„ä¸€å¼ å›¾æ¥è¯´æ˜é—®é¢˜ è¿™é‡Œé¢æ¯”è¾ƒéš¾ç†è§£çš„æ˜¯Fragmentå‘Activityä¼ é€’æ•°æ®ï¼Œæˆ‘ä¸ªäººæ˜¯è¿™æ ·ç†è§£çš„ï¼šå‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œç‚¹å‡»Fragment Aä¸­çš„æŸä¸ªé€‰é¡¹éœ€è¦åˆ‡æ¢åˆ°Fragment B,é‚£ä¹ˆFragmentå¿…é¡»æŠŠè¿™ä¸ªè®¯æ¯ä¼ ç»™å®ƒæ‰€åœ¨çš„Activity,å› ä¸ºFragment Aæ˜¯æ²¡æœ‰åˆ‡æ¢çš„èƒ½åŠ›çš„ï¼Œè¿™ç§å¤§äº‹å¿…é¡»Aå’ŒBçš„çˆ¸çˆ¸æ¥å®Œæˆã€‚é‚£å¦‚ä½•åšå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæ¥å£Iï¼Œç„¶åè®©Activityå®ç°è¿™ä¸ªæ¥å£ï¼Œè¿™ä¸ªæ¥å£é‡Œå‡½æ•°çš„å‚æ•°å°±æ˜¯Fragment Aè¦å‘Activityä¼ é€’çš„æ•°æ®ï¼Œç„¶åæˆ‘ä»¬åœ¨Fragmentä¸­è·å¾—Activityå¯¹è±¡ï¼Œè°ƒç”¨è¿™ä¸ªæ¥å£å‡½æ•°ï¼Œæ˜¯ä¸æ˜¯å°±å¾ˆå·§å¦™çš„æŠŠFragment Açš„ä¿¡æ¯ï¼ˆä½œä¸ºå‚æ•°ï¼‰ä¼ é€’ç»™äº†Activityï¼ˆActivityå®ç°äº†è¿™ä¸ªæ¥å£ï¼Œæ‰€ä»¥è°ƒç”¨çš„æ—¶å€™è‡ªç„¶èƒ½è·å¾—æ¥å£çš„å‚æ•°ï¼Œè€Œè¿™ä¸ªå‚æ•°æ¥è‡ªäºFragment Aï¼‰å‘¢ï¼Ÿ é‡åˆ°çš„é—®é¢˜ æˆ‘ç”¨çš„æ˜¯ä¸¤ä¸ªfragment,ä¸€ä¸ªé™æ€æ·»åŠ ä¸€ä¸ªåŠ¨æ€æ·»åŠ ï¼Œä¸€ä¸ªfragmentä¸­å—åˆ°ç‚¹å‡»äº‹ä»¶å»åŠ¨æ€æ·»åŠ å¦ä¸€ä¸ªfragmentæ—¶ï¼Œæ€»æ˜¯å¤±è´¥ï¼Œçœ‹å®Œäº†ç½‘ä¸Šçš„å„ç§æ–¹æ³•ï¼Œå¦‚åŒ…çš„ç‰ˆæœ¬é—®é¢˜ï¼Œsupport.v4è¿˜æ˜¯appåŒ…,ä»¥åŠfragmentçš„nameé—®é¢˜ï¼Œéƒ½æ²¡æœ‰æ‰¾åˆ°åŸå› ï¼Œåæ¥å‘ç°ï¼ŒåŸæ¥æ˜¯è¿™ä¸ªconstraintlayoutæå¾—æˆ‘æ²¡æœ‰æŠŠfragmentç”»å‡ºæ¥ï¼Œæ‰€ä»¥ä»¥åå¼€å‘è¿˜æ˜¯ç»™å¸ƒå±€åŠ ç‚¹é¢œè‰²ä¸ºå¥½ã€‚ æˆ‘æƒ³åœ¨Activityä¸­å…ˆæ¨¡æ‹Ÿä¸€æ¬¡ä¸€ä¸ªfragmentä¸­çš„ç‚¹å‡»äº‹ä»¶ï¼Œè¿™æ ·ä¸€è¿›æ¥å±å¹•å°±ä¸ä¼šæ„Ÿè§‰å¾ˆç©ºæ´ï¼Œäºæ˜¯æˆ‘åœ¨onCreateæ–¹æ³•ä¸­æ·»åŠ äº†buttonçš„performclickæ–¹æ³•ï¼Œä½†æ˜¯ï¼Œæ²¡ååº”ï¼Œåˆç»è¿‡ä¸€é˜µæœå¯»ï¼ŒåŸæ¥åœ¨onCreateä¸­ï¼Œå…¶å®fragmentå¸ƒå±€è¿˜æ²¡æœ‰åŠ è½½å®Œï¼Œè¿™æ—¶å€™è´¸ç„¶performclickæ˜¯æ²¡æœ‰ä½œç”¨çš„ï¼Œåº”è¯¥è®²æ–¹æ³•åŠ åˆ°onStartä¸­ï¼Œçœ‹æ¥å­¦å¥½ä»–ä»¬çš„ç”Ÿå‘½å‘¨æœŸè¿˜æ˜¯å¾ˆæœ‰ç”¨çš„é¸­ã€‚ ä¿¡å·å¼ºåº¦ æœ‰ä¸¤ç§ä¿¡å·å•ä½ï¼Œdbmå’Œasu asu(alone signal unit)ï¼šç‹¬ç«‹ä¿¡å·å•å…ƒï¼Œæ˜¯ä¸€ç§æ¨¡æ‹Ÿä¿¡å·ã€‚asuä»£è¡¨æ‰‹æœºå°†å®ƒçš„ä½ç½®ä¼ é€’ç»™é™„è¿‘çš„ä¿¡å·å¡”çš„é€Ÿç‡ï¼Œå®ƒå’Œdbmæµ‹é‡çš„æ˜¯ä¸€æ ·çš„ä¸œè¥¿ï¼Œä½†æ˜¯æ˜¯ä»¥ä¸€ç§æ›´åŠ çº¿æ€§çš„æ–¹å¼æ¥è¡¨ç¤ºã€‚ dBmï¼šæ˜¯ä¸€ä¸ªè¡¨ç¤ºåŠŸç‡ç»å¯¹å€¼çš„å€¼ï¼ˆä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯ä»¥1mWåŠŸç‡ä¸ºåŸºå‡†çš„ä¸€ä¸ªæ¯”å€¼ï¼‰ï¼Œè®¡ç®—å…¬å¼ä¸ºï¼š10logï¼ˆåŠŸç‡å€¼/1mwï¼‰ã€‚ ç½‘ç»œç±»å‹ ç”µä¿¡ 2G CDMA3G CDMA20004G TD-LTEï¼ŒFDD-LTE ç§»åŠ¨ 2G GSM3G TD-SCDMA4G TD-LTEï¼ŒFDD-LTE è”é€š 2G GSM3G WCDMA4G TD-LTEï¼ŒFDD-LTE å®‰å“apiæä¾›çš„ç±»å‹ æƒé™ç®¡ç†å®‰å“çš„æƒé™åˆ†æ­£å¸¸æƒé™å’Œå±é™©æƒé™ï¼Œæ­£å¸¸æƒé™åœ¨Manifestä¸­æ·»åŠ ä¸€å“ˆå°±å¯ä»¥äº†ï¼Œä½†æ˜¯å±é™©æƒé™è‡ªå·±æ·»åŠ åè¿˜éœ€è¦ä¸€ä¸ªæ‰‹åŠ¨ç”³è¯·å¹¶è¦†ç›–åŸæ¥æ–¹æ³•çš„è¿‡ç¨‹ã€‚ é€šè¿‡ActivityCompat.requestPermissionsæ¥ç”³è¯·æˆ‘ä»¬æ‰€éœ€çš„æƒé™ï¼Œå®ƒä¼šå›è°ƒonRequestPermissionsResultæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å¤å†™è¿™ä¸ªæ–¹æ³•æ¥è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ï¼Œå¤å†™æ–¹å¼å¾ˆç®€å•ï¼Œè®©MainActivityå®ç°ActivityCompat.OnRequestPermissionsResultCallbackæ¥å£ï¼ˆå› ä¸ºonRequestPermissionsResultæ–¹æ³•å°±æ˜¯iè¿™ä¸ªæ¥å£ä¸­çš„ï¼‰ï¼Œç„¶åå†MainActivityä¸­å¤å†™è¯¥æ–¹æ³•å³å¯ Context å’Œ Activity çš„å…³ç³»ç”¨ä¸€å¼ å›¾å°±å¾ˆèƒ½è¯´æ˜é—®é¢˜äº† å…³äºfindViewByIdåˆšåˆšåœ¨åšä¸€ä¸ªpopupwindowé‡Œé¢æ˜¾ç¤ºåŠ¨æ€å›¾è¡¨çš„ä¸œè¥¿,åœ¨æ‰¾å›¾è¡¨çš„idæ—¶æ€»æ˜¯è¿”å›ç©ºæŒ‡é’ˆï¼Œåæ¥å‘ç°ï¼Œä¹‹å‰å†™çš„ç±»é‡Œé¢æ€»ä»¥ä¸ºfindViewByIdæ˜¯Contextçš„æ–¹æ³•ï¼Œæ‰€ä»¥æ­¤å‰åœ¨ç”¨è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ä¸€ç›´ä¼ é€’Contextæ¥è°ƒç”¨ï¼Œå…¶å®è¿™æ˜¯ä¸€ä¸ªViewçš„æ–¹æ³•ï¼Œè™½ç„¶åœ¨åŒä¸€ä¸ªContextä¸‹ï¼Œä½†å·²ç»æ˜¯ä¸åŒçš„è§†å›¾äº†ï¼Œæ‰€ä»¥æ€»è¿”å›ç©ºæŒ‡é’ˆã€‚ setOnclickedListeneråœ¨é‡å†™è¯¥æ¥å£çš„onClickedæ–¹æ³•æ—¶ï¼Œè¯¥æ–¹æ³•çš„å‚æ•°æ˜¯è¢«ç‚¹å‡»çš„é‚£ä¸ªè§†å›¾ï¼Œæ¯”å¦‚æŒ‰é’®ç­‰ã€‚ PopupWindow1234void showAtLocation (View parent, // è¯¥å±æ€§åªè¦æ˜¯å±å¹•ä¸Šä»»æ„æ§ä»¶å¯¹è±¡å³å¯ int gravity, // å±å¹•ä½ç½® int x, // åç§»åæ ‡ int y) è¿™é‡Œéœ€è¦æ³¨æ„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å±å¹•ä¸Šçš„ç»„ä»¶ï¼Œä½†ä¸èƒ½æ˜¯popupwindowä¸­çš„ç»„å»ºï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ Problems ASè§†å›¾ç¼–è¾‘å™¨é‡Œä¸èƒ½æ˜¾ç¤ºæ§ä»¶ï¼Œæœ€åè§£å†³åŠæ³•ï¼Œåœ¨style.xmlä¸­çš„parent=åé¢åŠ Base.","categories":[{"name":"ç§»åŠ¨å¼€å‘","slug":"ç§»åŠ¨å¼€å‘","permalink":"http://example.com/categories/%E7%A7%BB%E5%8A%A8%E5%BC%80%E5%8F%91/"}],"tags":[]},{"title":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","date":"2018-06-29T10:32:31.000Z","updated":"2023-05-29T14:17:39.320Z","comments":true,"path":"2018/06/29/æ•°æ®ç»“æ„/","link":"","permalink":"http://example.com/2018/06/29/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/","excerpt":"","text":"æ ‘æ ‘çš„è¡¨ç¤ºæ–¹æ³•é€šè¿‡åœ¨è¿ç»­çš„å­˜å‚¨ç©ºé—´ä¸­æ ‡æ³¨æ¯ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼Œå…„å¼ŸèŠ‚ç‚¹ï¼Œå­èŠ‚ç‚¹ç­‰ï¼Œæ¥è¾¾åˆ°ç´¢å¼•çš„ç›®çš„ åŒäº²è¡¨ç¤ºæ³• åœ¨æ¯ä¸ªèŠ‚ç‚¹åé¢æŒ‡æ˜çˆ¶èŠ‚ç‚¹æ‰€åœ¨ä½ç½®ï¼ˆç»“æ„ä½“å°±å¯ä»¥è¡¨ç¤ºï¼‰ å­©å­è¡¨ç¤ºæ³• åœ¨æ¯ä¸ªèŠ‚ç‚¹åé¢é“¾æ¥ä¸Šå­èŠ‚ç‚¹çš„ä¸‹è¡¨ï¼ˆæ•°ç»„+é“¾è¡¨æ¥è¡¨ç¤ºï¼‰ åŒäº²å­©å­è¡¨ç¤ºæ³• ä»¥ä¸Šä¸¤ç§æ–¹å¼çš„ç»“åˆï¼Œæ¯ä¸ªèŠ‚ç‚¹åé¢æ—¢æŒ‡æ˜çˆ¶èŠ‚ç‚¹çš„ä½ç½®ï¼Œä¹ŸåŒæ—¶é“¾æ¥ä¸Šå„ä¸ªå­èŠ‚ç‚¹ 12345678910111213141516#define MAX_TREE_SIZE 50typedef CTNode&#123; int index; CTNode *next ;&#125;NodePtr;typedef struct&#123; ElementType elem ; int parent_index ; NodePtr *firstChild ;&#125;CTBox;typedef struct&#123; CTBox nodes[MAX_TREE_SIZE]&#125;CTree; äºŒå‰æ ‘äºŒå‰æ ‘ï¼Œé¡¾åæ€ä¹‰ï¼Œæœ€å¤šæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ã€‚åœ¨é€’å½’å®šä¹‰çš„æƒ…å†µä¸‹ï¼Œå®ƒæœ‰äº”ç§å½¢æ€ï¼šç©ºäºŒå‰æ ‘ï¼Œåªæœ‰æ ¹èŠ‚ç‚¹ï¼Œåªæœ‰å·¦å­æ ‘ï¼Œåªæœ‰å³å­æ ‘ï¼Œå·¦å³å­æ ‘éƒ½æœ‰ã€‚ æ¯”å¦‚è¯´ï¼Œå¯¹äºä¸€æ£µäºŒå‰æ ‘ï¼Œæœ‰ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œé‚£å®ƒæœ‰å‡ ç§æƒ…å†µå‘¢ï¼Ÿç­”æ¡ˆæ˜¯äº”ç§ï¼ ç‰¹æ®ŠäºŒå‰æ ‘ æ–œäºŒå‰æ ‘ï¼ˆæ–œæˆä¸€æ¡çº¿ï¼‰ï¼Œæ»¡äºŒå‰æ ‘ï¼ˆæœ€åœ†æ»¡çš„æƒ…å†µï¼‰ï¼Œå®Œå…¨äºŒå‰æ ‘ï¼ˆæœ€åä¸€å±‚æœ€å³è¾¹çš„èŠ‚ç‚¹ä»å³å¾€å·¦ç¼ºå¤±ï¼‰ äºŒå‰æ ‘æ€§è´¨ äºŒå‰æ ‘çš„ç¬¬iå±‚æœ€å¤šæœ‰2^(i-1)ä¸ªèŠ‚ç‚¹ ï¼ˆåŒ–ä½œç­‰æ¯”æ•°åˆ—ï¼ŒäºŒå‰æ ‘çš„ç¬¬iå±‚ç›¸å½“äºæ•°åˆ—çš„ç¬¬i-1é¡¹ï¼‰ æ·±åº¦ä¸ºkçš„äºŒå‰æ ‘è‡³å¤šæœ‰2^k-1ä¸ªèŠ‚ç‚¹ ä»»ä½•ä¸€æ£µäºŒå‰æ ‘ï¼Œå¦‚æœå…¶å¶å­èŠ‚ç‚¹æ•°ä¸ºn0ï¼Œåº¦ä¸ºäºŒçš„èŠ‚ç‚¹æ•°ä¸ºn2,åˆ™n0 = n2 + 1 æ¨å¯¼ï¼šè®¾æ€»ç»“ç‚¹æ•°ä¸ºn,åº¦ä¸º1çš„èŠ‚ç‚¹æ•°ä¸ºn1,n=n0+n1+n2,æ ‘ææ•°ç›®ä¸ºn-1=n1+2*n2,ç»“åˆè¿™ä¸¤ä¸ªå…¬å¼æœ‰n0=n2+1 å…·æœ‰nä¸ªèŠ‚ç‚¹çš„å®Œå…¨äºŒå‰æ ‘çš„æ·±åº¦æ˜¯$$ \\lfloor \\log n \\rfloor+1$$ æ¨å¯¼ï¼šè®¾è¯¥äºŒå‰æ ‘æ·±åº¦ä¸ºk,åˆ™å®ƒçš„èŠ‚ç‚¹æ•°é‡ä½äºæ·±åº¦ä¸ºk-1å’Œæ·±åº¦ä¸ºkçš„æ»¡äºŒå‰æ ‘ä¸­é—´ï¼Œå³æœ‰ $ 2^{k-1} -1 &lt; n \\leq2^{k}-1$ åŒ–ç®€å¾— $k-1\\leq \\log n&lt;k$ æ‰€ä»¥æœ‰$k=\\lfloor \\log n\\rfloor+1$ å¦‚æœä¸€æ£µæœ‰nä¸ªèŠ‚ç‚¹çš„å®Œå…¨äºŒå‰æ ‘å…¶èŠ‚ç‚¹æŒ‰å±‚åºç¼–å·ï¼Œå¯¹ä»»ä¸€èŠ‚ç‚¹i(1&lt;=i&lt;=n)æœ‰å¦‚ä¸‹æ€§è´¨ å¦‚æœi=1,åˆ™iæ˜¯æ ¹èŠ‚ç‚¹ å¦‚æœ2i&gt;n,åˆ™iæ²¡æœ‰å·¦å­©å­ï¼Œå¦åˆ™å…¶å·¦å­©å­æ˜¯2i å¦‚æœ2i+1&gt;n,åˆ™iæ²¡æœ‰å³å­©å­ï¼Œå¦åˆ™å…¶å³å­©å­æ˜¯2i+1 äºŒå‰æ ‘å­˜å‚¨ç»“æ„ æ•°ç»„æˆ–è€…é“¾è¡¨ï¼Œç”¨æ•°ç»„å­˜å‚¨çš„è¯é‡åˆ°æç«¯æƒ…å†µï¼ˆå¦‚æ–œæ ‘ï¼‰æ¯”è¾ƒæµªè´¹ç©ºé—´ï¼Œæ‰€ä»¥ä¸€èˆ¬ç”¨é“¾è¡¨æ¥å­˜å‚¨ 12345typedef BiNode&#123; ElemType elem; BiNode *lchild ; Binode *rchild ;&#125;BiTree äºŒå‰æ ‘çš„éå† å‰åºéå† æ ¹ï¼Œå·¦ï¼Œå³ ä¸­åºéå† å·¦ï¼Œæ ¹ï¼Œå³ ååºéå† å·¦ï¼Œå³ï¼Œæ ¹ å±‚åºéå† 12345678910111213141516171819202122232425262728293031323334353637//define bitreetypedef struct BiTree&#123; char data ; struct BiTree * lchild ; struct BiTree * rchild ;&#125;BiTree;//create bitreevoid createBiTree(BiTree* &amp;T)&#123; char c ; //cin &gt;&gt; c ; if(&#x27; &#x27;==(c=getchar())) T = NULL; else&#123; T = new BiTree ; T -&gt; data = c ; createBiTree(T-&gt;lchild) ; createBiTree(T-&gt;rchild) ; &#125; &#125;void visit(BiTree* T,int level)&#123; cout &lt;&lt; &quot;node &quot; &lt;&lt; T-&gt; data &lt;&lt; &quot; in level &quot; &lt;&lt; level &lt;&lt; endl ;&#125;//traverse bitreevoid preOrderTraverse(BiTree* T,int level)&#123; if(T)&#123; visit(T,level) ; preOrderTraverse(T-&gt;lchild,level+1) ; preOrderTraverse(T -&gt; rchild,level+1) ; &#125; &#125; Huffman Tree èƒŒæ™¯ æœ‰nä¸ªå¸¦æƒé‡çš„å¶å­èŠ‚ç‚¹ï¼Œæˆ‘ä»¬æƒ³æ„é€ ä¸€æ£µäºŒå‰æ ‘ï¼Œä½¿å¾—å¸¦æƒè·¯å¾„é•¿åº¦æœ€å° æ–¹æ³• ä¸æ–­çš„å°†ä¸¤æ£µæƒå€¼æœ€å°çš„æ ‘åˆå¹¶æˆä¸€æ£µæ›´å¤§çš„æ ‘ï¼Œæ–°æ ‘çš„æ ¹èŠ‚ç‚¹æƒå€¼ä¸ºä¹‹å‰ä¸¤æ£µæ ‘çš„æ ¹èŠ‚ç‚¹æƒå€¼ä¹‹å’Œã€‚ Huffman Code ç»¼åˆè€ƒè™‘ï¼Œæˆ‘ä»¬è®¤ä¸ºHuffman Treeä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æœ‰æƒå€¼ï¼ˆå…¶ä¸­éå¶å­èŠ‚ç‚¹æƒå€¼ä¸º0ï¼‰ï¼Œå·¦å³å­©å­ã€‚ä¸”å“ˆå¤«æ›¼æ ‘çš„èŠ‚ç‚¹è¦ä¹ˆä¸º0è¦ä¹ˆä¸º2ï¼Œæ²¡æœ‰åº¦ä¸º1çš„èŠ‚ç‚¹ï¼Œåˆ™æœ‰nä¸ªå¶å­èŠ‚ç‚¹çš„å“ˆå¤«æ›¼æ ‘å…±æœ‰2n-1ä¸ªèŠ‚ç‚¹ï¼ˆè¿™ç‚¹å¯ç”±äºŒå‰æ ‘æ€§è´¨æ¨å‡ºï¼‰ï¼Œæˆ‘ä»¬è€ƒè™‘å°†å…¶å­˜å‚¨åœ¨é•¿åº¦ä¸º2nçš„ä¸€ç»´æ•°ç»„ä¸­ï¼ˆé€‰æ‹©é•¿åº¦ä¸º2nè€Œä¸æ˜¯2n-1æ˜¯ä¸ºäº†ä¸‹è¾¹ä»1å¼€å§‹è®¡ç®—ï¼‰ å­˜å‚¨ç»“æ„ 1234typedef struct&#123; unsigned int weight ; unsigned int parent,lchild,rchild ; //è¿™é‡Œæˆ‘ä»¬å­˜å‚¨çš„éƒ½æ˜¯ä¸‹æ ‡&#125;HTNode,*HuffmanCode å“ˆå¤«æ›¼ç¼–ç ä¸»è¦åˆ†ä¸ºä¸€ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š åˆå§‹åŒ– åˆå§‹åŒ–æ—¶ç»™å¶å­èŠ‚ç‚¹æƒé‡ï¼Œéå¶å­èŠ‚ç‚¹æƒé‡ä¸º0ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€è¡Œå’Œç¬¬äºŒè¡Œforå¾ªç¯çš„æ„æ€ï¼‰ æ„å»ºå“ˆå¤«æ›¼æ ‘ æ„å»ºæ—¶æˆ‘ä»¬å°±ä»å‰é¢nä¸ªå¶å­èŠ‚ç‚¹æ‰¾åˆ°æƒå€¼æœ€å°çš„ä¸¤ä¸ªï¼Œå°†ä»–ä¿©åˆå¹¶æˆä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ï¼Œæ”¾åœ¨n+1çš„ä½ç½®ï¼Œä»¥æ­¤ç±»æ¨ï¼ˆå¯¹åº”ç¬¬ä¸‰ä¸ªforå¾ªç¯ï¼‰ æ±‚å“ˆå¤«æ›¼ç¼–ç  æ±‚å“ˆå¤«æ›¼ç¼–ç å°±æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹æ¸¸èµ°ä¸‹å»ï¼Œå¦‚æœæ˜¯å·¦å­©å­åˆ™ç¼–ç ä¸º0ï¼Œå¦‚æœæ˜¯å³å­©å­ï¼Œåˆ™ç¼–ç ä¸º1ï¼Œç„¶åå°†ç¼–ç ä»¥æ­¤å­˜å…¥ç›¸åº”æ•°ç»„é‡Œã€‚ä½†æ˜¯ï¼Œå¦‚æœä»æ ¹èŠ‚ç‚¹å¼€å§‹å¯»æ‰¾ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¿…é¡»éå†è¿™æ£µæ ‘ï¼Œè¿™æ˜¯å¾ˆéº»çƒ¦çš„ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä»å¶å­èŠ‚ç‚¹å›æº¯åˆ°æ ¹èŠ‚ç‚¹ï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œä»ç»“æ„ä½“æˆ‘ä»¬å¯ä»¥çŸ¥é“å®ƒæ˜¯æœ‰æŒ‡å‘çˆ¶èŠ‚ç‚¹çš„æŒ‡é’ˆçš„ï¼Œé‚£æˆ‘ä»¬å°±ä»å¶å­èŠ‚ç‚¹å¼€å§‹å›æº¯ï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å·¦å­©å­ï¼Œåˆ™å½“å‰ç¼–ç ä¸º0ï¼Œå¦‚æœæ˜¯å³å­©å­ï¼Œåˆ™ç¼–ç ä¸º1ï¼ŒåŒæ—¶æˆ‘ä»¬è®¾ç½®ä¸€ä¸ªæ•°ç»„cd[â€¦]æ¥å­˜å‚¨ç¼–ç ï¼Œå› ä¸ºæ˜¯ä»å¶å­åˆ°æ ¹èŠ‚ç‚¹è¿™æ ·å›æº¯çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åˆ°çš„ç¼–ç è‚¯å®šæ˜¯åç€çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æŠŠè¿™ä¸ªç¼–ç ä»æ•°ç»„cdçš„çš„å±è‚¡å¼€å§‹æ”¾ï¼Œå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜äº†ã€‚ å›¾å…³é”®è·¯å¾„ åœ¨AOEç½‘ï¼ˆActivity On Edgeï¼‰ä¸­ï¼Œå¼§è¡¨ç¤ºæ´»åŠ¨ï¼Œé¡¶ç‚¹è¡¨ç¤ºäº‹ä»¶ï¼Œæƒå€¼è¡¨ç¤ºæ´»åŠ¨æŒç»­æ—¶é—´ï¼Œå®ƒæ˜¯ä¸€ä¸ªæœ‰å‘æ— ç¯å›¾ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒAOEç½‘å¯ä»¥ç”¨æ¥ä¼°ç®—å·¥ç¨‹çš„å®Œæˆæ—¶é—´ã€‚å®ƒçš„ä¸¤ä¸ªä¸»è¦é—®é¢˜æ˜¯ï¼š 1. å®Œæˆæ•´é¡¹å·¥ç¨‹éœ€è¦å¤šé•¿æ—¶é—´ 2. å“ªäº›æ´»åŠ¨æ˜¯å½±å“å·¥ç¨‹è¿›åº¦çš„å…³é”® â€‹ å¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå®Œæˆæ•´é¡¹å·¥ç¨‹çš„éœ€è¦å¤šé•¿æ—¶é—´ï¼Œæˆ‘ä»¬åªéœ€è¦è€ƒè™‘å®Œæˆå®ƒæ‰€éœ€è¦çš„æœ€çŸ­æ—¶é—´å³å¯ã€‚å¯¹äºä¸€ä¸ªæœ‰å‘æ— ç¯å›¾æ‰€è¡¨ç¤ºçš„å·¥ç¨‹æ¥è¯´ï¼Œå®Œæˆå·¥ç¨‹çš„æœ€çŸ­æ—¶é—´æ˜¯ä»å¼€å§‹ç‚¹åˆ°ç»“æŸç‚¹çš„æœ€é•¿è·¯å¾„çš„é•¿åº¦ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæœ€é•¿è·¯å¾„å«åšå…³é”®è·¯å¾„ï¼ˆè¿™é‡Œæœ‰äººå¯èƒ½ä¼šç–‘é—®ä¸ºä»€ä¹ˆä¸æ˜¯æœ€çŸ­è·¯å¾„çš„é•¿åº¦ï¼Œä½ æƒ³ï¼Œå¦‚æœæ˜¯åœ¨æœ€çŸ­è·¯å¾„é•¿åº¦æ‰€è¡¨ç¤ºçš„æ—¶é—´å†…å°±èƒ½å®Œæˆå·¥ç¨‹ï¼Œé‚£ä¹ˆé‚£äº›è€—æ—¶è¾ƒé•¿çš„å·¥åºå’‹æ•´ï¼Œå‡è®¾æœ€é•¿é•¿åº¦æ˜¯8ï¼Œæœ€çŸ­æ˜¯5ï¼Œå¦‚æœæœ‰ä¸ªå·¥åºéœ€è¦åœ¨æ—¶é—´ä¸º6æ—¶è¿›è¡Œï¼Œå¦‚æœé€‰æ‹©5ä½œä¸ºå®Œæˆå·¥ç¨‹çš„æœ€çŸ­æ—¶é—´ï¼Œé‚£è¿™ä¸ªå·¥åºå²‚ä¸æ˜¯æ²¡æœ‰æ—¶é—´è¿›è¡Œäº†ï¼‰ â€‹ å¯¹äºç¬¬äºŒä¸ªé—®é¢˜ï¼Œå“ªäº›æ´»åŠ¨æ˜¯å½±å“å·¥ç¨‹è¿›åº¦çš„å…³é”®ï¼Œæˆ‘ä»¬å¼•å…¥ä¸‹å›¾æ¥è¯´æ˜é—®é¢˜ï¼Œå› ä¸ºé€”ä¸­æœ‰äº›æ´»åŠ¨æ˜¯å¹¶è¡Œè¿›è¡Œçš„ï¼Œæ‰€ä»¥æœ‰äº›é¡¶ç‚¹äº‹ä»¶çš„å¼€å§‹æ—¶é—´å…¶å®æ˜¯ä¸å”¯ä¸€çš„ï¼Œæ‹¿v5æ¥è¯´ï¼Œv1 -&gt; v2 -&gt; v5 è¿™æ¡è·¯å¾„æ‰§è¡Œçš„è¯ï¼Œv5è¦åˆ°7è¿™ä¸ªæ—¶é—´ç‚¹æ‰èƒ½æ‰§è¡Œï¼ŒæŒ‰ç…§v1 -&gt; v3 -&gt; v5 è¿™æ¡è·¯å¾„æ‰§è¡Œçš„è¯ï¼Œåˆ°5è¿™ä¸ªæ—¶é—´ç‚¹å°±å¯ä»¥æ‰§è¡Œäº†ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œv5å¤„çš„äº‹ä»¶çœŸçš„èƒ½åœ¨æ—¶é—´ä¸º5æ—¶æ‰§è¡Œä¹ˆï¼Œç­”æ¡ˆæ˜¯ä¸èƒ½ï¼å¦‚æœæ­¤æ—¶æ‰§è¡Œçš„è¯ï¼Œæ—¶é—´ä¸º5æ—¶v2è¿˜æ²¡æœ‰è¢«æ‰§è¡Œï¼Œv5çš„å…ˆå†³æ¡ä»¶è¿˜ä¸æ»¡è¶³å‘¢ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸Šè¿°ä¸­æœ€çŸ­æ—¶é—´ä¸ºä»€ä¹ˆé€‰çš„æ˜¯æœ€é•¿è·¯å¾„çš„åŸå› ã€‚è¿™é‡Œæˆ‘ä»¬æå‡ºäº‹ä»¶çš„æœ€æ—©å¼€å§‹æ—¶é—´eiè¿™ä¸€æ¦‚å¿µ äº‹ä»¶Viçš„æœ€æ—©å¼€å§‹æ—¶é—´å°±æ˜¯ä»V1åˆ°Viçš„æœ€é•¿è·ç¦»ã€‚æœ€æ—©å¼€å§‹æ—¶é—´ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯è¿™ä¸ªäº‹ä»¶æœ€æ—©èƒ½è¢«æ‰§è¡Œçš„æ—¶é—´ï¼Œä¸Šè¿°çš„V5çš„æœ€æ—©å¼€å§‹æ—¶é—´å°±æ˜¯7ï¼Œä¹Ÿå°±æ˜¯è¯´V7ä¸èƒ½æ¯”æ—¶é—´7æ›´æ—©æ‰§è¡Œäº†ï¼Œä¸ç„¶å®ƒçš„å…ˆå†³äº‹ä»¶æ²¡æœ‰è¢«æ‰§è¡Œå®Œã€‚ä¹Ÿå³V5çš„æ‰§è¡Œæ—¶é—´åº”è¯¥å¤§äºç­‰äº7ï¼Œé‚£æ˜¯ä¸æ˜¯å¯ä»¥æ— é™å¤§å‘¢ï¼Ÿæ˜¾ç„¶æ˜¯ä¸èƒ½çš„ï¼Œå› ä¸ºæ— é™å»¶è¿Ÿè‚¯å®šä¼šå»¶è¯¯å·¥æœŸå•Šï¼Œæ‰€ä»¥V5çš„æ‰§è¡Œæ—¶é—´å†æ€ä¹ˆå»¶è¿Ÿï¼Œä¹Ÿè¦åœ¨å·¥æœŸï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„é¡¹ç›®çš„æœ€çŸ­æ—¶é—´å³å…³é”®è·¯å¾„ï¼‰ç»“æŸå‰èµ°åˆ°V9å•Šã€‚å› æ­¤æˆ‘ä»¬åˆæå‡ºäº†æœ€è¿Ÿå¼€å§‹æ—¶é—´liï¼Œé¡¾åæ€ä¹‰ä¹Ÿå°±æ˜¯è¿™ä¸ªå¼€å§‹æ—¶é—´çš„é€‰æ‹©å¾ˆç²¾å‡†ï¼Œåˆšå¥½åˆ°å·¥æœŸç»“æŸï¼Œå®ƒä¹Ÿåˆšå¥½èµ°åˆ°V9. â€‹ æ‹¿ä¸Šå›¾æ¥åˆ†æï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥çŸ¥ä»v1åˆ°v9çš„æœ€é•¿è·¯å¾„æ˜¯ï¼ˆv1,v2,v5,v8,v9ï¼‰,è·¯å¾„é•¿åº¦18ï¼Œå³v9çš„æœ€æ—©å‘ç”Ÿæ—¶é—´æ˜¯18.æˆ‘ä»¬æ¥çœ‹æ´»åŠ¨a6(æ³¨æ„è¿™é‡Œçœ‹çš„æ˜¯æ´»åŠ¨ä¸æ˜¯äº‹ä»¶å“¦),å®ƒçš„æœ€æ—©å¼€å§‹æ—¶é—´æ˜¯5ï¼ˆä»v1åˆ°v4ï¼‰,æœ€æ™šå¼€å§‹æ—¶é—´æ˜¯8ï¼Œæ€ä¹ˆç®—çš„å‘¢ï¼Œæ€»é•¿æ˜¯18ï¼Œå®ƒå¦‚æœè¦èµ¶åœ¨åˆšå¥½å·¥æœŸç»“æŸçš„æ—¶å€™èµ¶åˆ°v9,é‚£å®ƒåº”è¯¥ä»æ—¶é—´ 18-a11-a9-a6 = 8 å¤„å¼€å§‹ï¼Œè¿™æ ·å·¥æœŸç»“æŸæ—¶å°±åˆšå¥½èµ¶åˆ°v9ã€‚ â€‹ ä¸Šè¿°æˆ‘ä»¬è®¡ç®—äº†æ—¶é—´çš„æœ€æ—©å¼€å§‹æ—¶é—´å’Œæœ€è¿Ÿå¼€å§‹æ—¶é—´ï¼Œä½ ä¼šå‘ç°ï¼Œåœ¨l-eä¹‹é—´æœ‰ä¸ªå·®å€¼ï¼Œè¿™ä¸ªå·®å€¼è¡¨ç¤ºæˆ‘ä»¬å·¥æœŸå¯ä»¥å»¶è¿Ÿçš„ä¸€ä¸ªå¹…åº¦ï¼Œé‚£ä¹ˆå°±ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå·®å€¼ä¸ºé›¶ï¼Œå®ƒè¡¨ç¤ºè¿™ä¸ªæ´»åŠ¨ä¸€ç§’é’Ÿéƒ½å»¶æœŸä¸å¾—ï¼Œä¸ç„¶ä¼šå½±å“æ•´ä¸ªå·¥æœŸè¿›åº¦ï¼Œæˆ‘ä»¬æŠŠè¿™ç§æ´»åŠ¨å«åšå…³é”®æ´»åŠ¨ã€‚ â€‹ â€‹ æ’åºæ’å…¥æ’åºæ’å…¥æ’åºçš„æ ¸å¿ƒæ€æƒ³ï¼šè®¤ä¸ºæœ€åˆçš„ä¸€ä¸ªå…ƒç´ æ˜¯æœ‰åºçš„ï¼Œ â€‹ ç„¶åä»ç¬¬äºŒä¸ªå…ƒç´ å¾€åï¼Œå¼€å§‹å’Œå·²ç»æœ‰åºçš„å…ƒç´ è¿›è¡Œé€†å‘æ¯”è¾ƒï¼Œ â€‹ å¦‚æœæ¯”æœ‰åºçš„å€’æ•°ç¬¬ä¸€ä¸ªå…ƒç´ å¤§æ˜¯æœ€å¥½çš„ï¼Œè¿™ç§æƒ…å†µä¸‹ä¸ç”¨ç§»åŠ¨æœ‰åºå…ƒç´ å¯ä»¥ç›´æ¥æ’å…¥æœ«å°¾ â€‹ å¦åˆ™å°±æ˜¯æŠŠæœ‰åºéƒ¨åˆ†å‘åç§»åŠ¨ï¼Œç›´åˆ°é‡è§æŸä¸ªå…ƒç´ ï¼Œå®ƒåˆšå¥½å°äºæˆ‘ä»¬çš„å¾…æ¯”è¾ƒå…ƒç´ ï¼Œ æŸ¥æ‰¾äºŒå‰æ’åºæ ‘å·¦å­©å­æ¯”çˆ¶äº²å°ï¼Œå³å­©å­æ¯”çˆ¶äº²å¤§ã€‚æ­£å¸¸æƒ…å†µï¼Œç”¨nä¸ªèŠ‚ç‚¹éšæœºæ„é€ çš„äºŒå‰æ’åºæ ‘ï¼Œé«˜åº¦ä¸ºlog(n),æ‰€ä»¥æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯log(n)ï¼Œæ²¡é—®é¢˜ã€‚ä½†æ€•å°±æ€•åœ¨è¿™ä¸ªäºŒå‰æ’åºæ ‘èµ°æç«¯ï¼Œä¸‡ä¸€å®ƒåªæœ‰å·¦å­©å­æˆ–è€…åªæœ‰å³å­©å­ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šå˜æˆä¸ªé“¾è¡¨ï¼Œè¿™æ—¶å€™æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦å°±å˜æˆäº†näº†ã€‚ æ‰€ä»¥ï¼Œä¸ºäº†é¿å…ä¸Šè¿°æƒ…å†µçš„å‘ç”Ÿï¼Œæˆ‘ä»¬éœ€è¦è–›å¾®åˆ¶è£ä¸€ä¸‹äºŒå‰æ’åºæ ‘ï¼Œä½¿å®ƒä¸è¦åç§‘ä¸¥é‡ï¼Œäºæ˜¯å°±æœ‰äº†å¹³è¡¡äºŒå‰æ ‘ã€‚ å¹³è¡¡äºŒå‰æ ‘ï¼ˆAVLæ ‘ï¼‰å› ä¸ºäºŒå‰æ’åºæ ‘åç§‘ä¸¥é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬æ•™ä¼šäº†AVLæ ‘é›¨éœ²å‡æ²¾ï¼Œåœ¨ä¿è¯äºŒå‰æ’åºæ ‘çš„ç‰¹ç‚¹ä¸Šï¼Œæˆ‘ä»¬åˆè¦æ±‚AVLæ ‘å·¦å³å­æ ‘é«˜åº¦å·®ä¸èƒ½è¶…è¿‡1ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ•´æ£µæ ‘å°±æ˜¾å¾—å¾ˆå‡è¡¡äº†ã€‚æ¯å½“æ’å…¥æˆ–è€…åˆ é™¤èŠ‚ç‚¹ä½¿å¾—æ ‘å¤±è¡¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½è¦é€šè¿‡æ—‹è½¬å»è°ƒèŠ‚ã€‚ ä½†æ˜¯ï¼è™½ç„¶å®ƒå¾ˆä¸¥æ ¼çš„å¹³è¡¡äº†ï¼Œä½†æ˜¯æ¯æ¬¡è¿™ç§è°ƒèŠ‚ç¡®å®å¾ˆè´¹æ—¶çš„ï¼Œè¿™å¯¹äºé¢‘ç¹çš„åˆ é™¤å’Œæ’å…¥çš„åœºæ™¯æ¥è¯´ï¼Œå¹¶ä¸æ˜¯ä¸ªå¥½æ¶ˆæ¯ã€‚æ‰€ä»¥äººä»¬åˆæƒ³ï¼Œèƒ½ä¸èƒ½å¼±åŒ–ä¸€ä¸‹å®ƒçš„å¹³è¡¡ï¼Œè®©å®ƒå¯ä»¥åç§‘ï¼Œä½†æ˜¯ä¸è¦å¤ªä¸¥é‡å°±è¡Œï¼Œäºæ˜¯ï¼Œå°±æœ‰äº†çº¢é»‘æ ‘ã€‚ çº¢é»‘æ ‘çº¢é»‘æ ‘çš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š æ¯ä¸ªèŠ‚ç‚¹è¦ä¹ˆçº¢è¦ä¹ˆé»‘ æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²çš„ æ¯ä¸ªå¶èŠ‚ç‚¹éƒ½æ˜¯ç©ºèŠ‚ç‚¹ï¼Œæ˜¯é»‘çš„ å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ˜¯çº¢çš„ï¼Œé‚£ä¹ˆå®ƒçš„ä¸¤ä¸ªå„¿å­æ˜¯é»‘çš„ å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œåˆ°å¶å­èŠ‚ç‚¹çš„ä»»æ„ä¸€æ¡è·¯å¾„ä¸Šï¼Œé»‘è‰²èŠ‚ç‚¹æ•°ç›®éƒ½ä¸€æ ·å¤š å®ƒçš„æŸ¥æ‰¾ï¼Œæ’å…¥ï¼Œåˆ é™¤æ—¶é—´å¤æ‚åº¦ä¸ºO(log n),å®ƒçš„ç»Ÿè®¡æ€§èƒ½æ¯”AVLæ•°æ›´å¥½ã€‚ æ’å…¥æ’å…¥åªèƒ½æ˜¯æ’å…¥çº¢è‰²èŠ‚ç‚¹ï¼Œå› ä¸ºæ’å…¥é»‘èŠ‚ç‚¹ï¼Œè¿èƒŒæ€§è´¨äº”ï¼Œéœ€è¦å¤§è§„æ¨¡è°ƒæ•´ã€‚ æ’å…¥çš„èŠ‚ç‚¹æ˜¯æ ¹èŠ‚ç‚¹ ç›´æ¥æ¶‚é»‘ æ’å…¥çš„èŠ‚ç‚¹çš„çˆ¶äº²æ˜¯é»‘èŠ‚ç‚¹ æ²¡æ¯›ç—…ï¼Œç›´æ¥æ’ çˆ¶äº²æ˜¯çº¢èŠ‚ç‚¹ ç°è±¡è¯´æ˜ å¤„ç†ç­–ç•¥ Case 1 å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯çº¢è‰²ï¼Œä¸”å½“å‰èŠ‚ç‚¹çš„ç¥–çˆ¶èŠ‚ç‚¹çš„å¦ä¸€ä¸ªå­èŠ‚ç‚¹ï¼ˆå”å”èŠ‚ç‚¹ï¼‰ä¹Ÿæ˜¯çº¢è‰²ã€‚ (01) å°†â€œçˆ¶èŠ‚ç‚¹â€è®¾ä¸ºé»‘è‰²ã€‚ (02) å°†â€œå”å”èŠ‚ç‚¹â€è®¾ä¸ºé»‘è‰²ã€‚ (03) å°†â€œç¥–çˆ¶èŠ‚ç‚¹â€è®¾ä¸ºâ€œçº¢è‰²â€ã€‚ (04) å°†â€œç¥–çˆ¶èŠ‚ç‚¹â€è®¾ä¸ºâ€œå½“å‰èŠ‚ç‚¹â€(çº¢è‰²èŠ‚ç‚¹)ï¼›å³ï¼Œä¹‹åç»§ç»­å¯¹â€œå½“å‰èŠ‚ç‚¹â€è¿›è¡Œæ“ä½œã€‚ Case 2 å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯çº¢è‰²ï¼Œå”å”èŠ‚ç‚¹æ˜¯é»‘è‰²ï¼Œä¸”å½“å‰èŠ‚ç‚¹æ˜¯å…¶çˆ¶èŠ‚ç‚¹çš„å³å­©å­ (01) å°†â€œçˆ¶èŠ‚ç‚¹â€ä½œä¸ºâ€œæ–°çš„å½“å‰èŠ‚ç‚¹â€ã€‚ (02) ä»¥â€œæ–°çš„å½“å‰èŠ‚ç‚¹â€ä¸ºæ”¯ç‚¹è¿›è¡Œå·¦æ—‹ã€‚ Case 3 å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æ˜¯çº¢è‰²ï¼Œå”å”èŠ‚ç‚¹æ˜¯é»‘è‰²ï¼Œä¸”å½“å‰èŠ‚ç‚¹æ˜¯å…¶çˆ¶èŠ‚ç‚¹çš„å·¦å­©å­ (01) å°†â€œçˆ¶èŠ‚ç‚¹â€è®¾ä¸ºâ€œé»‘è‰²â€ã€‚ (02) å°†â€œç¥–çˆ¶èŠ‚ç‚¹â€è®¾ä¸ºâ€œçº¢è‰²â€ã€‚ (03) ä»¥â€œç¥–çˆ¶èŠ‚ç‚¹â€ä¸ºæ”¯ç‚¹è¿›è¡Œå³æ—‹ã€‚ å”å”æ˜¯çº¢è‰² å”å”æ˜¯é»‘è‰²ï¼Œå½“å‰æ˜¯å³å­©å­ å¤„ç†ç­–ç•¥ï¼š å°†â€œçˆ¶èŠ‚ç‚¹â€ä½œä¸ºâ€œæ–°çš„å½“å‰èŠ‚ç‚¹â€ï¼› ä»¥â€œæ–°çš„å½“å‰èŠ‚ç‚¹â€ä¸ºæ”¯ç‚¹è¿›è¡Œå·¦æ—‹ã€‚ å”å”æ˜¯é»‘è‰²ï¼Œå½“å‰æ˜¯å·¦å­©å­ å¤„ç†ç­–ç•¥(01) å°†â€œçˆ¶èŠ‚ç‚¹â€è®¾ä¸ºâ€œé»‘è‰²â€ã€‚(02) å°†â€œç¥–çˆ¶èŠ‚ç‚¹â€è®¾ä¸ºâ€œçº¢è‰²â€ã€‚(03) ä»¥â€œç¥–çˆ¶èŠ‚ç‚¹â€ä¸ºæ”¯ç‚¹è¿›è¡Œå³æ—‹ã€‚ åˆ é™¤æ™®é€šäºŒå‰æ ‘çš„åˆ é™¤è§„åˆ™ï¼š 1ã€å¦‚æœåˆ é™¤çš„æ˜¯å¶èŠ‚ç‚¹ï¼Œå¯ä»¥ç›´æ¥åˆ é™¤ï¼› 2ã€å¦‚æœè¢«åˆ é™¤çš„å…ƒç´ æœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œå¯ä»¥å°†å­èŠ‚ç‚¹ç›´æ¥ç§»åˆ°è¢«åˆ é™¤å…ƒç´ çš„ä½ç½®ï¼› 3ã€å¦‚æœæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œè¿™æ—¶å€™å°±å¯ä»¥æŠŠè¢«åˆ é™¤å…ƒç´ çš„å³æ”¯çš„æœ€å°èŠ‚ç‚¹ï¼ˆè¢«åˆ é™¤å…ƒç´ å³æ”¯çš„æœ€å·¦è¾¹çš„èŠ‚ç‚¹ï¼‰å’Œè¢«åˆ é™¤å…ƒç´ äº’æ¢ï¼Œæˆ‘ä»¬æŠŠè¢«åˆ é™¤å…ƒç´ å³æ”¯çš„æœ€å·¦è¾¹çš„èŠ‚ç‚¹ç§°ä¹‹ä¸ºåç»§èŠ‚ç‚¹ï¼ˆåç»§å…ƒç´ ï¼‰ï¼Œç„¶ååœ¨æ ¹æ®æƒ…å†µ1æˆ–è€…æƒ…å†µ2è¿›è¡Œæ“ä½œã€‚ å¯¹äºçº¢é»‘æ ‘çš„åˆ é™¤ï¼Œé¦–å…ˆè¦æ»¡è¶³æ™®é€šäºŒå‰æ ‘çš„åˆ é™¤è§„åˆ™ï¼Œå…¶æ¬¡ï¼Œåˆ é™¤è¿˜ä¸èƒ½å½±å“åˆ°ä¸Šè¿°çš„çº¢é»‘æ ‘çš„äº”æ¡ç‰¹æ€§ã€‚ å¤§æ„å°±æ˜¯ï¼šçº¢è‰²çš„ï¼Œç›´æ¥åˆ ï¼›æ ¹èŠ‚ç‚¹ï¼Œç›´æ¥åˆ ï¼› è¿™ä¸ªæˆ‘å·²ç»å†™ä¸åŠ¨äº†ï¼Œæœ‰æ—¶é—´å†å†™å§ï¼Œ æ€»ç»“æ€»ä¹‹ï¼Œæ— è®ºæ˜¯æ’å…¥è¿˜æ˜¯åˆ é™¤ï¼Œåœ¨æ»¡è¶³æ™®é€šäºŒå‰æ’åºæ•°çš„è§„åˆ™ä¹‹ä¸Šï¼Œè¿˜éœ€è¦è€ƒè™‘é…è‰²é—®é¢˜ï¼Œè¦ä½¿å¾—é¢œè‰²æ»¡è¶³çº¢é»‘æ ‘çš„å®šä¹‰ã€‚ æ„Ÿæ‚Ÿä¸ºä»€ä¹ˆä»Šå¤©çªç„¶çœ‹è¿™ä¸ªå‘¢ï¼Œå› ä¸ºåœ¨çœ‹æºç çš„æ—¶å€™æ¸æ¸å‘ç°é™¤äº†HashMap, TreeMapä¹Ÿç”¨åˆ°äº†çº¢é»‘æ ‘å»è¾¾åˆ°ä¸€ä¸ªæœ‰åºçš„Mapçš„æ•ˆæœçš„ï¼Œæ‰€ä»¥å°±çœ‹äº†ä¸‹ï¼Œè™½ç„¶æŒºå¤æ‚çš„ï¼Œæˆ‘ä¹Ÿæ²¡çœ‹å®Œï¼Œä½†æ˜¯å¤§æ¦‚æ‡‚å®ƒçš„å·¥ä½œåŸç†ä»¥åŠè®¾è®¡å“²å­¦äº†ï¼Œä¹Ÿæ˜¯ä¸é”™çš„æ”¶è·å•¦ï¼Œèµ·ç ä»¥åå†çœ‹æºç çš„æ—¶å€™ç¢°åˆ°å®ƒå°±ä¸ä¼šå¾ˆé™Œç”Ÿäº†ã€‚ å‚è€ƒæ–‡çŒ®ï¼š çº¢é»‘æ ‘(ä¸€)ä¹‹ åŸç†å’Œç®—æ³•è¯¦ç»†ä»‹ç»","categories":[{"name":"æ•°æ®ç»“æ„ä¸ç®—æ³•","slug":"æ•°æ®ç»“æ„ä¸ç®—æ³•","permalink":"http://example.com/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"}],"tags":[]},{"title":"windowsä¸‹tensorflow anocondaå®‰è£…","slug":"windowsä¸‹tensorflow anocondaå®‰è£…","date":"2018-05-31T04:00:00.000Z","updated":"2018-05-31T04:00:00.000Z","comments":true,"path":"2018/05/31/windowsä¸‹tensorflow anocondaå®‰è£…/","link":"","permalink":"http://example.com/2018/05/31/windows%E4%B8%8Btensorflow%20anoconda%E5%AE%89%E8%A3%85/","excerpt":"","text":"ä¹‹å‰å·²ç»è£…å¥½anocondaï¼Œè¿™é‡Œå®‰è£…tensorflow å‡†å¤‡å·¥ä½œï¼šPython3.5 æˆ–è€…Python3.6 å¾ˆå¤šæ“ä½œæŒ‡ä»¤å®˜æ–¹æ–‡æ¡£å·²ç»ç»™å‡º æ‰“å¼€cmdï¼Œè¾“å…¥ conda create -n tensorflow python=3.5 åˆ›å»ºä¸€ä¸ªåä¸ºtensorflowçš„ç¯å¢ƒï¼Œï¼ˆè¿™é‡Œæˆ‘ç¬¬ä¸€æ¬¡å°è¯•å¹¶æ²¡æœ‰æˆåŠŸï¼Œå°†ç›®å½•åˆ‡æ¢åˆ°Pythonåº•ä¸‹æ‰æˆåŠŸï¼Œä¼°è®¡æ˜¯ç¯å¢ƒå˜é‡çš„é—®é¢˜ï¼‰ï¼Œå¯èƒ½ä¼šæ˜¾ç¤ºè¦å®‰è£…æ–°çš„æ–‡ä»¶ï¼Œç‚¹yå³å¯ã€‚ æ¿€æ´»ç¯å¢ƒ activate tensorflow è¿™æ—¶ä½ ä¼šå‘ç°å‘½ä»¤è¡Œæœ€å¼€å§‹ä¼šæœ‰(tensorflow)ï¼Œè¯´æ˜å·²ç»æ¿€æ´» å®‰è£…tensorflow, å› ä¸ºæˆ‘å®‰è£…çš„æ˜¯cpuç‰ˆæœ¬ï¼Œæ‰€ä»¥å‘½ä»¤å¦‚ä¸‹ï¼š pip install --ignore-installed --upgrade tensorflow è‡³æ­¤å®‰è£…å·²ç»å®Œæˆï¼Œå¦‚éœ€æ£€éªŒæ˜¯å¦å®‰è£…æˆåŠŸï¼Œè¾“å…¥python,å¦‚æœimport tensorflowä¸æŠ¥é”™ï¼ŒåŸºæœ¬è¯´æ˜å®‰è£…æˆåŠŸ è‡³æ­¤tensorflowçš„å®‰è£…å·¥ä½œå·²ç»å®Œæˆï¼Œé‚£å¦‚ä½•åœ¨anconda navigatorä¸­å¯¼å…¥å‘¢ï¼Ÿ æ–¹æ³•ä¸€ UIç•Œé¢ä¸­å¯¼å…¥ â€‹ ä¸ªäººè§‰å¾—è¿™ç§æ–¹æ³•å¾ˆå®¹æ˜“å¡æ­»ï¼Œæ¨èç¬¬äºŒç§ æ–¹æ³•äºŒ å‘½ä»¤è¡Œä¸‹è½½ é¦–å…ˆactivate æŸç¯å¢ƒï¼Œç„¶åconda install xxx (å¦‚spyder) å¦‚æœä¹‹å‰å®‰è£…äº†åˆ«çš„pythonç‰ˆæœ¬ï¼Œå› ä¸ºanacondaé‡Œé¢è‡ªå·±å¸¦äº†python,å¦‚ä½•ç»™æŒ‡å®šç‰ˆæœ¬å®‰è£…numpy?è¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼ï¼š 1. activate condaç¯å¢ƒï¼Œç„¶åconda install numpy,è¿™æ ·ä¼šå®‰è£…è®¸å¤šå…¶ä»–çš„åŒ…ï¼Œå¾ˆéº»çƒ¦,ä¸æ¨è 2. py -3 -m pip install python","categories":[{"name":"æ•™ç¨‹","slug":"æ•™ç¨‹","permalink":"http://example.com/categories/%E6%95%99%E7%A8%8B/"}],"tags":[]},{"title":"leetcodeé¢˜è§£","slug":"LeetCodeé¢˜è§£","date":"2018-05-03T03:13:20.000Z","updated":"2023-05-29T14:17:39.379Z","comments":true,"path":"2018/05/03/LeetCodeé¢˜è§£/","link":"","permalink":"http://example.com/2018/05/03/LeetCode%E9%A2%98%E8%A7%A3/","excerpt":"","text":"###542.01 çŸ©é˜µ é¢˜ç›®æè¿° ç»™å®šä¸€ä¸ªç”± 0 å’Œ 1 ç»„æˆçš„çŸ©é˜µï¼Œæ‰¾å‡ºæ¯ä¸ªå…ƒç´ åˆ°æœ€è¿‘çš„ 0 çš„è·ç¦»ã€‚ ä¸¤ä¸ªç›¸é‚»å…ƒç´ é—´çš„è·ç¦»ä¸º 1 ã€‚ é¢˜ç›®åˆ†æ å¯ç”¨åŠ¨æ€è§„åˆ’æ¥æ±‚è§£ï¼Œæ¯ä¸ªå…ƒç´ è·ç¦»0æœ€è¿‘çš„è·ç¦» = è¯¥å…ƒç´ é‚»å±…è·ç¦»0æœ€è¿‘çš„è·ç¦» + 1 ä¸ºäº†ä»åˆ†åˆ©ç”¨å†…å­˜ç©ºé—´ï¼Œæˆ‘ä»¬ä»ç„¶ç”¨è¿™ä¸ªçŸ©é˜µæ¥è¡¨ç¤ºè·ç¦» ä¸ºé›¶çš„å…ƒç´ ä¸ç”¨å¤„ç†ï¼Œå¦‚æœæŸä¸ªå…ƒç´ çš„é‚»å±…æœ‰0ï¼Œé‚£ä¹ˆå°†è¯¥å…ƒç´ ç½®ä¸º1ï¼ˆè¯´æ˜å®ƒåˆ°0çš„è·ç¦»ä¸º1ï¼‰ å°†å‰©ä¸‹çš„å…ƒç´ ï¼ˆä¹Ÿå°±æ˜¯å‘¨å›´å…¨æ˜¯1çš„å…ƒç´ ï¼‰ç½®ä¸ºæ— ç©·å¤§ï¼Œè¿™ä¸ªåˆå§‹åŒ–æ„å‘³ç€ä»–ä»¬åˆ°é›¶çš„è·ç¦»ä¸ºæ— ç©·å¤§ï¼Œéœ€è¦åœ¨åé¢çš„åŠ¨æ€è§„åˆ’ä¸­æ±‚è§£ é€šè¿‡ä¸Šè¿°çš„å¤„ç†ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ï¼Œè¿™äº›æ— ç©·å¤§çš„å€¼å…¶å®éƒ½è¢«æ•°å­—1æˆ–è€…è¾¹ç•Œæ‰€åŒ…å«ï¼Œé€šè¿‡è¾¹ç•Œå€¼å¯ä»¥æ›´æ–°æ— ç©·å¤§çš„å€¼ å¯¹çŸ©é˜µè¿›è¡Œéå†ï¼Œç¬¬ä¸€é¡ºåºæ¨ªå‘éå†ï¼Œå½“é‡è§å€¼ä¸ºæ— ç©·å¤§çš„å…ƒç´ æ—¶ï¼Œæ›´æ–°å®ƒçš„å€¼ä¸º é‚»å±…åˆ°0æœ€è¿‘è·ç¦»+1 å’Œæ— ç©·å¤§ æœ¬èº«å€¼çš„è¾ƒå°è€… matrix[i][j]=min(matrix[i-1][j]+1,matrix[i][j]) //å¦‚æœè¯¥å…ƒç´ ä¸æ˜¯ç¬¬ä¸€åˆ— ç¬¬ä¸€æ¬¡éå†å°†ä¼šå’Œè¯¥å…ƒç´ çš„å·¦è¾¹å…ƒç´ å’Œä¸Šè¾¹å…ƒç´ æ¯”è¾ƒ ç¬¬äºŒæ¬¡éå†ä»æœ€åä¸€è¡Œæœ€åä¸€åˆ—å¼€å§‹éå†ï¼Œå°†ä¼šå’Œè¯¥å…ƒç´ çš„å³è¾¹å’Œä¸‹è¾¹å…ƒç´ è¿›è¡Œæ¯”è¾ƒ ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495import static java.lang.Math.min;public class Matrix2&#123; public static void main(String[] args) &#123; int[][] matrix = //&#123;&#123;0,0,0&#125;, &#123;0,1,0&#125;, &#123;1,1,1&#125;&#125; ; &#123; &#123;0, 0, 1, 0, 1, 1, 1, 0, 1, 1&#125;, &#123;1, 1, 1, 1, 0, 1, 1, 1, 1, 1&#125;, &#123;1, 1, 1, 1, 1, 0, 0, 0, 1, 1&#125;, &#123;1, 0, 1, 0, 1, 1, 1, 0, 1, 1&#125;, &#123;0, 0, 1, 1, 1, 0, 1, 1, 1, 1&#125;, &#123;1, 0, 1, 1, 1, 1, 1, 1, 1, 1&#125;, &#123;1, 1, 1, 1, 0, 1, 0, 1, 0, 1&#125;, &#123;0, 1, 0, 0, 0, 1, 0, 0, 1, 1&#125;, &#123;1, 1, 1, 0, 1, 1, 0, 1, 0, 1&#125;, &#123;1, 0, 1, 1, 1, 0, 1, 1, 1, 0&#125;&#125;; int [][] matrix2 ; matrix2 = updateMatrix(matrix) ; System.out.println(&quot;last&quot;); for(int i=0 ; i&lt;matrix2.length; i++)&#123; for(int j=0; j&lt;matrix2[0].length;j++)&#123; System.out.print(matrix2[i][j]+&quot; &quot;); &#125; System.out.println(); &#125; &#125; public static int[][] updateMatrix(int[][] matrix)&#123; // for(int i=0; i&lt;matrix.length;i++)&#123; for(int j=0; j&lt;matrix[0].length;j++)&#123; if(matrix[i][j]==1)&#123; if(i&gt;0 &amp;&amp; matrix[i-1][j]==0) &#123; matrix[i][j]=1; continue; &#125; if(i&lt;matrix.length-1 &amp;&amp; matrix[i+1][j]==0)&#123; matrix[i][j]=1 ; continue; &#125; if(j&gt;0 &amp;&amp; matrix[i][j-1]==0)&#123; matrix[i][j]=1 ; continue; &#125; if(j&lt;matrix[0].length-1 &amp;&amp; matrix[i][j+1]==0)&#123; matrix[i][j]=1; continue; &#125; matrix[i][j]=65535 ; &#125; &#125; &#125; System.out.println(&quot;first &quot;); for(int i=0 ; i&lt;matrix.length; i++)&#123; for(int j=0; j&lt;matrix[0].length;j++)&#123; System.out.printf(&quot;%-8d&quot;,matrix[i][j]); &#125; System.out.println(); &#125; for(int i=0; i&lt;matrix.length;i++)&#123; for(int j=0; j&lt;matrix[0].length;j++)&#123; if(matrix[i][j]==65535)&#123; if(i&gt;0)&#123; matrix[i][j] = min(matrix[i-1][j]+1,matrix[i][j]); &#125; if(j&gt;0)&#123; matrix[i][j] = min(matrix[i][j-1]+1,matrix[i][j]); &#125; &#125; &#125; &#125; System.out.println(&quot;second &quot;); for(int i=0 ; i&lt;matrix.length; i++)&#123; for(int j=0; j&lt;matrix[0].length;j++)&#123; System.out.printf(matrix[i][j]+&quot;\\t&quot;); &#125; System.out.println(); &#125; for(int i=matrix.length-1; i&gt;=0;i--)&#123; for(int j=matrix[0].length-1;j&gt;=0;j--)&#123; if(i&lt;matrix.length-1) matrix[i][j]=min(matrix[i+1][j]+1,matrix[i][j]); if(j&lt;matrix[0].length-1) matrix[i][j]=min(matrix[i][j+1]+1,matrix[i][j]); &#125; &#125; return matrix; &#125;&#125; å…³äºç–‘é—® å¯èƒ½æœ‰äººä¼šæƒ³ï¼Œä¸ºä»€ä¹ˆè¦éå†ä¸¤éï¼Œè€Œä¸æ˜¯åœ¨ç¬¬ä¸€æ¬¡éå†æ—¶å°±ç›´æ¥å’Œå‰åå·¦å³é‚»å±…ç›¸æ¯”è¾ƒï¼Œç»§ç»­çœ‹è¿™å¼ å›¾ï¼ŒæŒ‰ç…§æˆ‘ä»¬çš„æ€è·¯å¤„ç†åæ˜¯è¿™æ ·çš„ è¯·çœ‹ç¬¬ä¸€è¡Œå€’æ•°ç¬¬äºŒä¸ªå…ƒç´ m[0][8]ï¼Œå¦‚æœåªè¿›è¡Œä¸€æ¬¡é¡ºåºéå†ï¼Œç”±äºå®ƒåº•ä¸‹çš„å€¼m[1][8]æ²¡æœ‰æ›´æ–°ï¼Œå®ƒå°†ä¼šè®¤ä¸ºä»å·¦è¾¹å¾—åˆ°çš„4(m[0][7]+1)è¿™ä¸ªå€¼æ˜¯æœ€å°å€¼ï¼Œä½†æ˜¯äº‹å®æ˜¯ï¼Œå½“å®ƒåº•ä¸‹è¿™ä¸ªæ— ç©·å¤§å€¼å¦‚æœç»è¿‡æ›´æ–°æˆ2ï¼Œé‚£ä¹ˆå®ƒçš„4ä¹Ÿåº”è¯¥æ›´æ–°ä¸º3ã€‚å¦‚æœæŒ‰ç…§æˆ‘ä»¬åªéå†ä¸€æ¬¡çš„æ€æƒ³ï¼Œå®ƒæ˜¯ç­‰ä¸åˆ°m[1][8]æ›´æ–°çš„ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬å…ˆæ­£å‘éå†æ¯”è¾ƒå·¦è¾¹å’Œä¸Šè¾¹å…ƒç´ ï¼Œå¾—åˆ°ä¸‹å›¾ ç¬¬äºŒæ¬¡åå‘éå†æ—¶ï¼Œå½“m[0][8]å’Œå®ƒä¸‹é¢çš„m[1][8]æ¯”è¾ƒæ—¶ï¼Œå› ä¸ºm[1][8]å·²ç»æ›´æ–°ï¼Œæ‰€ä»¥å®ƒä¹Ÿä¼šè¢«æ›´æ–°ã€‚ æ‰€ä»¥è¯´ï¼Œç¬¬ä¸€æ³¢éå†æ—¶æœ¬æ¥å°±æ˜¯ä»å·¦åˆ°å³ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºï¼Œå³ä½¿å¼ºè¡Œå’Œå½“å‰å…ƒç´ çš„å³è¾¹å’Œä¸‹è¾¹æ¯”è¾ƒï¼Œå› ä¸ºè¿™ä¸¤è¾¹è¿˜æ²¡æœ‰æ›´æ–°ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰ä»€ä¹ˆæ•ˆæœï¼Œæ‰€ä»¥æ‰éœ€è¦ä¸¤æ¬¡éå†ï¼Œä¸”æ–¹å‘ç›¸å 1 456. 132æ¨¡å¼ é¢˜ç›®æè¿° ç»™å®šä¸€ä¸ªæ•´æ•°åºåˆ—ï¼ša1, a2, â€¦, anï¼Œä¸€ä¸ª132æ¨¡å¼çš„å­åºåˆ— ai, aj, ak è¢«å®šä¹‰ä¸ºï¼šå½“ i &lt; j &lt; k æ—¶ï¼Œai &lt; ak &lt; ajã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•ï¼Œå½“ç»™å®šæœ‰ n ä¸ªæ•°å­—çš„åºåˆ—æ—¶ï¼ŒéªŒè¯è¿™ä¸ªåºåˆ—ä¸­æ˜¯å¦å«æœ‰132æ¨¡å¼çš„å­åºåˆ—ã€‚ æ³¨æ„ï¼šn çš„å€¼å°äº15000ã€‚ åˆ†æ æœ€æš´åŠ›çš„æ–¹æ³•å°±æ˜¯é€šè¿‡ä¸‰é‡å¾ªç¯ç›´æ¥åˆ¤æ–­ï¼Œä½†æ˜¯è¿è¡Œæ—¶ä¼šè¶…æ—¶ï¼Œè¿™é‡Œå¯¹ä¸‰é‡å¾ªç¯è¿›è¡Œä¼˜åŒ–ï¼Œé€šè¿‡è§‚å¯Ÿå¯çŸ¥ï¼Œå‡è®¾ä¸‰ä¸ªæ•°ä¾æ¬¡æ˜¯x,y,z.å¦‚æœy&lt;=x,è¿™æ—¶å¯ä»¥ç›´æ¥ç”¨yæ¥æ›¿ä»£xï¼Œå› ä¸ºç”¨ä¸€ä¸ªæ›´å°çš„å€¼æ¥åšxè‚¯å®šæ˜¯ä¸ä¼šé”™çš„ã€‚åŒç†ï¼Œå¦‚æœz&gt;=yï¼Œæˆ‘ä»¬å°±ç”¨zçš„å€¼æ¥æ›´æ–°yã€‚éœ€è¦æ³¨æ„çš„æ˜¯ä¸‹æ ‡çš„ç§»åŠ¨ã€‚ ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445public boolean find132pattern(int[] nums) &#123; int x,y,z ; int min,max ; if(nums.length==0) return false; min=max=nums[0] ; for(int i=1; i&lt;nums.length;i++)&#123; min = nums[i]&lt;min ? nums[i] : min ; max = nums[i]&gt;max ? nums[i]:max ; &#125; if(max-min&lt;2) return false ; for(int i=0; i&lt;nums.length;)&#123; x= nums[i]; for(int j=i+1; j&lt;nums.length;)&#123; y=nums[j]; //å¦‚æœé‡è§æ¯”xè¿˜å°çš„å€¼ï¼Œå°±æ›´æ–°x,åŒæ—¶æ›´æ–°ä¸‹æ ‡ if(y&lt;=x)&#123; x=y; i=j; j++; continue ; &#125; for(int k=j+1; k&lt;nums.length;k++)&#123; z=nums[k]; //å¦‚æœé‡è§æ¯”yè¿˜å¤§çš„å€¼ï¼Œå°±æ›´æ–°y,åŒæ—¶æ›´æ–°ä¸‹æ ‡ if(z&gt;=y)&#123; y=z ; j=k; continue; &#125; if( x&gt;=z)&#123; continue; &#125; else return true ; &#125; j++; &#125; i++; &#125; return false ; &#125; åæ€ çœ‹äº†ä¸‹é‡Œé¢å¤§ç¥è§£ç­”ï¼Œæ—¶é—´å¤æ‚åº¦æ§åˆ¶åœ¨O(n)ä¹Ÿæ˜¯å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚å…ˆæ‰¾åˆ°å½“å‰å…ƒç´ nums[i]å‰é¢æ‰€æœ‰å…ƒç´ ä¸­æœ€å°çš„å…ƒç´ min[i]ï¼Œç„¶ååå‘éå†ï¼Œå¹¶åœ¨éå†æ—¶å°†å…ƒç´ åŠ å…¥é›†åˆï¼Œç„¶ååˆ¤æ–­é›†åˆä¸­æ˜¯å¦å­˜åœ¨å¤§äºå½“å‰å…ƒç´ nums[i]å‰é¢çš„æœ€å°å…ƒç´ min[i]çš„å…ƒç´ ï¼Œå¦‚æœå­˜åœ¨ä¸”è¿™ä¸ªå…ƒç´ å°äºå½“å‰å…ƒç´ ï¼Œåˆ™è¿”å›true.å¦åˆ™ç›´åˆ°éå†ç»“æŸå¹¶è¿”å›false. 650.2 Keys Keyboard é¢˜ç›®æè¿° Initially on a notepad only one character â€˜Aâ€™ is present. You can perform two operations on this notepad for each step: Copy All: You can copy all the characters present on the notepad (partial copy is not allowed). Paste: You can paste the characters which are copied last time. Given a number n. You have to get exactly n â€˜Aâ€™ on the notepad by performing the minimum number of steps permitted. Output the minimum number of steps to get n â€˜Aâ€™. é¢˜ç›®åˆ†æ é¢˜ç›®æœ€ç»ˆåŒ–ç®€ä¸ºnçš„ç´ æ•°åˆ†è§£ï¼Œç„¶åå°†è´¨å› æ•°æ±‚å’Œ ä»£ç  12345678910111213141516public int minSteps(int n) &#123; int sum=0; if(n==1) return 0 ; if(n==2) return 2; for(int i=2; i*i&lt;=n;i++)&#123; while(n%i==0)&#123; sum+=i ; n/=i; &#125; &#125; if(n!=1) sum+=n; return sum ; &#125;","categories":[{"name":"é¢˜è§£","slug":"é¢˜è§£","permalink":"http://example.com/categories/%E9%A2%98%E8%A7%A3/"}],"tags":[{"name":"Leetcode","slug":"Leetcode","permalink":"http://example.com/tags/Leetcode/"}]},{"title":"Spring","slug":"Spring","date":"2018-04-15T08:27:20.000Z","updated":"2023-05-29T14:17:37.589Z","comments":true,"path":"2018/04/15/Spring/","link":"","permalink":"http://example.com/2018/04/15/Spring/","excerpt":"","text":"åˆæ¢Springç±»ä¼¼äºStruts2, Springä¹Ÿæ˜¯é€šè¿‡xmlé…ç½®æ–‡ä»¶æ¥å¯¹ç±»è¿›è¡Œæ“ä½œçš„ åœ¨Struts2ä¸­ï¼Œå¯¹äºè¡¨å•çš„æäº¤ï¼Œé€šè¿‡å°†è¡¨å•ä¸­æ ‡ç­¾çš„nameå±æ€§è®¾ç½®ä¸ºBeanä¸­å¯¹åº”çš„å±æ€§ï¼Œé€šè¿‡é…ç½®struts.xmlå¯ä»¥è®©æ¡†æ¶è‡ªå·±å»è°ƒç”¨å¯¹åº”çš„setterï¼Œè¿™é‡Œä¹Ÿæ˜¯ç±»ä¼¼ï¼Œåªä¸è¿‡è®¾ç½®çš„æ˜¯applicationContext.xml,è¿™ä¸ªé…ç½®æ–‡ä»¶å°†ä¼šå‘Šè¯‰å®¹å™¨å¦‚ä½•æ“ä½œå…·ä½“çš„ç±»ã€‚ çœ‹ä¸€æ®µä»£ç ï¼š beanåŒ…ä¸­ æ¥å£IPersonåŠå…¶å®ç°ç±» 123456package com.bean;public interface IPerson &#123; public void say();&#125; 123456789101112131415161718192021222324252627package com.bean;public class ChineseImp implements IPerson &#123; private String name ; private int age ; @Override public void say() &#123; System.out.println(&quot;I&#x27;m Chinese,my name is&quot;+this.name+&quot; my age is &quot;+this.age); &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125;&#125; 1234567891011121314151617181920212223242526272829package com.bean;import java.sql.SQLOutput;public class AmericanImp implements IPerson &#123; private String name ; private int age ; @Override public void say() &#123; System.out.println(&quot;I&#x27;m American,my name is &quot;+this.name+&quot; my age is&quot;+this.age); &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125;&#125; applicationContext.xml 12345678910111213141516171819202122&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt; &lt;bean id=&quot;chinese&quot; class=&quot;com.bean.ChineseImp&quot;&gt; &lt;property name=&quot;name&quot;&gt; &lt;value&gt;taochaoquan&lt;/value&gt; &lt;/property&gt; &lt;property name=&quot;age&quot;&gt; &lt;value&gt;23&lt;/value&gt; &lt;/property&gt; &lt;/bean&gt; &lt;bean id=&quot;american&quot; class=&quot;com.bean.AmericanImp&quot;&gt; &lt;property name=&quot;name&quot;&gt; &lt;value&gt;Arrow&lt;/value&gt; &lt;/property&gt; &lt;property name=&quot;age&quot;&gt; &lt;value&gt;12&lt;/value&gt; &lt;/property&gt; &lt;/bean&gt;&lt;/beans&gt; emmmmå†…å®¹æµ…æ˜¾æ˜“æ‡‚ï¼Œå°±ä¸è¯¦è¿°äº† æµ‹è¯•ç±» 1234567891011121314151617package com.spring;import com.bean.IPerson;import org.springframework.context.ApplicationContext;import org.springframework.context.support.ClassPathXmlApplicationContext;public class Test &#123; public static void main(String[] args) &#123; //åˆ›å»ºSpringå®¹å™¨ ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;); IPerson p1 = (IPerson) context.getBean(&quot;chinese&quot;); p1.say(); IPerson p2 = (IPerson) context.getBean(&quot;american&quot;); p2.say(); &#125;&#125; è¾“å‡º 12I&#x27;m Chinese,my name istaochaoquan my age is 23I&#x27;m American,my name is Arrow my age is12 æ§åˆ¶åè½¬å’Œä¾èµ–æ³¨å…¥ â€‹ ä¼ ç»Ÿçš„è®¾è®¡æ¨¡å¼ï¼šå‡å¦‚è°ƒç”¨è€…Aéœ€è¦è°ƒç”¨è¢«è°ƒç”¨è€…Bï¼Œé‚£ä¹ˆå®ƒå°±éœ€è¦newå‡ºä¸€ä¸ªBï¼Œè¿™æ ·çš„è¯ï¼ŒA,Bä¹‹é—´çš„è€¦åˆåº¦å°±ä¼šæ¯”è¾ƒé«˜ï¼Œå‡å¦‚è¯´åæœŸéœ€æ±‚å‘ç”Ÿäº†å˜åŒ–ï¼Œéœ€è¦å¾€Bä¸­æ·»åŠ å±æ€§ï¼Œé‚£ä¹ˆå°±å¾—ä¿®æ”¹é¡¹ç›®ä¸­è°ƒç”¨äº†Bå¤„çš„ç›¸å…³ä»£ç ã€‚ â€‹ ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼šå‡å¦‚è¯´Aéœ€è¦è°ƒç”¨Bï¼ŒSpringå®¹å™¨ä¼šè‡ªåŠ¨å°†Bçš„å®ä¾‹æ³¨å…¥åˆ°Aä¸­ï¼Œç›¸å½“äºæ­¤æ—¶Aæ‹¥æœ‰äº†Bï¼Œå½“é¡¹ç›®éœ€æ±‚å˜æ›´æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹Springçš„é…ç½®æ–‡ä»¶è€Œæ— éœ€ä¿®æ”¹ä»£ç  ä¸‹é¢ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜6 æœ‰ä¸€ä¸ªUserç±» 1234567891011121314151617181920212223package bean;public class User &#123; private String username ; private String password ; public String getUsername() &#123; return username; &#125; public void setUsername(String username) &#123; this.username = username; &#125; public String getPassword() &#123; return password; &#125; public void setPassword(String password) &#123; this.password = password; &#125;&#125; ç”¨æ¥å£UserDaoæ¥æ¨¡æ‹ŸæŒä¹…å±‚ 12345678package dao;import bean.User;public interface UserDao &#123; public void save(User user);&#125; 1234567891011package dao;import bean.User;public class UserDaoImp implements UserDao &#123; @Override public void save(User user) &#123; System.out.println(&quot;user has been saved in database&quot;); &#125;&#125; æœåŠ¡å±‚ 123456789package service;import bean.User;public interface UserService &#123; public void add( User user);&#125; 12345678910111213141516171819202122package service;import bean.User;import dao.UserDao;public class UserServiceImp implements UserService &#123; private UserDao userDao ; public UserDao getUserDao() &#123; return userDao; &#125; public void setUserDao(UserDao userDao) &#123; this.userDao = userDao; &#125; @Override public void add(User user) &#123; userDao.save(user); &#125;&#125; æµ‹è¯•ç±» 123456789101112131415161718package main;import bean.User;import org.springframework.context.ApplicationContext;import org.springframework.context.support.ClassPathXmlApplicationContext;import service.UserServiceImp;public class Test &#123; public static void main(String[] args) &#123; ApplicationContext context = new ClassPathXmlApplicationContext(&quot;beans.xml&quot;); UserServiceImp usi = (UserServiceImp) context.getBean(&quot;userService&quot;) ; User user = new User(); user.setUsername(&quot;tao&quot;); user.setPassword(&quot;123&quot;); usi.add(user); &#125;&#125; å¤§æ¦‚ä¸šåŠ¡é€»è¾‘å¦‚ä¸‹ï¼šæœ‰ä¸€ä¸ªæ–°çš„ç”¨æˆ·userï¼Œæˆ‘ä»¬æƒ³æŠŠå®ƒåŠ åˆ°ç”¨æˆ·åˆ—è¡¨ä¸­ï¼ŒUserServiceImpç±»ä¸­æä¾›äº†add()æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œaddæ–¹æ³•å†…éƒ¨å…¶å®æ˜¯è°ƒç”¨äº†UserDaoçš„saveæ–¹æ³•ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå½“Testç±»ä¸­çš„usi.add()ä¼ å…¥useråï¼Œåº”å½“éœ€è¦ä¸€ä¸ªUserDaoçš„å®ä¾‹æ¥æ‰§è¡Œsaveæ–¹æ³•ï¼Œè€Œåœ¨æˆ‘ä»¬çš„ä»£ç ä¸­å¹¶æ²¡æœ‰çœ‹åˆ°newå‡ºçš„å®ä¾‹ã€‚å…¶å®è¿™ä¸ªæ“ä½œå°±æ˜¯Springå®¹å™¨å¸®æˆ‘ä»¬åšçš„ï¼Œè¯·çœ‹ä¸‹é¢çš„é…ç½®æ–‡ä»¶ beans.xml 1234567891011&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt; &lt;bean id=&quot;udi&quot; class=&quot;dao.UserDaoImp&quot;&gt;&lt;/bean&gt; &lt;bean id=&quot;userService&quot; class=&quot;service.UserServiceImp&quot;&gt; &lt;property name=&quot;userDao&quot;&gt; &lt;ref bean=&quot;udi&quot;/&gt; &lt;/property&gt; &lt;/bean&gt;&lt;/beans&gt; è¿™é‡Œå…¶å®å°±æ˜¯æŠŠè¢«ä¾èµ–çš„UserDaoçš„å®ä¾‹æ³¨å…¥äº†UserServiceImpçš„å®ä¾‹ä¸­ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ä¾èµ–æ³¨å…¥ã€‚ å¯¹äºä¸Šé¢çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¦‚æœ æˆ‘ä»¬ä¸ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œåº”è¯¥æ˜¯è¿™æ ·çš„ï¼Œ1.åˆ›å»ºUserServiceImpå®ä¾‹ï¼Œ2.åˆ›å»ºUserDaoå®ä¾‹ï¼Œ3.é€šè¿‡UserServiceImpçš„setteræ–¹æ³•ï¼Œå»ºç«‹ä¸¤è€…ä¾èµ–ï¼Œ å¯ä»¥çœ‹å‡ºï¼Œä¾èµ–æ³¨å…¥å¸®æˆ‘ä»¬å®Œæˆäº†ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥ï¼Œå¾ˆå¥½çš„è§£è€¦äº†ä»–ä»¬çš„ä¾èµ–æ€§ Spring MVCé…ç½®DispatcherServlet å¤§æ¦‚å®Œæˆäº†ä¸€ä¸ªç®€å•demo,æˆ‘åªæƒ³è¯´ï¼Œæœ€åéƒ¨ç½²çš„æ—¶å€™å¹¶ä¸ç”¨åŠ é¡¹ç›®åç§°æ¥è®¿é—®ï¼Œç›´æ¥localhost:8008/welcomeå°±å¯ä»¥äº†ã€‚ æ³¨è§£ @PathVariable å½“ä½¿ç”¨@RequestMapping URI tempalteæ ·å¼æ˜ å°„æ—¶ï¼Œå³someUrl/{paramId},è¿™æ—¶çš„paramIdå¯é€šè¿‡@PathVariableæ³¨è§£å°†å…¶ç»‘å®šåˆ°æ–¹æ³•å‚æ•°ä¸Š 123456789@Controller @RequestMapping(&quot;/owners/&#123;ownerId&#125;&quot;) public class RelativePathUriTemplateController &#123; @RequestMapping(&quot;/pets/&#123;petId&#125;&quot;) public void findPet(@PathVariable String ownerId, @PathVariable String petId, Model model) &#123; // implementation omitted &#125; &#125; å‡å¦‚ä½¿ç”¨@PathVariableæ³¨è§£æ—¶å‚æ•°åå’ŒURI templateä¸­çš„ä¸ä¸€è‡´ï¼Œå¯ä»¥è¿™æ ·@PathVarible(&quot;name&quot;)å…¶ä¸­nameä¸ºURI templateä¸­çš„å˜é‡å @RequestHeader æŠŠrequest headerä¸­çš„æŸäº›å­—æ®µç»‘å®šåˆ°å‚æ•°ä¸Š @CookieValue æŠŠRequest headerä¸­å…³äºcookieçš„å€¼ç»‘å®šåˆ°å‚æ•°ä¸Š @RequestParamå’Œ@RequestBody @SessionAttributeå’Œ@ModelAttribute ç»‘å®šHttpSessionä¸­çš„attributeå¯¹è±¡çš„å€¼, @ModelAttributeæ³¨è§£æœ‰ä¸¤ä¸ªç”¨æ³•ï¼Œä¸€ä¸ªæ˜¯ç”¨äºæ–¹æ³•ä¸Šï¼Œä¸€ä¸ªæ˜¯ç”¨äºå‚æ•°ä¸Šã€‚ç”¨äºæ–¹æ³•ä¸Šæ—¶ï¼Œè¢«å…¶æ³¨é‡Šçš„æ–¹æ³•ä¼šåœ¨Controlleræ¯ä¸ªæ–¹æ³•æ‰§è¡Œå‰è¢«æ‰§è¡Œï¼Œå› æ­¤é€šå¸¸ç”¨æ¥åœ¨å¤„ç†@RequestMappingä¹‹å‰ä¸ºè¯·æ±‚ç»‘å®šéœ€è¦ä»åå°æŸ¥è¯¢çš„modelï¼›ç”¨äºå‚æ•°ä¸Šæ—¶ï¼Œç”¨æ¥é€šè¿‡åç§°å¯¹åº”æŠŠç›¸åº”åç§°çš„å€¼ç»‘å®šåˆ°æ³¨è§£çš„å‚æ•°beanä¸Š æ€»çš„æ¥è¯´ï¼Œæ³¨è§£å°±æ˜¯å®ç°äº†è¯·æ±‚çš„ç›¸å…³å€¼ä¸æ–¹æ³•å‚æ•°çš„ç»‘å®šã€‚ è¯·æ±‚å‚æ•°åå’Œjavaç±»çš„å±æ€§ç›¸åŒ¹é… æµ‹è¯•SpringMVC HttpRequest â€“&gt; DispatcherServlet â€“&gt; Handler Mapping â€“&gt; Controller â€“&gt; Model and View â€“&gt; DispatherServlet â€“&gt; View Resolver â€“&gt; Model","categories":[{"name":"JavaWeb","slug":"JavaWeb","permalink":"http://example.com/categories/JavaWeb/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"http://example.com/tags/Spring/"}]},{"title":"Intellijå¿«æ·é”®","slug":"Intellijå¿«æ·é”®","date":"2018-03-29T07:31:04.000Z","updated":"2023-05-29T14:17:39.325Z","comments":true,"path":"2018/03/29/Intellijå¿«æ·é”®/","link":"","permalink":"http://example.com/2018/03/29/Intellij%E5%BF%AB%E6%8D%B7%E9%94%AE/","excerpt":"","text":"alt+Enter çº é”™æç¤º ctrl+q æ˜¾ç¤ºå‡½æ•°æ³¨é‡Š ctrl+h æ˜¾ç¤ºç±»ç»§æ‰¿ç»“æ„","categories":[],"tags":[{"name":"æ•™ç¨‹","slug":"æ•™ç¨‹","permalink":"http://example.com/tags/%E6%95%99%E7%A8%8B/"}]},{"title":"javaå­¦ä¹ ç¬”è®°","slug":"javaå­¦ä¹ ç¬”è®°","date":"2018-03-14T06:57:25.000Z","updated":"2023-05-29T14:17:39.378Z","comments":true,"path":"2018/03/14/javaå­¦ä¹ ç¬”è®°/","link":"","permalink":"http://example.com/2018/03/14/java%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","excerpt":"","text":"ç»§æ‰¿ä¸è¦†ç›– å½“é€šè¿‡ä¸€ä¸ªçˆ¶ç±»çš„å¼•ç”¨æŒ‡å‘ä¸€ä¸ªå­ç±»çš„å¯¹è±¡åï¼Œå°†åªèƒ½é€šè¿‡è¿™ä¸ªçˆ¶ç±»çš„å¼•ç”¨è®¿é—®é‚£äº›çˆ¶ç±»ä¸­å®šä¹‰äº†çš„å±æ€§å’Œæ–¹æ³•ã€‚Javaå¹³å°çš„æ‰§è¡Œè§„åˆ™æ˜¯ï¼š åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œå¯ä»¥è°ƒç”¨å“ªäº›æ–¹æ³•ï¼Œè®¿é—®å“ªäº›å±æ€§ï¼Œæ˜¯å¼•ç”¨ç±»å‹å†³å®šçš„ï¼›åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œå…·ä½“è®¿é—®å“ªä¸ªå±æ€§ï¼Œæ‰§è¡Œå“ªä¸ªæ–¹æ³•ï¼Œæ˜¯å¯¹è±¡çš„ç±»å‹å†³å®šçš„ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå­ç±»ä¸­æœ‰è¿™ä¸ªæ–¹æ³•f1è€Œçˆ¶ç±»ä¸­æ²¡æœ‰ï¼Œé‚£ä¹ˆæŒ‡å‘å­ç±»çš„çˆ¶ç±»å¼•ç”¨æ˜¯ä¸èƒ½è°ƒç”¨å­ç±»çš„è¿™ä¸ªæ–¹æ³•f1çš„,åªæœ‰å½“å­ç±»å’Œçˆ¶ç±»æ‹¥æœ‰ä¸€æ ·çš„æ–¹æ³•ï¼ˆç»§æ‰¿æˆ–è€…è¦†ç›–å¾—åˆ°ï¼‰æ—¶ï¼ŒæŒ‡å‘å­ç±»çš„çˆ¶ç±»å¼•ç”¨æ‰å¯ä»¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”è°ƒç”¨çš„æ˜¯å­ç±»çš„æ–¹æ³•ã€‚ ä½¿ç”¨è¦†ç›–çš„å‡ æ¡è§„åˆ™ å­ç±»å¿…é¡»æŠŠè¿™ä¸ªæ–¹æ³•ä»çˆ¶ç±»ä¸­ç»§æ‰¿è¿‡æ¥ï¼Œè¿™ä¸ªä¸æ–¹æ³•çš„è®¿é—®æ§åˆ¶ç¬¦æœ‰å…³ç³»ï¼› å­ç±»æ–¹æ³•çš„è®¿é—®æ§åˆ¶ç¬¦çš„è®¿é—®æƒé™åº”æ¯”çˆ¶ç±»ä¸­çš„æ›´å®½æ¾æˆ–è€…ç›¸åŒ å­ç±»æ–¹æ³•è¿”å›å€¼ç±»å‹å¿…é¡»èƒ½èµ‹å€¼ç»™çˆ¶ç±»æ–¹æ³•è¿”å›å€¼ç±»å‹ å½“ç»§æ‰¿è¢«å¼•å…¥åˆ°é‡è½½çš„å‚æ•°ä¸­æ—¶ï¼Œå†³å®šå‡½æ•°é‡è½½çš„å“ªä¸ªæ–¹æ³•è¢«è°ƒç”¨çš„æ˜¯å®å‚ã€‚è¿™é‡Œçš„å®å‚æŒ‡çš„æ˜¯å¼•ç”¨çš„ç±»å‹ï¼Œè€Œä¸æ˜¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡çš„ç±»å‹ å¯¹äºé™æ€æ–¹æ³•ï¼ŒJavaä¼šæ ¹æ®å¼•ç”¨çš„ç±»å‹è€Œéå¼•ç”¨æŒ‡å‘çš„å¯¹è±¡çš„ç±»å‹æ¥å†³å®šè°ƒç”¨å“ªä¸ªé™æ€æ–¹æ³• å˜é‡çš„è¦†ç›–ï¼Œå˜é‡çš„å€¼å–å†³äºå¼•ç”¨ç±»å‹è€Œä¸æ˜¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ç±»å‹ å¤šæ€æ‰€è°“å¤šæ€ï¼ŒæŒ‡çš„æ˜¯åŒä¸€è¡Œä¸ºåœ¨ä¸åŒç¯å¢ƒä¸‹æœ‰ä¸åŒè¡¨ç°ã€‚ ä¸ºä»€ä¹ˆä¼šæœ‰å¤šæ€å‘¢ï¼Ÿä¸»è¦ç”±ä¸‰ä¸ªåŸå› é€ æˆï¼š ç»§æ‰¿ è¦†ç›– çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡ æ¥å£ä»€ä¹ˆæ˜¯æ¥å£å¦‚ä½•å®šä¹‰æ¥å£ ç¨‹åºä½¿ç”¨æ¥å£å¯ä»¥å¾ˆå¥½çš„é¿å…å¯¹å¤–éƒ¨ç±»çš„ä¾èµ–æ€§ï¼Œå› ä¸ºå¯¹å¤–åªéœ€è¦ä¸€ä¸ªæ¥å£ï¼Œä»»ä½•å®ç°äº†è¯¥æ¥å£çš„å¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’è¿‡å»ã€‚ ä¿å­˜æ¥å£çš„æ–‡ä»¶åä¹Ÿè¦å’Œæ¥å£åç›¸åŒ ```public abstract insterface æ¥å£å{ public static final int r =1; public abstract è¿”å›å€¼ æ–¹æ³•å(); } 12ä¹Ÿå¯ä»¥ç®€å•å†™ä¸º interface æ¥å£å{ int r =1 ; è¿”å›å€¼ æ–¹æ³•å() } 123456789101112#### æ€ä¹ˆä½¿ç”¨æ¥å£#### ä¸ºä»€ä¹ˆè¦ç”¨æ¥å£### æŠ½è±¡ç±»+ æ¥å£æ˜¯æŠ½è±¡çš„ï¼Œå¿…é¡»é€šè¿‡ç±»å®ç°å®ƒæ‰èƒ½ç”¨ï¼Œé™¤äº†æŠ½è±¡çš„æ¥å£ä¹‹å¤–ï¼Œè¿˜æœ‰æŠ½è±¡çš„ç±»ï¼Œå…¶å£°æ˜æ–¹æ³•ç±»ä¼¼ public abstract class Person{ private String name ; public Person(String name)&#123; this.name = name ; &#125; ... public abstract void introduceSelf(); } 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263 + æŠ½è±¡ç±»é¦–å…ˆæ˜¯ä¸€ä¸ªç±» + æŠ½è±¡ç±»ä¸­å¯ä»¥æ²¡æœ‰æŠ½è±¡æ–¹æ³• + ä¸€ä¸ªç±»å¦‚æœç»§æ‰¿äº†æŠ½è±¡ç±»ï¼Œè¦ä¹ˆè‡ªå·±å®ç°çˆ¶ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œè¦ä¹ˆå°†è‡ªå·±ä¹Ÿå£°æ˜ä¸ºæŠ½è±¡ç±» + ç±»ä¹Ÿå¯ä»¥é€šè¿‡æ¥å£æ¥è·å¾—æŠ½è±¡æ–¹æ³•+ ä¸ºä»€ä¹ˆè¦æœ‰æŠ½è±¡ç±» + ä»è¯­æ³•ä¸Šè®²ï¼Œæ˜¯ä¸ºäº†è®©å­ç±»å¼ºåˆ¶è¦†ç›–çˆ¶ç±»ä¸­çš„æŸäº›ç±»ï¼ˆæœ‰ç‚¹åƒc++ä¸­çš„è™šå‡½æ•°ï¼Ÿï¼‰ + ä»ä¸šåŠ¡ä¸Šè®²ï¼Œå¦‚æœæœ‰ä¸€ä¸ªçˆ¶ç±»çš„æ–¹æ³•ä¸åº”è¯¥è¢«è°ƒç”¨ï¼ˆå› ä¸ºè°ƒç”¨å®ƒæ²¡æœ‰å®é™…æ„ä¹‰çš„æƒ…å†µï¼‰ï¼Œæ­¤æ—¶åº”è¯¥ç”¨æŠ½è±¡ç±»ã€‚### å†…éƒ¨ç±»#### æˆå‘˜å†…éƒ¨ç±»å®šä¹‰åœ¨ç±»ä¸­çš„ç±»ï¼Œä¸ç±»ä¸­å…¶ä»–æˆå‘˜æ˜¯åŒä¸€é‡é‡çº§+ å†…éƒ¨ç±»å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œå› ä¸ºå®ƒä»¬æœ¬æ¥å°±æ˜¯åŒä¸€çº§åˆ«çš„+ å†…éƒ¨ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªæŒ‡å‘å¤–éƒ¨ç±»çš„å¼•ç”¨+ å¤–éƒ¨ç±»çš„ä»£ç è¦æƒ³è®¿é—®å†…éƒ¨ç±»çš„å¯¹è±¡ä¸­çš„å˜é‡ï¼Œéœ€è¦å…ˆåˆ›å»ºè¦ç»™å†…éƒ¨æˆå‘˜ç±»çš„å¯¹è±¡#### å±€éƒ¨å†…éƒ¨ç±»å®šä¹‰åœ¨ç±»ä¸­ä¸€ä¸ªæ–¹æ³•æˆ–è€…ä¸€ä¸ªä½œç”¨åŸŸä¸­çš„ç±»ï¼Œä¸æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡æ˜¯åŒä¸€çº§åˆ«çš„ã€‚å¯ä»¥ä½¿ç”¨å…¶æ‰€åœ¨æ–¹æ³•ä¸­çš„finalå˜é‡ä¸èƒ½åŒ…å«é™æ€æˆå‘˜+ é™æ€æ–¹æ³•ä¸­çš„å±€éƒ¨å†…éƒ¨ç±» + å—é™æ€æ–¹æ³•é™åˆ¶ï¼Œåªèƒ½è®¿é—®é™æ€å˜é‡å’Œæ–¹æ³•ä¸­çš„`final`å˜é‡+ éé™æ€æ–¹æ³•ä¸­çš„å±€éƒ¨å†…éƒ¨ç±» + éšå«æœ‰æŒ‡å‘å¤–éƒ¨ç±»çš„å¼•ç”¨#### åŒ¿åå†…éƒ¨ç±»+ æ²¡æœ‰åå­—+ ä¸èƒ½æ·»åŠ æ„é€ æ–¹æ³•+ æ²¡æœ‰ä¿®é¥°ç¬¦+ é€šè¿‡æ¥å£æ¥ä½¿ç”¨åŒ¿åç±»+ é€šè¿‡æŠ½è±¡ç±»æ¥ä½¿ç”¨åŒ¿åç±»#### é™æ€å†…éƒ¨ç±»+ æ˜¯ç±»èŒƒç•´ä¸­çš„å…ƒç´ ï¼Œå…¶ä¸­ä¸å«æŒ‡å‘å¤–éƒ¨ç±»å¯¹è±¡çš„å…ƒç´ ï¼Œæ‰€ä»¥ä¸èƒ½åœ¨é™æ€æˆå‘˜å†…éƒ¨ç±»ä¸­ä½¿ç”¨å¤–éƒ¨ç±»ä¸­çš„éé™æ€ æˆå‘˜+ é™æ€æˆå‘˜åªèƒ½è®¿é—®é™æ€æˆå‘˜### Javaå¼‚å¸¸+ å¼‚å¸¸æŠ›å‡º+ å¼‚å¸¸ä¼ é€’ + ä»æŸä¸ªæ–¹æ³•ä¸­çš„æŸä¸ª`throw`è¯­å¥ä¼ é€’åˆ°è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„åœ°æ–¹ï¼Œä¸€ç›´åˆ°`main`æ–¹æ³• + å¼‚å¸¸å¿…é¡»è¢«ä¼ é€’å‡ºå»æˆ–è€…å¤„ç†æ‰ + æŠ›å‡ºå¼‚å¸¸ä½ç½®åé¢çš„ä»£ç ä¸ä¼šè¢«æ‰§è¡Œ+ å¼‚å¸¸å¤„ç† try{ //å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸çš„ä»£ç  }catch(å¼‚å¸¸ç±»å‹1 å¼‚å¸¸å¼•ç”¨1){ //å¦‚æœæŠ›å‡ºçš„å¼‚å¸¸ä¸æ­¤å¤„çš„å¼‚å¸¸ç±»å‹åŒ¹é…ï¼Œç”¨å¼‚å¸¸å¼•ç”¨æŒ‡å‘tryä¸­çš„å¼‚å¸¸å®ä¾‹ //å¤„ç†å¼‚å¸¸ }catch(å¼‚å¸¸ç±»å‹2 å¼‚å¸¸å¼•ç”¨2){ }finally{ /*`finally`è¯­å¥ä¸­çš„ä»£ç æ— è®ºå¦‚ä½•éƒ½ä¼šè¢«æ‰§è¡Œï¼Œæ— è®ºä¸Šé¢çš„catchè¿‡ç¨‹æ˜¯åŒ¹é…åˆ°å¼‚å¸¸å¤„ç†æ‰äº†è¿˜æ˜¯å°†å¼‚å¸¸ æŠ›å‡ºï¼Œéƒ½ä¼šæ‰§è¡Œfinallyå—ï¼Œå¦‚æœå¼‚å¸¸è¢«å¤„ç†æ‰äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æ‰§è¡Œfinally,å¦‚æœå¼‚å¸¸æ²¡æœ‰è¢«åŒ¹é…ï¼Œé‚£ä¹ˆ å…ˆæ‰§è¡Œfinally,å†æŠ›å‡ºå¼‚å¸¸ */ /*finallyè¯­å¥é€šå¸¸ä¸è¢«é‡åˆ°ï¼Œä¸€ç§å…¸å‹ä½¿ç”¨æƒ…å†µæ˜¯ç”¨æ¥é‡Šæ”¾èµ„æº*/ } 1 try{}finally{ } 1234567 å…³äºå¼‚å¸¸çš„æ•è·ï¼Œæˆ‘ä»¬å¯ä»¥åšçš„ä¸ä»…ä»…æ˜¯å°†å…¶æ‰“å°è¾“å‡ºï¼Œä¹Ÿå¯ä»¥åœ¨`catch`è¯­å¥é‡Œå¯¹å¼‚å¸¸è¿›è¡Œä¿®æ”¹### Javaå¤šçº¿ç¨‹+ å¤šçº¿ç¨‹ public class UseRunnable { public static void main(String args[]) throws InterruptedException &#123; //æ˜¾ç¤ºä¸»çº¿ç¨‹çš„åå­— System.out.println(&quot;current thread name is: &quot;+Thread.currentThread().getName()); System.out.println(&quot;program will be executed after 5000 ms&quot;); //è¿™é‡Œçš„Threadæ–¹æ³•å’ŒcurrentThreadæ–¹æ³•ä¸€æ ·ï¼Œéƒ½æ˜¯é™æ€æ–¹æ³• Thread.sleep(5000); MyRunnable runnable = new MyRunnable(); Thread thread = new Thread(runnable); //è¿™é‡Œä¹Ÿå¯ä»¥é€šè¿‡åŒ¿åç±»çš„æ–¹å¼å®ç°Runnable /* * Thread thread = new Thread(new Runnable()&#123; * public void run()&#123; * System.out.println(&quot;this is my runnable in anther way&quot;) * &#125; * &#125;) * */ thread.start(); MyThread mythread = new MyThread(); mythread.start(); &#125; } /methond 1/class MyRunnable implements Runnable{ //é€šè¿‡ç»§æ‰¿æ¥å£çš„æ–¹å¼æ¥å®ç°çº¿ç¨‹ @Override public void run() &#123; System.out.println(&quot;this is my runnable&quot;); &#125; } /*å…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç»§æ‰¿Threadç±»æ¥å®ç°*è¿™æ ·åšæœ‰ä¸ªæ˜¾è‘—çš„ä¸å¥½ï¼Œjavaä¸­ç±»æ˜¯å•ç»§æ‰¿çš„ï¼Œå¦‚æœä¸ºäº†ä½¿ç”¨çº¿ç¨‹è€Œå»ç»§æ‰¿Threadç±»ï¼Œ é‚£å°†ä¸èƒ½ç»§æ‰¿å…¶ä»–ç±»ï¼Œæ‰€ä»¥è¿˜æ˜¯å®ç°æ¥å£çš„æ–¹å¼å¥½ä¸€äº›*/ /method 2/class MyThread extends Thread{ //Threadç±»æœ‰ä¸€ä¸ªå‚æ•°ä¸ºç©ºçš„æ„é€ æ–¹æ³• public void run()&#123; System.out.println(&quot;this is my thread&quot;); &#125; 123456789101112131415161718192021 + synchronizedå…³é”®å­— å½“æŸä¸ªæ–¹æ³•åªå…è®¸åŒä¸€æ—¶é—´åªè¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®æ—¶ï¼Œå¯ä»¥ç”¨synchronizedå…³é”®å­—æ¥ä¿®é¥°è¿™ä¸ªæ–¹æ³• + `public synchronized static void func()` å½“synchronizedä¿®é¥°é™æ€æ–¹æ³•æ—¶ï¼Œæ˜¯ç±»èŒƒç•´å†…çš„åŒæ­¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŠ å…¥æŸç±»æœ‰å¤šä¸ªé™æ€åŒæ­¥æ–¹æ³•ï¼Œé‚£ä¹ˆå½“å…¶ä¸­ä¸€ä¸ªæ–¹æ³•è¢«ç¬¬ä¸€ä¸ªçº¿ç¨‹è®¿é—®æ—¶ï¼Œå½“ç¬¬äºŒä¸ªçº¿ç¨‹è¯•å›¾è®¿é—®è¿™ä¸ªç±»ä¸­çš„ä»»æ„ä¸€ä¸ªé™æ€åŒæ­¥æ–¹æ³•æ—¶ï¼Œå®ƒéƒ½ä¼šè¢«æŒ‚èµ·ã€‚ä½†æ˜¯ä¸åŒç±»ä¸­çš„é™æ€æ–¹æ³•äº’ä¸å½±å“ã€‚ + `public synchronized void func()` å¯¹è±¡èŒƒç•´çš„åŒæ­¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æŸä¸ªçº¿ç¨‹è®¿é—®è¯¥å¯¹è±¡ä¸­çš„éé™æ€åŒæ­¥æ–¹æ³•æ—¶ï¼Œå¦‚æœå¦ä¸€çº¿ç¨‹è¯•å›¾è®¿é—®åŒä¸€ä¸ªå¯¹è±¡ä¸­çš„ä»»æ„éé™æ€åŒæ­¥æ–¹æ³•æ—¶ï¼Œå®ƒå°†è¢«æŒ‚èµ· + + wait()å’Œnotify() package top.iamnewbie; public class UseWaitAndNotify { public static void main(String[] args) &#123; Object obj = new Object(); Waiting waiting = new Waiting(obj); Notifier notifier = new Notifier(obj); //æ³¨æ„,è¿™é‡Œä½¿ç”¨åŒä¸€å¯¹è±¡åˆå§‹åŒ–Waitingå’ŒNotifier //å› ä¸ºWaitingå’ŒNotifieréƒ½å®ç°äº†Runnableæ¥å£ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ä»–ä»¬æ¥åˆå§‹åŒ–Threadç±» Thread thread1 = new Thread(waiting,&quot;çº¿ç¨‹1&quot;); Thread thread2 = new Thread(notifier,&quot;çº¿ç¨‹2&quot;); //é€šè¿‡startå‡½æ•°æ¥è§¦å‘Runnableçš„runå‡½æ•° thread1.start(); thread2.start(); &#125; } //å®ƒå®ç°äº†Runnableæ¥å£ï¼Œåœ¨Threadä¸­å°†è¿™ä¸ªç±»çš„å®ä¾‹ä½œä¸ºå‚æ•°å°±å¯ä»¥åˆ›å»ºçº¿ç¨‹class Waiting implements Runnable{ private Object waitObj ; public Waiting(Object obj) &#123; this.waitObj = obj; &#125; @Override public void run() &#123; System.out.println(Thread.currentThread().getName()+&quot;å°†è¢«æŒ‚èµ·&quot;); synchronized (waitObj)&#123; try &#123; waitObj.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; System.out.println(Thread.currentThread().getName()+&quot;è¢«å”¤é†’&quot;); &#125; } class Notifier implements Runnable{ private Object notifyObj ; public Notifier(Object notifyObj) &#123; this.notifyObj = notifyObj; &#125; @Override public void run() &#123; System.out.println(&quot;å¼€å§‹notifyçº¿ç¨‹&quot;); try &#123; Thread.sleep(5000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; synchronized (notifyObj)&#123; notifyObj.notify(); &#125; System.out.println(&quot;notifyçº¿ç¨‹ç»“æŸ&quot;); &#125; } 123åŒæ­¥ä»£ç å—ï¼Œè¯­æ³•å¦‚ä¸‹ synchronized(å¯¹è±¡å¼•ç”¨){ åŒæ­¥ä»£ç  } 12345678910111213141516171819202122232425262728293031323334353637 å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒæ­¥ä»£ç å—ï¼Œè€Œä¸”åŒæ­¥ä»£ç å—ä¸­å¯¹è±¡çš„å¼•ç”¨æŒ‡å‘çš„æ˜¯åŒä¸€å¯¹è±¡ï¼Œé‚£ä¹ˆå°±åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è¿›å…¥ä»£ç å—æ‰§è¡Œã€‚ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä¸¤ä¸ªç±»ä¸­éƒ½å†™äº†åŒæ­¥ä»£ç å—ï¼Œåœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œå¯ä»¥å‘ç°ï¼Œç”¨çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡å®ä¾‹æ¥åˆå§‹åŒ–`Waiting`å’Œ`Notifier`,ä¹Ÿå°±æ˜¯è¯´è™½ç„¶åŒæ­¥ä»£ç å—æ˜¯åœ¨ä¸¤ä¸ªå¯¹è±¡ä¸­ï¼Œä½†æ˜¯åŒæ­¥ä»£ç å—ä¸­å¯¹è±¡çš„å¼•ç”¨æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼ˆè¿™ä¹Ÿæ˜¯å°†ä¸¤ä¸ªçº¿ç¨‹è”ç³»èµ·æ¥çš„å…³é”®ï¼‰ã€‚è¿›å…¥ä»£ç å—æ—¶ï¼Œç»™å¯¹è±¡åŠ é”ï¼Œæ‰§è¡Œwait()æ–¹æ³•æ—¶ï¼Œå»æ‰é”ï¼Œæ­¤æ—¶çº¿ç¨‹1è¢«æŒ‚èµ·ï¼ŒåŒæ—¶`obj`å¯¹è±¡ä¹Ÿæ²¡æœ‰è¢«åŠ é”ï¼Œè¿™æ—¶å€™çº¿ç¨‹2å°±å¯ä»¥è®¿é—®è¿™ä¸ªä»£ç å—äº†ï¼Œä½¿ç”¨è¿‡synchronizedå…ˆåŠ é”ï¼Œæ‰§è¡Œnotifyåè§£é” é€šç¯‡æ¥çœ‹ï¼Œæ­£æ˜¯å› ä¸ºåˆå§‹åŒ–ä¸¤ä¸ªå¯¹è±¡ç”¨äº†åŒä¸€å¯¹è±¡ï¼Œè¿™æ‰è®©ä¸¤ä¸ªçº¿ç¨‹å»ºç«‹äº†å…³è”ã€‚### IOæ¥ä¸€å¼ è¾“å…¥æµå’Œè¾“å‡ºæµçš„ç±»å±‚æ¬¡å›¾![](https://ws1.sinaimg.cn/large/005UcYzagy1ftkxcjom5ij30n50nd45y.jpg)+ å…³äºå‡ ä¸ªç±» + Fileç±» æ–‡ä»¶å’Œæ–‡ä»¶å¤¹éƒ½ç”¨Fileç±»æ¥è¡¨ç¤º + `InputStream`å’Œ`OutputStream` Javaä¸­çš„è¾“å…¥æµå’Œè¾“å‡ºæµ + `Writer` Abstract class for writing to character streams. The only methods that a subclass must implement are write(char[], int, int), flush(), and close(). Most subclasses, however, will override some of the methods defined here in order to provide higher efficiency, additional functionality, or both. + `PrintWriter` `Writer`çš„å­ç±»ï¼Œå°†å¯¹è±¡æ ¼å¼åŒ–æ‰“å°åˆ°æ–‡ä»¶ä¸­ + + è¯»å†™æ•°æ® + å‘æ–‡ä»¶ä¸­å†™æ•°æ®ï¼ˆå‡è®¾æ–‡ä»¶å·²å­˜åœ¨ï¼‰ + `PrintWriter` PrintWriter printWriter = new PrintWriter(new FileOutputStream(filename)); printWriter.write(â€œwrite somethingâ€); printWriter.close(); 123456789 `PrintWriter()`æ¥å—çš„å‚æ•°ç±»å‹ä¸»è¦æœ‰![](https://ws1.sinaimg.cn/large/005UcYzagy1fpvrurtcrcj30qf0gg0ts.jpg)è¿™é‡Œçœ‹ä¸Šå»ä¸å…³è¾“å‡ºæµä»€ä¹ˆäº‹ï¼Œä½†å…¶å®å®ƒå·²ç»è•´å«åœ¨`PrintWriter`ç±»é‡Œé¢äº†.+ `BufferdWriter` BufferedWriter out=new BufferedWriter(new FileWriter(fileName)); out.write(&quot;Hello BufferWriter&quot;); out.close(); 1234567 `BufferdWriter()`æ¥å—çš„å‚æ•°ç±»å‹ ![](https://ws1.sinaimg.cn/large/005UcYzagy1fpvrwofyqzj30nr054t8t.jpg)+ `FileWriter` FileWriter writer=new FileWriter(fileName,true); writer.write(&quot;write something&quot;); writer.close(); 12345678910111213 `FileWriter()`æ¥å—çš„å‚æ•°ç±»å‹ ![](https://ws1.sinaimg.cn/large/005UcYzagy1fpvryi3ajmj30un0a8gm4.jpg) æ€»ç»“ä¸€ä¸‹ï¼Œå†™æ–‡ä»¶çš„è¯ä¸€èˆ¬ç”¨çš„å°±æ˜¯Writerçš„å­ç±»ï¼Œ+ è¯»æ–‡ä»¶ fileReader = new FileReader(file1); bufferedReader1 = new BufferedReader(fileReader); while((content1=bufferedReader1.readLine()) != null){ System.out.println(content1); } fileReader.close(); 1234567891011121314151617181920212223242526272829 ### Swing+ åŸºæœ¬æµç¨‹ åˆ›å»ºä¸€ä¸ªçª—å£`JFrame`,è¿›è¡ŒåŸºç¡€è®¾ç½®ï¼Œè·å¾—Containerå¯¹è±¡ï¼Œå‘é‡Œé¢æ·»åŠ å…¶ä»–ç»„ä»¶Â·### Java Collection Framework![](https://ws1.sinaimg.cn/large/005UcYzagy1fv5utslrw5j30lr0ijjui.jpg)#### ç›¸äº’åŒºåˆ«`ArrayList`åº•å±‚å®ç°æ˜¯æ•°ç»„ï¼Œå¯ä»¥å­˜å‚¨null, æ²¡æœ‰è¿›è¡ŒåŒæ­¥æªæ–½ï¼Œä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå½“æ•°ç»„å®¹é‡ä¸å¤Ÿæ—¶ï¼Œéœ€è¦æ‰©å®¹ã€‚`LinkedList`åŒæ—¶å®ç°äº†Listå’ŒDequeæ¥å£ï¼Œæ‰€ä»¥å®ƒæ—¢å¯ä»¥çœ‹ä½œä¸€ä¸ªé¡ºåºå®¹å™¨ï¼Œåˆå¯ä»¥çœ‹ä½œé˜Ÿåˆ—ï¼Œåˆå¯ä»¥çœ‹ä½œæ ˆã€‚ï¼ˆæˆ‘å¯¹Dequeçš„ç†è§£å°±æ˜¯åŒç«¯é˜Ÿåˆ—Double end queueï¼‰,å®ƒçš„åº•å±‚å®ç°æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚ä¸ºäº†æ•ˆç‡`LinkedList`åŒæ ·æ²¡æœ‰å®ç°åŒæ­¥ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®ï¼Œå¯ä»¥ç”¨`Collection.synchronizedList()`æ–¹æ³•å¯¹å…¶è¿›è¡ŒåŒ…è£…ã€‚Stack ç±»ç»§æ‰¿è‡ªVector, Javaå·²ä¸æ¨èä½¿ç”¨Stack, è€Œæ˜¯æ¨èä½¿ç”¨`ArrayDeque`ï¼ˆç»§æ‰¿è‡ªDequeï¼‰,`ArrayDeque`ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œéœ€è¦æ‰‹åŠ¨åŒæ­¥ï¼Œå…¶ä¸­ä¸å…è®¸æ”¾å…¥null. `ArrayDeque`åº•å±‚ä¹Ÿæ˜¯æ•°ç»„å®ç°ï¼Œä½œä¸ºåŒç«¯é˜Ÿåˆ—ï¼Œè‚¯å®šéœ€è¦åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦æ»¡äº†ï¼Œå¦‚æœæ»¡äº†è¦è¿›è¡Œæ‰©å®¹æ“ä½œï¼Œè™½ç„¶è¿™ä¸ªå·¥ä½œAPIå†…éƒ¨å°±å®Œæˆäº†ï¼Œä½†æ˜¯åœ¨çœ‹å®ƒçš„å®ç°æ—¶ï¼Œæˆ‘çš„è¡¨æƒ…æ˜¯è¿™æ ·çš„ï¼Œ![](https://ws1.sinaimg.cn/large/005UcYzagy1fv5x4qelgdj305n064dfs.jpg)æ•°æ®ç»“æ„ä¹¦ä¸Šè®²çš„åˆ¤æ–­é˜Ÿåˆ—æ»¡çš„æ–¹æ³•æ˜¯å–æ¨¡ï¼Œè¿™é‡Œå®ƒæ˜¯è¿™ä¹ˆå®ç°çš„ public void addFirst(E e) { if (e == null)//ä¸å…è®¸æ”¾å…¥null throw new NullPointerException(); elements[head = (head - 1) &amp; (elements.length - 1)] = e;//2.ä¸‹æ ‡æ˜¯å¦è¶Šç•Œ if (head == tail)//1.ç©ºé—´æ˜¯å¦å¤Ÿç”¨ doubleCapacity();//æ‰©å®¹ } 12345678910111213141516171819202122232425262728293031323334353637383940414243é€šè¿‡ä½è¿ç®—æ¥å®ç°çš„ï¼Œå› ä¸ºArrayæ¯æ¬¡æ‰©å®¹éƒ½æ˜¯æŒ‰å€æ•°å¢é•¿ï¼Œæ‰€ä»¥å®ƒçš„å®¹é‡æ˜¯2çš„æ¬¡å¹‚ï¼Œé‚£ä¹ˆç”¨head-1æ¥å’Œlength-1è¿›è¡Œä¸è¿ç®—ï¼Œå°±å¯ä»¥æ±‚æ¨¡äº†ï¼Œæƒ³æƒ³é€šè¿‡ä½è¿ç®—æ¥æ±‚æ¨¡è‚¯å®šä¼šèŠ‚çœå¾ˆå¤šæ—¶é—´å•Šã€‚çœŸçš„æ˜¯![](https://ws1.sinaimg.cn/large/005UcYzagy1fv5x90s09xj308o08c3yk.jpg)##### Vector å’Œ `ArrayList`1. vector æ˜¯çº¿ç¨‹åŒæ­¥çš„ï¼Œæ‰€ä»¥å®ƒä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œ `ArrayList` æ˜¯çº¿ç¨‹å¼‚æ­¥çš„ï¼Œæ˜¯ä¸å®‰å…¨çš„ã€‚å¦‚æœä¸è€ƒè™‘åˆ°çº¿ç¨‹çš„å®‰å…¨å› ç´ ï¼Œä¸€èˆ¬ç”¨ `ArrayList` æ•ˆç‡æ¯”è¾ƒé«˜ã€‚2. å¦‚æœé›†åˆä¸­çš„å…ƒç´ çš„æ•°ç›®å¤§äºç›®å‰é›†åˆæ•°ç»„çš„é•¿åº¦æ—¶ï¼Œvector å¢é•¿ç‡ä¸ºç›®å‰æ•°ç»„é•¿åº¦çš„100%,è€Œ arraylist å¢é•¿ç‡ä¸ºç›®å‰æ•°ç»„é•¿åº¦çš„50%.å¦‚è¿‡åœ¨é›†åˆä¸­ä½¿ç”¨æ•°æ®é‡æ¯”è¾ƒå¤§çš„æ•°æ®ï¼Œç”¨ vector æœ‰ä¸€å®šçš„ä¼˜åŠ¿ã€‚3. å¦‚æœæŸ¥æ‰¾ä¸€ä¸ªæŒ‡å®šä½ç½®çš„æ•°æ®ï¼Œvector å’Œ arraylist ä½¿ç”¨çš„æ—¶é—´æ˜¯ç›¸åŒçš„ï¼Œéƒ½æ˜¯0(1),è¿™ä¸ªæ—¶å€™ä½¿ç”¨ vector å’Œ arraylist éƒ½å¯ä»¥ã€‚è€Œå¦‚æœç§»åŠ¨ä¸€ä¸ªæŒ‡å®šä½ç½®çš„æ•°æ®èŠ±è´¹çš„æ—¶é—´ä¸º 0(n-i)n ä¸ºæ€»é•¿åº¦ï¼Œè¿™ä¸ªæ—¶å€™å°±åº”è¯¥è€ƒè™‘åˆ°ä½¿ç”¨ linklist,å› ä¸ºå®ƒç§»åŠ¨ä¸€ä¸ªæŒ‡å®šä½ç½®çš„æ•°æ®æ‰€èŠ±è´¹çš„æ—¶é—´ä¸º 0(1),è€ŒæŸ¥è¯¢ä¸€ä¸ªæŒ‡å®šä½ç½®çš„æ•°æ®æ—¶èŠ±è´¹çš„æ—¶é—´ä¸º 0(i)ã€‚ArrayList å’Œ Vector æ˜¯é‡‡ç”¨æ•°ç»„æ–¹å¼å­˜å‚¨æ•°æ®ï¼Œæ­¤æ•°ç»„å…ƒç´ æ•°å¤§äºå®é™…å­˜å‚¨çš„æ•°æ®ä»¥ä¾¿å¢åŠ å’Œæ’å…¥å…ƒç´ ï¼Œéƒ½å…è®¸ç›´æ¥åºå·ç´¢å¼•å…ƒç´ ï¼Œä½†æ˜¯æ’å…¥æ•°æ®è¦è®¾è®¡åˆ°æ•°ç»„å…ƒç´ ç§»åŠ¨ ç­‰å†…å­˜æ“ä½œï¼Œæ‰€ä»¥ç´¢å¼•æ•°æ®å¿«æ’å…¥æ•°æ®æ…¢ï¼ŒVector ç”±äºä½¿ç”¨äº† synchronized æ–¹æ³•ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰æ‰€ä»¥æ€§èƒ½ä¸Šæ¯”ArrayList è¦å·®ï¼ŒLinkedList ä½¿ç”¨åŒå‘é“¾è¡¨å®ç°å­˜å‚¨ï¼ŒæŒ‰åºå·ç´¢å¼•æ•°æ®éœ€è¦è¿›è¡Œå‘å‰æˆ–å‘åéå†ï¼Œä½†æ˜¯æ’å…¥æ•°æ®æ—¶åªéœ€è¦è®°å½•æœ¬é¡¹çš„å‰åé¡¹å³å¯ï¼Œæ‰€ä»¥æ’å…¥æ•°åº¦è¾ƒå¿«ï¼##### arraylist å’Œ linkedlist1. ArrayList æ˜¯å®ç°äº†åŸºäºåŠ¨æ€æ•°ç»„çš„æ•°æ®ç»“æ„ï¼ŒLinkedList åŸºäºé“¾è¡¨çš„æ•°æ®ç»“æ„ã€‚ 2.å¯¹äºéšæœºè®¿é—® get å’Œ setï¼ŒArrayList è§‰å¾—ä¼˜äº LinkedListï¼Œå› ä¸º LinkedList è¦ç§»åŠ¨æŒ‡é’ˆã€‚ 3.å¯¹äºæ–°å¢å’Œåˆ é™¤æ“ä½œ add å’Œ removeï¼ŒLinedList æ¯”è¾ƒå ä¼˜åŠ¿ï¼Œå› ä¸º ArrayList è¦ç§»åŠ¨æ•°æ®ã€‚ è¿™ä¸€ç‚¹è¦çœ‹å®é™…æƒ…å†µçš„ã€‚è‹¥åªå¯¹å•æ¡æ•°æ®æ’å…¥æˆ–åˆ é™¤ï¼ŒArrayList çš„é€Ÿåº¦åè€Œä¼˜äº LinkedListã€‚ä½†è‹¥æ˜¯æ‰¹é‡éšæœºçš„æ’å…¥åˆ é™¤æ•°æ®ï¼ŒLinkedList çš„é€Ÿåº¦å¤§å¤§ä¼˜äº ArrayList. å› ä¸º ArrayList æ¯æ’å…¥ä¸€æ¡æ•°æ®ï¼Œè¦ç§»åŠ¨æ’å…¥ç‚¹åŠä¹‹åçš„æ‰€æœ‰æ•°æ®ã€‚#### HashMap### Javaè‡ªåŠ¨æ‹†è£…ç®±==æ¯”è¾ƒçš„æ˜¯å¯¹è±¡åº”ç”¨ï¼Œequalsæ¯”è¾ƒçš„æ˜¯å€¼åœ¨Java 5ä¸­ï¼Œåœ¨Integerçš„æ“ä½œä¸Šå¼•å…¥äº†ä¸€ä¸ªæ–°åŠŸèƒ½æ¥èŠ‚çœå†…å­˜å’Œæé«˜æ€§èƒ½ã€‚æ•´å‹å¯¹è±¡é€šè¿‡ä½¿ç”¨ç›¸åŒçš„å¯¹è±¡å¼•ç”¨å®ç°äº†ç¼“å­˜å’Œé‡ç”¨ã€‚&gt; é€‚ç”¨äºæ•´æ•°å€¼åŒºé—´-128 è‡³ +127ã€‚&gt;&gt;&gt;&gt; åªé€‚ç”¨äºè‡ªåŠ¨è£…ç®±ã€‚ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡ä¸é€‚ç”¨ã€‚### Javaä¸­çš„String#### å…³äºå­—ç¬¦ä¸²å¸¸é‡æ± è€ƒè™‘ä»¥ä¸‹ä»£ç  String s1 = â€œtaochqâ€ ; ï¼ˆ1ï¼‰String s2 = new String(â€œtaochqâ€) ; ï¼ˆ2ï¼‰String s3 = new String(â€œtaochqâ€).intern() ; ï¼ˆ3ï¼‰ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455JVMä¸ºäº†æé«˜æ€§èƒ½å’Œå‡å°‘å†…å­˜å¼€é”€ï¼Œåœ¨å®ä¾‹åŒ–å­—ç¬¦ä¸²å¸¸é‡çš„æ—¶å€™è¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–ï¼Œå­—ç¬¦ä¸²ç±»ç»´æŠ¤äº†ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡æ± ã€‚æ‰§è¡Œä»£ç ï¼ˆ1ï¼‰çš„æ—¶å€™ï¼Œjvmä¼šæ£€æŸ¥å¸¸é‡æ± ä¸­æœ‰æ²¡æœ‰â€œtaochqâ€è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œæ²¡æœ‰åˆ™åˆ›å»ºå¹¶è¿”å›å¼•ç”¨ï¼ˆæ³¨æ„è¿™ä¸ªå¼•ç”¨æ˜¯æŒ‡å‘å­—ç¬¦ä¸²å¸¸é‡æ± çš„ï¼‰ï¼Œæœ‰çš„è¯åˆ™ç›´æ¥è¿”å›å®ƒçš„å¼•ç”¨ã€‚æ‰§è¡Œï¼ˆ2ï¼‰çš„æ—¶å€™ï¼Œs2æ˜¯åœ¨æ ˆä¸Šï¼Œå †ä¸Šä¼šåˆ›å»ºä¸€ä¸ªStringå¯¹è±¡ï¼Œå®ƒæŒ‡å‘å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„&quot;taochq&quot;,æ‰€ä»¥s2æŒ‡å‘çš„æ˜¯å †ä¸Šçš„ä¸€ä¸ªåœ°å€ã€‚æ‰§è¡Œï¼ˆ3ï¼‰çš„æ—¶å€™ï¼Œå› ä¸ºè°ƒç”¨äº†intern()æ–¹æ³•ï¼ŒJVMä¼šæ£€æŸ¥å¸¸é‡æ± ä¸­æ˜¯å¦æœ‰ç›¸åŒçš„çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥è¿”å›å¼•ç”¨ï¼ˆæ³¨æ„è¿™é‡Œçš„å¼•ç”¨ä¹Ÿæ˜¯æŒ‡å‘å­—ç¬¦ä¸²å¸¸é‡æ± çš„ï¼‰ï¼Œå¦‚æœæ²¡æœ‰åˆ™å°†å­—ç¬¦ä¸²æ”¾å…¥å¸¸é‡æ± å¹¶è¿”å›å®ƒçš„å¼•ç”¨ã€‚çœ‹åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½ä¼šè§‰å¾—ï¼Œä»£ç ï¼ˆ1ï¼‰å’Œä»£ç ï¼ˆ3ï¼‰å®ç°çš„æ•ˆæœå·®ä¸å¤šå•Šï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰`intern()`è¿™ä¸ªæ–¹æ³•å‘¢ï¼Œå…¶å®æ˜¯æœ‰åŒºåˆ«çš„ã€‚è¦çŸ¥é“ï¼Œå¸¸é‡æ± ä¿å­˜çš„æ˜¯**å·²ç¡®å®š**çš„å­—ç¬¦ä¸²ï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå°±æ˜¯è¯´å¾ˆå¤šæ—¶å€™æˆ‘ä»¬åœ¨ç¨‹åºä¸­ç”¨åˆ°çš„å­—ç¬¦ä¸²éƒ½æ˜¯åœ¨ç¼–è¯‘å™¨æ— æ³•ç¡®å®šçš„ï¼Œåªæœ‰åœ¨è¿è¡Œæ—¶æ‰çŸ¥é“è¿™ä¸ªå­—ç¬¦ä¸²ç¡®åˆ‡æ˜¯å•¥ï¼Œå¯¹äºè¿™ç§æƒ…å†µï¼Œä½¿ç”¨internè¿›è¡Œå®šä¹‰ï¼Œæ¯æ¬¡ç¨‹åºæ‰§è¡Œåˆ°è¿™é‡Œçš„æ—¶å€™ç›´æ¥è¿”å›å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥å‡å°‘å †ä¸Šå¯¹è±¡çš„åˆ›å»ºã€‚è€Œå¯¹äºé‚£ç§åœ¨ç¼–è¯‘å™¨å°±èƒ½ç¡®å®šçš„å¸¸é‡ï¼Œæˆ‘ä»¬å½“ç„¶å¯ä»¥ä½¿ç”¨åŒå¼•å·å­—ç¬¦ä¸²è¿›è¡Œå®šä¹‰ã€‚#### + å·æ‹¼æ¥å­—ç¬¦ä¸²åœ¨javaä¸­ï¼Œ`+`å¹¶ä¸æ˜¯è¿ç®—ç¬¦é‡è½½ï¼Œjavaæ˜¯ä¸æ”¯æŒè¿ç®—ç¬¦é‡è½½çš„ï¼Œè¿™åªæ˜¯javaçš„ä¸€ä¸ªè¯­æ³•ç³–ï¼Œå®ƒçš„åº•å±‚ä»ç„¶æ˜¯`stringbuilder`çš„`apend`æ“ä½œã€‚#### concatå€ŸåŠ©å­—ç¬¦æ•°ç»„ï¼Œæœ€ç»ˆè¿˜æ˜¯newäº†ä¸€ä¸ªæ–°çš„Stringå¯¹è±¡##### `String` `StringBuffer` `StringBuilder`å®ƒä»¬å†…éƒ¨éƒ½æ˜¯é€šè¿‡æ•°ç»„æ¥å®ç°çš„ï¼Œä¸åŒçš„æ˜¯ï¼ŒStringçš„å†…éƒ¨æ•°ç»„æ˜¯finalä¿®é¥°çš„ï¼Œæ˜¯ä¸å¯æ”¹å˜çš„ï¼Œ`StringBuffer`å’Œ`StringBuilder`å†…éƒ¨æ•°ç»„æ˜¯å¯ä¿®æ”¹çš„ã€‚å®ƒä¿©æœ‰ä¸€ä¸ªå˜é‡æ¥æŒ‡ç¤ºæ•°ç»„ä¸­å·²ç»è¢«å ç”¨çš„å…ƒç´ ä¸ªæ•°ã€‚å®ƒä»¬çš„appendæ–¹æ³•æ˜¯é€šè¿‡æ•°ç»„æ¥å®ç°çš„ã€‚`StringBuffer`å’Œ`StringBuilder`æœ€å¤§çš„åŒºåˆ«æ˜¯`StringBuffer`æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚#### æ€»ç»“å¦‚æœåœ¨å¾ªç¯ä½“å†…ï¼Œä½¿ç”¨`+`è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥çš„è¯ï¼Œä¼šé¢‘ç¹çš„åˆ›å»º`StringBuilder`å¯¹è±¡ï¼Œä¸å¦‚ç›´æ¥ç”¨`StringBuilder`æ‹¼æ¥æ¥çš„å¿«ã€‚#### Stringçš„æ¯”è¾ƒ`==`æ¯”è¾ƒçš„äº‹ä¸¤ä¸ªå¯¹è±¡çš„å¼•ç”¨æ˜¯å¦ç›¸åŒï¼Œå³ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡è€Œåªæ˜¯å¼•ç”¨ä¸åŒè€Œå·²ã€‚`equals()`æ–¹æ³•æ¯”è¾ƒçš„æ˜¯å­—ç¬¦ä¸²çš„å€¼ã€‚### `foreach`å¾ªç¯ä¸­çš„remove/addæ“ä½œæœ€è¿‘åœ¨é¡¹ç›®ä¸­ä½¿ç”¨`foreach`å¹¶ä¸”åœ¨é‡Œé¢å¯¹å…ƒç´ è¿›è¡Œremoveæ—¶å¸¸å¸¸å‘ç”Ÿå¹¶å‘ä¿®æ”¹å¼‚å¸¸,ç‰¹æ­¤è®°å½•ã€‚ java.util.ConcurrentModificationException 123#### é—®é¢˜åœºæ™¯ List list = new ArrayList(); list.add(â€œthis isâ€); list.add(â€œa foreachâ€); list.add(â€œexampleâ€); for(String str: list){ if(str.equals(â€œa foreach)){ list.remove(str); }} 123æ‰§è¡Œä»¥ä¸Šä»£ç æ—¶ï¼Œå°±ä¼šäº§ç”Ÿä¸Šè¿°å¼‚å¸¸ã€‚ Exception in thread â€œmainâ€ java.util.ConcurrentModificationException at java.base/java.util.ArrayList$Itr.checkForComodification(ArrayList.java:937) at java.base/java.util.ArrayList$Itr.next(ArrayList.java:891) at Test.main(Test.java:12) 12345678910111213#### é—®é¢˜åˆ†æ`foreach`å¾ªç¯å…¶å®æ˜¯javaæä¾›ç»™æˆ‘ä»¬çš„è¯­æ³•ç³–ï¼Œå…¶æœ¬è´¨è¿˜æ˜¯å€ŸåŠ©whileå¾ªç¯å’Œiteratoræ¥å®ç°çš„ï¼ˆiteratorä½¿ç”¨è¿­ä»£å™¨æ¨¡å¼å®ç°ï¼‰ã€‚ä¹‹æ‰€ä»¥å‡ºç°ä¸Šè¿°å¼‚å¸¸ï¼Œæ˜¯å› ä¸ºè§¦å‘äº†javaçš„fail-fastæœºåˆ¶ã€‚fail-fastå³å¿«é€Ÿå¤±è´¥æœºåˆ¶ï¼Œå½“å¤šçº¿ç¨‹è®¿é—®é›†åˆç±»å¹¶å¯¹å…¶è¿›è¡Œä¿®æ”¹æ—¶ï¼Œå¯èƒ½è§¦å‘ã€‚å…¶å®å•çº¿ç¨‹ä¹Ÿæ˜¯å¯ä»¥è§¦å‘çš„ï¼Œæ¯”å¦‚æœ¬ä¾‹ã€‚å…¶å®äº§ç”Ÿå¹¶å‘ä¿®æ”¹å¼‚å¸¸çš„åŸå› å¾ˆç®€å•,`checkForComdification`çš„ä»£ç å¦‚ä¸‹ï¼š final void checkForComodification() { if (modCount != expectedModCount) throw new ConcurrentModificationException(); } å¯ä»¥çœ‹å‡ºï¼ŒæŠ›å‡ºå¼‚å¸¸çš„åŸå› æ˜¯å› ä¸º`modCount`å’Œ`expectedModCount`çš„å€¼ä¸ä¸€æ ·ï¼Œé‚£è¿™ä¸¤ä¸ªå€¼ä»£è¡¨ç€ä»€ä¹ˆå‘¢ï¼Ÿ + `modCount`æ˜¯`AbstractList`ä¸­çš„æˆå‘˜å˜é‡ï¼Œä»£è¡¨listè¢«ä¿®æ”¹çš„æ¬¡æ•° + `expectedModCount` æ˜¯ `ArrayList`ä¸­çš„ä¸€ä¸ªå†…éƒ¨ç±»â€”â€”`Itr`ä¸­çš„æˆå‘˜å˜é‡ã€‚`expectedModCount`è¡¨ç¤ºè¿™ä¸ªè¿­ä»£å™¨æœŸæœ›è¯¥é›†åˆè¢«ä¿®æ”¹çš„æ¬¡æ•°ã€‚å…¶å€¼æ˜¯åœ¨`ArrayList.iterator`æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™åˆå§‹åŒ–çš„ã€‚**åªæœ‰é€šè¿‡è¿­ä»£å™¨å¯¹é›†åˆè¿›è¡Œæ“ä½œï¼Œè¯¥å€¼æ‰ä¼šæ”¹å˜**ã€‚ çœ‹åˆ°è¿™é‡Œï¼Œå…¶å®é—®é¢˜å·²ç»æ˜äº†äº†ï¼Œ`foreach`æ˜¯ç”¨while+iteratorå®ç°çš„ï¼Œä½†æ˜¯ä¸Šè¿°ä»£ç ä¸­removeæ“ä½œå´ç”¨çš„æ˜¯é›†åˆç±»è‡ªå·±çš„removeæ–¹æ³•è€Œä¸æ˜¯iteratorçš„remove,è¿™æ ·é€ æˆçš„ç»“æœå°±æ˜¯`modCount`å¾—åˆ°äº†ä¿®æ”¹ä½†æ˜¯`expectedModCount`å´æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œä»è€ŒæŠ›å‡ºå¼‚å¸¸ã€‚ ### Javaä¸­çš„æ—¥å¿— é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œä¸­æœ‰ä¸€æ¡ï¼šã€å¼ºåˆ¶ã€‘åº”ç”¨ä¸­ä¸å¯ç›´æ¥ä½¿ç”¨æ—¥å¿—ç³»ç»Ÿï¼ˆLog4jã€`Logback`ï¼‰ä¸­çš„APIï¼Œè€Œåº”ä¾èµ–ä½¿ç”¨æ—¥å¿—æ¡†æ¶SLF4Jä¸­çš„APIï¼Œä½¿ç”¨é—¨é¢æ¨¡å¼çš„æ—¥å¿—æ¡†æ¶ï¼Œæœ‰åˆ©äºç»´æŠ¤å’Œå„ä¸ªç±»çš„æ—¥å¿—å¤„ç†æ–¹å¼ç»Ÿä¸€ã€‚ æ¥çœ‹ä¸‹Javaä¸­ä¸€äº›å¥½çš„æ—¥å¿—é—¨é¢ï¼š **SLF4J**(Simple Logging Facade for Java) ### Javaä¸­çš„å¼•ç”¨ åœ¨JVMçš„æ–‡ç« ä¸­æœ‰å†™åˆ°ã€‚ + #### å¼±å¼•ç”¨","categories":[{"name":"java","slug":"java","permalink":"http://example.com/categories/java/"}],"tags":[{"name":"javaåŸºç¡€","slug":"javaåŸºç¡€","permalink":"http://example.com/tags/java%E5%9F%BA%E7%A1%80/"}]},{"title":"mongodbå­¦ä¹ ç¬”è®°","slug":"mongodbå­¦ä¹ ç¬”è®°","date":"2018-01-02T01:41:25.000Z","updated":"2023-05-29T14:17:37.587Z","comments":true,"path":"2018/01/02/mongodbå­¦ä¹ ç¬”è®°/","link":"","permalink":"http://example.com/2018/01/02/mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","excerpt":"","text":"å…³ç³»å‹æ•°æ®åº“ä¸MongoDBæœ¯è¯­å¯¹æ¯” å…³ç³»å‹æ•°æ®åº“ MongoDB è¡¨ é›†åˆ è¡Œ æ–‡æ¡£ åˆ— å­—æ®µ è¡¨join å†…åµŒ ä¸»é”® ä¸»é”®ï¼ˆç”±MongoDBæä¾›é»˜è®¤çš„key_idï¼‰ åˆ›å»ºæ•°æ®åº“ use DATABASE_NAME å¾—åˆ° è®°ä¸€æ¬¡åœ¨mapreduceé‡Œå¡«çš„å‘ mapreduceæœ€åˆæ˜¯ç”±è°·æ­Œæå‡ºçš„æ¡†æ¶ï¼Œä½†å·²åœ¨å¤šç§å¹³å°ä¸Šå®ç°ã€‚åˆ†ä¸ºmapå’Œreduceä¸¤ä¸ªé˜¶æ®µã€‚ mapé˜¶æ®µé€šè¿‡emitå‡½æ•°å¯¹åŒä¸€ä¸ªkeyæ‰€å¯¹åº”çš„å€¼è¿›è¡Œæ˜ å°„ï¼Œreduceé˜¶æ®µå¯¹æ¯ç»„æ˜ å°„ç»“æœè¿›è¡ŒåŒ–ç®€ã€‚ç”¨å®˜æ–¹æ–‡æ¡£çš„ä¸€å¼ å›¾æ¥è¯´æ˜ï¼š â€‹ â€‹ é—®é¢˜åˆé›† åœ¨è¿æ¥MongoDBçš„è¿‡ç¨‹ä¸­ï¼Œå®é™…ä¸Šåº”è¯¥ç”¨ä¸¤æ¬¡cmd,ç¬¬ä¸€æ¬¡æ˜¯å¼€å¯MongoæœåŠ¡ï¼Œç¬¬äºŒæ¬¡æ‰æ˜¯è¿æ¥åˆ°æ•°æ®åº“ã€‚å…ˆåˆ°å®‰è£…ç›®å½•ä¸‹çš„binæ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œmongod --dbpath &quot;F:\\mongodb\\data\\db&quot;å¯åŠ¨æœåŠ¡å™¨ï¼Œç„¶åé‡æ–°æ‰“å¼€å‘½ä»¤è¡Œï¼Œè¾“å…¥mongoè¿æ¥æ•°æ®åº“ åœ¨node.jsæ“ä½œmongodbæ—¶é‡åˆ°å¦‚ä¸‹é”™è¯¯ MongoNetworkError: connection destroyed, not possible to instantiate cursor æœ€åå‘ç°åº”è¯¥æŠŠdb.close()å†™åˆ°å›æ‰å‡½æ•°é‡Œé¢ â€‹mongodbçš„åœ¨çº¿è°ƒè¯•ç«¯å£é»˜è®¤28017 mongodbçš„è®¿é—®æ§åˆ¶é—®é¢˜ï¼š adminå¯¹äºéç³»ç»Ÿé›†åˆå…¶å®æ˜¯æ²¡æœ‰è¯»æƒé™çš„","categories":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"tags":[]},{"title":"MySQLå­¦ä¹ ç¬”è®°","slug":"MySQLå­¦ä¹ ç¬”è®°","date":"2017-12-13T10:54:49.000Z","updated":"2023-05-29T14:17:39.314Z","comments":true,"path":"2017/12/13/MySQLå­¦ä¹ ç¬”è®°/","link":"","permalink":"http://example.com/2017/12/13/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","excerpt":"","text":"###MySQLé€»è¾‘æ¶æ„ redo log &amp; bin logMySQLçš„æ¯æ¬¡æ•°æ®æ›´æ”¹éƒ½ä¸ä¼šç«‹å³å†™å…¥ç£ç›˜çš„ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªå¤§é‡IOçš„è¿‡ç¨‹ï¼Œè€—æ—¶è€—åŠ›ï¼Œä¸€ä¸ªå¯å–çš„æ“ä½œæ—¶æˆ‘å…ˆæŠŠå½“å‰çš„æ“ä½œè®°å½•åœ¨æ—¥å¿—é‡Œï¼Œç­‰åˆ°å¤œæ·±äººé™æ“ä½œç³»ç»Ÿç©ºé—²çš„æ—¶å€™ï¼Œåœ¨é€šè¿‡æ—¥å¿—æŠŠç›¸å…³çš„ä¿®æ”¹æŒä¹…åŒ–ã€‚ æ‰€ä»¥ï¼Œæœºæ™ºçš„MySQLè®¾è®¡è€…ä»¬å°±æå‡ºäº†ä¸€ä¸ªå«åšWAL(write ahead logging)çš„æŠ€æœ¯ã€‚ æ¯å½“å¯¹æ•°æ®åº“è¿›è¡Œä¿®æ”¹æ“ä½œæ—¶ï¼Œä¼šå…ˆåœ¨redo logä¸­æ·»åŠ ä¸€è¡Œè®°å½•â€œéœ€è¦åœ¨å“ªä¸ªæ•°æ®é¡µä¸Šåšä»€ä¹ˆä¿®æ”¹â€ï¼Œå¹¶ä¸”æŠŠè¿™è¡Œè®°å½•çš„çŠ¶æ€è®¾ç½®ä¸ºprepareçŠ¶æ€ï¼Œç­‰åˆ°äº‹åŠ¡æäº¤åï¼Œå†æŠŠredo logä¸­çš„è¿™è¡Œè®°å½•çš„çŠ¶æ€è®¾ç½®ä¸ºcommit. redo logè®°å½•æ–¹å¼redo logæ˜¯InnoDBæ‰€æœ‰çš„ï¼Œå®ƒçš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œå¯ä»¥é€šè¿‡ç‰¹å®šå‚æ•°æ¥é…ç½®æ—¥å¿—æ–‡ä»¶çš„æ•°é‡å’Œæ¯ä¸ªæ—¥å¿—æ–‡ä»¶çš„å¤§å°ã€‚ å®ƒé‡‡ç”¨å¾ªç¯å†™çš„æ–¹å¼ï¼Œå¦‚ä¸‹å›¾ï¼š å…¶ä¸­write posè¡¨ç¤ºå½“å‰æ‰“ç®—å†™çš„ä½ç½®ï¼Œwrite poså’Œcheck pointä¹‹é—´çš„ç©ºé—´è¡¨ç¤ºç©ºé—²ç©ºé—´ï¼Œå› ä¸ºæ˜¯å¾ªç¯å†™ï¼Œæ‰€ä»¥å¿…ç„¶å­˜åœ¨ä¸€ä¸ªå†™æ»¡çš„é—®é¢˜ï¼Œå†™æ»¡äº†ï¼Œå°±è¦æ“¦é™¤ï¼Œç„¶åç»§ç»­å†™ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸èƒ½ä¿å­˜è¿‡å»çš„æ‰€æœ‰æ—¶åˆ»çš„çŠ¶æ€ã€‚ æœ‰äº†è¿™ä¸ªredo log,å°±å¯ä»¥ä¿è¯æ•°æ®åº“å¼‚å¸¸é‡å¯åï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥æ ¹æ®redo logé‡Œé¢çš„è®°å½•è¿›è¡Œæ¢å¤ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªèƒ½åŠ›å«åšcrash-safe. é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ—¢ç„¶éƒ½æœ‰äº†redo logï¼Œä¸ºä»€ä¹ˆè¿˜è¦bin logå‘¢ï¼Ÿ æ ¹æ®ä¸Šè¿°åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“ï¼š redo logæ˜¯InnoDBå¼•æ“ç‰¹æœ‰çš„ï¼Œå…¶ä»–å¼•æ“æ²¡æœ‰ redo logå®¹é‡æœ‰é™ï¼Œæ‰€ä»¥ä¸ä¼šä¿å­˜å¤ªå¤šçš„å†å²è®°å½•ã€‚ åŸºäºä¸Šè¿°ä¸¤æ¡ï¼Œæˆ‘ä»¬åˆæœ‰äº†bin log, é‚£å®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ bin logæ˜¯å±äºserverå±‚çš„ï¼Œæ‰€ä»¥å®ƒå¯¹äºæ‰€æœ‰å­˜å‚¨å¼•æ“éƒ½èƒ½ç”¨ bin logæ˜¯é€šè¿‡è¿½åŠ æ–¹å¼å†™å…¥çš„ï¼Œæ‰€ä»¥æ—§çš„è®°å½•ä¸ä¼šè¢«æ“¦é™¤ redo logè®°å½•çš„æ˜¯ç‰©ç†ä¿®æ”¹ï¼Œæ¯”å¦‚æŸä¸ªé¡µé¢çš„æŸä¸ªå€¼ä¿®æ”¹ä¸ºå•¥ï¼Œè€Œbin logè®°å½•çš„é€»è¾‘æ“ä½œï¼Œä½ å¯ä»¥è®¤ä¸ºå®ƒè®°å½•äº†ä¸€æ¡SQLè¯­å¥ æœ‰äº†è¿™ä¸¤ä¸ªæ—¥å¿—åï¼Œè¿™ä¸¤ä»½æ—¥å¿—éœ€è¦ä¿è¯é€»è¾‘ä¸€è‡´ï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºå•¥ï¼Œå…ˆè®°ç€å§ï¼‰ï¼Œè€Œè¿™ä¸ªä¿è¯æ˜¯é€šè¿‡ä¸€ä¸ªå«åšä¸¤é˜¶æ®µæäº¤çš„æ–¹å¼æ¥å®ç°çš„ï¼š å®ƒçš„å¤§æ„æ˜¯è¿™æ ·çš„ï¼Œå½“æœ‰ä¸€ä¸ªæ•°æ®åº“çš„ä¿®æ”¹æ—¶ï¼Œå…ˆå°†ä¿®æ”¹åçš„å€¼æ”¾åˆ°å†…å­˜ï¼Œç„¶ååœ¨redo logé‡Œé¢è®°å½•ä¸€å“ˆï¼Œæ­¤æ—¶çš„çŠ¶æ€æ˜¯prepare, ç„¶ååœ¨bin logé‡Œé¢å†è®°å½•ä¸€å“ˆï¼Œæœ€åæäº¤äº‹åŠ¡ï¼Œå°†redo logé‡Œé¢çš„çŠ¶æ€è®¾ç½®ä¸ºcommit. ç­‰åˆ°å¤œæ·±äººé™çš„æ—¶å€™ï¼Œå°±å¯ä»¥é€šè¿‡redoé‡Œé¢è¿™äº›çŠ¶æ€ä¸ºcommitçš„å­—æ®µæ¥ä¿®æ”¹æ•°æ®åº“äº†ã€‚ change bufferä»Šå¤©å­¦ä¹ äº†change buffer, ç®€å•æ¥è¯´ï¼Œchange bufferæ˜¯ç”¨ç»™æ™®é€šç´¢å¼•çš„ï¼Œå¯¹äºé¢‘ç¹çš„æ›´æ–°æˆ–è€…æ’å…¥æ“ä½œï¼Œå”¯ä¸€ç´¢å¼•éœ€è¦æŠŠå¯¹åº”æ•°æ®é¡µè¯»å…¥å†…å­˜æ£€æŸ¥å”¯ä¸€æ€§ï¼Œè¿™åŠ¿å¿…ä¼šå¢åŠ IOå¼€é”€ã€‚è€Œå¯¹æ™®é€šç´¢å¼•æ¥è¯´ï¼Œåˆ™æ²¡æœ‰å¿…è¦æ£€æŸ¥å”¯ä¸€æ€§ï¼Œæ‰€ä»¥é‡åˆ°æ›´æ–°æˆ–è€…æ’å…¥æ“ä½œï¼Œä¸ç€æ€¥æŠŠæ•°æ®é¡µè¯»å…¥å†…å­˜è¿›è¡Œæ›´æ–°ï¼Œè€Œæ˜¯å¯ä»¥å…ˆæŠŠè¦è¿›è¡Œçš„æ“ä½œè¯»å…¥ä¸€ä¸ªchange bufferä¸­ï¼Œç­‰åé¢å•¥æ—¶å€™æœºç¼˜å·§åˆäº†æŠŠå¯¹åº”æ•°æ®é¡µè¯»è¿›æ¥å’Œchange buffer mergeä¸€ä¸‹ã€‚","categories":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"tags":[]},{"title":"tensorflowå­¦ä¹ ç¬”è®°","slug":"tensorflowå­¦ä¹ ç¬”è®°","date":"2017-11-20T07:28:37.000Z","updated":"2023-05-29T14:17:39.328Z","comments":true,"path":"2017/11/20/tensorflowå­¦ä¹ ç¬”è®°/","link":"","permalink":"http://example.com/2017/11/20/tensorflow%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","excerpt":"","text":"Sessionä¼šè¯(Session)Sessionæ˜¯tensorflowä¸ºäº†æ§åˆ¶å’Œè¾“å‡ºæ–‡ä»¶æ‰€æ‰§è¡Œçš„è¯­å¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½¿ç”¨äº†tensorflow,è€Œä½ åˆæƒ³æ­£å¸¸è¾“å‡ºï¼Œé‚£å°±éœ€è¦åˆ›å»ºä¸€ä¸ªä¼šè¯ï¼Œåœ¨ä¼šè¯ä¸­æ‰§è¡Œsess.run()æ¥å®Œæˆä½ çš„éœ€æ±‚ã€‚ 12345678910111213import tensorflow as tfmatrix1 = tf.constant([[1,3]])matrix2 = tf.constant([[2],[4]])result = tf.matmul(matrix1,matrix2)#method1sess = tf.Session()print(sess.run(result))#method2with tf.Session() as sess : print(sess.run(result)) æ³¨æ„ï¼šå¯¹äºå¼ é‡çš„å†™æ³•ï¼Œæ— è®ºæ˜¯å‡ ç»´ï¼Œæœ€å¤–é¢æ€»æ˜¯æœ‰ä¸ªä¸­æ‹¬å·ï¼Œç„¶åæ¯ä¸€ç»´ä¸€ä¸ªä¸­æ‹¬å· å˜é‡tensorflowä¸­å˜é‡å¿…é¡»ç”¨tf.Variable()å‡½æ•°æ¥å®šä¹‰ï¼Œè€Œä¸”åº”ä»¥å®Œäº†ä¹‹åå¿…é¡»ç”¨tf.initialize_all_varialbles()æ¥åˆå§‹åŒ–ï¼Œå…¶å®è¿™é‡Œçš„åˆå§‹åŒ–ä¹Ÿåªæ˜¯é™æ€çš„åˆå§‹åŒ–ï¼Œæœ€åè¿˜è¦åœ¨sessionä¸­runä¸€ä¸‹ï¼Œrun()å®Œä¹‹åå˜é‡ç®—æ˜¯çœŸæ­£å¾—åˆ°äº†åˆå§‹åŒ–ï¼Œä½†æ˜¯å¦‚æœè¦è¾“å‡ºæŸä¸ªå˜é‡çš„å€¼ï¼Œä»éœ€è¦sess.run()å°†SessionæŒ‡é’ˆç§»è¿‡å» 123456789import tensorflow as tfa = tf.Variable(tf.random_uniform([1,1],1,5))init = tf.initialize_all_variables()with tf.Session() as sess: sess.run(init) print(sess.run(a)) å ä½ç¬¦ï¼ˆplaceholderï¼‰é¡¾åæ€ä¹‰ï¼Œå ä½ç¬¦åœ¨å£°æ˜çš„æ—¶å€™å¹¶æ²¡æœ‰å€¼ç»™å®ƒåˆå§‹åŒ–ï¼Œè¿™ä¹Ÿå°±æ˜¯å®ƒä¸ºä»€ä¹ˆå«å ä½ç¬¦çš„åŸå› ï¼Œä»…ä»…èµ·åˆ°ä¸€ä¸ªå ä½ç½®çš„ä½œç”¨ï¼Œé‚£å®ƒä»€ä¹ˆæ—¶å€™æœ‰å€¼å‘¢ï¼Ÿå®ƒä¼šåœ¨sessionä¸­è¢«èµ‹å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœç¨‹åºä¸­ä¸ç®—ä¸€å¼€å§‹å°±ç»™å€¼çš„è¯ï¼Œå¯ä»¥ç”¨å ä½ç¬¦çš„æ–¹å¼ã€‚ 12345678910import tensorflow as tfinput1 = tf.placeholder(tf.float32,shape=[1,1])input2 = tf.placeholder(tf.float32,shape=[1,1])output = tf.add(input1,input2)with tf.Session() as sess: result = sess.run(output,feed_dict=&#123;input1:[[1]],input2:[[1]]&#125;) print(result) placeholderæœ€ç»ˆåœ¨sess.run()ä¸­ç”¨feed_dict{}è¿›è¡Œè¾“å…¥ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå³ä¾¿è¿™é‡Œshapeæ˜¯[1,1],åé¢è¾“å…¥æ—¶ä»æ˜¯[[1]]çš„å½¢å¼ Tensorboardå…³äºtensorboardçš„ä½¿ç”¨ï¼Œå¤§æ¦‚åˆ†ä¸ºä¸€ä¸‹å‡ æ­¥ï¼š tf.summary.histogram()æˆ–è€…tf.summary.scalar()æ¥ç»˜åˆ¶å›¾å±‚ï¼Œä»åå­—ä¸Šè®²ï¼Œhistogramç»˜åˆ¶çš„æ˜¯æŸ±çŠ¶å›¾ï¼Œscalarç»˜åˆ¶çš„æ˜¯æŠ˜çº¿å›¾ï¼Œä½†å…¶å®æˆ‘å¹¶ä¸è®¤è¯†histogramç»˜åˆ¶çš„æ˜¯ä»€ä¹ˆä¸œè¥¿ merged = tf.summary.merge_allå°†æ‰€æœ‰çš„summaryæ±‡æ€»åœ¨ä¸€èµ· writer = tf.summary.FileWriter()å°†eventæ–‡ä»¶å†™åˆ°æŒ‡å®šç›®å½•ä¸‹ result = sess.run(merged,feed_dict=&#123;...&#125;) writer.add_summary(result,i) ç„¶ååœ¨å‘½ä»¤è¡Œä¸­tensorboard --logdir eventæ–‡ä»¶ç›®å½• Regressionä»£ç åˆ†æè¿™é‡Œæ˜¯ä¸€ä¸ªå›å½’åˆ†æçš„ä¾‹å­ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162# -*- coding: utf-8 -*-&quot;&quot;&quot;Created on Sat Jan 6 16:20:17 2018@author: Terry&quot;&quot;&quot;import tensorflow as tfimport numpy as npimport matplotlib.pyplot as plt#è¿™é‡Œå®šä¹‰äº†éšå«å±‚def add_layer(inputs, in_size, out_size, activation_function=None): #å‚æ•°åŒ…æ‹¬è¾“å…¥å€¼ï¼Œè¾“å…¥å€¼å¤§å°ï¼Œè¾“å‡ºå€¼å¤§å°ï¼Œä»¥åŠæ¿€åŠ±å‡½æ•° Weights = tf.Variable(tf.random_normal([in_size, out_size])) #è¿™ä¸ªéšè—å±‚åšçš„äº‹æƒ…å°±æ˜¯è®¡ç®—ï¼šè¾“å…¥*æƒé‡+åç½® biases = tf.Variable(tf.zeros([1, out_size]) + 0.1) #å¦‚æœæœ‰æ¿€åŠ±å‡½æ•°åˆ™æŠŠç»“æœæ”¾åˆ°æ¿€åŠ±å‡½æ•°é‡Œå†è®¡ç®—ä¸€æ¬¡ Wx_plus_b = tf.matmul(inputs, Weights) + biases if activation_function is None: outputs = Wx_plus_b else: outputs = activation_function(Wx_plus_b) return outputs# Make up some real data#åœ¨è¿™é‡Œè¾“å…¥æ•°æ®x_data = np.linspace(-1, 1, 300, dtype=np.float32)[:, np.newaxis]noise = np.random.normal(0, 0.05, x_data.shape).astype(np.float32)y_data = np.square(x_data) - 0.5 + noise##plt.scatter(x_data, y_data)##plt.show()# define placeholder for inputs to network#è¿™é‡Œæ˜¯è¾“å…¥å±‚ï¼Œxs,yséƒ½æ˜¯éœ€è¦è¾“å…¥çš„æ•°æ®ï¼Œåªä¸è¿‡æ˜¯åœ¨åé¢è¾“å…¥ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨äº†å ä½ç¬¦xs = tf.placeholder(tf.float32, [None, 1])ys = tf.placeholder(tf.float32, [None, 1])# add hidden layer#è¿™é‡Œæ˜¯éšè—å±‚l1 = add_layer(xs , 1, 10, activation_function=tf.nn.relu)# add output layerprediction = add_layer(l1, 10, 1, activation_function=None)# the error between prediction and real dataloss = tf.reduce_mean(tf.reduce_sum(tf.square(ys-prediction), reduction_indices=[1]))train_step = tf.train.GradientDescentOptimizer(0.1).minimize(loss)# important stepsess = tf.Session()# tf.initialize_all_variables() no long valid from# 2017-03-02 if using tensorflow &gt;= 0.12if int((tf.__version__).split(&#x27;.&#x27;)[1]) &lt; 12 and int((tf.__version__).split(&#x27;.&#x27;)[0]) &lt; 1: init = tf.initialize_all_variables()else: init = tf.global_variables_initializer()sess.run(init)for i in range(1000): # training sess.run(train_step, feed_dict=&#123;xs: x_data, ys: y_data&#125;) if i % 50 == 0: # to see the step improvement print(sess.run(loss, feed_dict=&#123;xs: x_data, ys: y_data&#125;)) å®ƒçš„å­¦ä¹ è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼Œå¯¹äºä¸¤ä¸ªåˆå§‹å€¼xsï¼Œys,xsä¼šç»è¿‡æŸç§å˜æ¢åˆ°è¾¾ysï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡éšå«å±‚ï¼Œä¼šè®¡ç®—å‡ºæ¥ä¸€ä¸ªOutput,é€šè¿‡è®­ç»ƒä¸æ–­å‡å°ysï¼ˆç†æƒ³å€¼ï¼‰å’Œoutputï¼ˆå®é™…å€¼ï¼‰çš„è¯¯å·®ï¼Œæ¥è¾¾åˆ°å­¦ä¹ çš„æ•ˆæœ Classificationä»£ç åˆ†æ12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758# -*- coding: utf-8 -*-&quot;&quot;&quot;Created on Mon Jun 25 11:04:49 2018@author: Arrow&quot;&quot;&quot;import tensorflow as tffrom tensorflow.examples.tutorials.mnist import input_datamnist = input_data.read_data_sets(&#x27;MNIST_data&#x27;,one_hot=True) #one-hot vectorè¡¨ç¤ºé™¤äº†æŸä¸€ä½çš„æ•°å­—æ˜¯ä¸€å…¶ä»–çš„éƒ½æ˜¯0def add_layer(inputs,in_size,out_size,activation_function=None): Weights = tf.Variable(tf.random_normal([in_size,out_size])) biases = tf.Variable(tf.zeros([1,out_size])+0.1) Wx_plus_b = tf.matmul(inputs,Weights)+biases if activation_function is None: outputs = Wx_plus_b else: outputs = activation_function(Wx_plus_b) return outputsdef compute_accuracy(v_xs,v_ys): global prediction y_pre = sess.run(prediction,feed_dict=&#123;xs:v_xs&#125;) correct_prediction = tf.equal(tf.argmax(y_pre,1),tf.arg_max(v_ys,1)) accuracy = tf.reduce_mean(tf.cast(correct_prediction,tf.float32)) result = sess.run(accuracy,feed_dict=&#123;xs:v_xs,ys:v_ys&#125;) return result#define placeholder for inputs to network xs = tf.placeholder(tf.float32,[None,784])ys = tf.placeholder(tf.float32,[None,10])# add output layerprediction = add_layer(xs,784,10,activation_function=tf.nn.softmax)#the error between prediction and real data #è¿™é‡Œä½¿ç”¨äº¤å‰ç†µæ¥è®¡ç®—è¯¯å·®ï¼Œå¯¹æ•°é‡Œé¢çš„æ˜¯é¢„æµ‹å€¼ï¼Œå¤–é¢çš„æ˜¯å®é™…å€¼cross_entropy = tf.reduce_mean(-tf.reduce_sum(ys * tf.log(prediction),reduction_indices=[1])) #ä½¿ç”¨æ¢¯åº¦ä¸‹é™ï¼Œå­¦ä¹ é€Ÿç‡ä¸º0.5è¿›è¡Œè®­ç»ƒtrain_step = tf.train.GradientDescentOptimizer(0.5).minimize(cross_entropy)sess = tf.Session()#important stepsess.run(tf.global_variables_initializer())for i in range(1000): #æ¯æ¬¡éšæœºæŠ“å–100ä¸ªæ•°æ®ç‚¹è¿›è¡Œè®­ç»ƒ batch_xs,batch_ys = mnist.train.next_batch(100) sess.run(train_step,feed_dict=&#123;xs:batch_xs,ys:batch_ys&#125;) #æ¯è®­ç»ƒ50æ­¥æ‰“å°ä¸€ä¸‹ç²¾åº¦ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆç²¾å¦™çš„åšæ³•ï¼Œæ‰“å°ç²¾åº¦è¾“å…¥çš„æ˜¯testä¸­çš„imageå’Œlabel, #è®­ç»ƒç”¨çš„æ•°æ®é›†æ˜¯train,é‚£ä¹ˆè®­ç»ƒç»“æœæ˜¯å¦‚ä½•ç”¨åˆ°testæ•°æ®é›†ä¸­çš„å‘¢ï¼Œè¿™ä¸»è¦å¾—ç›Šäºcompute_accuracyä¸­ #çš„å…¨å±€å˜é‡prediction,predictionä¼šè°ƒç”¨add_layeræ–¹æ³•ï¼Œç”¨å·²ç»ç»è¿‡è®­ç»ƒçš„Weightså’ŒbiasesåŒtestæ•°æ®é›†ä¸­ #çš„è¾“å…¥è¿›è¡Œè®¡ç®—ï¼Œè¿™æ ·å°±ä¼šå¾—åˆ°testæ•°æ®é›†ä¸­çš„é¢„æµ‹å€¼ if i % 50 ==0: print(compute_accuracy(mnist.test.images,mnist.test.labels)) dropout fix overfitting123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869# -*- coding: utf-8 -*-&quot;&quot;&quot;Created on Thu Jun 28 15:10:29 2018@author: Arrow&quot;&quot;&quot;import tensorflow as tffrom sklearn.datasets import load_digitsfrom sklearn.cross_validation import train_test_splitfrom sklearn.preprocessing import LabelBinarizerdigits = load_digits()X = digits.datay = digits.targety = LabelBinarizer().fit_transform(y)X_train,X_test,y_train,y_test = train_test_split(X,y,test_size=.3)tf.reset_default_graph()def add_layer(inputs,in_size,out_size,layer_name,activation_function=None): Weights = tf.Variable(tf.random_normal([in_size,out_size])) biases = tf.Variable(tf.zeros([1,out_size]))+0.1 Wx_plus_b = tf.matmul(inputs,Weights)+biases Wx_plus_b = tf.nn.dropout(Wx_plus_b,keep_prob) if activation_function is None: outputs = Wx_plus_b else: outputs = activation_function(Wx_plus_b) tf.summary.histogram(layer_name+&#x27;/outputs&#x27;,outputs) return outputs#define placeholder for inputs to networkkeep_prob = tf.placeholder(tf.float32)xs = tf.placeholder(tf.float32,[None,64])ys = tf.placeholder(tf.float32,[None,10])# add output layerl1 = add_layer(xs,64,50,&#x27;l1&#x27;,activation_function=tf.nn.tanh)prediction = add_layer(l1,50,10,&#x27;l2&#x27;,activation_function=tf.nn.softmax)# the loss between prediction and real datacross_entropy = tf.reduce_mean(-tf.reduce_sum(ys*tf.log(prediction),reduction_indices=[1]))tf.summary.scalar(&#x27;loss&#x27;,cross_entropy)train_step = tf.train.GradientDescentOptimizer(0.5).minimize(cross_entropy)sess = tf.Session()merged = tf.summary.merge_all()train_writer = tf.summary.FileWriter(&quot;logs/train&quot;,sess.graph)test_writer = tf.summary.FileWriter(&quot;logs/test&quot;,sess.graph)init = tf.global_variables_initializer()sess.run(init)for i in range(500): sess.run(train_step,feed_dict=&#123;xs:X_train,ys:y_train,keep_prob:0.5&#125;) if i % 50 == 0: train_result = sess.run(merged,feed_dict=&#123;xs:X_train,ys:y_train,keep_prob:1&#125;) test_result = sess.run(merged,feed_dict=&#123;xs:X_test,ys:y_test,keep_prob:1&#125;) train_writer.add_summary(train_result,i) test_writer.add_summary(test_result,i) æœ‰ç‚¹ä¸å¤ªæ˜ç™½çš„æ˜¯ï¼Œlossç”Ÿæˆçš„æ˜¯ä¸¤ä¸ªeventæ–‡ä»¶ï¼Œä¸ºä»€ä¹ˆæœ€åæ˜¾ç¤ºåœ¨ä¸€å¼ å›¾é‡Œï¼Œéš¾é“è¯´æ˜¯tensorflowè‡ªå·±æŠŠlogdirä¸‹çš„ä¸¤ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„ä¸¤ä¸ªæ–‡ä»¶åˆå¹¶äº†ä¹ˆ é‡åˆ°çš„é—®é¢˜ InvalidArgumentError: You must feed a value for placeholder tensor &#39;Placeholder&#39; with dtype float ä¸€ç›´ä»¥ä¸ºæ˜¯å ä½ç¬¦çš„é—®é¢˜ï¼Œåæ¥å‘ç°æ˜¯tensorboardçš„é—®é¢˜ï¼Œå› ä¸ºä¸Šè¿°ä»£ç ä¸­å…¶å®æ˜¯è¦ç»˜åˆ¶ä¸¤ä»½å›¾è¡¨ï¼Œå¤§æ¦‚æ˜¯å› ä¸ºtensorflowçš„tf.merge_all_summaries()ä½¿ç”¨ä¸€ä¸ªé»˜è®¤çš„å›¾æ¥æ”¶é›†æˆ‘ä»¬çš„æ‰€æœ‰æ“ä½œï¼ŒåŒ…æ‹¬æ­¤å‰è¿›è¡Œçš„ä¸€äº›é”™è¯¯æ“ä½œï¼Œæ‰€ä»¥æˆ‘åœ¨æ‰€æœ‰çš„tfæ“ä½œä¹‹å‰åŠ äº†ä»£ç tf.reset_default_graph()å°±å¥½äº†ï¼Œæ›´å¤šè¯·å‚è€ƒ ä¸€äº›å°é—®é¢˜ åœ¨å¼•å…¥matplotlibæ—¶ï¼Œæœ‰é”™è¯¯æ˜¾ç¤ºspyder No module named &#39;PyQt4&#39;ï¼Œå‡ ç»æŠ˜è…¾ï¼Œæœ€åå‘ç°ç³»ç»Ÿä¸­æœ‰æ–°ç‰ˆæœ¬PyQt5è€Œé»˜è®¤è®¾ç½®è¿˜æ˜¯4ï¼Œæ‰€ä»¥æ‰“å¼€Tools -&gt; Preferences -&gt; IPython console -&gt; Graphics -&gt; Backened ä¿®æ”¹ä¸ºQT5 Convolution Neural NetworkCNNå¸¸ç”¨åœ¨å›¾ç‰‡è¯†åˆ«ï¼Œè®¡ç®—æœºè§†è§‰ç­‰é¢†åŸŸï¼Œå®ƒå¤§æ¦‚æ“ä½œå¦‚ä¸‹ï¼š å¯¹äºä¸€å¼ å›¾ç‰‡ï¼Œå®ƒæœ‰é•¿å®½é«˜ï¼Œè¿™é‡Œçš„é«˜æŒ‡çš„æ˜¯å®ƒæ˜¯é»‘ç™½è¿˜æ˜¯å½©è‰²çš„ ç„¶åæœ‰ä¸ªè¿‡æ»¤å™¨ï¼Œåœ¨å›¾ç‰‡ä¸Šè¿›è¡Œæ‰«æï¼Œæ¯æ¬¡ä¼šæ‰«æå›¾ç‰‡ä¸Šçš„ä¸€å°éƒ¨åˆ†åŒºåŸŸï¼Œç»è¿‡ä¸€æ¬¡æ‰«æï¼Œä¼šæŠŠè¿™ä¸ªå›¾ç‰‡å‹ç¼©æˆï¼Œé•¿å’Œå®½æ›´å°ï¼Œé«˜åº¦æ›´åšçš„ä¸€ä¸ªå›¾ç‰‡ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«åšå·ç§¯ã€‚æ¯æ¬¡æ‰«æå¤šå¤§ä¸€å—åŒºåŸŸå‘¢ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªå«åšpatch,æœ‰æ—¶å€™ä¹Ÿå«å®ƒKernel,è¿˜æœ‰ä¸€ä¸ªæœ¯è¯­å«stride,è¡¨ç¤ºæ‰«ææ—¶ç§»åŠ¨çš„æ­¥å¹…ã€‚è¿™ä¸ªè¿‡ç¨‹å…¶å®å°±æ˜¯å¯¹ç‰¹å¾çš„å¤šæ¬¡æå–ï¼Œå…¶ä¸­çš„é«˜åº¦å°±è¡¨ç‰¹å¾ï¼Œè¿™æ ·çš„è¿‡ç¨‹é‡å¤å‡ æ¬¡åï¼Œä¼šå¾—åˆ°ä¸€ä¸ªé•¿å®½å¾ˆå°ï¼Œé«˜åº¦å¾ˆåšçš„å›¾ç‰‡ï¼Œ ç„¶åæŠŠå®ƒæ”¾åˆ°å…¨è¿æ¥ç¥ç»ç½‘ç»œä¸­è¿›è¡Œåˆ†ç±»ã€‚ å¦‚æœæ¯æ¬¡æ‰«ææ—¶strideè¿‡å¤§ï¼Œå¯èƒ½ä¼šé€ æˆä¿¡æ¯çš„æŸå¤±ï¼Œè¿™æ—¶å€™å°±éœ€è¦pooling æ± åŒ–æ¥å‡å°‘ è¿™ä¸ªæ•ˆæœã€‚ æ ¹æ®æ‰«æä¸­å¦‚ä½•å¤„ç†è¾¹ç•Œï¼Œæœ‰valid paddingå’Œsame paddingï¼Œvalid paddingè¡¨ç¤ºåªå¤„ç†å›¾ç‰‡è¾¹ç¼˜å†…å®¹ï¼Œä¸ä¼šæ¶‰åŠè¾¹ç¼˜ä»¥å¤–çš„ä¸œè¥¿ï¼Œsame paddingè¡¨ç¤ºå°†å›¾ç‰‡è¾¹ç¼˜ä»¥å¤–çš„ä¸œè¥¿ç”¨0æ¥å¡«å…… ä»£ç åˆ†æ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105# -*- coding: utf-8 -*-&quot;&quot;&quot;Created on Fri Jun 29 13:54:21 2018@author: Arrow&quot;&quot;&quot;import tensorflow as tffrom tensorflow.examples.tutorials.mnist import input_data# number 1 to 10 datamnist = input_data.read_data_sets(&#x27;MNIST_data&#x27;, one_hot=True)def add_layer(inputs, in_size, out_size, activation_function=None,): # add one more layer and return the output of this layer Weights = tf.Variable(tf.random_normal([in_size, out_size])) biases = tf.Variable(tf.zeros([1, out_size]) + 0.1,) Wx_plus_b = tf.matmul(inputs, Weights) + biases if activation_function is None: outputs = Wx_plus_b else: outputs = activation_function(Wx_plus_b,) return outputsdef compute_accuracy(v_xs, v_ys): global prediction y_pre = sess.run(prediction, feed_dict=&#123;xs: v_xs, keep_prob: 1&#125;) correct_prediction = tf.equal(tf.argmax(y_pre,1), tf.argmax(v_ys,1)) accuracy = tf.reduce_mean(tf.cast(correct_prediction, tf.float32)) result = sess.run(accuracy, feed_dict=&#123;xs: v_xs, ys: v_ys, keep_prob: 1&#125;) return result#è¾“å…¥å½¢çŠ¶ï¼Œè¿”å›æƒé‡def weight_variable(shape): #äº§ç”Ÿæ­£å¤ªåˆ†å¸ƒï¼Œstddevæ˜¯æ ‡å‡†å·® initial = tf.truncated_normal(shape,stddev=0.1) return tf.Variable(initial)#è¾“å…¥å½¢çŠ¶ï¼Œè¿”å›åç½®def biase_variable(shape): initial = tf.constant(0.1,shape=shape) return tf.Variable(initial)#å®šä¹‰ä¸€ä¸ªäºŒç»´çš„å·ç§¯ç¥ç»ç½‘ç»œdef conv2d(x,W): # strides=[1,x_movesize,y_movesize,1] return tf.nn.conv2d(x,W,strides=[1,1,1,1],padding=&#x27;SAME&#x27;)def max_pool_2x2(x): return tf.nn.max_pool(x,ksize=[1,2,2,1],strides=[1,2,2,1],padding=&#x27;SAME&#x27;)# define placeholder for inputs to networkxs = tf.placeholder(tf.float32, [None, 784]) # 28x28ys = tf.placeholder(tf.float32, [None, 10])keep_prob = tf.placeholder(tf.float32) # -1 è¡¨ç¤ºæš‚æ—¶ä¸è€ƒè™‘å›¾ç‰‡è¾“å…¥æ•°é‡å¤šå°‘è¿™ä¸ªç»´åº¦ï¼Œ1è¡¨ç¤ºchannelçš„æ•°é‡x_image = tf.reshape(xs,[-1,28,28,1])##conv1 layer # å·ç§¯å’Œpatch 5X5,channel 1,output height 32W_conv1 = weight_variable([5,5,1,32])b_conv1 = biase_variable([32]) #output size 28x28x32 (SAME paddingä¸æ”¹å˜é•¿å®½)h_conv1 = tf.nn.relu(conv2d(x_image,W_conv1)+b_conv1) #output size 14x14x32 (poolingçš„æ­¥é•¿æ˜¯2) h_pool1 = max_pool_2x2(h_conv1)##conv2 layerW_conv2 = weight_variable([5,5,32,64])b_conv2 = biase_variable([64]) #output size 14x14x64 (SAME paddingä¸æ”¹å˜é•¿å®½)h_conv2 = tf.nn.relu(conv2d(h_pool1,W_conv2)+b_conv2) #output size 7x7x64 (poolingçš„æ­¥é•¿æ˜¯2) h_pool2 = max_pool_2x2(h_conv2)##func1 layerW_fc1 = weight_variable([7*7*64,1024])b_fc1 = biase_variable([1024]) #[n_samples,7,7,64] &gt;&gt; [n_samples,7*7*64]h_pool2_flat = tf.reshape(h_pool2,[-1,7*7*64])h_fc1 = tf.nn.relu(tf.matmul(h_pool2_flat,W_fc1)+b_fc1)h_fc1_drop = tf.nn.dropout(h_fc1,keep_prob)## func2 layerW_fc2 = weight_variable([1024,10])b_fc2 = biase_variable([10])prediction = tf.nn.softmax(tf.matmul(h_fc1_drop,W_fc2)+b_fc2)# the error between prediction and real datacross_entropy = tf.reduce_mean(-tf.reduce_sum(ys * tf.log(prediction), reduction_indices=[1])) # losstrain_step = tf.train.AdamOptimizer(1e-4).minimize(cross_entropy)sess = tf.Session()# important stepinit = tf.global_variables_initializer()sess.run(init)for i in range(1000): batch_xs, batch_ys = mnist.train.next_batch(100) sess.run(train_step, feed_dict=&#123;xs: batch_xs, ys: batch_ys,keep_prob:0.5&#125;) if i % 50 == 0: print(compute_accuracy(mnist.test.images, mnist.test.labels)) RNN ç”¨æ¥åšclassificationçš„ä¾‹å­ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242# -*- coding: utf-8 -*-&quot;&quot;&quot;Created on Mon Jul 2 15:04:48 2018@author: Arrow&quot;&quot;&quot;import tensorflow as tffrom tensorflow.examples.tutorials.mnist import input_data# set random seed for comparing the two result calculationstf.set_random_seed(1)# this is datamnist = input_data.read_data_sets(&#x27;MNIST_data&#x27;, one_hot=True)# hyperparameterslr = 0.001training_iters = 100000batch_size = 128n_inputs = 28 # MNIST data input (img shape: 28*28)n_steps = 28 # time stepsn_hidden_units = 128 # neurons in hidden layern_classes = 10 # MNIST classes (0-9 digits)# tf Graph inputx = tf.placeholder(tf.float32, [None, n_steps, n_inputs])y = tf.placeholder(tf.float32, [None, n_classes])# Define weightsweights = &#123; # (28, 128) &#x27;in&#x27;: tf.Variable(tf.random_normal([n_inputs, n_hidden_units])), # (128, 10) &#x27;out&#x27;: tf.Variable(tf.random_normal([n_hidden_units, n_classes]))&#125;biases = &#123; # (128, ) &#x27;in&#x27;: tf.Variable(tf.constant(0.1, shape=[n_hidden_units, ])), # (10, ) &#x27;out&#x27;: tf.Variable(tf.constant(0.1, shape=[n_classes, ]))&#125;def RNN(X, weights, biases): # hidden layer for input to cell ######################################## # transpose the inputs shape from # X ==&gt; (128 batch * 28 steps, 28 inputs) X = tf.reshape(X, [-1, n_inputs]) # into hidden # X_in = (128 batch * 28 steps, 128 hidden) X_in = tf.matmul(X, weights[&#x27;in&#x27;]) + biases[&#x27;in&#x27;] # X_in ==&gt; (128 batch, 28 steps, 128 hidden) X_in = tf.reshape(X_in, [-1, n_steps, n_hidden_units]) # cell ########################################## # basic LSTM Cell. if int((tf.__version__).split(&#x27;.&#x27;)[1]) &lt; 12 and int((tf.__version__).split(&#x27;.&#x27;)[0]) &lt; 1: cell = tf.nn.rnn_cell.BasicLSTMCell(n_hidden_units, forget_bias=1.0, state_is_tuple=True) else: cell = tf.contrib.rnn.BasicLSTMCell(n_hidden_units) # lstm cell is divided into two parts (c_state, h_state) init_state = cell.zero_state(batch_size, dtype=tf.float32) # You have 2 options for following step. # 1: tf.nn.rnn(cell, inputs); # 2: tf.nn.dynamic_rnn(cell, inputs). # If use option 1, you have to modified the shape of X_in, go and check out this: # https://github.com/aymericdamien/TensorFlow-Examples/blob/master/examples/3_NeuralNetworks/recurrent_network.py # In here, we go for option 2. # dynamic_rnn receive Tensor (batch, steps, inputs) or (steps, batch, inputs) as X_in. # Make sure the time_major is changed accordingly. outputs, final_state = tf.nn.dynamic_rnn(cell, X_in, initial_state=init_state, time_major=False) # hidden layer for output as the final results ############################################# # results = tf.matmul(final_state[1], weights[&#x27;out&#x27;]) + biases[&#x27;out&#x27;] # # or # unpack to list [(batch, outputs)..] * steps if int((tf.__version__).split(&#x27;.&#x27;)[1]) &lt; 12 and int((tf.__version__).split(&#x27;.&#x27;)[0]) &lt; 1: outputs = tf.unpack(tf.transpose(outputs, [1, 0, 2])) # states is the last outputs else: outputs = tf.unstack(tf.transpose(outputs, [1,0,2])) results = tf.matmul(outputs[-1], weights[&#x27;out&#x27;]) + biases[&#x27;out&#x27;] # shape = (128, 10) return resultspred = RNN(x, weights, biases)cost = tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits(logits=pred, labels=y))train_op = tf.train.AdamOptimizer(lr).minimize(cost)# tf.argmax()ç”¨æ¥è¿”å›å½“å‰å‘é‡æœ€å¤§å€¼çš„ç´¢å¼•ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯1è¡¨ç¤ºæŒ‰è¡Œï¼Œæ˜¯0è¡¨ç¤ºæŒ‰åˆ—correct_pred = tf.equal(tf.argmax(pred, 1), tf.argmax(y, 1))accuracy = tf.reduce_mean(tf.cast(correct_pred, tf.float32))with tf.Session() as sess: # tf.initialize_all_variables() no long valid from # 2017-03-02 if using tensorflow &gt;= 0.12 if int((tf.__version__).split(&#x27;.&#x27;)[1]) &lt; 12 and int((tf.__version__).split(&#x27;.&#x27;)[0]) &lt; 1: init = tf.initialize_all_variables() else: init = tf.global_variables_initializer() sess.run(init) step = 0 while step * batch_size &lt; training_iters: batch_xs, batch_ys = mnist.train.next_batch(batch_size) batch_xs = batch_xs.reshape([batch_size, n_steps, n_inputs]) sess.run([train_op], feed_dict=&#123; x: batch_xs, y: batch_ys, &#125;) if step % 20 == 0: print(sess.run(accuracy, feed_dict=&#123; x: batch_xs, y: batch_ys, &#125;)) step += 1 CNNåšregressionçš„ä¾‹å­ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667&quot;&quot;&quot;Know more, visit my Python tutorial page: https://morvanzhou.github.io/tutorials/My Youtube Channel: https://www.youtube.com/user/MorvanZhouDependencies:tensorflow: 1.1.0matplotlibnumpy&quot;&quot;&quot;import tensorflow as tfimport numpy as npimport matplotlib.pyplot as plt# Hyper ParametersTIME_STEP = 10 # rnn time stepINPUT_SIZE = 1 # rnn input sizeCELL_SIZE = 32 # rnn cell sizeLR = 0.02 # learning rate# show datasteps = np.linspace(0, np.pi*2, 100, dtype=np.float32)x_np = np.sin(steps); y_np = np.cos(steps) # float32 for converting torch FloatTensorplt.plot(steps, y_np, &#x27;r-&#x27;, label=&#x27;target (cos)&#x27;); plt.plot(steps, x_np, &#x27;b-&#x27;, label=&#x27;input (sin)&#x27;)plt.legend(loc=&#x27;best&#x27;); plt.show()# tensorflow placeholderstf_x = tf.placeholder(tf.float32, [None, TIME_STEP, INPUT_SIZE]) # shape(batch, 5, 1)tf_y = tf.placeholder(tf.float32, [None, TIME_STEP, INPUT_SIZE]) # input y# RNNrnn_cell = tf.contrib.rnn.BasicRNNCell(num_units=CELL_SIZE)init_s = rnn_cell.zero_state(batch_size=1, dtype=tf.float32) # very first hidden stateoutputs, final_s = tf.nn.dynamic_rnn( rnn_cell, # cell you have chosen tf_x, # input initial_state=init_s, # the initial hidden state time_major=False, # False: (batch, time step, input); True: (time step, batch, input))outs2D = tf.reshape(outputs, [-1, CELL_SIZE]) # reshape 3D output to 2D for fully connected layernet_outs2D = tf.layers.dense(outs2D, INPUT_SIZE)outs = tf.reshape(net_outs2D, [-1, TIME_STEP, INPUT_SIZE]) # reshape back to 3Dloss = tf.losses.mean_squared_error(labels=tf_y, predictions=outs) # compute costtrain_op = tf.train.AdamOptimizer(LR).minimize(loss)sess = tf.Session()sess.run(tf.global_variables_initializer()) # initialize var in graphplt.figure(1, figsize=(12, 5)); plt.ion() # continuously plotfor step in range(60): start, end = step * np.pi, (step+1)*np.pi # time range # use sin predicts cos steps = np.linspace(start, end, TIME_STEP) x = np.sin(steps)[np.newaxis, :, np.newaxis] # shape (batch, time_step, input_size) y = np.cos(steps)[np.newaxis, :, np.newaxis] if &#x27;final_s_&#x27; not in globals(): # first state, no any hidden state feed_dict = &#123;tf_x: x, tf_y: y&#125; else: # has hidden state, so pass it to rnn feed_dict = &#123;tf_x: x, tf_y: y, init_s: final_s_&#125; _, pred_, final_s_ = sess.run([train_op, outs, final_s], feed_dict) # train # plotting plt.plot(steps, y.flatten(), &#x27;r-&#x27;); plt.plot(steps, pred_.flatten(), &#x27;b-&#x27;) plt.ylim((-1.2, 1.2)); plt.draw(); plt.pause(0.05)plt.ioff(); plt.show() ä¸Šè¿°ä¾‹å­ä¸­ï¼Œshapeçš„å˜åŒ–å¾ˆçƒ¦äººå‘ ç»¼åˆä¸Šè¿°ä¸¤ä¸ªä¾‹å­ï¼ŒLSTMRNNçš„æ ¸å¿ƒè¿‡ç¨‹ï¼Œinput_layer,cell,output_layer,å¯¹æ­¤tensorflowå·²ç»ä¸ºæˆ‘ä»¬åšäº†å¾ˆå¤§çš„é›†æˆå·¥ä½œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œinput_layeré˜¶æ®µéœ€è¦è¿›è¡Œreshape,ä¸è¿‡ç”¨å¿ƒçš„tf apiä¼¼ä¹æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œç„¶åå°±æ˜¯output_layeréƒ¨åˆ†ä¹Ÿè¦reshape,cellé˜¶æ®µä¸»è¦æ˜¯æ„å»ºcell, init state,å¹¶æ‰§è¡ŒRNNï¼Œæ¡†æ¶å¤§æ¦‚å°±æ˜¯iè¿™æ ·äº†ã€‚ æŸå¤±å‡½æ•°å¯¹æŸå¤±å‡½æ•°æ±‚å¯¼ï¼Œä»è€ŒçŸ¥é“å¦‚ä½•è°ƒèŠ‚å‚æ•°èƒ½å¤Ÿä½¿æŸå¤±å‡½æ•°è¶…é™ä½çš„æ–¹å‘å‘å±•ã€‚ ä¸Šå›¾å°±æ˜¯ä¸€ä¸ªç”¨äºè®­ç»ƒæ¨¡å‹çš„è¿­ä»£çš„æ–¹æ³•ã€‚ æ¢¯åº¦ä¸‹é™æ³•æ¢¯åº¦ï¼Œæ˜¯ç”±åå¯¼æ•°ç»„æˆçš„çŸ¢é‡ï¼Œè€Œåå¯¼æ•°ï¼ŒæŒ‡çš„æ˜¯å¤šå…ƒå‡½æ•°å¯¹æŸä¸€ä¸ªè‡ªå˜é‡çš„å¯¼æ•°ï¼ˆä¿æŒå…¶ä»–å˜é‡ä¸å˜ï¼‰ï¼Œåå¯¼æ•°åœ¨å‡ ä½•ä¸Šååº”å‡ºæ¥çš„å°±æ˜¯è¿™ä¸ªå‡½æ•°æ²¿ç€è¯¥è‡ªå˜é‡ç»´åº¦çš„ä¸€ä¸ªå¢å‡æƒ…å†µï¼Œæ‰€ä»¥ç”±åå¯¼æ•°ç»„æˆçš„æ¢¯åº¦ï¼Œå°±å¯ä»¥æè¿°å‡½æ•°åœ¨æ•´ä¸ªå®šä¹‰åŸŸä¸Šçš„ä¸€ä¸ªèµ·ä¼æƒ…å†µã€‚ é€šè¿‡æ¢¯åº¦ä¸‹é™çš„æ–¹æ³•ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ›´å¿«çš„æ‰¾åˆ°æŸå¤±æœ€å°çš„ç‚¹ã€‚ å­¦ä¹ é€Ÿç‡è¿™é‡Œä¼šæœ‰ä¸€ä¸ªå­¦ä¹ é€Ÿç‡çš„æ¦‚å¿µï¼Œå…¶è¡¨ç¤ºæ¯æ¬¡è®­ç»ƒçš„ä¸€ä¸ªæ­¥é•¿ï¼Œå­¦ä¹ é€Ÿç‡å¹¶éè¶Šå¤§è¶Šå¥½ï¼Œå› ä¸ºæœ‰æ—¶å­¦ä¹ é€Ÿç‡äº¤å¤§æ—¶ï¼Œå¯èƒ½ç›´æ¥è·³è¿‡æŸå¤±å‡½æ•°æœ€å°çš„ç‚¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ¢¯åº¦å¤§å°ä¸º 2.5ï¼Œå­¦ä¹ é€Ÿç‡ä¸º 0.01ï¼Œåˆ™æ¢¯åº¦ä¸‹é™æ³•ç®—æ³•ä¼šé€‰æ‹©è·ç¦»å‰ä¸€ä¸ªç‚¹ 0.025 çš„ä½ç½®ä½œä¸ºä¸‹ä¸€ä¸ªç‚¹ã€‚","categories":[{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"http://example.com/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"}],"tags":[]}],"categories":[{"name":"Linux","slug":"Linux","permalink":"http://example.com/categories/Linux/"},{"name":"Java","slug":"Java","permalink":"http://example.com/categories/Java/"},{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"http://example.com/categories/%E7%BD%91%E7%BB%9C/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"},{"name":"Netty","slug":"Netty","permalink":"http://example.com/categories/Netty/"},{"name":"å®¹å™¨","slug":"å®¹å™¨","permalink":"http://example.com/categories/%E5%AE%B9%E5%99%A8/"},{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"http://example.com/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"http://example.com/categories/%E5%89%8D%E7%AB%AF/"},{"name":"Spring","slug":"Spring","permalink":"http://example.com/categories/Spring/"},{"name":"æ¡†æ¶","slug":"æ¡†æ¶","permalink":"http://example.com/categories/%E6%A1%86%E6%9E%B6/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"http://example.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"æ•°æ®ç»“æ„ä¸ç®—æ³•","slug":"æ•°æ®ç»“æ„ä¸ç®—æ³•","permalink":"http://example.com/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"},{"name":"OS","slug":"OS","permalink":"http://example.com/categories/OS/"},{"name":"æœºå™¨å­¦ä¹ ","slug":"æœºå™¨å­¦ä¹ ","permalink":"http://example.com/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"},{"name":"JavaWeb","slug":"JavaWeb","permalink":"http://example.com/categories/JavaWeb/"},{"name":"åç«¯","slug":"åç«¯","permalink":"http://example.com/categories/%E5%90%8E%E7%AB%AF/"},{"name":"æ•™ç¨‹","slug":"æ•™ç¨‹","permalink":"http://example.com/categories/%E6%95%99%E7%A8%8B/"},{"name":"java","slug":"java","permalink":"http://example.com/categories/java/"},{"name":"å­¦æœ¯","slug":"å­¦æœ¯","permalink":"http://example.com/categories/%E5%AD%A6%E6%9C%AF/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"ç§»åŠ¨å¼€å‘","slug":"ç§»åŠ¨å¼€å‘","permalink":"http://example.com/categories/%E7%A7%BB%E5%8A%A8%E5%BC%80%E5%8F%91/"},{"name":"é¢˜è§£","slug":"é¢˜è§£","permalink":"http://example.com/categories/%E9%A2%98%E8%A7%A3/"}],"tags":[{"name":"ä¸­æ–­","slug":"ä¸­æ–­","permalink":"http://example.com/tags/%E4%B8%AD%E6%96%AD/"},{"name":"å¼‚å¸¸","slug":"å¼‚å¸¸","permalink":"http://example.com/tags/%E5%BC%82%E5%B8%B8/"},{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"http://example.com/tags/%E7%BD%91%E7%BB%9C/"},{"name":"æ³›å‹","slug":"æ³›å‹","permalink":"http://example.com/tags/%E6%B3%9B%E5%9E%8B/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"http://example.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"},{"name":"Netty","slug":"Netty","permalink":"http://example.com/tags/Netty/"},{"name":"Java","slug":"Java","permalink":"http://example.com/tags/Java/"},{"name":"async","slug":"async","permalink":"http://example.com/tags/async/"},{"name":"å®¹å™¨","slug":"å®¹å™¨","permalink":"http://example.com/tags/%E5%AE%B9%E5%99%A8/"},{"name":"ç±»å¸è½½","slug":"ç±»å¸è½½","permalink":"http://example.com/tags/%E7%B1%BB%E5%8D%B8%E8%BD%BD/"},{"name":"Instrument","slug":"Instrument","permalink":"http://example.com/tags/Instrument/"},{"name":"ASM","slug":"ASM","permalink":"http://example.com/tags/ASM/"},{"name":"è·¨åŸŸ","slug":"è·¨åŸŸ","permalink":"http://example.com/tags/%E8%B7%A8%E5%9F%9F/"},{"name":"åŒæºç­–ç•¥","slug":"åŒæºç­–ç•¥","permalink":"http://example.com/tags/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/"},{"name":"Spring","slug":"Spring","permalink":"http://example.com/tags/Spring/"},{"name":"åŠ¨æ€ä»£ç†","slug":"åŠ¨æ€ä»£ç†","permalink":"http://example.com/tags/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"},{"name":"é¢ç»","slug":"é¢ç»","permalink":"http://example.com/tags/%E9%9D%A2%E7%BB%8F/"},{"name":"redis","slug":"redis","permalink":"http://example.com/tags/redis/"},{"name":"MySQL","slug":"MySQL","permalink":"http://example.com/tags/MySQL/"},{"name":"äºŒå‰æ ‘","slug":"äºŒå‰æ ‘","permalink":"http://example.com/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/"},{"name":"TCP","slug":"TCP","permalink":"http://example.com/tags/TCP/"},{"name":"TCP/IP","slug":"TCP-IP","permalink":"http://example.com/tags/TCP-IP/"},{"name":"IOæ¨¡å‹","slug":"IOæ¨¡å‹","permalink":"http://example.com/tags/IO%E6%A8%A1%E5%9E%8B/"},{"name":"JVM","slug":"JVM","permalink":"http://example.com/tags/JVM/"},{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"http://example.com/tags/%E5%B9%B6%E5%8F%91/"},{"name":"Lock","slug":"Lock","permalink":"http://example.com/tags/Lock/"},{"name":"çº¿ç¨‹æ± ","slug":"çº¿ç¨‹æ± ","permalink":"http://example.com/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/"},{"name":"æ’åº","slug":"æ’åº","permalink":"http://example.com/tags/%E6%8E%92%E5%BA%8F/"},{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"http://example.com/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/"},{"name":"finalize","slug":"finalize","permalink":"http://example.com/tags/finalize/"},{"name":"å†…éƒ¨ç±»","slug":"å†…éƒ¨ç±»","permalink":"http://example.com/tags/%E5%86%85%E9%83%A8%E7%B1%BB/"},{"name":"https","slug":"https","permalink":"http://example.com/tags/https/"},{"name":"å¼ºåŒ–å­¦ä¹ ","slug":"å¼ºåŒ–å­¦ä¹ ","permalink":"http://example.com/tags/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/"},{"name":"å…³é”®å­—","slug":"å…³é”®å­—","permalink":"http://example.com/tags/%E5%85%B3%E9%94%AE%E5%AD%97/"},{"name":"ç»§æ‰¿","slug":"ç»§æ‰¿","permalink":"http://example.com/tags/%E7%BB%A7%E6%89%BF/"},{"name":"HashMap","slug":"HashMap","permalink":"http://example.com/tags/HashMap/"},{"name":"RequestBody","slug":"RequestBody","permalink":"http://example.com/tags/RequestBody/"},{"name":"fail fast","slug":"fail-fast","permalink":"http://example.com/tags/fail-fast/"},{"name":"Nginx","slug":"Nginx","permalink":"http://example.com/tags/Nginx/"},{"name":"ç±»åŠ è½½","slug":"ç±»åŠ è½½","permalink":"http://example.com/tags/%E7%B1%BB%E5%8A%A0%E8%BD%BD/"},{"name":"volatile","slug":"volatile","permalink":"http://example.com/tags/volatile/"},{"name":"å‰‘æŒ‡offer","slug":"å‰‘æŒ‡offer","permalink":"http://example.com/tags/%E5%89%91%E6%8C%87offer/"},{"name":"é”","slug":"é”","permalink":"http://example.com/tags/%E9%94%81/"},{"name":"é›†åˆç±»","slug":"é›†åˆç±»","permalink":"http://example.com/tags/%E9%9B%86%E5%90%88%E7%B1%BB/"},{"name":"classæ–‡ä»¶","slug":"classæ–‡ä»¶","permalink":"http://example.com/tags/class%E6%96%87%E4%BB%B6/"},{"name":"IO","slug":"IO","permalink":"http://example.com/tags/IO/"},{"name":"åå°„","slug":"åå°„","permalink":"http://example.com/tags/%E5%8F%8D%E5%B0%84/"},{"name":"æ•™ç¨‹","slug":"æ•™ç¨‹","permalink":"http://example.com/tags/%E6%95%99%E7%A8%8B/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"http://example.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"Javaè™šæ‹Ÿæœº","slug":"Javaè™šæ‹Ÿæœº","permalink":"http://example.com/tags/Java%E8%99%9A%E6%8B%9F%E6%9C%BA/"},{"name":"æ•°å­¦","slug":"æ•°å­¦","permalink":"http://example.com/tags/%E6%95%B0%E5%AD%A6/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://example.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"Leetcode","slug":"Leetcode","permalink":"http://example.com/tags/Leetcode/"},{"name":"javaåŸºç¡€","slug":"javaåŸºç¡€","permalink":"http://example.com/tags/java%E5%9F%BA%E7%A1%80/"}]}